(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function o(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(c){if(c.ep)return;c.ep=!0;const u=o(c);fetch(c.href,u)}})();function makeMap(n,e){const o=Object.create(null),s=n.split(",");for(let c=0;c<s.length;c++)o[s[c]]=!0;return e?c=>!!o[c.toLowerCase()]:c=>!!o[c]}function normalizeStyle(n){if(isArray$1(n)){const e={};for(let o=0;o<n.length;o++){const s=n[o],c=isString(s)?parseStringStyle(s):normalizeStyle(s);if(c)for(const u in c)e[u]=c[u]}return e}else{if(isString(n))return n;if(isObject$3(n))return n}}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:([^]+)/,styleCommentRE=/\/\*.*?\*\//gs;function parseStringStyle(n){const e={};return n.replace(styleCommentRE,"").split(listDelimiterRE).forEach(o=>{if(o){const s=o.split(propertyDelimiterRE);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function normalizeClass(n){let e="";if(isString(n))e=n;else if(isArray$1(n))for(let o=0;o<n.length;o++){const s=normalizeClass(n[o]);s&&(e+=s+" ")}else if(isObject$3(n))for(const o in n)n[o]&&(e+=o+" ");return e.trim()}function normalizeProps(n){if(!n)return null;let{class:e,style:o}=n;return e&&!isString(e)&&(n.class=normalizeClass(e)),o&&(n.style=normalizeStyle(o)),n}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(n){return!!n||n===""}function looseCompareArrays(n,e){if(n.length!==e.length)return!1;let o=!0;for(let s=0;o&&s<n.length;s++)o=looseEqual(n[s],e[s]);return o}function looseEqual(n,e){if(n===e)return!0;let o=isDate(n),s=isDate(e);if(o||s)return o&&s?n.getTime()===e.getTime():!1;if(o=isSymbol(n),s=isSymbol(e),o||s)return n===e;if(o=isArray$1(n),s=isArray$1(e),o||s)return o&&s?looseCompareArrays(n,e):!1;if(o=isObject$3(n),s=isObject$3(e),o||s){if(!o||!s)return!1;const c=Object.keys(n).length,u=Object.keys(e).length;if(c!==u)return!1;for(const d in n){const m=n.hasOwnProperty(d),_=e.hasOwnProperty(d);if(m&&!_||!m&&_||!looseEqual(n[d],e[d]))return!1}}return String(n)===String(e)}function looseIndexOf(n,e){return n.findIndex(o=>looseEqual(o,e))}const toDisplayString=n=>isString(n)?n:n==null?"":isArray$1(n)||isObject$3(n)&&(n.toString===objectToString||!isFunction(n.toString))?JSON.stringify(n,replacer,2):String(n),replacer=(n,e)=>e&&e.__v_isRef?replacer(n,e.value):isMap(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((o,[s,c])=>(o[`${s} =>`]=c,o),{})}:isSet(e)?{[`Set(${e.size})`]:[...e.values()]}:isObject$3(e)&&!isArray$1(e)&&!isPlainObject$1(e)?String(e):e,EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,onRE=/^on[^a-z]/,isOn=n=>onRE.test(n),isModelListener=n=>n.startsWith("onUpdate:"),extend$1=Object.assign,remove$2=(n,e)=>{const o=n.indexOf(e);o>-1&&n.splice(o,1)},hasOwnProperty$1=Object.prototype.hasOwnProperty,hasOwn=(n,e)=>hasOwnProperty$1.call(n,e),isArray$1=Array.isArray,isMap=n=>toTypeString(n)==="[object Map]",isSet=n=>toTypeString(n)==="[object Set]",isDate=n=>toTypeString(n)==="[object Date]",isFunction=n=>typeof n=="function",isString=n=>typeof n=="string",isSymbol=n=>typeof n=="symbol",isObject$3=n=>n!==null&&typeof n=="object",isPromise=n=>isObject$3(n)&&isFunction(n.then)&&isFunction(n.catch),objectToString=Object.prototype.toString,toTypeString=n=>objectToString.call(n),toRawType=n=>toTypeString(n).slice(8,-1),isPlainObject$1=n=>toTypeString(n)==="[object Object]",isIntegerKey=n=>isString(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=n=>{const e=Object.create(null);return o=>e[o]||(e[o]=n(o))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(n=>n.replace(camelizeRE,(e,o)=>o?o.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(n=>n.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(n=>n.charAt(0).toUpperCase()+n.slice(1)),toHandlerKey=cacheStringFunction(n=>n?`on${capitalize(n)}`:""),hasChanged=(n,e)=>!Object.is(n,e),invokeArrayFns=(n,e)=>{for(let o=0;o<n.length;o++)n[o](e)},def=(n,e,o)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value:o})},looseToNumber=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let activeEffectScope;class EffectScope{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=activeEffectScope,!e&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const o=activeEffectScope;try{return activeEffectScope=this,e()}finally{activeEffectScope=o}}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(e){if(this._active){let o,s;for(o=0,s=this.effects.length;o<s;o++)this.effects[o].stop();for(o=0,s=this.cleanups.length;o<s;o++)this.cleanups[o]();if(this.scopes)for(o=0,s=this.scopes.length;o<s;o++)this.scopes[o].stop(!0);if(!this.detached&&this.parent&&!e){const c=this.parent.scopes.pop();c&&c!==this&&(this.parent.scopes[this.index]=c,c.index=this.index)}this.parent=void 0,this._active=!1}}}function effectScope(n){return new EffectScope(n)}function recordEffectScope(n,e=activeEffectScope){e&&e.active&&e.effects.push(n)}function getCurrentScope(){return activeEffectScope}function onScopeDispose(n){activeEffectScope&&activeEffectScope.cleanups.push(n)}const createDep=n=>{const e=new Set(n);return e.w=0,e.n=0,e},wasTracked=n=>(n.w&trackOpBit)>0,newTracked=n=>(n.n&trackOpBit)>0,initDepMarkers=({deps:n})=>{if(n.length)for(let e=0;e<n.length;e++)n[e].w|=trackOpBit},finalizeDepMarkers=n=>{const{deps:e}=n;if(e.length){let o=0;for(let s=0;s<e.length;s++){const c=e[s];wasTracked(c)&&!newTracked(c)?c.delete(n):e[o++]=c,c.w&=~trackOpBit,c.n&=~trackOpBit}e.length=o}},targetMap=new WeakMap;let effectTrackDepth=0,trackOpBit=1;const maxMarkerBits=30;let activeEffect;const ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol("");class ReactiveEffect{constructor(e,o=null,s){this.fn=e,this.scheduler=o,this.active=!0,this.deps=[],this.parent=void 0,recordEffectScope(this,s)}run(){if(!this.active)return this.fn();let e=activeEffect,o=shouldTrack;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=activeEffect,activeEffect=this,shouldTrack=!0,trackOpBit=1<<++effectTrackDepth,effectTrackDepth<=maxMarkerBits?initDepMarkers(this):cleanupEffect(this),this.fn()}finally{effectTrackDepth<=maxMarkerBits&&finalizeDepMarkers(this),trackOpBit=1<<--effectTrackDepth,activeEffect=this.parent,shouldTrack=o,this.parent=void 0,this.deferStop&&this.stop()}}stop(){activeEffect===this?this.deferStop=!0:this.active&&(cleanupEffect(this),this.onStop&&this.onStop(),this.active=!1)}}function cleanupEffect(n){const{deps:e}=n;if(e.length){for(let o=0;o<e.length;o++)e[o].delete(n);e.length=0}}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const n=trackStack.pop();shouldTrack=n===void 0?!0:n}function track(n,e,o){if(shouldTrack&&activeEffect){let s=targetMap.get(n);s||targetMap.set(n,s=new Map);let c=s.get(o);c||s.set(o,c=createDep()),trackEffects(c)}}function trackEffects(n,e){let o=!1;effectTrackDepth<=maxMarkerBits?newTracked(n)||(n.n|=trackOpBit,o=!wasTracked(n)):o=!n.has(activeEffect),o&&(n.add(activeEffect),activeEffect.deps.push(n))}function trigger(n,e,o,s,c,u){const d=targetMap.get(n);if(!d)return;let m=[];if(e==="clear")m=[...d.values()];else if(o==="length"&&isArray$1(n)){const _=Number(s);d.forEach((ue,gn)=>{(gn==="length"||gn>=_)&&m.push(ue)})}else switch(o!==void 0&&m.push(d.get(o)),e){case"add":isArray$1(n)?isIntegerKey(o)&&m.push(d.get("length")):(m.push(d.get(ITERATE_KEY)),isMap(n)&&m.push(d.get(MAP_KEY_ITERATE_KEY)));break;case"delete":isArray$1(n)||(m.push(d.get(ITERATE_KEY)),isMap(n)&&m.push(d.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(n)&&m.push(d.get(ITERATE_KEY));break}if(m.length===1)m[0]&&triggerEffects(m[0]);else{const _=[];for(const ue of m)ue&&_.push(...ue);triggerEffects(createDep(_))}}function triggerEffects(n,e){const o=isArray$1(n)?n:[...n];for(const s of o)s.computed&&triggerEffect(s);for(const s of o)s.computed||triggerEffect(s)}function triggerEffect(n,e){(n!==activeEffect||n.allowRecurse)&&(n.scheduler?n.scheduler():n.run())}function getDepFromReactive(n,e){var o;return(o=targetMap.get(n))===null||o===void 0?void 0:o.get(e)}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(isSymbol)),get$1$1=createGetter(),shallowGet=createGetter(!1,!0),readonlyGet=createGetter(!0),arrayInstrumentations=createArrayInstrumentations();function createArrayInstrumentations(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...o){const s=toRaw(this);for(let u=0,d=this.length;u<d;u++)track(s,"get",u+"");const c=s[e](...o);return c===-1||c===!1?s[e](...o.map(toRaw)):c}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...o){pauseTracking();const s=toRaw(this)[e].apply(this,o);return resetTracking(),s}}),n}function hasOwnProperty(n){const e=toRaw(this);return track(e,"has",n),e.hasOwnProperty(n)}function createGetter(n=!1,e=!1){return function(s,c,u){if(c==="__v_isReactive")return!n;if(c==="__v_isReadonly")return n;if(c==="__v_isShallow")return e;if(c==="__v_raw"&&u===(n?e?shallowReadonlyMap:readonlyMap:e?shallowReactiveMap:reactiveMap).get(s))return s;const d=isArray$1(s);if(!n){if(d&&hasOwn(arrayInstrumentations,c))return Reflect.get(arrayInstrumentations,c,u);if(c==="hasOwnProperty")return hasOwnProperty}const m=Reflect.get(s,c,u);return(isSymbol(c)?builtInSymbols.has(c):isNonTrackableKeys(c))||(n||track(s,"get",c),e)?m:isRef(m)?d&&isIntegerKey(c)?m:m.value:isObject$3(m)?n?readonly(m):reactive(m):m}}const set$1$1=createSetter(),shallowSet=createSetter(!0);function createSetter(n=!1){return function(o,s,c,u){let d=o[s];if(isReadonly(d)&&isRef(d)&&!isRef(c))return!1;if(!n&&(!isShallow(c)&&!isReadonly(c)&&(d=toRaw(d),c=toRaw(c)),!isArray$1(o)&&isRef(d)&&!isRef(c)))return d.value=c,!0;const m=isArray$1(o)&&isIntegerKey(s)?Number(s)<o.length:hasOwn(o,s),_=Reflect.set(o,s,c,u);return o===toRaw(u)&&(m?hasChanged(c,d)&&trigger(o,"set",s,c):trigger(o,"add",s,c)),_}}function deleteProperty(n,e){const o=hasOwn(n,e);n[e];const s=Reflect.deleteProperty(n,e);return s&&o&&trigger(n,"delete",e,void 0),s}function has$1(n,e){const o=Reflect.has(n,e);return(!isSymbol(e)||!builtInSymbols.has(e))&&track(n,"has",e),o}function ownKeys(n){return track(n,"iterate",isArray$1(n)?"length":ITERATE_KEY),Reflect.ownKeys(n)}const mutableHandlers={get:get$1$1,set:set$1$1,deleteProperty,has:has$1,ownKeys},readonlyHandlers={get:readonlyGet,set(n,e){return!0},deleteProperty(n,e){return!0}},shallowReactiveHandlers=extend$1({},mutableHandlers,{get:shallowGet,set:shallowSet}),toShallow=n=>n,getProto=n=>Reflect.getPrototypeOf(n);function get$2(n,e,o=!1,s=!1){n=n.__v_raw;const c=toRaw(n),u=toRaw(e);o||(e!==u&&track(c,"get",e),track(c,"get",u));const{has:d}=getProto(c),m=s?toShallow:o?toReadonly:toReactive;if(d.call(c,e))return m(n.get(e));if(d.call(c,u))return m(n.get(u));n!==c&&n.get(e)}function has(n,e=!1){const o=this.__v_raw,s=toRaw(o),c=toRaw(n);return e||(n!==c&&track(s,"has",n),track(s,"has",c)),n===c?o.has(n):o.has(n)||o.has(c)}function size(n,e=!1){return n=n.__v_raw,!e&&track(toRaw(n),"iterate",ITERATE_KEY),Reflect.get(n,"size",n)}function add$1(n){n=toRaw(n);const e=toRaw(this);return getProto(e).has.call(e,n)||(e.add(n),trigger(e,"add",n,n)),this}function set$2(n,e){e=toRaw(e);const o=toRaw(this),{has:s,get:c}=getProto(o);let u=s.call(o,n);u||(n=toRaw(n),u=s.call(o,n));const d=c.call(o,n);return o.set(n,e),u?hasChanged(e,d)&&trigger(o,"set",n,e):trigger(o,"add",n,e),this}function deleteEntry(n){const e=toRaw(this),{has:o,get:s}=getProto(e);let c=o.call(e,n);c||(n=toRaw(n),c=o.call(e,n)),s&&s.call(e,n);const u=e.delete(n);return c&&trigger(e,"delete",n,void 0),u}function clear(){const n=toRaw(this),e=n.size!==0,o=n.clear();return e&&trigger(n,"clear",void 0,void 0),o}function createForEach(n,e){return function(s,c){const u=this,d=u.__v_raw,m=toRaw(d),_=e?toShallow:n?toReadonly:toReactive;return!n&&track(m,"iterate",ITERATE_KEY),d.forEach((ue,gn)=>s.call(c,_(ue),_(gn),u))}}function createIterableMethod(n,e,o){return function(...s){const c=this.__v_raw,u=toRaw(c),d=isMap(u),m=n==="entries"||n===Symbol.iterator&&d,_=n==="keys"&&d,ue=c[n](...s),gn=o?toShallow:e?toReadonly:toReactive;return!e&&track(u,"iterate",_?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:nh,done:ih}=ue.next();return ih?{value:nh,done:ih}:{value:m?[gn(nh[0]),gn(nh[1])]:gn(nh),done:ih}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(n){return function(...e){return n==="delete"?!1:this}}function createInstrumentations(){const n={get(u){return get$2(this,u)},get size(){return size(this)},has,add:add$1,set:set$2,delete:deleteEntry,clear,forEach:createForEach(!1,!1)},e={get(u){return get$2(this,u,!1,!0)},get size(){return size(this)},has,add:add$1,set:set$2,delete:deleteEntry,clear,forEach:createForEach(!1,!0)},o={get(u){return get$2(this,u,!0)},get size(){return size(this,!0)},has(u){return has.call(this,u,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},s={get(u){return get$2(this,u,!0,!0)},get size(){return size(this,!0)},has(u){return has.call(this,u,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(u=>{n[u]=createIterableMethod(u,!1,!1),o[u]=createIterableMethod(u,!0,!1),e[u]=createIterableMethod(u,!1,!0),s[u]=createIterableMethod(u,!0,!0)}),[n,o,e,s]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(n,e){const o=e?n?shallowReadonlyInstrumentations:shallowInstrumentations:n?readonlyInstrumentations:mutableInstrumentations;return(s,c,u)=>c==="__v_isReactive"?!n:c==="__v_isReadonly"?n:c==="__v_raw"?s:Reflect.get(hasOwn(o,c)&&c in s?o:s,c,u)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(n){return n.__v_skip||!Object.isExtensible(n)?0:targetTypeMap(toRawType(n))}function reactive(n){return isReadonly(n)?n:createReactiveObject(n,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(n){return createReactiveObject(n,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(n){return createReactiveObject(n,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function createReactiveObject(n,e,o,s,c){if(!isObject$3(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const u=c.get(n);if(u)return u;const d=getTargetType(n);if(d===0)return n;const m=new Proxy(n,d===2?s:o);return c.set(n,m),m}function isReactive(n){return isReadonly(n)?isReactive(n.__v_raw):!!(n&&n.__v_isReactive)}function isReadonly(n){return!!(n&&n.__v_isReadonly)}function isShallow(n){return!!(n&&n.__v_isShallow)}function isProxy(n){return isReactive(n)||isReadonly(n)}function toRaw(n){const e=n&&n.__v_raw;return e?toRaw(e):n}function markRaw(n){return def(n,"__v_skip",!0),n}const toReactive=n=>isObject$3(n)?reactive(n):n,toReadonly=n=>isObject$3(n)?readonly(n):n;function trackRefValue(n){shouldTrack&&activeEffect&&(n=toRaw(n),trackEffects(n.dep||(n.dep=createDep())))}function triggerRefValue(n,e){n=toRaw(n);const o=n.dep;o&&triggerEffects(o)}function isRef(n){return!!(n&&n.__v_isRef===!0)}function ref$1(n){return createRef(n,!1)}function shallowRef(n){return createRef(n,!0)}function createRef(n,e){return isRef(n)?n:new RefImpl(n,e)}class RefImpl{constructor(e,o){this.__v_isShallow=o,this.dep=void 0,this.__v_isRef=!0,this._rawValue=o?e:toRaw(e),this._value=o?e:toReactive(e)}get value(){return trackRefValue(this),this._value}set value(e){const o=this.__v_isShallow||isShallow(e)||isReadonly(e);e=o?e:toRaw(e),hasChanged(e,this._rawValue)&&(this._rawValue=e,this._value=o?e:toReactive(e),triggerRefValue(this))}}function unref(n){return isRef(n)?n.value:n}const shallowUnwrapHandlers={get:(n,e,o)=>unref(Reflect.get(n,e,o)),set:(n,e,o,s)=>{const c=n[e];return isRef(c)&&!isRef(o)?(c.value=o,!0):Reflect.set(n,e,o,s)}};function proxyRefs(n){return isReactive(n)?n:new Proxy(n,shallowUnwrapHandlers)}class CustomRefImpl{constructor(e){this.dep=void 0,this.__v_isRef=!0;const{get:o,set:s}=e(()=>trackRefValue(this),()=>triggerRefValue(this));this._get=o,this._set=s}get value(){return this._get()}set value(e){this._set(e)}}function customRef(n){return new CustomRefImpl(n)}function toRefs(n){const e=isArray$1(n)?new Array(n.length):{};for(const o in n)e[o]=toRef(n,o);return e}class ObjectRefImpl{constructor(e,o,s){this._object=e,this._key=o,this._defaultValue=s,this.__v_isRef=!0}get value(){const e=this._object[this._key];return e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return getDepFromReactive(toRaw(this._object),this._key)}}function toRef(n,e,o){const s=n[e];return isRef(s)?s:new ObjectRefImpl(n,e,o)}var _a$1$1;class ComputedRefImpl{constructor(e,o,s,c){this._setter=o,this.dep=void 0,this.__v_isRef=!0,this[_a$1$1]=!1,this._dirty=!0,this.effect=new ReactiveEffect(e,()=>{this._dirty||(this._dirty=!0,triggerRefValue(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!c,this.__v_isReadonly=s}get value(){const e=toRaw(this);return trackRefValue(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}_a$1$1="__v_isReadonly";function computed$1(n,e,o=!1){let s,c;const u=isFunction(n);return u?(s=n,c=NOOP):(s=n.get,c=n.set),new ComputedRefImpl(s,c,u||!c,o)}function warn$1(n,...e){}function callWithErrorHandling(n,e,o,s){let c;try{c=s?n(...s):n()}catch(u){handleError(u,e,o)}return c}function callWithAsyncErrorHandling(n,e,o,s){if(isFunction(n)){const u=callWithErrorHandling(n,e,o,s);return u&&isPromise(u)&&u.catch(d=>{handleError(d,e,o)}),u}const c=[];for(let u=0;u<n.length;u++)c.push(callWithAsyncErrorHandling(n[u],e,o,s));return c}function handleError(n,e,o,s=!0){const c=e?e.vnode:null;if(e){let u=e.parent;const d=e.proxy,m=o;for(;u;){const ue=u.ec;if(ue){for(let gn=0;gn<ue.length;gn++)if(ue[gn](n,d,m)===!1)return}u=u.parent}const _=e.appContext.config.errorHandler;if(_){callWithErrorHandling(_,null,10,[n,d,m]);return}}logError(n,o,c,s)}function logError(n,e,o,s=!0){console.error(n)}let isFlushing=!1,isFlushPending=!1;const queue=[];let flushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick(n){const e=currentFlushPromise||resolvedPromise;return n?e.then(this?n.bind(this):n):e}function findInsertionIndex(n){let e=flushIndex+1,o=queue.length;for(;e<o;){const s=e+o>>>1;getId(queue[s])<n?e=s+1:o=s}return e}function queueJob(n){(!queue.length||!queue.includes(n,isFlushing&&n.allowRecurse?flushIndex+1:flushIndex))&&(n.id==null?queue.push(n):queue.splice(findInsertionIndex(n.id),0,n),queueFlush())}function queueFlush(){!isFlushing&&!isFlushPending&&(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function invalidateJob(n){const e=queue.indexOf(n);e>flushIndex&&queue.splice(e,1)}function queuePostFlushCb(n){isArray$1(n)?pendingPostFlushCbs.push(...n):(!activePostFlushCbs||!activePostFlushCbs.includes(n,n.allowRecurse?postFlushIndex+1:postFlushIndex))&&pendingPostFlushCbs.push(n),queueFlush()}function flushPreFlushCbs(n,e=isFlushing?flushIndex+1:0){for(;e<queue.length;e++){const o=queue[e];o&&o.pre&&(queue.splice(e,1),e--,o())}}function flushPostFlushCbs(n){if(pendingPostFlushCbs.length){const e=[...new Set(pendingPostFlushCbs)];if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...e);return}for(activePostFlushCbs=e,activePostFlushCbs.sort((o,s)=>getId(o)-getId(s)),postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++)activePostFlushCbs[postFlushIndex]();activePostFlushCbs=null,postFlushIndex=0}}const getId=n=>n.id==null?1/0:n.id,comparator=(n,e)=>{const o=getId(n)-getId(e);if(o===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return o};function flushJobs(n){isFlushPending=!1,isFlushing=!0,queue.sort(comparator);const e=NOOP;try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const o=queue[flushIndex];o&&o.active!==!1&&callWithErrorHandling(o,null,14)}}finally{flushIndex=0,queue.length=0,flushPostFlushCbs(),isFlushing=!1,currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs()}}function emit(n,e,...o){if(n.isUnmounted)return;const s=n.vnode.props||EMPTY_OBJ;let c=o;const u=e.startsWith("update:"),d=u&&e.slice(7);if(d&&d in s){const gn=`${d==="modelValue"?"model":d}Modifiers`,{number:nh,trim:ih}=s[gn]||EMPTY_OBJ;ih&&(c=o.map(rh=>isString(rh)?rh.trim():rh)),nh&&(c=o.map(looseToNumber))}let m,_=s[m=toHandlerKey(e)]||s[m=toHandlerKey(camelize(e))];!_&&u&&(_=s[m=toHandlerKey(hyphenate(e))]),_&&callWithAsyncErrorHandling(_,n,6,c);const ue=s[m+"Once"];if(ue){if(!n.emitted)n.emitted={};else if(n.emitted[m])return;n.emitted[m]=!0,callWithAsyncErrorHandling(ue,n,6,c)}}function normalizeEmitsOptions(n,e,o=!1){const s=e.emitsCache,c=s.get(n);if(c!==void 0)return c;const u=n.emits;let d={},m=!1;if(!isFunction(n)){const _=ue=>{const gn=normalizeEmitsOptions(ue,e,!0);gn&&(m=!0,extend$1(d,gn))};!o&&e.mixins.length&&e.mixins.forEach(_),n.extends&&_(n.extends),n.mixins&&n.mixins.forEach(_)}return!u&&!m?(isObject$3(n)&&s.set(n,null),null):(isArray$1(u)?u.forEach(_=>d[_]=null):extend$1(d,u),isObject$3(n)&&s.set(n,d),d)}function isEmitListener(n,e){return!n||!isOn(e)?!1:(e=e.slice(2).replace(/Once$/,""),hasOwn(n,e[0].toLowerCase()+e.slice(1))||hasOwn(n,hyphenate(e))||hasOwn(n,e))}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(n){const e=currentRenderingInstance;return currentRenderingInstance=n,currentScopeId=n&&n.type.__scopeId||null,e}function pushScopeId(n){currentScopeId=n}function popScopeId(){currentScopeId=null}function withCtx(n,e=currentRenderingInstance,o){if(!e||n._n)return n;const s=(...c)=>{s._d&&setBlockTracking(-1);const u=setCurrentRenderingInstance(e);let d;try{d=n(...c)}finally{setCurrentRenderingInstance(u),s._d&&setBlockTracking(1)}return d};return s._n=!0,s._c=!0,s._d=!0,s}function markAttrsAccessed(){}function renderComponentRoot(n){const{type:e,vnode:o,proxy:s,withProxy:c,props:u,propsOptions:[d],slots:m,attrs:_,emit:ue,render:gn,renderCache:nh,data:ih,setupState:rh,ctx:oh,inheritAttrs:lh}=n;let ch,dh;const _h=setCurrentRenderingInstance(n);try{if(o.shapeFlag&4){const fh=c||s;ch=normalizeVNode(gn.call(fh,fh,nh,u,rh,ih,oh)),dh=_}else{const fh=e;ch=normalizeVNode(fh.length>1?fh(u,{attrs:_,slots:m,emit:ue}):fh(u,null)),dh=e.props?_:getFunctionalFallthrough(_)}}catch(fh){blockStack.length=0,handleError(fh,n,1),ch=createVNode(Comment)}let Sh=ch;if(dh&&lh!==!1){const fh=Object.keys(dh),{shapeFlag:yh}=Sh;fh.length&&yh&7&&(d&&fh.some(isModelListener)&&(dh=filterModelListeners(dh,d)),Sh=cloneVNode(Sh,dh))}return o.dirs&&(Sh=cloneVNode(Sh),Sh.dirs=Sh.dirs?Sh.dirs.concat(o.dirs):o.dirs),o.transition&&(Sh.transition=o.transition),ch=Sh,setCurrentRenderingInstance(_h),ch}const getFunctionalFallthrough=n=>{let e;for(const o in n)(o==="class"||o==="style"||isOn(o))&&((e||(e={}))[o]=n[o]);return e},filterModelListeners=(n,e)=>{const o={};for(const s in n)(!isModelListener(s)||!(s.slice(9)in e))&&(o[s]=n[s]);return o};function shouldUpdateComponent(n,e,o){const{props:s,children:c,component:u}=n,{props:d,children:m,patchFlag:_}=e,ue=u.emitsOptions;if(e.dirs||e.transition)return!0;if(o&&_>=0){if(_&1024)return!0;if(_&16)return s?hasPropsChanged(s,d,ue):!!d;if(_&8){const gn=e.dynamicProps;for(let nh=0;nh<gn.length;nh++){const ih=gn[nh];if(d[ih]!==s[ih]&&!isEmitListener(ue,ih))return!0}}}else return(c||m)&&(!m||!m.$stable)?!0:s===d?!1:s?d?hasPropsChanged(s,d,ue):!0:!!d;return!1}function hasPropsChanged(n,e,o){const s=Object.keys(e);if(s.length!==Object.keys(n).length)return!0;for(let c=0;c<s.length;c++){const u=s[c];if(e[u]!==n[u]&&!isEmitListener(o,u))return!0}return!1}function updateHOCHostEl({vnode:n,parent:e},o){for(;e&&e.subTree===n;)(n=e.vnode).el=o,e=e.parent}const isSuspense=n=>n.__isSuspense;function queueEffectWithSuspense(n,e){e&&e.pendingBranch?isArray$1(n)?e.effects.push(...n):e.effects.push(n):queuePostFlushCb(n)}function provide(n,e){if(currentInstance){let o=currentInstance.provides;const s=currentInstance.parent&&currentInstance.parent.provides;s===o&&(o=currentInstance.provides=Object.create(s)),o[n]=e}}function inject(n,e,o=!1){const s=currentInstance||currentRenderingInstance;if(s){const c=s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides;if(c&&n in c)return c[n];if(arguments.length>1)return o&&isFunction(e)?e.call(s.proxy):e}}function watchEffect(n,e){return doWatch(n,null,e)}const INITIAL_WATCHER_VALUE={};function watch(n,e,o){return doWatch(n,e,o)}function doWatch(n,e,{immediate:o,deep:s,flush:c,onTrack:u,onTrigger:d}=EMPTY_OBJ){const m=getCurrentScope()===(currentInstance==null?void 0:currentInstance.scope)?currentInstance:null;let _,ue=!1,gn=!1;if(isRef(n)?(_=()=>n.value,ue=isShallow(n)):isReactive(n)?(_=()=>n,s=!0):isArray$1(n)?(gn=!0,ue=n.some(Sh=>isReactive(Sh)||isShallow(Sh)),_=()=>n.map(Sh=>{if(isRef(Sh))return Sh.value;if(isReactive(Sh))return traverse(Sh);if(isFunction(Sh))return callWithErrorHandling(Sh,m,2)})):isFunction(n)?e?_=()=>callWithErrorHandling(n,m,2):_=()=>{if(!(m&&m.isUnmounted))return nh&&nh(),callWithAsyncErrorHandling(n,m,3,[ih])}:_=NOOP,e&&s){const Sh=_;_=()=>traverse(Sh())}let nh,ih=Sh=>{nh=dh.onStop=()=>{callWithErrorHandling(Sh,m,4)}},rh;if(isInSSRComponentSetup)if(ih=NOOP,e?o&&callWithAsyncErrorHandling(e,m,3,[_(),gn?[]:void 0,ih]):_(),c==="sync"){const Sh=useSSRContext();rh=Sh.__watcherHandles||(Sh.__watcherHandles=[])}else return NOOP;let oh=gn?new Array(n.length).fill(INITIAL_WATCHER_VALUE):INITIAL_WATCHER_VALUE;const lh=()=>{if(dh.active)if(e){const Sh=dh.run();(s||ue||(gn?Sh.some((fh,yh)=>hasChanged(fh,oh[yh])):hasChanged(Sh,oh)))&&(nh&&nh(),callWithAsyncErrorHandling(e,m,3,[Sh,oh===INITIAL_WATCHER_VALUE?void 0:gn&&oh[0]===INITIAL_WATCHER_VALUE?[]:oh,ih]),oh=Sh)}else dh.run()};lh.allowRecurse=!!e;let ch;c==="sync"?ch=lh:c==="post"?ch=()=>queuePostRenderEffect(lh,m&&m.suspense):(lh.pre=!0,m&&(lh.id=m.uid),ch=()=>queueJob(lh));const dh=new ReactiveEffect(_,ch);e?o?lh():oh=dh.run():c==="post"?queuePostRenderEffect(dh.run.bind(dh),m&&m.suspense):dh.run();const _h=()=>{dh.stop(),m&&m.scope&&remove$2(m.scope.effects,dh)};return rh&&rh.push(_h),_h}function instanceWatch(n,e,o){const s=this.proxy,c=isString(n)?n.includes(".")?createPathGetter(s,n):()=>s[n]:n.bind(s,s);let u;isFunction(e)?u=e:(u=e.handler,o=e);const d=currentInstance;setCurrentInstance(this);const m=doWatch(c,u.bind(s),o);return d?setCurrentInstance(d):unsetCurrentInstance(),m}function createPathGetter(n,e){const o=e.split(".");return()=>{let s=n;for(let c=0;c<o.length&&s;c++)s=s[o[c]];return s}}function traverse(n,e){if(!isObject$3(n)||n.__v_skip||(e=e||new Set,e.has(n)))return n;if(e.add(n),isRef(n))traverse(n.value,e);else if(isArray$1(n))for(let o=0;o<n.length;o++)traverse(n[o],e);else if(isSet(n)||isMap(n))n.forEach(o=>{traverse(o,e)});else if(isPlainObject$1(n))for(const o in n)traverse(n[o],e);return n}function defineComponent(n){return isFunction(n)?{setup:n,name:n.name}:n}const isAsyncWrapper=n=>!!n.type.__asyncLoader,isKeepAlive=n=>n.type.__isKeepAlive;function onActivated(n,e){registerKeepAliveHook(n,"a",e)}function onDeactivated(n,e){registerKeepAliveHook(n,"da",e)}function registerKeepAliveHook(n,e,o=currentInstance){const s=n.__wdc||(n.__wdc=()=>{let c=o;for(;c;){if(c.isDeactivated)return;c=c.parent}return n()});if(injectHook(e,s,o),o){let c=o.parent;for(;c&&c.parent;)isKeepAlive(c.parent.vnode)&&injectToKeepAliveRoot(s,e,o,c),c=c.parent}}function injectToKeepAliveRoot(n,e,o,s){const c=injectHook(e,n,s,!0);onUnmounted(()=>{remove$2(s[e],c)},o)}function injectHook(n,e,o=currentInstance,s=!1){if(o){const c=o[n]||(o[n]=[]),u=e.__weh||(e.__weh=(...d)=>{if(o.isUnmounted)return;pauseTracking(),setCurrentInstance(o);const m=callWithAsyncErrorHandling(e,o,n,d);return unsetCurrentInstance(),resetTracking(),m});return s?c.unshift(u):c.push(u),u}}const createHook=n=>(e,o=currentInstance)=>(!isInSSRComponentSetup||n==="sp")&&injectHook(n,(...s)=>e(...s),o),onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(n,e=currentInstance){injectHook("ec",n,e)}function withDirectives(n,e){const o=currentRenderingInstance;if(o===null)return n;const s=getExposeProxy(o)||o.proxy,c=n.dirs||(n.dirs=[]);for(let u=0;u<e.length;u++){let[d,m,_,ue=EMPTY_OBJ]=e[u];d&&(isFunction(d)&&(d={mounted:d,updated:d}),d.deep&&traverse(m),c.push({dir:d,instance:s,value:m,oldValue:void 0,arg:_,modifiers:ue}))}return n}function invokeDirectiveHook(n,e,o,s){const c=n.dirs,u=e&&e.dirs;for(let d=0;d<c.length;d++){const m=c[d];u&&(m.oldValue=u[d].value);let _=m.dir[s];_&&(pauseTracking(),callWithAsyncErrorHandling(_,o,8,[n.el,m,n,e]),resetTracking())}}const COMPONENTS="components";function resolveComponent(n,e){return resolveAsset(COMPONENTS,n,!0,e)||n}const NULL_DYNAMIC_COMPONENT=Symbol();function resolveDynamicComponent(n){return isString(n)?resolveAsset(COMPONENTS,n,!1)||n:n||NULL_DYNAMIC_COMPONENT}function resolveAsset(n,e,o=!0,s=!1){const c=currentRenderingInstance||currentInstance;if(c){const u=c.type;if(n===COMPONENTS){const m=getComponentName(u,!1);if(m&&(m===e||m===camelize(e)||m===capitalize(camelize(e))))return u}const d=resolve(c[n]||u[n],e)||resolve(c.appContext[n],e);return!d&&s?u:d}}function resolve(n,e){return n&&(n[e]||n[camelize(e)]||n[capitalize(camelize(e))])}function renderList(n,e,o,s){let c;const u=o&&o[s];if(isArray$1(n)||isString(n)){c=new Array(n.length);for(let d=0,m=n.length;d<m;d++)c[d]=e(n[d],d,void 0,u&&u[d])}else if(typeof n=="number"){c=new Array(n);for(let d=0;d<n;d++)c[d]=e(d+1,d,void 0,u&&u[d])}else if(isObject$3(n))if(n[Symbol.iterator])c=Array.from(n,(d,m)=>e(d,m,void 0,u&&u[m]));else{const d=Object.keys(n);c=new Array(d.length);for(let m=0,_=d.length;m<_;m++){const ue=d[m];c[m]=e(n[ue],ue,m,u&&u[m])}}else c=[];return o&&(o[s]=c),c}function renderSlot(n,e,o={},s,c){if(currentRenderingInstance.isCE||currentRenderingInstance.parent&&isAsyncWrapper(currentRenderingInstance.parent)&&currentRenderingInstance.parent.isCE)return e!=="default"&&(o.name=e),createVNode("slot",o,s&&s());let u=n[e];u&&u._c&&(u._d=!1),openBlock();const d=u&&ensureValidVNode(u(o)),m=createBlock(Fragment,{key:o.key||d&&d.key||`_${e}`},d||(s?s():[]),d&&n._===1?64:-2);return!c&&m.scopeId&&(m.slotScopeIds=[m.scopeId+"-s"]),u&&u._c&&(u._d=!0),m}function ensureValidVNode(n){return n.some(e=>isVNode(e)?!(e.type===Comment||e.type===Fragment&&!ensureValidVNode(e.children)):!0)?n:null}const getPublicInstance=n=>n?isStatefulComponent(n)?getExposeProxy(n)||n.proxy:getPublicInstance(n.parent):null,publicPropertiesMap=extend$1(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>getPublicInstance(n.parent),$root:n=>getPublicInstance(n.root),$emit:n=>n.emit,$options:n=>resolveMergedOptions(n),$forceUpdate:n=>n.f||(n.f=()=>queueJob(n.update)),$nextTick:n=>n.n||(n.n=nextTick.bind(n.proxy)),$watch:n=>instanceWatch.bind(n)}),hasSetupBinding=(n,e)=>n!==EMPTY_OBJ&&!n.__isScriptSetup&&hasOwn(n,e),PublicInstanceProxyHandlers={get({_:n},e){const{ctx:o,setupState:s,data:c,props:u,accessCache:d,type:m,appContext:_}=n;let ue;if(e[0]!=="$"){const rh=d[e];if(rh!==void 0)switch(rh){case 1:return s[e];case 2:return c[e];case 4:return o[e];case 3:return u[e]}else{if(hasSetupBinding(s,e))return d[e]=1,s[e];if(c!==EMPTY_OBJ&&hasOwn(c,e))return d[e]=2,c[e];if((ue=n.propsOptions[0])&&hasOwn(ue,e))return d[e]=3,u[e];if(o!==EMPTY_OBJ&&hasOwn(o,e))return d[e]=4,o[e];shouldCacheAccess&&(d[e]=0)}}const gn=publicPropertiesMap[e];let nh,ih;if(gn)return e==="$attrs"&&track(n,"get",e),gn(n);if((nh=m.__cssModules)&&(nh=nh[e]))return nh;if(o!==EMPTY_OBJ&&hasOwn(o,e))return d[e]=4,o[e];if(ih=_.config.globalProperties,hasOwn(ih,e))return ih[e]},set({_:n},e,o){const{data:s,setupState:c,ctx:u}=n;return hasSetupBinding(c,e)?(c[e]=o,!0):s!==EMPTY_OBJ&&hasOwn(s,e)?(s[e]=o,!0):hasOwn(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(u[e]=o,!0)},has({_:{data:n,setupState:e,accessCache:o,ctx:s,appContext:c,propsOptions:u}},d){let m;return!!o[d]||n!==EMPTY_OBJ&&hasOwn(n,d)||hasSetupBinding(e,d)||(m=u[0])&&hasOwn(m,d)||hasOwn(s,d)||hasOwn(publicPropertiesMap,d)||hasOwn(c.config.globalProperties,d)},defineProperty(n,e,o){return o.get!=null?n._.accessCache[e]=0:hasOwn(o,"value")&&this.set(n,e,o.value,null),Reflect.defineProperty(n,e,o)}};let shouldCacheAccess=!0;function applyOptions(n){const e=resolveMergedOptions(n),o=n.proxy,s=n.ctx;shouldCacheAccess=!1,e.beforeCreate&&callHook(e.beforeCreate,n,"bc");const{data:c,computed:u,methods:d,watch:m,provide:_,inject:ue,created:gn,beforeMount:nh,mounted:ih,beforeUpdate:rh,updated:oh,activated:lh,deactivated:ch,beforeDestroy:dh,beforeUnmount:_h,destroyed:Sh,unmounted:fh,render:yh,renderTracked:mh,renderTriggered:Ch,errorCaptured:Mh,serverPrefetch:Ph,expose:Eh,inheritAttrs:Nh,components:Wh,directives:Yh,filters:gh}=e;if(ue&&resolveInjections(ue,s,null,n.appContext.config.unwrapInjectedRef),d)for(const $h in d){const Rh=d[$h];isFunction(Rh)&&(s[$h]=Rh.bind(o))}if(c){const $h=c.call(o,o);isObject$3($h)&&(n.data=reactive($h))}if(shouldCacheAccess=!0,u)for(const $h in u){const Rh=u[$h],Oh=isFunction(Rh)?Rh.bind(o,o):isFunction(Rh.get)?Rh.get.bind(o,o):NOOP,Lh=!isFunction(Rh)&&isFunction(Rh.set)?Rh.set.bind(o):NOOP,qh=computed({get:Oh,set:Lh});Object.defineProperty(s,$h,{enumerable:!0,configurable:!0,get:()=>qh.value,set:Hh=>qh.value=Hh})}if(m)for(const $h in m)createWatcher(m[$h],s,o,$h);if(_){const $h=isFunction(_)?_.call(o):_;Reflect.ownKeys($h).forEach(Rh=>{provide(Rh,$h[Rh])})}gn&&callHook(gn,n,"c");function wh($h,Rh){isArray$1(Rh)?Rh.forEach(Oh=>$h(Oh.bind(o))):Rh&&$h(Rh.bind(o))}if(wh(onBeforeMount,nh),wh(onMounted,ih),wh(onBeforeUpdate,rh),wh(onUpdated,oh),wh(onActivated,lh),wh(onDeactivated,ch),wh(onErrorCaptured,Mh),wh(onRenderTracked,mh),wh(onRenderTriggered,Ch),wh(onBeforeUnmount,_h),wh(onUnmounted,fh),wh(onServerPrefetch,Ph),isArray$1(Eh))if(Eh.length){const $h=n.exposed||(n.exposed={});Eh.forEach(Rh=>{Object.defineProperty($h,Rh,{get:()=>o[Rh],set:Oh=>o[Rh]=Oh})})}else n.exposed||(n.exposed={});yh&&n.render===NOOP&&(n.render=yh),Nh!=null&&(n.inheritAttrs=Nh),Wh&&(n.components=Wh),Yh&&(n.directives=Yh)}function resolveInjections(n,e,o=NOOP,s=!1){isArray$1(n)&&(n=normalizeInject(n));for(const c in n){const u=n[c];let d;isObject$3(u)?"default"in u?d=inject(u.from||c,u.default,!0):d=inject(u.from||c):d=inject(u),isRef(d)&&s?Object.defineProperty(e,c,{enumerable:!0,configurable:!0,get:()=>d.value,set:m=>d.value=m}):e[c]=d}}function callHook(n,e,o){callWithAsyncErrorHandling(isArray$1(n)?n.map(s=>s.bind(e.proxy)):n.bind(e.proxy),e,o)}function createWatcher(n,e,o,s){const c=s.includes(".")?createPathGetter(o,s):()=>o[s];if(isString(n)){const u=e[n];isFunction(u)&&watch(c,u)}else if(isFunction(n))watch(c,n.bind(o));else if(isObject$3(n))if(isArray$1(n))n.forEach(u=>createWatcher(u,e,o,s));else{const u=isFunction(n.handler)?n.handler.bind(o):e[n.handler];isFunction(u)&&watch(c,u,n)}}function resolveMergedOptions(n){const e=n.type,{mixins:o,extends:s}=e,{mixins:c,optionsCache:u,config:{optionMergeStrategies:d}}=n.appContext,m=u.get(e);let _;return m?_=m:!c.length&&!o&&!s?_=e:(_={},c.length&&c.forEach(ue=>mergeOptions$1(_,ue,d,!0)),mergeOptions$1(_,e,d)),isObject$3(e)&&u.set(e,_),_}function mergeOptions$1(n,e,o,s=!1){const{mixins:c,extends:u}=e;u&&mergeOptions$1(n,u,o,!0),c&&c.forEach(d=>mergeOptions$1(n,d,o,!0));for(const d in e)if(!(s&&d==="expose")){const m=internalOptionMergeStrats[d]||o&&o[d];n[d]=m?m(n[d],e[d]):e[d]}return n}const internalOptionMergeStrats={data:mergeDataFn,props:mergeObjectOptions,emits:mergeObjectOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(n,e){return e?n?function(){return extend$1(isFunction(n)?n.call(this,this):n,isFunction(e)?e.call(this,this):e)}:e:n}function mergeInject(n,e){return mergeObjectOptions(normalizeInject(n),normalizeInject(e))}function normalizeInject(n){if(isArray$1(n)){const e={};for(let o=0;o<n.length;o++)e[n[o]]=n[o];return e}return n}function mergeAsArray(n,e){return n?[...new Set([].concat(n,e))]:e}function mergeObjectOptions(n,e){return n?extend$1(extend$1(Object.create(null),n),e):e}function mergeWatchOptions(n,e){if(!n)return e;if(!e)return n;const o=extend$1(Object.create(null),n);for(const s in e)o[s]=mergeAsArray(n[s],e[s]);return o}function initProps(n,e,o,s=!1){const c={},u={};def(u,InternalObjectKey,1),n.propsDefaults=Object.create(null),setFullProps(n,e,c,u);for(const d in n.propsOptions[0])d in c||(c[d]=void 0);o?n.props=s?c:shallowReactive(c):n.type.props?n.props=c:n.props=u,n.attrs=u}function updateProps(n,e,o,s){const{props:c,attrs:u,vnode:{patchFlag:d}}=n,m=toRaw(c),[_]=n.propsOptions;let ue=!1;if((s||d>0)&&!(d&16)){if(d&8){const gn=n.vnode.dynamicProps;for(let nh=0;nh<gn.length;nh++){let ih=gn[nh];if(isEmitListener(n.emitsOptions,ih))continue;const rh=e[ih];if(_)if(hasOwn(u,ih))rh!==u[ih]&&(u[ih]=rh,ue=!0);else{const oh=camelize(ih);c[oh]=resolvePropValue(_,m,oh,rh,n,!1)}else rh!==u[ih]&&(u[ih]=rh,ue=!0)}}}else{setFullProps(n,e,c,u)&&(ue=!0);let gn;for(const nh in m)(!e||!hasOwn(e,nh)&&((gn=hyphenate(nh))===nh||!hasOwn(e,gn)))&&(_?o&&(o[nh]!==void 0||o[gn]!==void 0)&&(c[nh]=resolvePropValue(_,m,nh,void 0,n,!0)):delete c[nh]);if(u!==m)for(const nh in u)(!e||!hasOwn(e,nh))&&(delete u[nh],ue=!0)}ue&&trigger(n,"set","$attrs")}function setFullProps(n,e,o,s){const[c,u]=n.propsOptions;let d=!1,m;if(e)for(let _ in e){if(isReservedProp(_))continue;const ue=e[_];let gn;c&&hasOwn(c,gn=camelize(_))?!u||!u.includes(gn)?o[gn]=ue:(m||(m={}))[gn]=ue:isEmitListener(n.emitsOptions,_)||(!(_ in s)||ue!==s[_])&&(s[_]=ue,d=!0)}if(u){const _=toRaw(o),ue=m||EMPTY_OBJ;for(let gn=0;gn<u.length;gn++){const nh=u[gn];o[nh]=resolvePropValue(c,_,nh,ue[nh],n,!hasOwn(ue,nh))}}return d}function resolvePropValue(n,e,o,s,c,u){const d=n[o];if(d!=null){const m=hasOwn(d,"default");if(m&&s===void 0){const _=d.default;if(d.type!==Function&&isFunction(_)){const{propsDefaults:ue}=c;o in ue?s=ue[o]:(setCurrentInstance(c),s=ue[o]=_.call(null,e),unsetCurrentInstance())}else s=_}d[0]&&(u&&!m?s=!1:d[1]&&(s===""||s===hyphenate(o))&&(s=!0))}return s}function normalizePropsOptions(n,e,o=!1){const s=e.propsCache,c=s.get(n);if(c)return c;const u=n.props,d={},m=[];let _=!1;if(!isFunction(n)){const gn=nh=>{_=!0;const[ih,rh]=normalizePropsOptions(nh,e,!0);extend$1(d,ih),rh&&m.push(...rh)};!o&&e.mixins.length&&e.mixins.forEach(gn),n.extends&&gn(n.extends),n.mixins&&n.mixins.forEach(gn)}if(!u&&!_)return isObject$3(n)&&s.set(n,EMPTY_ARR),EMPTY_ARR;if(isArray$1(u))for(let gn=0;gn<u.length;gn++){const nh=camelize(u[gn]);validatePropName(nh)&&(d[nh]=EMPTY_OBJ)}else if(u)for(const gn in u){const nh=camelize(gn);if(validatePropName(nh)){const ih=u[gn],rh=d[nh]=isArray$1(ih)||isFunction(ih)?{type:ih}:Object.assign({},ih);if(rh){const oh=getTypeIndex(Boolean,rh.type),lh=getTypeIndex(String,rh.type);rh[0]=oh>-1,rh[1]=lh<0||oh<lh,(oh>-1||hasOwn(rh,"default"))&&m.push(nh)}}}const ue=[d,m];return isObject$3(n)&&s.set(n,ue),ue}function validatePropName(n){return n[0]!=="$"}function getType(n){const e=n&&n.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:n===null?"null":""}function isSameType(n,e){return getType(n)===getType(e)}function getTypeIndex(n,e){return isArray$1(e)?e.findIndex(o=>isSameType(o,n)):isFunction(e)&&isSameType(e,n)?0:-1}const isInternalKey=n=>n[0]==="_"||n==="$stable",normalizeSlotValue=n=>isArray$1(n)?n.map(normalizeVNode):[normalizeVNode(n)],normalizeSlot$1=(n,e,o)=>{if(e._n)return e;const s=withCtx((...c)=>normalizeSlotValue(e(...c)),o);return s._c=!1,s},normalizeObjectSlots=(n,e,o)=>{const s=n._ctx;for(const c in n){if(isInternalKey(c))continue;const u=n[c];if(isFunction(u))e[c]=normalizeSlot$1(c,u,s);else if(u!=null){const d=normalizeSlotValue(u);e[c]=()=>d}}},normalizeVNodeSlots=(n,e)=>{const o=normalizeSlotValue(e);n.slots.default=()=>o},initSlots=(n,e)=>{if(n.vnode.shapeFlag&32){const o=e._;o?(n.slots=toRaw(e),def(e,"_",o)):normalizeObjectSlots(e,n.slots={})}else n.slots={},e&&normalizeVNodeSlots(n,e);def(n.slots,InternalObjectKey,1)},updateSlots=(n,e,o)=>{const{vnode:s,slots:c}=n;let u=!0,d=EMPTY_OBJ;if(s.shapeFlag&32){const m=e._;m?o&&m===1?u=!1:(extend$1(c,e),!o&&m===1&&delete c._):(u=!e.$stable,normalizeObjectSlots(e,c)),d=e}else e&&(normalizeVNodeSlots(n,e),d={default:1});if(u)for(const m in c)!isInternalKey(m)&&!(m in d)&&delete c[m]};function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid$1=0;function createAppAPI(n,e){return function(s,c=null){isFunction(s)||(s=Object.assign({},s)),c!=null&&!isObject$3(c)&&(c=null);const u=createAppContext(),d=new Set;let m=!1;const _=u.app={_uid:uid$1++,_component:s,_props:c,_container:null,_context:u,_instance:null,version:version$6,get config(){return u.config},set config(ue){},use(ue,...gn){return d.has(ue)||(ue&&isFunction(ue.install)?(d.add(ue),ue.install(_,...gn)):isFunction(ue)&&(d.add(ue),ue(_,...gn))),_},mixin(ue){return u.mixins.includes(ue)||u.mixins.push(ue),_},component(ue,gn){return gn?(u.components[ue]=gn,_):u.components[ue]},directive(ue,gn){return gn?(u.directives[ue]=gn,_):u.directives[ue]},mount(ue,gn,nh){if(!m){const ih=createVNode(s,c);return ih.appContext=u,gn&&e?e(ih,ue):n(ih,ue,nh),m=!0,_._container=ue,ue.__vue_app__=_,getExposeProxy(ih.component)||ih.component.proxy}},unmount(){m&&(n(null,_._container),delete _._container.__vue_app__)},provide(ue,gn){return u.provides[ue]=gn,_}};return _}}function setRef(n,e,o,s,c=!1){if(isArray$1(n)){n.forEach((ih,rh)=>setRef(ih,e&&(isArray$1(e)?e[rh]:e),o,s,c));return}if(isAsyncWrapper(s)&&!c)return;const u=s.shapeFlag&4?getExposeProxy(s.component)||s.component.proxy:s.el,d=c?null:u,{i:m,r:_}=n,ue=e&&e.r,gn=m.refs===EMPTY_OBJ?m.refs={}:m.refs,nh=m.setupState;if(ue!=null&&ue!==_&&(isString(ue)?(gn[ue]=null,hasOwn(nh,ue)&&(nh[ue]=null)):isRef(ue)&&(ue.value=null)),isFunction(_))callWithErrorHandling(_,m,12,[d,gn]);else{const ih=isString(_),rh=isRef(_);if(ih||rh){const oh=()=>{if(n.f){const lh=ih?hasOwn(nh,_)?nh[_]:gn[_]:_.value;c?isArray$1(lh)&&remove$2(lh,u):isArray$1(lh)?lh.includes(u)||lh.push(u):ih?(gn[_]=[u],hasOwn(nh,_)&&(nh[_]=gn[_])):(_.value=[u],n.k&&(gn[n.k]=_.value))}else ih?(gn[_]=d,hasOwn(nh,_)&&(nh[_]=d)):rh&&(_.value=d,n.k&&(gn[n.k]=d))};d?(oh.id=-1,queuePostRenderEffect(oh,o)):oh()}}}const queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(n){return baseCreateRenderer(n)}function baseCreateRenderer(n,e){const o=getGlobalThis();o.__VUE__=!0;const{insert:s,remove:c,patchProp:u,createElement:d,createText:m,createComment:_,setText:ue,setElementText:gn,parentNode:nh,nextSibling:ih,setScopeId:rh=NOOP,insertStaticContent:oh}=n,lh=(uh,ph,kh,xh=null,bh=null,Bh=null,Uh=!1,zh=null,jh=!!ph.dynamicChildren)=>{if(uh===ph)return;uh&&!isSameVNodeType(uh,ph)&&(xh=Dh(uh),Hh(uh,bh,Bh,!0),uh=null),ph.patchFlag===-2&&(jh=!1,ph.dynamicChildren=null);const{type:Kh,ref:tf,shapeFlag:Zh}=ph;switch(Kh){case Text$1:ch(uh,ph,kh,xh);break;case Comment:dh(uh,ph,kh,xh);break;case Static:uh==null&&_h(ph,kh,xh,Uh);break;case Fragment:Wh(uh,ph,kh,xh,bh,Bh,Uh,zh,jh);break;default:Zh&1?yh(uh,ph,kh,xh,bh,Bh,Uh,zh,jh):Zh&6?Yh(uh,ph,kh,xh,bh,Bh,Uh,zh,jh):(Zh&64||Zh&128)&&Kh.process(uh,ph,kh,xh,bh,Bh,Uh,zh,jh,Jh)}tf!=null&&bh&&setRef(tf,uh&&uh.ref,Bh,ph||uh,!ph)},ch=(uh,ph,kh,xh)=>{if(uh==null)s(ph.el=m(ph.children),kh,xh);else{const bh=ph.el=uh.el;ph.children!==uh.children&&ue(bh,ph.children)}},dh=(uh,ph,kh,xh)=>{uh==null?s(ph.el=_(ph.children||""),kh,xh):ph.el=uh.el},_h=(uh,ph,kh,xh)=>{[uh.el,uh.anchor]=oh(uh.children,ph,kh,xh,uh.el,uh.anchor)},Sh=({el:uh,anchor:ph},kh,xh)=>{let bh;for(;uh&&uh!==ph;)bh=ih(uh),s(uh,kh,xh),uh=bh;s(ph,kh,xh)},fh=({el:uh,anchor:ph})=>{let kh;for(;uh&&uh!==ph;)kh=ih(uh),c(uh),uh=kh;c(ph)},yh=(uh,ph,kh,xh,bh,Bh,Uh,zh,jh)=>{Uh=Uh||ph.type==="svg",uh==null?mh(ph,kh,xh,bh,Bh,Uh,zh,jh):Ph(uh,ph,bh,Bh,Uh,zh,jh)},mh=(uh,ph,kh,xh,bh,Bh,Uh,zh)=>{let jh,Kh;const{type:tf,props:Zh,shapeFlag:nf,transition:of,dirs:sf}=uh;if(jh=uh.el=d(uh.type,Bh,Zh&&Zh.is,Zh),nf&8?gn(jh,uh.children):nf&16&&Mh(uh.children,jh,null,xh,bh,Bh&&tf!=="foreignObject",Uh,zh),sf&&invokeDirectiveHook(uh,null,xh,"created"),Ch(jh,uh,uh.scopeId,Uh,xh),Zh){for(const af in Zh)af!=="value"&&!isReservedProp(af)&&u(jh,af,null,Zh[af],Bh,uh.children,xh,bh,Fh);"value"in Zh&&u(jh,"value",null,Zh.value),(Kh=Zh.onVnodeBeforeMount)&&invokeVNodeHook(Kh,xh,uh)}sf&&invokeDirectiveHook(uh,null,xh,"beforeMount");const lf=(!bh||bh&&!bh.pendingBranch)&&of&&!of.persisted;lf&&of.beforeEnter(jh),s(jh,ph,kh),((Kh=Zh&&Zh.onVnodeMounted)||lf||sf)&&queuePostRenderEffect(()=>{Kh&&invokeVNodeHook(Kh,xh,uh),lf&&of.enter(jh),sf&&invokeDirectiveHook(uh,null,xh,"mounted")},bh)},Ch=(uh,ph,kh,xh,bh)=>{if(kh&&rh(uh,kh),xh)for(let Bh=0;Bh<xh.length;Bh++)rh(uh,xh[Bh]);if(bh){let Bh=bh.subTree;if(ph===Bh){const Uh=bh.vnode;Ch(uh,Uh,Uh.scopeId,Uh.slotScopeIds,bh.parent)}}},Mh=(uh,ph,kh,xh,bh,Bh,Uh,zh,jh=0)=>{for(let Kh=jh;Kh<uh.length;Kh++){const tf=uh[Kh]=zh?cloneIfMounted(uh[Kh]):normalizeVNode(uh[Kh]);lh(null,tf,ph,kh,xh,bh,Bh,Uh,zh)}},Ph=(uh,ph,kh,xh,bh,Bh,Uh)=>{const zh=ph.el=uh.el;let{patchFlag:jh,dynamicChildren:Kh,dirs:tf}=ph;jh|=uh.patchFlag&16;const Zh=uh.props||EMPTY_OBJ,nf=ph.props||EMPTY_OBJ;let of;kh&&toggleRecurse(kh,!1),(of=nf.onVnodeBeforeUpdate)&&invokeVNodeHook(of,kh,ph,uh),tf&&invokeDirectiveHook(ph,uh,kh,"beforeUpdate"),kh&&toggleRecurse(kh,!0);const sf=bh&&ph.type!=="foreignObject";if(Kh?Eh(uh.dynamicChildren,Kh,zh,kh,xh,sf,Bh):Uh||Rh(uh,ph,zh,null,kh,xh,sf,Bh,!1),jh>0){if(jh&16)Nh(zh,ph,Zh,nf,kh,xh,bh);else if(jh&2&&Zh.class!==nf.class&&u(zh,"class",null,nf.class,bh),jh&4&&u(zh,"style",Zh.style,nf.style,bh),jh&8){const lf=ph.dynamicProps;for(let af=0;af<lf.length;af++){const cf=lf[af],hf=Zh[cf],ff=nf[cf];(ff!==hf||cf==="value")&&u(zh,cf,hf,ff,bh,uh.children,kh,xh,Fh)}}jh&1&&uh.children!==ph.children&&gn(zh,ph.children)}else!Uh&&Kh==null&&Nh(zh,ph,Zh,nf,kh,xh,bh);((of=nf.onVnodeUpdated)||tf)&&queuePostRenderEffect(()=>{of&&invokeVNodeHook(of,kh,ph,uh),tf&&invokeDirectiveHook(ph,uh,kh,"updated")},xh)},Eh=(uh,ph,kh,xh,bh,Bh,Uh)=>{for(let zh=0;zh<ph.length;zh++){const jh=uh[zh],Kh=ph[zh],tf=jh.el&&(jh.type===Fragment||!isSameVNodeType(jh,Kh)||jh.shapeFlag&70)?nh(jh.el):kh;lh(jh,Kh,tf,null,xh,bh,Bh,Uh,!0)}},Nh=(uh,ph,kh,xh,bh,Bh,Uh)=>{if(kh!==xh){if(kh!==EMPTY_OBJ)for(const zh in kh)!isReservedProp(zh)&&!(zh in xh)&&u(uh,zh,kh[zh],null,Uh,ph.children,bh,Bh,Fh);for(const zh in xh){if(isReservedProp(zh))continue;const jh=xh[zh],Kh=kh[zh];jh!==Kh&&zh!=="value"&&u(uh,zh,Kh,jh,Uh,ph.children,bh,Bh,Fh)}"value"in xh&&u(uh,"value",kh.value,xh.value)}},Wh=(uh,ph,kh,xh,bh,Bh,Uh,zh,jh)=>{const Kh=ph.el=uh?uh.el:m(""),tf=ph.anchor=uh?uh.anchor:m("");let{patchFlag:Zh,dynamicChildren:nf,slotScopeIds:of}=ph;of&&(zh=zh?zh.concat(of):of),uh==null?(s(Kh,kh,xh),s(tf,kh,xh),Mh(ph.children,kh,tf,bh,Bh,Uh,zh,jh)):Zh>0&&Zh&64&&nf&&uh.dynamicChildren?(Eh(uh.dynamicChildren,nf,kh,bh,Bh,Uh,zh),(ph.key!=null||bh&&ph===bh.subTree)&&traverseStaticChildren(uh,ph,!0)):Rh(uh,ph,kh,tf,bh,Bh,Uh,zh,jh)},Yh=(uh,ph,kh,xh,bh,Bh,Uh,zh,jh)=>{ph.slotScopeIds=zh,uh==null?ph.shapeFlag&512?bh.ctx.activate(ph,kh,xh,Uh,jh):gh(ph,kh,xh,bh,Bh,Uh,jh):Ah(uh,ph,jh)},gh=(uh,ph,kh,xh,bh,Bh,Uh)=>{const zh=uh.component=createComponentInstance(uh,xh,bh);if(isKeepAlive(uh)&&(zh.ctx.renderer=Jh),setupComponent(zh),zh.asyncDep){if(bh&&bh.registerDep(zh,wh),!uh.el){const jh=zh.subTree=createVNode(Comment);dh(null,jh,ph,kh)}return}wh(zh,uh,ph,kh,bh,Bh,Uh)},Ah=(uh,ph,kh)=>{const xh=ph.component=uh.component;if(shouldUpdateComponent(uh,ph,kh))if(xh.asyncDep&&!xh.asyncResolved){$h(xh,ph,kh);return}else xh.next=ph,invalidateJob(xh.update),xh.update();else ph.el=uh.el,xh.vnode=ph},wh=(uh,ph,kh,xh,bh,Bh,Uh)=>{const zh=()=>{if(uh.isMounted){let{next:tf,bu:Zh,u:nf,parent:of,vnode:sf}=uh,lf=tf,af;toggleRecurse(uh,!1),tf?(tf.el=sf.el,$h(uh,tf,Uh)):tf=sf,Zh&&invokeArrayFns(Zh),(af=tf.props&&tf.props.onVnodeBeforeUpdate)&&invokeVNodeHook(af,of,tf,sf),toggleRecurse(uh,!0);const cf=renderComponentRoot(uh),hf=uh.subTree;uh.subTree=cf,lh(hf,cf,nh(hf.el),Dh(hf),uh,bh,Bh),tf.el=cf.el,lf===null&&updateHOCHostEl(uh,cf.el),nf&&queuePostRenderEffect(nf,bh),(af=tf.props&&tf.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(af,of,tf,sf),bh)}else{let tf;const{el:Zh,props:nf}=ph,{bm:of,m:sf,parent:lf}=uh,af=isAsyncWrapper(ph);if(toggleRecurse(uh,!1),of&&invokeArrayFns(of),!af&&(tf=nf&&nf.onVnodeBeforeMount)&&invokeVNodeHook(tf,lf,ph),toggleRecurse(uh,!0),Zh&&ef){const cf=()=>{uh.subTree=renderComponentRoot(uh),ef(Zh,uh.subTree,uh,bh,null)};af?ph.type.__asyncLoader().then(()=>!uh.isUnmounted&&cf()):cf()}else{const cf=uh.subTree=renderComponentRoot(uh);lh(null,cf,kh,xh,uh,bh,Bh),ph.el=cf.el}if(sf&&queuePostRenderEffect(sf,bh),!af&&(tf=nf&&nf.onVnodeMounted)){const cf=ph;queuePostRenderEffect(()=>invokeVNodeHook(tf,lf,cf),bh)}(ph.shapeFlag&256||lf&&isAsyncWrapper(lf.vnode)&&lf.vnode.shapeFlag&256)&&uh.a&&queuePostRenderEffect(uh.a,bh),uh.isMounted=!0,ph=kh=xh=null}},jh=uh.effect=new ReactiveEffect(zh,()=>queueJob(Kh),uh.scope),Kh=uh.update=()=>jh.run();Kh.id=uh.uid,toggleRecurse(uh,!0),Kh()},$h=(uh,ph,kh)=>{ph.component=uh;const xh=uh.vnode.props;uh.vnode=ph,uh.next=null,updateProps(uh,ph.props,xh,kh),updateSlots(uh,ph.children,kh),pauseTracking(),flushPreFlushCbs(),resetTracking()},Rh=(uh,ph,kh,xh,bh,Bh,Uh,zh,jh=!1)=>{const Kh=uh&&uh.children,tf=uh?uh.shapeFlag:0,Zh=ph.children,{patchFlag:nf,shapeFlag:of}=ph;if(nf>0){if(nf&128){Lh(Kh,Zh,kh,xh,bh,Bh,Uh,zh,jh);return}else if(nf&256){Oh(Kh,Zh,kh,xh,bh,Bh,Uh,zh,jh);return}}of&8?(tf&16&&Fh(Kh,bh,Bh),Zh!==Kh&&gn(kh,Zh)):tf&16?of&16?Lh(Kh,Zh,kh,xh,bh,Bh,Uh,zh,jh):Fh(Kh,bh,Bh,!0):(tf&8&&gn(kh,""),of&16&&Mh(Zh,kh,xh,bh,Bh,Uh,zh,jh))},Oh=(uh,ph,kh,xh,bh,Bh,Uh,zh,jh)=>{uh=uh||EMPTY_ARR,ph=ph||EMPTY_ARR;const Kh=uh.length,tf=ph.length,Zh=Math.min(Kh,tf);let nf;for(nf=0;nf<Zh;nf++){const of=ph[nf]=jh?cloneIfMounted(ph[nf]):normalizeVNode(ph[nf]);lh(uh[nf],of,kh,null,bh,Bh,Uh,zh,jh)}Kh>tf?Fh(uh,bh,Bh,!0,!1,Zh):Mh(ph,kh,xh,bh,Bh,Uh,zh,jh,Zh)},Lh=(uh,ph,kh,xh,bh,Bh,Uh,zh,jh)=>{let Kh=0;const tf=ph.length;let Zh=uh.length-1,nf=tf-1;for(;Kh<=Zh&&Kh<=nf;){const of=uh[Kh],sf=ph[Kh]=jh?cloneIfMounted(ph[Kh]):normalizeVNode(ph[Kh]);if(isSameVNodeType(of,sf))lh(of,sf,kh,null,bh,Bh,Uh,zh,jh);else break;Kh++}for(;Kh<=Zh&&Kh<=nf;){const of=uh[Zh],sf=ph[nf]=jh?cloneIfMounted(ph[nf]):normalizeVNode(ph[nf]);if(isSameVNodeType(of,sf))lh(of,sf,kh,null,bh,Bh,Uh,zh,jh);else break;Zh--,nf--}if(Kh>Zh){if(Kh<=nf){const of=nf+1,sf=of<tf?ph[of].el:xh;for(;Kh<=nf;)lh(null,ph[Kh]=jh?cloneIfMounted(ph[Kh]):normalizeVNode(ph[Kh]),kh,sf,bh,Bh,Uh,zh,jh),Kh++}}else if(Kh>nf)for(;Kh<=Zh;)Hh(uh[Kh],bh,Bh,!0),Kh++;else{const of=Kh,sf=Kh,lf=new Map;for(Kh=sf;Kh<=nf;Kh++){const uf=ph[Kh]=jh?cloneIfMounted(ph[Kh]):normalizeVNode(ph[Kh]);uf.key!=null&&lf.set(uf.key,Kh)}let af,cf=0;const hf=nf-sf+1;let ff=!1,vf=0;const pf=new Array(hf);for(Kh=0;Kh<hf;Kh++)pf[Kh]=0;for(Kh=of;Kh<=Zh;Kh++){const uf=uh[Kh];if(cf>=hf){Hh(uf,bh,Bh,!0);continue}let df;if(uf.key!=null)df=lf.get(uf.key);else for(af=sf;af<=nf;af++)if(pf[af-sf]===0&&isSameVNodeType(uf,ph[af])){df=af;break}df===void 0?Hh(uf,bh,Bh,!0):(pf[df-sf]=Kh+1,df>=vf?vf=df:ff=!0,lh(uf,ph[df],kh,null,bh,Bh,Uh,zh,jh),cf++)}const _f=ff?getSequence(pf):EMPTY_ARR;for(af=_f.length-1,Kh=hf-1;Kh>=0;Kh--){const uf=sf+Kh,df=ph[uf],wf=uf+1<tf?ph[uf+1].el:xh;pf[Kh]===0?lh(null,df,kh,wf,bh,Bh,Uh,zh,jh):ff&&(af<0||Kh!==_f[af]?qh(df,kh,wf,2):af--)}}},qh=(uh,ph,kh,xh,bh=null)=>{const{el:Bh,type:Uh,transition:zh,children:jh,shapeFlag:Kh}=uh;if(Kh&6){qh(uh.component.subTree,ph,kh,xh);return}if(Kh&128){uh.suspense.move(ph,kh,xh);return}if(Kh&64){Uh.move(uh,ph,kh,Jh);return}if(Uh===Fragment){s(Bh,ph,kh);for(let Zh=0;Zh<jh.length;Zh++)qh(jh[Zh],ph,kh,xh);s(uh.anchor,ph,kh);return}if(Uh===Static){Sh(uh,ph,kh);return}if(xh!==2&&Kh&1&&zh)if(xh===0)zh.beforeEnter(Bh),s(Bh,ph,kh),queuePostRenderEffect(()=>zh.enter(Bh),bh);else{const{leave:Zh,delayLeave:nf,afterLeave:of}=zh,sf=()=>s(Bh,ph,kh),lf=()=>{Zh(Bh,()=>{sf(),of&&of()})};nf?nf(Bh,sf,lf):lf()}else s(Bh,ph,kh)},Hh=(uh,ph,kh,xh=!1,bh=!1)=>{const{type:Bh,props:Uh,ref:zh,children:jh,dynamicChildren:Kh,shapeFlag:tf,patchFlag:Zh,dirs:nf}=uh;if(zh!=null&&setRef(zh,null,kh,uh,!0),tf&256){ph.ctx.deactivate(uh);return}const of=tf&1&&nf,sf=!isAsyncWrapper(uh);let lf;if(sf&&(lf=Uh&&Uh.onVnodeBeforeUnmount)&&invokeVNodeHook(lf,ph,uh),tf&6)Th(uh.component,kh,xh);else{if(tf&128){uh.suspense.unmount(kh,xh);return}of&&invokeDirectiveHook(uh,null,ph,"beforeUnmount"),tf&64?uh.type.remove(uh,ph,kh,bh,Jh,xh):Kh&&(Bh!==Fragment||Zh>0&&Zh&64)?Fh(Kh,ph,kh,!1,!0):(Bh===Fragment&&Zh&384||!bh&&tf&16)&&Fh(jh,ph,kh),xh&&Xh(uh)}(sf&&(lf=Uh&&Uh.onVnodeUnmounted)||of)&&queuePostRenderEffect(()=>{lf&&invokeVNodeHook(lf,ph,uh),of&&invokeDirectiveHook(uh,null,ph,"unmounted")},kh)},Xh=uh=>{const{type:ph,el:kh,anchor:xh,transition:bh}=uh;if(ph===Fragment){Qh(kh,xh);return}if(ph===Static){fh(uh);return}const Bh=()=>{c(kh),bh&&!bh.persisted&&bh.afterLeave&&bh.afterLeave()};if(uh.shapeFlag&1&&bh&&!bh.persisted){const{leave:Uh,delayLeave:zh}=bh,jh=()=>Uh(kh,Bh);zh?zh(uh.el,Bh,jh):jh()}else Bh()},Qh=(uh,ph)=>{let kh;for(;uh!==ph;)kh=ih(uh),c(uh),uh=kh;c(ph)},Th=(uh,ph,kh)=>{const{bum:xh,scope:bh,update:Bh,subTree:Uh,um:zh}=uh;xh&&invokeArrayFns(xh),bh.stop(),Bh&&(Bh.active=!1,Hh(Uh,uh,ph,kh)),zh&&queuePostRenderEffect(zh,ph),queuePostRenderEffect(()=>{uh.isUnmounted=!0},ph),ph&&ph.pendingBranch&&!ph.isUnmounted&&uh.asyncDep&&!uh.asyncResolved&&uh.suspenseId===ph.pendingId&&(ph.deps--,ph.deps===0&&ph.resolve())},Fh=(uh,ph,kh,xh=!1,bh=!1,Bh=0)=>{for(let Uh=Bh;Uh<uh.length;Uh++)Hh(uh[Uh],ph,kh,xh,bh)},Dh=uh=>uh.shapeFlag&6?Dh(uh.component.subTree):uh.shapeFlag&128?uh.suspense.next():ih(uh.anchor||uh.el),Gh=(uh,ph,kh)=>{uh==null?ph._vnode&&Hh(ph._vnode,null,null,!0):lh(ph._vnode||null,uh,ph,null,null,null,kh),flushPreFlushCbs(),flushPostFlushCbs(),ph._vnode=uh},Jh={p:lh,um:Hh,m:qh,r:Xh,mt:gh,mc:Mh,pc:Rh,pbc:Eh,n:Dh,o:n};let rf,ef;return e&&([rf,ef]=e(Jh)),{render:Gh,hydrate:rf,createApp:createAppAPI(Gh,rf)}}function toggleRecurse({effect:n,update:e},o){n.allowRecurse=e.allowRecurse=o}function traverseStaticChildren(n,e,o=!1){const s=n.children,c=e.children;if(isArray$1(s)&&isArray$1(c))for(let u=0;u<s.length;u++){const d=s[u];let m=c[u];m.shapeFlag&1&&!m.dynamicChildren&&((m.patchFlag<=0||m.patchFlag===32)&&(m=c[u]=cloneIfMounted(c[u]),m.el=d.el),o||traverseStaticChildren(d,m)),m.type===Text$1&&(m.el=d.el)}}function getSequence(n){const e=n.slice(),o=[0];let s,c,u,d,m;const _=n.length;for(s=0;s<_;s++){const ue=n[s];if(ue!==0){if(c=o[o.length-1],n[c]<ue){e[s]=c,o.push(s);continue}for(u=0,d=o.length-1;u<d;)m=u+d>>1,n[o[m]]<ue?u=m+1:d=m;ue<n[o[u]]&&(u>0&&(e[s]=o[u-1]),o[u]=s)}}for(u=o.length,d=o[u-1];u-- >0;)o[u]=d,d=e[d];return o}const isTeleport=n=>n.__isTeleport,Fragment=Symbol(void 0),Text$1=Symbol(void 0),Comment=Symbol(void 0),Static=Symbol(void 0),blockStack=[];let currentBlock=null;function openBlock(n=!1){blockStack.push(currentBlock=n?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(n){isBlockTreeEnabled+=n}function setupBlock(n){return n.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(n),n}function createElementBlock(n,e,o,s,c,u){return setupBlock(createBaseVNode(n,e,o,s,c,u,!0))}function createBlock(n,e,o,s,c){return setupBlock(createVNode(n,e,o,s,c,!0))}function isVNode(n){return n?n.__v_isVNode===!0:!1}function isSameVNodeType(n,e){return n.type===e.type&&n.key===e.key}const InternalObjectKey="__vInternal",normalizeKey=({key:n})=>n??null,normalizeRef=({ref:n,ref_key:e,ref_for:o})=>n!=null?isString(n)||isRef(n)||isFunction(n)?{i:currentRenderingInstance,r:n,k:e,f:!!o}:n:null;function createBaseVNode(n,e=null,o=null,s=0,c=null,u=n===Fragment?0:1,d=!1,m=!1){const _={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&normalizeKey(e),ref:e&&normalizeRef(e),scopeId:currentScopeId,slotScopeIds:null,children:o,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:u,patchFlag:s,dynamicProps:c,dynamicChildren:null,appContext:null,ctx:currentRenderingInstance};return m?(normalizeChildren(_,o),u&128&&n.normalize(_)):o&&(_.shapeFlag|=isString(o)?8:16),isBlockTreeEnabled>0&&!d&&currentBlock&&(_.patchFlag>0||u&6)&&_.patchFlag!==32&&currentBlock.push(_),_}const createVNode=_createVNode;function _createVNode(n,e=null,o=null,s=0,c=null,u=!1){if((!n||n===NULL_DYNAMIC_COMPONENT)&&(n=Comment),isVNode(n)){const m=cloneVNode(n,e,!0);return o&&normalizeChildren(m,o),isBlockTreeEnabled>0&&!u&&currentBlock&&(m.shapeFlag&6?currentBlock[currentBlock.indexOf(n)]=m:currentBlock.push(m)),m.patchFlag|=-2,m}if(isClassComponent(n)&&(n=n.__vccOpts),e){e=guardReactiveProps(e);let{class:m,style:_}=e;m&&!isString(m)&&(e.class=normalizeClass(m)),isObject$3(_)&&(isProxy(_)&&!isArray$1(_)&&(_=extend$1({},_)),e.style=normalizeStyle(_))}const d=isString(n)?1:isSuspense(n)?128:isTeleport(n)?64:isObject$3(n)?4:isFunction(n)?2:0;return createBaseVNode(n,e,o,s,c,d,u,!0)}function guardReactiveProps(n){return n?isProxy(n)||InternalObjectKey in n?extend$1({},n):n:null}function cloneVNode(n,e,o=!1){const{props:s,ref:c,patchFlag:u,children:d}=n,m=e?mergeProps(s||{},e):s;return{__v_isVNode:!0,__v_skip:!0,type:n.type,props:m,key:m&&normalizeKey(m),ref:e&&e.ref?o&&c?isArray$1(c)?c.concat(normalizeRef(e)):[c,normalizeRef(e)]:normalizeRef(e):c,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:d,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Fragment?u===-1?16:u|16:u,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:n.transition,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&cloneVNode(n.ssContent),ssFallback:n.ssFallback&&cloneVNode(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce}}function createTextVNode(n=" ",e=0){return createVNode(Text$1,null,n,e)}function createCommentVNode(n="",e=!1){return e?(openBlock(),createBlock(Comment,null,n)):createVNode(Comment,null,n)}function normalizeVNode(n){return n==null||typeof n=="boolean"?createVNode(Comment):isArray$1(n)?createVNode(Fragment,null,n.slice()):typeof n=="object"?cloneIfMounted(n):createVNode(Text$1,null,String(n))}function cloneIfMounted(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:cloneVNode(n)}function normalizeChildren(n,e){let o=0;const{shapeFlag:s}=n;if(e==null)e=null;else if(isArray$1(e))o=16;else if(typeof e=="object")if(s&65){const c=e.default;c&&(c._c&&(c._d=!1),normalizeChildren(n,c()),c._c&&(c._d=!0));return}else{o=32;const c=e._;!c&&!(InternalObjectKey in e)?e._ctx=currentRenderingInstance:c===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else isFunction(e)?(e={default:e,_ctx:currentRenderingInstance},o=32):(e=String(e),s&64?(o=16,e=[createTextVNode(e)]):o=8);n.children=e,n.shapeFlag|=o}function mergeProps(...n){const e={};for(let o=0;o<n.length;o++){const s=n[o];for(const c in s)if(c==="class")e.class!==s.class&&(e.class=normalizeClass([e.class,s.class]));else if(c==="style")e.style=normalizeStyle([e.style,s.style]);else if(isOn(c)){const u=e[c],d=s[c];d&&u!==d&&!(isArray$1(u)&&u.includes(d))&&(e[c]=u?[].concat(u,d):d)}else c!==""&&(e[c]=s[c])}return e}function invokeVNodeHook(n,e,o,s=null){callWithAsyncErrorHandling(n,e,7,[o,s])}const emptyAppContext=createAppContext();let uid=0;function createComponentInstance(n,e,o){const s=n.type,c=(e?e.appContext:n.appContext)||emptyAppContext,u={uid:uid++,vnode:n,type:s,parent:e,appContext:c,root:null,next:null,subTree:null,effect:null,update:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(c.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(s,c),emitsOptions:normalizeEmitsOptions(s,c),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:s.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,suspense:o,suspenseId:o?o.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return u.ctx={_:u},u.root=e?e.root:u,u.emit=emit.bind(null,u),n.ce&&n.ce(u),u}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance,setCurrentInstance=n=>{currentInstance=n,n.scope.on()},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),currentInstance=null};function isStatefulComponent(n){return n.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(n,e=!1){isInSSRComponentSetup=e;const{props:o,children:s}=n.vnode,c=isStatefulComponent(n);initProps(n,o,c,e),initSlots(n,s);const u=c?setupStatefulComponent(n,e):void 0;return isInSSRComponentSetup=!1,u}function setupStatefulComponent(n,e){const o=n.type;n.accessCache=Object.create(null),n.proxy=markRaw(new Proxy(n.ctx,PublicInstanceProxyHandlers));const{setup:s}=o;if(s){const c=n.setupContext=s.length>1?createSetupContext(n):null;setCurrentInstance(n),pauseTracking();const u=callWithErrorHandling(s,n,0,[n.props,c]);if(resetTracking(),unsetCurrentInstance(),isPromise(u)){if(u.then(unsetCurrentInstance,unsetCurrentInstance),e)return u.then(d=>{handleSetupResult(n,d,e)}).catch(d=>{handleError(d,n,0)});n.asyncDep=u}else handleSetupResult(n,u,e)}else finishComponentSetup(n,e)}function handleSetupResult(n,e,o){isFunction(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:isObject$3(e)&&(n.setupState=proxyRefs(e)),finishComponentSetup(n,o)}let compile;function finishComponentSetup(n,e,o){const s=n.type;if(!n.render){if(!e&&compile&&!s.render){const c=s.template||resolveMergedOptions(n).template;if(c){const{isCustomElement:u,compilerOptions:d}=n.appContext.config,{delimiters:m,compilerOptions:_}=s,ue=extend$1(extend$1({isCustomElement:u,delimiters:m},d),_);s.render=compile(c,ue)}}n.render=s.render||NOOP}setCurrentInstance(n),pauseTracking(),applyOptions(n),resetTracking(),unsetCurrentInstance()}function createAttrsProxy(n){return new Proxy(n.attrs,{get(e,o){return track(n,"get","$attrs"),e[o]}})}function createSetupContext(n){const e=s=>{n.exposed=s||{}};let o;return{get attrs(){return o||(o=createAttrsProxy(n))},slots:n.slots,emit:n.emit,expose:e}}function getExposeProxy(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(proxyRefs(markRaw(n.exposed)),{get(e,o){if(o in e)return e[o];if(o in publicPropertiesMap)return publicPropertiesMap[o](n)},has(e,o){return o in e||o in publicPropertiesMap}}))}function getComponentName(n,e=!0){return isFunction(n)?n.displayName||n.name:n.name||e&&n.__name}function isClassComponent(n){return isFunction(n)&&"__vccOpts"in n}const computed=(n,e)=>computed$1(n,e,isInSSRComponentSetup);function useSlots(){return getContext().slots}function useAttrs(){return getContext().attrs}function getContext(){const n=getCurrentInstance();return n.setupContext||(n.setupContext=createSetupContext(n))}function h$1(n,e,o){const s=arguments.length;return s===2?isObject$3(e)&&!isArray$1(e)?isVNode(e)?createVNode(n,null,[e]):createVNode(n,e):createVNode(n,null,e):(s>3?o=Array.prototype.slice.call(arguments,2):s===3&&isVNode(o)&&(o=[o]),createVNode(n,e,o))}const ssrContextKey=Symbol(""),useSSRContext=()=>inject(ssrContextKey),version$6="3.2.47",svgNS="http://www.w3.org/2000/svg",doc$1=typeof document<"u"?document:null,templateContainer=doc$1&&doc$1.createElement("template"),nodeOps={insert:(n,e,o)=>{e.insertBefore(n,o||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,o,s)=>{const c=e?doc$1.createElementNS(svgNS,n):doc$1.createElement(n,o?{is:o}:void 0);return n==="select"&&s&&s.multiple!=null&&c.setAttribute("multiple",s.multiple),c},createText:n=>doc$1.createTextNode(n),createComment:n=>doc$1.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>doc$1.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,o,s,c,u){const d=o?o.previousSibling:e.lastChild;if(c&&(c===u||c.nextSibling))for(;e.insertBefore(c.cloneNode(!0),o),!(c===u||!(c=c.nextSibling)););else{templateContainer.innerHTML=s?`<svg>${n}</svg>`:n;const m=templateContainer.content;if(s){const _=m.firstChild;for(;_.firstChild;)m.appendChild(_.firstChild);m.removeChild(_)}e.insertBefore(m,o)}return[d?d.nextSibling:e.firstChild,o?o.previousSibling:e.lastChild]}};function patchClass(n,e,o){const s=n._vtc;s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?n.removeAttribute("class"):o?n.setAttribute("class",e):n.className=e}function patchStyle(n,e,o){const s=n.style,c=isString(o);if(o&&!c){if(e&&!isString(e))for(const u in e)o[u]==null&&setStyle(s,u,"");for(const u in o)setStyle(s,u,o[u])}else{const u=s.display;c?e!==o&&(s.cssText=o):e&&n.removeAttribute("style"),"_vod"in n&&(s.display=u)}}const importantRE=/\s*!important$/;function setStyle(n,e,o){if(isArray$1(o))o.forEach(s=>setStyle(n,e,s));else if(o==null&&(o=""),e.startsWith("--"))n.setProperty(e,o);else{const s=autoPrefix(n,e);importantRE.test(o)?n.setProperty(hyphenate(s),o.replace(importantRE,""),"important"):n[s]=o}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(n,e){const o=prefixCache[e];if(o)return o;let s=camelize(e);if(s!=="filter"&&s in n)return prefixCache[e]=s;s=capitalize(s);for(let c=0;c<prefixes.length;c++){const u=prefixes[c]+s;if(u in n)return prefixCache[e]=u}return e}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(n,e,o,s,c){if(s&&e.startsWith("xlink:"))o==null?n.removeAttributeNS(xlinkNS,e.slice(6,e.length)):n.setAttributeNS(xlinkNS,e,o);else{const u=isSpecialBooleanAttr(e);o==null||u&&!includeBooleanAttr(o)?n.removeAttribute(e):n.setAttribute(e,u?"":o)}}function patchDOMProp(n,e,o,s,c,u,d){if(e==="innerHTML"||e==="textContent"){s&&d(s,c,u),n[e]=o??"";return}if(e==="value"&&n.tagName!=="PROGRESS"&&!n.tagName.includes("-")){n._value=o;const _=o??"";(n.value!==_||n.tagName==="OPTION")&&(n.value=_),o==null&&n.removeAttribute(e);return}let m=!1;if(o===""||o==null){const _=typeof n[e];_==="boolean"?o=includeBooleanAttr(o):o==null&&_==="string"?(o="",m=!0):_==="number"&&(o=0,m=!0)}try{n[e]=o}catch{}m&&n.removeAttribute(e)}function addEventListener$1(n,e,o,s){n.addEventListener(e,o,s)}function removeEventListener(n,e,o,s){n.removeEventListener(e,o,s)}function patchEvent(n,e,o,s,c=null){const u=n._vei||(n._vei={}),d=u[e];if(s&&d)d.value=s;else{const[m,_]=parseName(e);if(s){const ue=u[e]=createInvoker(s,c);addEventListener$1(n,m,ue,_)}else d&&(removeEventListener(n,m,d,_),u[e]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(n){let e;if(optionsModifierRE.test(n)){e={};let s;for(;s=n.match(optionsModifierRE);)n=n.slice(0,n.length-s[0].length),e[s[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):hyphenate(n.slice(2)),e]}let cachedNow=0;const p$2=Promise.resolve(),getNow=()=>cachedNow||(p$2.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(n,e){const o=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=o.attached)return;callWithAsyncErrorHandling(patchStopImmediatePropagation(s,o.value),e,5,[s])};return o.value=n,o.attached=getNow(),o}function patchStopImmediatePropagation(n,e){if(isArray$1(e)){const o=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{o.call(n),n._stopped=!0},e.map(s=>c=>!c._stopped&&s&&s(c))}else return e}const nativeOnRE=/^on[a-z]/,patchProp=(n,e,o,s,c=!1,u,d,m,_)=>{e==="class"?patchClass(n,s,c):e==="style"?patchStyle(n,o,s):isOn(e)?isModelListener(e)||patchEvent(n,e,o,s,d):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):shouldSetAsProp(n,e,s,c))?patchDOMProp(n,e,s,u,d,m,_):(e==="true-value"?n._trueValue=s:e==="false-value"&&(n._falseValue=s),patchAttr(n,e,s,c))};function shouldSetAsProp(n,e,o,s){return s?!!(e==="innerHTML"||e==="textContent"||e in n&&nativeOnRE.test(e)&&isFunction(o)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA"||nativeOnRE.test(e)&&isString(o)?!1:e in n}const getModelAssigner=n=>{const e=n.props["onUpdate:modelValue"]||!1;return isArray$1(e)?o=>invokeArrayFns(e,o):e};function onCompositionStart(n){n.target.composing=!0}function onCompositionEnd(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const vModelText={created(n,{modifiers:{lazy:e,trim:o,number:s}},c){n._assign=getModelAssigner(c);const u=s||c.props&&c.props.type==="number";addEventListener$1(n,e?"change":"input",d=>{if(d.target.composing)return;let m=n.value;o&&(m=m.trim()),u&&(m=looseToNumber(m)),n._assign(m)}),o&&addEventListener$1(n,"change",()=>{n.value=n.value.trim()}),e||(addEventListener$1(n,"compositionstart",onCompositionStart),addEventListener$1(n,"compositionend",onCompositionEnd),addEventListener$1(n,"change",onCompositionEnd))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,modifiers:{lazy:o,trim:s,number:c}},u){if(n._assign=getModelAssigner(u),n.composing||document.activeElement===n&&n.type!=="range"&&(o||s&&n.value.trim()===e||(c||n.type==="number")&&looseToNumber(n.value)===e))return;const d=e??"";n.value!==d&&(n.value=d)}},vModelCheckbox={deep:!0,created(n,e,o){n._assign=getModelAssigner(o),addEventListener$1(n,"change",()=>{const s=n._modelValue,c=getValue(n),u=n.checked,d=n._assign;if(isArray$1(s)){const m=looseIndexOf(s,c),_=m!==-1;if(u&&!_)d(s.concat(c));else if(!u&&_){const ue=[...s];ue.splice(m,1),d(ue)}}else if(isSet(s)){const m=new Set(s);u?m.add(c):m.delete(c),d(m)}else d(getCheckboxValue(n,u))})},mounted:setChecked,beforeUpdate(n,e,o){n._assign=getModelAssigner(o),setChecked(n,e,o)}};function setChecked(n,{value:e,oldValue:o},s){n._modelValue=e,isArray$1(e)?n.checked=looseIndexOf(e,s.props.value)>-1:isSet(e)?n.checked=e.has(s.props.value):e!==o&&(n.checked=looseEqual(e,getCheckboxValue(n,!0)))}const vModelRadio={created(n,{value:e},o){n.checked=looseEqual(e,o.props.value),n._assign=getModelAssigner(o),addEventListener$1(n,"change",()=>{n._assign(getValue(n))})},beforeUpdate(n,{value:e,oldValue:o},s){n._assign=getModelAssigner(s),e!==o&&(n.checked=looseEqual(e,s.props.value))}},vModelSelect={deep:!0,created(n,{value:e,modifiers:{number:o}},s){const c=isSet(e);addEventListener$1(n,"change",()=>{const u=Array.prototype.filter.call(n.options,d=>d.selected).map(d=>o?looseToNumber(getValue(d)):getValue(d));n._assign(n.multiple?c?new Set(u):u:u[0])}),n._assign=getModelAssigner(s)},mounted(n,{value:e}){setSelected(n,e)},beforeUpdate(n,e,o){n._assign=getModelAssigner(o)},updated(n,{value:e}){setSelected(n,e)}};function setSelected(n,e){const o=n.multiple;if(!(o&&!isArray$1(e)&&!isSet(e))){for(let s=0,c=n.options.length;s<c;s++){const u=n.options[s],d=getValue(u);if(o)isArray$1(e)?u.selected=looseIndexOf(e,d)>-1:u.selected=e.has(d);else if(looseEqual(getValue(u),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!o&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function getValue(n){return"_value"in n?n._value:n.value}function getCheckboxValue(n,e){const o=e?"_trueValue":"_falseValue";return o in n?n[o]:e}const vModelDynamic={created(n,e,o){callModelHook(n,e,o,null,"created")},mounted(n,e,o){callModelHook(n,e,o,null,"mounted")},beforeUpdate(n,e,o,s){callModelHook(n,e,o,s,"beforeUpdate")},updated(n,e,o,s){callModelHook(n,e,o,s,"updated")}};function resolveDynamicModel(n,e){switch(n){case"SELECT":return vModelSelect;case"TEXTAREA":return vModelText;default:switch(e){case"checkbox":return vModelCheckbox;case"radio":return vModelRadio;default:return vModelText}}}function callModelHook(n,e,o,s,c){const d=resolveDynamicModel(n.tagName,o.props&&o.props.type)[c];d&&d(n,e,o,s)}const systemModifiers=["ctrl","shift","alt","meta"],modifierGuards={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>systemModifiers.some(o=>n[`${o}Key`]&&!e.includes(o))},withModifiers=(n,e)=>(o,...s)=>{for(let c=0;c<e.length;c++){const u=modifierGuards[e[c]];if(u&&u(o,e))return}return n(o,...s)},keyNames={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},withKeys=(n,e)=>o=>{if(!("key"in o))return;const s=hyphenate(o.key);if(e.some(c=>c===s||keyNames[c]===s))return n(o)},rendererOptions=extend$1({patchProp},nodeOps);let renderer;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}const createApp=(...n)=>{const e=ensureRenderer().createApp(...n),{mount:o}=e;return e.mount=s=>{const c=normalizeContainer(s);if(!c)return;const u=e._component;!isFunction(u)&&!u.render&&!u.template&&(u.template=c.innerHTML),c.innerHTML="";const d=o(c,!1,c instanceof SVGElement);return c instanceof Element&&(c.removeAttribute("v-cloak"),c.setAttribute("data-v-app","")),d},e};function normalizeContainer(n){return isString(n)?document.querySelector(n):n}var isVue2=!1;/*!
  * pinia v2.0.34
  * (c) 2023 Eduardo San Martin Morote
  * @license MIT
  */let activePinia;const setActivePinia=n=>activePinia=n,piniaSymbol=Symbol();function isPlainObject(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var MutationType;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(MutationType||(MutationType={}));function createPinia(){const n=effectScope(!0),e=n.run(()=>ref$1({}));let o=[],s=[];const c=markRaw({install(u){setActivePinia(c),c._a=u,u.provide(piniaSymbol,c),u.config.globalProperties.$pinia=c,s.forEach(d=>o.push(d)),s=[]},use(u){return!this._a&&!isVue2?s.push(u):o.push(u),this},_p:o,_a:null,_e:n,_s:new Map,state:e});return c}const noop$3=()=>{};function addSubscription(n,e,o,s=noop$3){n.push(e);const c=()=>{const u=n.indexOf(e);u>-1&&(n.splice(u,1),s())};return!o&&getCurrentScope()&&onScopeDispose(c),c}function triggerSubscriptions(n,...e){n.slice().forEach(o=>{o(...e)})}function mergeReactiveObjects(n,e){n instanceof Map&&e instanceof Map&&e.forEach((o,s)=>n.set(s,o)),n instanceof Set&&e instanceof Set&&e.forEach(n.add,n);for(const o in e){if(!e.hasOwnProperty(o))continue;const s=e[o],c=n[o];isPlainObject(c)&&isPlainObject(s)&&n.hasOwnProperty(o)&&!isRef(s)&&!isReactive(s)?n[o]=mergeReactiveObjects(c,s):n[o]=s}return n}const skipHydrateSymbol=Symbol();function shouldHydrate(n){return!isPlainObject(n)||!n.hasOwnProperty(skipHydrateSymbol)}const{assign:assign$1}=Object;function isComputed(n){return!!(isRef(n)&&n.effect)}function createOptionsStore(n,e,o,s){const{state:c,actions:u,getters:d}=e,m=o.state.value[n];let _;function ue(){m||(o.state.value[n]=c?c():{});const gn=toRefs(o.state.value[n]);return assign$1(gn,u,Object.keys(d||{}).reduce((nh,ih)=>(nh[ih]=markRaw(computed(()=>{setActivePinia(o);const rh=o._s.get(n);return d[ih].call(rh,rh)})),nh),{}))}return _=createSetupStore(n,ue,e,o,s,!0),_}function createSetupStore(n,e,o={},s,c,u){let d;const m=assign$1({actions:{}},o),_={deep:!0};let ue,gn,nh=markRaw([]),ih=markRaw([]),rh;const oh=s.state.value[n];!u&&!oh&&(s.state.value[n]={}),ref$1({});let lh;function ch(Ch){let Mh;ue=gn=!1,typeof Ch=="function"?(Ch(s.state.value[n]),Mh={type:MutationType.patchFunction,storeId:n,events:rh}):(mergeReactiveObjects(s.state.value[n],Ch),Mh={type:MutationType.patchObject,payload:Ch,storeId:n,events:rh});const Ph=lh=Symbol();nextTick().then(()=>{lh===Ph&&(ue=!0)}),gn=!0,triggerSubscriptions(nh,Mh,s.state.value[n])}const dh=u?function(){const{state:Mh}=o,Ph=Mh?Mh():{};this.$patch(Eh=>{assign$1(Eh,Ph)})}:noop$3;function _h(){d.stop(),nh=[],ih=[],s._s.delete(n)}function Sh(Ch,Mh){return function(){setActivePinia(s);const Ph=Array.from(arguments),Eh=[],Nh=[];function Wh(Ah){Eh.push(Ah)}function Yh(Ah){Nh.push(Ah)}triggerSubscriptions(ih,{args:Ph,name:Ch,store:yh,after:Wh,onError:Yh});let gh;try{gh=Mh.apply(this&&this.$id===n?this:yh,Ph)}catch(Ah){throw triggerSubscriptions(Nh,Ah),Ah}return gh instanceof Promise?gh.then(Ah=>(triggerSubscriptions(Eh,Ah),Ah)).catch(Ah=>(triggerSubscriptions(Nh,Ah),Promise.reject(Ah))):(triggerSubscriptions(Eh,gh),gh)}}const fh={_p:s,$id:n,$onAction:addSubscription.bind(null,ih),$patch:ch,$reset:dh,$subscribe(Ch,Mh={}){const Ph=addSubscription(nh,Ch,Mh.detached,()=>Eh()),Eh=d.run(()=>watch(()=>s.state.value[n],Nh=>{(Mh.flush==="sync"?gn:ue)&&Ch({storeId:n,type:MutationType.direct,events:rh},Nh)},assign$1({},_,Mh)));return Ph},$dispose:_h},yh=reactive(fh);s._s.set(n,yh);const mh=s._e.run(()=>(d=effectScope(),d.run(()=>e())));for(const Ch in mh){const Mh=mh[Ch];if(isRef(Mh)&&!isComputed(Mh)||isReactive(Mh))u||(oh&&shouldHydrate(Mh)&&(isRef(Mh)?Mh.value=oh[Ch]:mergeReactiveObjects(Mh,oh[Ch])),s.state.value[n][Ch]=Mh);else if(typeof Mh=="function"){const Ph=Sh(Ch,Mh);mh[Ch]=Ph,m.actions[Ch]=Mh}}return assign$1(yh,mh),assign$1(toRaw(yh),mh),Object.defineProperty(yh,"$state",{get:()=>s.state.value[n],set:Ch=>{ch(Mh=>{assign$1(Mh,Ch)})}}),s._p.forEach(Ch=>{assign$1(yh,d.run(()=>Ch({store:yh,app:s._a,pinia:s,options:m})))}),oh&&u&&o.hydrate&&o.hydrate(yh.$state,oh),ue=!0,gn=!0,yh}function defineStore(n,e,o){let s,c;const u=typeof e=="function";typeof n=="string"?(s=n,c=u?o:e):(c=n,s=n.id);function d(m,_){const ue=getCurrentInstance();return m=m||ue&&inject(piniaSymbol,null),m&&setActivePinia(m),m=activePinia,m._s.has(s)||(u?createSetupStore(s,e,c,m):createOptionsStore(s,c,m)),m._s.get(s)}return d.$id=s,d}function isObject$2(n){return typeof n=="object"&&n!==null}function normalizeOptions(n,e){return n=isObject$2(n)?n:Object.create(null),new Proxy(n,{get(o,s,c){return s==="key"?Reflect.get(o,s,c):Reflect.get(o,s,c)||Reflect.get(e,s,c)}})}function get$1(n,e){return e.reduce((o,s)=>o==null?void 0:o[s],n)}function set$1(n,e,o){return e.slice(0,-1).reduce((s,c)=>/^(__proto__)$/.test(c)?{}:s[c]=s[c]||{},n)[e[e.length-1]]=o,n}function pick(n,e){return e.reduce((o,s)=>{const c=s.split(".");return set$1(o,c,get$1(n,c))},{})}function hydrateStore(n,{storage:e,serializer:o,key:s,debug:c}){try{const u=e==null?void 0:e.getItem(s);u&&n.$patch(o==null?void 0:o.deserialize(u))}catch(u){c&&console.error(u)}}function persistState(n,{storage:e,serializer:o,key:s,paths:c,debug:u}){try{const d=Array.isArray(c)?pick(n,c):n;e.setItem(s,o.serialize(d))}catch(d){u&&console.error(d)}}function createPersistedState(n={}){return e=>{const{auto:o=!1}=n,{options:{persist:s=o},store:c}=e;if(!s)return;const u=(Array.isArray(s)?s.map(d=>normalizeOptions(d,n)):[normalizeOptions(s,n)]).map(({storage:d=localStorage,beforeRestore:m=null,afterRestore:_=null,serializer:ue={serialize:JSON.stringify,deserialize:JSON.parse},key:gn=c.$id,paths:nh=null,debug:ih=!1})=>{var rh;return{storage:d,beforeRestore:m,afterRestore:_,serializer:ue,key:((rh=n.key)!=null?rh:oh=>oh)(gn),paths:nh,debug:ih}});c.$persist=()=>{u.forEach(d=>{persistState(c.$state,d)})},c.$hydrate=({runHooks:d=!0}={})=>{u.forEach(m=>{const{beforeRestore:_,afterRestore:ue}=m;d&&(_==null||_(e)),hydrateStore(c,m),d&&(ue==null||ue(e))})},u.forEach(d=>{const{beforeRestore:m,afterRestore:_}=d;m==null||m(e),hydrateStore(c,d),_==null||_(e),c.$subscribe((ue,gn)=>{persistState(gn,d)},{detached:!0})})}}var src_default=createPersistedState();class Text{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,o,s){let c=[];return this.decompose(0,e,c,2),s.length&&s.decompose(0,s.length,c,3),this.decompose(o,this.length,c,1),TextNode.from(c,this.length-(o-e)+s.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,o=this.length){let s=[];return this.decompose(e,o,s,0),TextNode.from(s,o-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let o=this.scanIdentical(e,1),s=this.length-this.scanIdentical(e,-1),c=new RawTextCursor(this),u=new RawTextCursor(e);for(let d=o,m=o;;){if(c.next(d),u.next(d),d=0,c.lineBreak!=u.lineBreak||c.done!=u.done||c.value!=u.value)return!1;if(m+=c.value.length,c.done||m>=s)return!0}}iter(e=1){return new RawTextCursor(this,e)}iterRange(e,o=this.length){return new PartialTextCursor(this,e,o)}iterLines(e,o){let s;if(e==null)s=this.iter();else{o==null&&(o=this.lines+1);let c=this.line(e).from;s=this.iterRange(c,Math.max(c,o==this.lines+1?this.length:o<=1?0:this.line(o-1).to))}return new LineCursor(s)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Text.empty:e.length<=32?new TextLeaf(e):TextNode.from(TextLeaf.split(e,[]))}}class TextLeaf extends Text{constructor(e,o=textLength(e)){super(),this.text=e,this.length=o}get lines(){return this.text.length}get children(){return null}lineInner(e,o,s,c){for(let u=0;;u++){let d=this.text[u],m=c+d.length;if((o?s:m)>=e)return new Line(c,m,s,d);c=m+1,s++}}decompose(e,o,s,c){let u=e<=0&&o>=this.length?this:new TextLeaf(sliceText(this.text,e,o),Math.min(o,this.length)-Math.max(0,e));if(c&1){let d=s.pop(),m=appendText(u.text,d.text.slice(),0,u.length);if(m.length<=32)s.push(new TextLeaf(m,d.length+u.length));else{let _=m.length>>1;s.push(new TextLeaf(m.slice(0,_)),new TextLeaf(m.slice(_)))}}else s.push(u)}replace(e,o,s){if(!(s instanceof TextLeaf))return super.replace(e,o,s);let c=appendText(this.text,appendText(s.text,sliceText(this.text,0,e)),o),u=this.length+s.length-(o-e);return c.length<=32?new TextLeaf(c,u):TextNode.from(TextLeaf.split(c,[]),u)}sliceString(e,o=this.length,s=`
`){let c="";for(let u=0,d=0;u<=o&&d<this.text.length;d++){let m=this.text[d],_=u+m.length;u>e&&d&&(c+=s),e<_&&o>u&&(c+=m.slice(Math.max(0,e-u),o-u)),u=_+1}return c}flatten(e){for(let o of this.text)e.push(o)}scanIdentical(){return 0}static split(e,o){let s=[],c=-1;for(let u of e)s.push(u),c+=u.length+1,s.length==32&&(o.push(new TextLeaf(s,c)),s=[],c=-1);return c>-1&&o.push(new TextLeaf(s,c)),o}}class TextNode extends Text{constructor(e,o){super(),this.children=e,this.length=o,this.lines=0;for(let s of e)this.lines+=s.lines}lineInner(e,o,s,c){for(let u=0;;u++){let d=this.children[u],m=c+d.length,_=s+d.lines-1;if((o?_:m)>=e)return d.lineInner(e,o,s,c);c=m+1,s=_+1}}decompose(e,o,s,c){for(let u=0,d=0;d<=o&&u<this.children.length;u++){let m=this.children[u],_=d+m.length;if(e<=_&&o>=d){let ue=c&((d<=e?1:0)|(_>=o?2:0));d>=e&&_<=o&&!ue?s.push(m):m.decompose(e-d,o-d,s,ue)}d=_+1}}replace(e,o,s){if(s.lines<this.lines)for(let c=0,u=0;c<this.children.length;c++){let d=this.children[c],m=u+d.length;if(e>=u&&o<=m){let _=d.replace(e-u,o-u,s),ue=this.lines-d.lines+_.lines;if(_.lines<ue>>5-1&&_.lines>ue>>5+1){let gn=this.children.slice();return gn[c]=_,new TextNode(gn,this.length-(o-e)+s.length)}return super.replace(u,m,_)}u=m+1}return super.replace(e,o,s)}sliceString(e,o=this.length,s=`
`){let c="";for(let u=0,d=0;u<this.children.length&&d<=o;u++){let m=this.children[u],_=d+m.length;d>e&&u&&(c+=s),e<_&&o>d&&(c+=m.sliceString(e-d,o-d,s)),d=_+1}return c}flatten(e){for(let o of this.children)o.flatten(e)}scanIdentical(e,o){if(!(e instanceof TextNode))return 0;let s=0,[c,u,d,m]=o>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;c+=o,u+=o){if(c==d||u==m)return s;let _=this.children[c],ue=e.children[u];if(_!=ue)return s+_.scanIdentical(ue,o);s+=_.length+1}}static from(e,o=e.reduce((s,c)=>s+c.length+1,-1)){let s=0;for(let rh of e)s+=rh.lines;if(s<32){let rh=[];for(let oh of e)oh.flatten(rh);return new TextLeaf(rh,o)}let c=Math.max(32,s>>5),u=c<<1,d=c>>1,m=[],_=0,ue=-1,gn=[];function nh(rh){let oh;if(rh.lines>u&&rh instanceof TextNode)for(let lh of rh.children)nh(lh);else rh.lines>d&&(_>d||!_)?(ih(),m.push(rh)):rh instanceof TextLeaf&&_&&(oh=gn[gn.length-1])instanceof TextLeaf&&rh.lines+oh.lines<=32?(_+=rh.lines,ue+=rh.length+1,gn[gn.length-1]=new TextLeaf(oh.text.concat(rh.text),oh.length+1+rh.length)):(_+rh.lines>c&&ih(),_+=rh.lines,ue+=rh.length+1,gn.push(rh))}function ih(){_!=0&&(m.push(gn.length==1?gn[0]:TextNode.from(gn,ue)),ue=-1,_=gn.length=0)}for(let rh of e)nh(rh);return ih(),m.length==1?m[0]:new TextNode(m,o)}}Text.empty=new TextLeaf([""],0);function textLength(n){let e=-1;for(let o of n)e+=o.length+1;return e}function appendText(n,e,o=0,s=1e9){for(let c=0,u=0,d=!0;u<n.length&&c<=s;u++){let m=n[u],_=c+m.length;_>=o&&(_>s&&(m=m.slice(0,s-c)),c<o&&(m=m.slice(o-c)),d?(e[e.length-1]+=m,d=!1):e.push(m)),c=_+1}return e}function sliceText(n,e,o){return appendText(n,[""],e,o)}class RawTextCursor{constructor(e,o=1){this.dir=o,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[o>0?1:(e instanceof TextLeaf?e.text.length:e.children.length)<<1]}nextInner(e,o){for(this.done=this.lineBreak=!1;;){let s=this.nodes.length-1,c=this.nodes[s],u=this.offsets[s],d=u>>1,m=c instanceof TextLeaf?c.text.length:c.children.length;if(d==(o>0?m:0)){if(s==0)return this.done=!0,this.value="",this;o>0&&this.offsets[s-1]++,this.nodes.pop(),this.offsets.pop()}else if((u&1)==(o>0?0:1)){if(this.offsets[s]+=o,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(c instanceof TextLeaf){let _=c.text[d+(o<0?-1:0)];if(this.offsets[s]+=o,_.length>Math.max(0,e))return this.value=e==0?_:o>0?_.slice(e):_.slice(0,_.length-e),this;e-=_.length}else{let _=c.children[d+(o<0?-1:0)];e>_.length?(e-=_.length,this.offsets[s]+=o):(o<0&&this.offsets[s]--,this.nodes.push(_),this.offsets.push(o>0?1:(_ instanceof TextLeaf?_.text.length:_.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class PartialTextCursor{constructor(e,o,s){this.value="",this.done=!1,this.cursor=new RawTextCursor(e,o>s?-1:1),this.pos=o>s?e.length:0,this.from=Math.min(o,s),this.to=Math.max(o,s)}nextInner(e,o){if(o<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,o<0?this.pos-this.to:this.from-this.pos);let s=o<0?this.pos-this.from:this.to-this.pos;e>s&&(e=s),s-=e;let{value:c}=this.cursor.next(e);return this.pos+=(c.length+e)*o,this.value=c.length<=s?c:o<0?c.slice(c.length-s):c.slice(0,s),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class LineCursor{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:o,lineBreak:s,value:c}=this.inner.next(e);return o?(this.done=!0,this.value=""):s?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=c,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(e,o,s,c){this.from=e,this.to=o,this.number=s,this.text=c}get length(){return this.to-this.from}}let extend="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(n=>n?parseInt(n,36):1);for(let n=1;n<extend.length;n++)extend[n]+=extend[n-1];function isExtendingChar(n){for(let e=1;e<extend.length;e+=2)if(extend[e]>n)return extend[e-1]<=n;return!1}function isRegionalIndicator(n){return n>=127462&&n<=127487}const ZWJ=8205;function findClusterBreak(n,e,o=!0,s=!0){return(o?nextClusterBreak:prevClusterBreak)(n,e,s)}function nextClusterBreak(n,e,o){if(e==n.length)return e;e&&surrogateLow(n.charCodeAt(e))&&surrogateHigh(n.charCodeAt(e-1))&&e--;let s=codePointAt(n,e);for(e+=codePointSize(s);e<n.length;){let c=codePointAt(n,e);if(s==ZWJ||c==ZWJ||o&&isExtendingChar(c))e+=codePointSize(c),s=c;else if(isRegionalIndicator(c)){let u=0,d=e-2;for(;d>=0&&isRegionalIndicator(codePointAt(n,d));)u++,d-=2;if(u%2==0)break;e+=2}else break}return e}function prevClusterBreak(n,e,o){for(;e>0;){let s=nextClusterBreak(n,e-2,o);if(s<e)return s;e--}return 0}function surrogateLow(n){return n>=56320&&n<57344}function surrogateHigh(n){return n>=55296&&n<56320}function codePointAt(n,e){let o=n.charCodeAt(e);if(!surrogateHigh(o)||e+1==n.length)return o;let s=n.charCodeAt(e+1);return surrogateLow(s)?(o-55296<<10)+(s-56320)+65536:o}function fromCodePoint(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function codePointSize(n){return n<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(MapMode||(MapMode={}));class ChangeDesc{constructor(e){this.sections=e}get length(){let e=0;for(let o=0;o<this.sections.length;o+=2)e+=this.sections[o];return e}get newLength(){let e=0;for(let o=0;o<this.sections.length;o+=2){let s=this.sections[o+1];e+=s<0?this.sections[o]:s}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let o=0,s=0,c=0;o<this.sections.length;){let u=this.sections[o++],d=this.sections[o++];d<0?(e(s,c,u),c+=u):c+=d,s+=u}}iterChangedRanges(e,o=!1){iterChanges(this,e,o)}get invertedDesc(){let e=[];for(let o=0;o<this.sections.length;){let s=this.sections[o++],c=this.sections[o++];c<0?e.push(s,c):e.push(c,s)}return new ChangeDesc(e)}composeDesc(e){return this.empty?e:e.empty?this:composeSets(this,e)}mapDesc(e,o=!1){return e.empty?this:mapSet(this,e,o)}mapPos(e,o=-1,s=MapMode.Simple){let c=0,u=0;for(let d=0;d<this.sections.length;){let m=this.sections[d++],_=this.sections[d++],ue=c+m;if(_<0){if(ue>e)return u+(e-c);u+=m}else{if(s!=MapMode.Simple&&ue>=e&&(s==MapMode.TrackDel&&c<e&&ue>e||s==MapMode.TrackBefore&&c<e||s==MapMode.TrackAfter&&ue>e))return null;if(ue>e||ue==e&&o<0&&!m)return e==c||o<0?u:u+_;u+=_}c=ue}if(e>c)throw new RangeError(`Position ${e} is out of range for changeset of length ${c}`);return u}touchesRange(e,o=e){for(let s=0,c=0;s<this.sections.length&&c<=o;){let u=this.sections[s++],d=this.sections[s++],m=c+u;if(d>=0&&c<=o&&m>=e)return c<e&&m>o?"cover":!0;c=m}return!1}toString(){let e="";for(let o=0;o<this.sections.length;){let s=this.sections[o++],c=this.sections[o++];e+=(e?" ":"")+s+(c>=0?":"+c:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(o=>typeof o!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(e)}static create(e){return new ChangeDesc(e)}}class ChangeSet extends ChangeDesc{constructor(e,o){super(e),this.inserted=o}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,(o,s,c,u,d)=>e=e.replace(c,c+(s-o),d),!1),e}mapDesc(e,o=!1){return mapSet(this,e,o,!0)}invert(e){let o=this.sections.slice(),s=[];for(let c=0,u=0;c<o.length;c+=2){let d=o[c],m=o[c+1];if(m>=0){o[c]=m,o[c+1]=d;let _=c>>1;for(;s.length<_;)s.push(Text.empty);s.push(d?e.slice(u,u+d):Text.empty)}u+=d}return new ChangeSet(o,s)}compose(e){return this.empty?e:e.empty?this:composeSets(this,e,!0)}map(e,o=!1){return e.empty?this:mapSet(this,e,o,!0)}iterChanges(e,o=!1){iterChanges(this,e,o)}get desc(){return ChangeDesc.create(this.sections)}filter(e){let o=[],s=[],c=[],u=new SectionIter(this);e:for(let d=0,m=0;;){let _=d==e.length?1e9:e[d++];for(;m<_||m==_&&u.len==0;){if(u.done)break e;let gn=Math.min(u.len,_-m);addSection(c,gn,-1);let nh=u.ins==-1?-1:u.off==0?u.ins:0;addSection(o,gn,nh),nh>0&&addInsert(s,o,u.text),u.forward(gn),m+=gn}let ue=e[d++];for(;m<ue;){if(u.done)break e;let gn=Math.min(u.len,ue-m);addSection(o,gn,-1),addSection(c,gn,u.ins==-1?-1:u.off==0?u.ins:0),u.forward(gn),m+=gn}}return{changes:new ChangeSet(o,s),filtered:ChangeDesc.create(c)}}toJSON(){let e=[];for(let o=0;o<this.sections.length;o+=2){let s=this.sections[o],c=this.sections[o+1];c<0?e.push(s):c==0?e.push([s]):e.push([s].concat(this.inserted[o>>1].toJSON()))}return e}static of(e,o,s){let c=[],u=[],d=0,m=null;function _(gn=!1){if(!gn&&!c.length)return;d<o&&addSection(c,o-d,-1);let nh=new ChangeSet(c,u);m=m?m.compose(nh.map(m)):nh,c=[],u=[],d=0}function ue(gn){if(Array.isArray(gn))for(let nh of gn)ue(nh);else if(gn instanceof ChangeSet){if(gn.length!=o)throw new RangeError(`Mismatched change set length (got ${gn.length}, expected ${o})`);_(),m=m?m.compose(gn.map(m)):gn}else{let{from:nh,to:ih=nh,insert:rh}=gn;if(nh>ih||nh<0||ih>o)throw new RangeError(`Invalid change range ${nh} to ${ih} (in doc of length ${o})`);let oh=rh?typeof rh=="string"?Text.of(rh.split(s||DefaultSplit)):rh:Text.empty,lh=oh.length;if(nh==ih&&lh==0)return;nh<d&&_(),nh>d&&addSection(c,nh-d,-1),addSection(c,ih-nh,lh),addInsert(u,c,oh),d=ih}}return ue(e),_(!m),m}static empty(e){return new ChangeSet(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let o=[],s=[];for(let c=0;c<e.length;c++){let u=e[c];if(typeof u=="number")o.push(u,-1);else{if(!Array.isArray(u)||typeof u[0]!="number"||u.some((d,m)=>m&&typeof d!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(u.length==1)o.push(u[0],0);else{for(;s.length<c;)s.push(Text.empty);s[c]=Text.of(u.slice(1)),o.push(u[0],s[c].length)}}}return new ChangeSet(o,s)}static createSet(e,o){return new ChangeSet(e,o)}}function addSection(n,e,o,s=!1){if(e==0&&o<=0)return;let c=n.length-2;c>=0&&o<=0&&o==n[c+1]?n[c]+=e:e==0&&n[c]==0?n[c+1]+=o:s?(n[c]+=e,n[c+1]+=o):n.push(e,o)}function addInsert(n,e,o){if(o.length==0)return;let s=e.length-2>>1;if(s<n.length)n[n.length-1]=n[n.length-1].append(o);else{for(;n.length<s;)n.push(Text.empty);n.push(o)}}function iterChanges(n,e,o){let s=n.inserted;for(let c=0,u=0,d=0;d<n.sections.length;){let m=n.sections[d++],_=n.sections[d++];if(_<0)c+=m,u+=m;else{let ue=c,gn=u,nh=Text.empty;for(;ue+=m,gn+=_,_&&s&&(nh=nh.append(s[d-2>>1])),!(o||d==n.sections.length||n.sections[d+1]<0);)m=n.sections[d++],_=n.sections[d++];e(c,ue,u,gn,nh),c=ue,u=gn}}}function mapSet(n,e,o,s=!1){let c=[],u=s?[]:null,d=new SectionIter(n),m=new SectionIter(e);for(let _=-1;;)if(d.ins==-1&&m.ins==-1){let ue=Math.min(d.len,m.len);addSection(c,ue,-1),d.forward(ue),m.forward(ue)}else if(m.ins>=0&&(d.ins<0||_==d.i||d.off==0&&(m.len<d.len||m.len==d.len&&!o))){let ue=m.len;for(addSection(c,m.ins,-1);ue;){let gn=Math.min(d.len,ue);d.ins>=0&&_<d.i&&d.len<=gn&&(addSection(c,0,d.ins),u&&addInsert(u,c,d.text),_=d.i),d.forward(gn),ue-=gn}m.next()}else if(d.ins>=0){let ue=0,gn=d.len;for(;gn;)if(m.ins==-1){let nh=Math.min(gn,m.len);ue+=nh,gn-=nh,m.forward(nh)}else if(m.ins==0&&m.len<gn)gn-=m.len,m.next();else break;addSection(c,ue,_<d.i?d.ins:0),u&&_<d.i&&addInsert(u,c,d.text),_=d.i,d.forward(d.len-gn)}else{if(d.done&&m.done)return u?ChangeSet.createSet(c,u):ChangeDesc.create(c);throw new Error("Mismatched change set lengths")}}function composeSets(n,e,o=!1){let s=[],c=o?[]:null,u=new SectionIter(n),d=new SectionIter(e);for(let m=!1;;){if(u.done&&d.done)return c?ChangeSet.createSet(s,c):ChangeDesc.create(s);if(u.ins==0)addSection(s,u.len,0,m),u.next();else if(d.len==0&&!d.done)addSection(s,0,d.ins,m),c&&addInsert(c,s,d.text),d.next();else{if(u.done||d.done)throw new Error("Mismatched change set lengths");{let _=Math.min(u.len2,d.len),ue=s.length;if(u.ins==-1){let gn=d.ins==-1?-1:d.off?0:d.ins;addSection(s,_,gn,m),c&&gn&&addInsert(c,s,d.text)}else d.ins==-1?(addSection(s,u.off?0:u.len,_,m),c&&addInsert(c,s,u.textBit(_))):(addSection(s,u.off?0:u.len,d.off?0:d.ins,m),c&&!d.off&&addInsert(c,s,d.text));m=(u.ins>_||d.ins>=0&&d.len>_)&&(m||s.length>ue),u.forward2(_),d.forward(_)}}}}class SectionIter{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,o=this.i-2>>1;return o>=e.length?Text.empty:e[o]}textBit(e){let{inserted:o}=this.set,s=this.i-2>>1;return s>=o.length&&!e?Text.empty:o[s].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class SelectionRange{constructor(e,o,s){this.from=e,this.to=o,this.flags=s}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,o=-1){let s,c;return this.empty?s=c=e.mapPos(this.from,o):(s=e.mapPos(this.from,1),c=e.mapPos(this.to,-1)),s==this.from&&c==this.to?this:new SelectionRange(s,c,this.flags)}extend(e,o=e){if(e<=this.anchor&&o>=this.anchor)return EditorSelection.range(e,o);let s=Math.abs(e-this.anchor)>Math.abs(o-this.anchor)?e:o;return EditorSelection.range(this.anchor,s)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)}static create(e,o,s){return new SelectionRange(e,o,s)}}class EditorSelection{constructor(e,o){this.ranges=e,this.mainIndex=o}map(e,o=-1){return e.empty?this:EditorSelection.create(this.ranges.map(s=>s.map(e,o)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let o=0;o<this.ranges.length;o++)if(!this.ranges[o].eq(e.ranges[o]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new EditorSelection([this.main],0)}addRange(e,o=!0){return EditorSelection.create([e].concat(this.ranges),o?0:this.mainIndex+1)}replaceRange(e,o=this.mainIndex){let s=this.ranges.slice();return s[o]=e,EditorSelection.create(s,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(e.ranges.map(o=>SelectionRange.fromJSON(o)),e.main)}static single(e,o=e){return new EditorSelection([EditorSelection.range(e,o)],0)}static create(e,o=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let s=0,c=0;c<e.length;c++){let u=e[c];if(u.empty?u.from<=s:u.from<s)return EditorSelection.normalized(e.slice(),o);s=u.to}return new EditorSelection(e,o)}static cursor(e,o=0,s,c){return SelectionRange.create(e,e,(o==0?0:o<0?4:8)|(s==null?3:Math.min(2,s))|(c??33554431)<<5)}static range(e,o,s,c){let u=(s??33554431)<<5|(c==null?3:Math.min(2,c));return o<e?SelectionRange.create(o,e,24|u):SelectionRange.create(e,o,(o>e?4:0)|u)}static normalized(e,o=0){let s=e[o];e.sort((c,u)=>c.from-u.from),o=e.indexOf(s);for(let c=1;c<e.length;c++){let u=e[c],d=e[c-1];if(u.empty?u.from<=d.to:u.from<d.to){let m=d.from,_=Math.max(u.to,d.to);c<=o&&o--,e.splice(--c,2,u.anchor>u.head?EditorSelection.range(_,m):EditorSelection.range(m,_))}}return new EditorSelection(e,o)}}function checkSelection(n,e){for(let o of n.ranges)if(o.to>e)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(e,o,s,c,u){this.combine=e,this.compareInput=o,this.compare=s,this.isStatic=c,this.id=nextID++,this.default=e([]),this.extensions=typeof u=="function"?u(this):u}static define(e={}){return new Facet(e.combine||(o=>o),e.compareInput||((o,s)=>o===s),e.compare||(e.combine?(o,s)=>o===s:sameArray$1),!!e.static,e.enables)}of(e){return new FacetProvider([],this,0,e)}compute(e,o){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,o)}computeN(e,o){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,o)}from(e,o){return o||(o=s=>s),this.compute([e],s=>o(s.field(e)))}}function sameArray$1(n,e){return n==e||n.length==e.length&&n.every((o,s)=>o===e[s])}class FacetProvider{constructor(e,o,s,c){this.dependencies=e,this.facet=o,this.type=s,this.value=c,this.id=nextID++}dynamicSlot(e){var o;let s=this.value,c=this.facet.compareInput,u=this.id,d=e[u]>>1,m=this.type==2,_=!1,ue=!1,gn=[];for(let nh of this.dependencies)nh=="doc"?_=!0:nh=="selection"?ue=!0:((o=e[nh.id])!==null&&o!==void 0?o:1)&1||gn.push(e[nh.id]);return{create(nh){return nh.values[d]=s(nh),1},update(nh,ih){if(_&&ih.docChanged||ue&&(ih.docChanged||ih.selection)||ensureAll(nh,gn)){let rh=s(nh);if(m?!compareArray(rh,nh.values[d],c):!c(rh,nh.values[d]))return nh.values[d]=rh,1}return 0},reconfigure:(nh,ih)=>{let rh,oh=ih.config.address[u];if(oh!=null){let lh=getAddr(ih,oh);if(this.dependencies.every(ch=>ch instanceof Facet?ih.facet(ch)===nh.facet(ch):ch instanceof StateField?ih.field(ch,!1)==nh.field(ch,!1):!0)||(m?compareArray(rh=s(nh),lh,c):c(rh=s(nh),lh)))return nh.values[d]=lh,0}else rh=s(nh);return nh.values[d]=rh,1}}}}function compareArray(n,e,o){if(n.length!=e.length)return!1;for(let s=0;s<n.length;s++)if(!o(n[s],e[s]))return!1;return!0}function ensureAll(n,e){let o=!1;for(let s of e)ensureAddr(n,s)&1&&(o=!0);return o}function dynamicFacetSlot(n,e,o){let s=o.map(_=>n[_.id]),c=o.map(_=>_.type),u=s.filter(_=>!(_&1)),d=n[e.id]>>1;function m(_){let ue=[];for(let gn=0;gn<s.length;gn++){let nh=getAddr(_,s[gn]);if(c[gn]==2)for(let ih of nh)ue.push(ih);else ue.push(nh)}return e.combine(ue)}return{create(_){for(let ue of s)ensureAddr(_,ue);return _.values[d]=m(_),1},update(_,ue){if(!ensureAll(_,u))return 0;let gn=m(_);return e.compare(gn,_.values[d])?0:(_.values[d]=gn,1)},reconfigure(_,ue){let gn=ensureAll(_,s),nh=ue.config.facets[e.id],ih=ue.facet(e);if(nh&&!gn&&sameArray$1(o,nh))return _.values[d]=ih,0;let rh=m(_);return e.compare(rh,ih)?(_.values[d]=ih,0):(_.values[d]=rh,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(e,o,s,c,u){this.id=e,this.createF=o,this.updateF=s,this.compareF=c,this.spec=u,this.provides=void 0}static define(e){let o=new StateField(nextID++,e.create,e.update,e.compare||((s,c)=>s===c),e);return e.provide&&(o.provides=e.provide(o)),o}create(e){let o=e.facet(initField).find(s=>s.field==this);return((o==null?void 0:o.create)||this.createF)(e)}slot(e){let o=e[this.id]>>1;return{create:s=>(s.values[o]=this.create(s),1),update:(s,c)=>{let u=s.values[o],d=this.updateF(u,c);return this.compareF(u,d)?0:(s.values[o]=d,1)},reconfigure:(s,c)=>c.config.address[this.id]!=null?(s.values[o]=c.field(this),0):(s.values[o]=this.create(s),1)}}init(e){return[this,initField.of({field:this,create:e})]}get extension(){return this}}const Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(n){return e=>new PrecExtension(e,n)}const Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),default:prec(Prec_.default),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};class PrecExtension{constructor(e,o){this.inner=e,this.prec=o}}class Compartment{of(e){return new CompartmentInstance(this,e)}reconfigure(e){return Compartment.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class CompartmentInstance{constructor(e,o){this.compartment=e,this.inner=o}}class Configuration{constructor(e,o,s,c,u,d){for(this.base=e,this.compartments=o,this.dynamicSlots=s,this.address=c,this.staticValues=u,this.facets=d,this.statusTemplate=[];this.statusTemplate.length<s.length;)this.statusTemplate.push(0)}staticFacet(e){let o=this.address[e.id];return o==null?e.default:this.staticValues[o>>1]}static resolve(e,o,s){let c=[],u=Object.create(null),d=new Map;for(let ih of flatten(e,o,d))ih instanceof StateField?c.push(ih):(u[ih.facet.id]||(u[ih.facet.id]=[])).push(ih);let m=Object.create(null),_=[],ue=[];for(let ih of c)m[ih.id]=ue.length<<1,ue.push(rh=>ih.slot(rh));let gn=s==null?void 0:s.config.facets;for(let ih in u){let rh=u[ih],oh=rh[0].facet,lh=gn&&gn[ih]||[];if(rh.every(ch=>ch.type==0))if(m[oh.id]=_.length<<1|1,sameArray$1(lh,rh))_.push(s.facet(oh));else{let ch=oh.combine(rh.map(dh=>dh.value));_.push(s&&oh.compare(ch,s.facet(oh))?s.facet(oh):ch)}else{for(let ch of rh)ch.type==0?(m[ch.id]=_.length<<1|1,_.push(ch.value)):(m[ch.id]=ue.length<<1,ue.push(dh=>ch.dynamicSlot(dh)));m[oh.id]=ue.length<<1,ue.push(ch=>dynamicFacetSlot(ch,oh,rh))}}let nh=ue.map(ih=>ih(m));return new Configuration(e,d,nh,m,_,u)}}function flatten(n,e,o){let s=[[],[],[],[],[]],c=new Map;function u(d,m){let _=c.get(d);if(_!=null){if(_<=m)return;let ue=s[_].indexOf(d);ue>-1&&s[_].splice(ue,1),d instanceof CompartmentInstance&&o.delete(d.compartment)}if(c.set(d,m),Array.isArray(d))for(let ue of d)u(ue,m);else if(d instanceof CompartmentInstance){if(o.has(d.compartment))throw new RangeError("Duplicate use of compartment in extensions");let ue=e.get(d.compartment)||d.inner;o.set(d.compartment,ue),u(ue,m)}else if(d instanceof PrecExtension)u(d.inner,d.prec);else if(d instanceof StateField)s[m].push(d),d.provides&&u(d.provides,m);else if(d instanceof FacetProvider)s[m].push(d),d.facet.extensions&&u(d.facet.extensions,Prec_.default);else{let ue=d.extension;if(!ue)throw new Error(`Unrecognized extension value in extension set (${d}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);u(ue,m)}}return u(n,Prec_.default),s.reduce((d,m)=>d.concat(m))}function ensureAddr(n,e){if(e&1)return 2;let o=e>>1,s=n.status[o];if(s==4)throw new Error("Cyclic dependency between fields and/or facets");if(s&2)return s;n.status[o]=4;let c=n.computeSlot(n,n.config.dynamicSlots[o]);return n.status[o]=2|c}function getAddr(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:n=>n.some(e=>e),static:!0}),lineSeparator=Facet.define({combine:n=>n.length?n[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:n=>n.length?n[0]:!1});class Annotation{constructor(e,o){this.type=e,this.value=o}static define(){return new AnnotationType}}class AnnotationType{of(e){return new Annotation(this,e)}}class StateEffectType{constructor(e){this.map=e}of(e){return new StateEffect(this,e)}}class StateEffect{constructor(e,o){this.type=e,this.value=o}map(e){let o=this.type.map(this.value,e);return o===void 0?void 0:o==this.value?this:new StateEffect(this.type,o)}is(e){return this.type==e}static define(e={}){return new StateEffectType(e.map||(o=>o))}static mapEffects(e,o){if(!e.length)return e;let s=[];for(let c of e){let u=c.map(o);u&&s.push(u)}return s}}StateEffect.reconfigure=StateEffect.define();StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(e,o,s,c,u,d){this.startState=e,this.changes=o,this.selection=s,this.effects=c,this.annotations=u,this.scrollIntoView=d,this._doc=null,this._state=null,s&&checkSelection(s,o.newLength),u.some(m=>m.type==Transaction.time)||(this.annotations=u.concat(Transaction.time.of(Date.now())))}static create(e,o,s,c,u,d){return new Transaction(e,o,s,c,u,d)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let o of this.annotations)if(o.type==e)return o.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let o=this.annotation(Transaction.userEvent);return!!(o&&(o==e||o.length>e.length&&o.slice(0,e.length)==e&&o[e.length]=="."))}}Transaction.time=Annotation.define();Transaction.userEvent=Annotation.define();Transaction.addToHistory=Annotation.define();Transaction.remote=Annotation.define();function joinRanges(n,e){let o=[];for(let s=0,c=0;;){let u,d;if(s<n.length&&(c==e.length||e[c]>=n[s]))u=n[s++],d=n[s++];else if(c<e.length)u=e[c++],d=e[c++];else return o;!o.length||o[o.length-1]<u?o.push(u,d):o[o.length-1]<d&&(o[o.length-1]=d)}}function mergeTransaction(n,e,o){var s;let c,u,d;return o?(c=e.changes,u=ChangeSet.empty(e.changes.length),d=n.changes.compose(e.changes)):(c=e.changes.map(n.changes),u=n.changes.mapDesc(e.changes,!0),d=n.changes.compose(c)),{changes:d,selection:e.selection?e.selection.map(u):(s=n.selection)===null||s===void 0?void 0:s.map(c),effects:StateEffect.mapEffects(n.effects,c).concat(StateEffect.mapEffects(e.effects,u)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function resolveTransactionInner(n,e,o){let s=e.selection,c=asArray$1(e.annotations);return e.userEvent&&(c=c.concat(Transaction.userEvent.of(e.userEvent))),{changes:e.changes instanceof ChangeSet?e.changes:ChangeSet.of(e.changes||[],o,n.facet(lineSeparator)),selection:s&&(s instanceof EditorSelection?s:EditorSelection.single(s.anchor,s.head)),effects:asArray$1(e.effects),annotations:c,scrollIntoView:!!e.scrollIntoView}}function resolveTransaction(n,e,o){let s=resolveTransactionInner(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(o=!1);for(let u=1;u<e.length;u++){e[u].filter===!1&&(o=!1);let d=!!e[u].sequential;s=mergeTransaction(s,resolveTransactionInner(n,e[u],d?s.changes.newLength:n.doc.length),d)}let c=Transaction.create(n,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return extendTransaction(o?filterTransaction(c):c)}function filterTransaction(n){let e=n.startState,o=!0;for(let c of e.facet(changeFilter)){let u=c(n);if(u===!1){o=!1;break}Array.isArray(u)&&(o=o===!0?u:joinRanges(o,u))}if(o!==!0){let c,u;if(o===!1)u=n.changes.invertedDesc,c=ChangeSet.empty(e.doc.length);else{let d=n.changes.filter(o);c=d.changes,u=d.filtered.mapDesc(d.changes).invertedDesc}n=Transaction.create(e,c,n.selection&&n.selection.map(u),StateEffect.mapEffects(n.effects,u),n.annotations,n.scrollIntoView)}let s=e.facet(transactionFilter);for(let c=s.length-1;c>=0;c--){let u=s[c](n);u instanceof Transaction?n=u:Array.isArray(u)&&u.length==1&&u[0]instanceof Transaction?n=u[0]:n=resolveTransaction(e,asArray$1(u),!1)}return n}function extendTransaction(n){let e=n.startState,o=e.facet(transactionExtender),s=n;for(let c=o.length-1;c>=0;c--){let u=o[c](n);u&&Object.keys(u).length&&(s=mergeTransaction(s,resolveTransactionInner(e,u,n.changes.newLength),!0))}return s==n?n:Transaction.create(e,n.changes,n.selection,s.effects,s.annotations,s.scrollIntoView)}const none$2=[];function asArray$1(n){return n==null?none$2:Array.isArray(n)?n:[n]}var CharCategory=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function hasWordChar(n){if(wordChar)return wordChar.test(n);for(let e=0;e<n.length;e++){let o=n[e];if(/\w/.test(o)||o>""&&(o.toUpperCase()!=o.toLowerCase()||nonASCIISingleCaseWordChar.test(o)))return!0}return!1}function makeCategorizer(n){return e=>{if(!/\S/.test(e))return CharCategory.Space;if(hasWordChar(e))return CharCategory.Word;for(let o=0;o<n.length;o++)if(e.indexOf(n[o])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(e,o,s,c,u,d){this.config=e,this.doc=o,this.selection=s,this.values=c,this.status=e.statusTemplate.slice(),this.computeSlot=u,d&&(d._state=this);for(let m=0;m<this.config.dynamicSlots.length;m++)ensureAddr(this,m<<1);this.computeSlot=null}field(e,o=!0){let s=this.config.address[e.id];if(s==null){if(o)throw new RangeError("Field is not present in this state");return}return ensureAddr(this,s),getAddr(this,s)}update(...e){return resolveTransaction(this,e,!0)}applyTransaction(e){let o=this.config,{base:s,compartments:c}=o;for(let d of e.effects)d.is(Compartment.reconfigure)?(o&&(c=new Map,o.compartments.forEach((m,_)=>c.set(_,m)),o=null),c.set(d.value.compartment,d.value.extension)):d.is(StateEffect.reconfigure)?(o=null,s=d.value):d.is(StateEffect.appendConfig)&&(o=null,s=asArray$1(s).concat(d.value));let u;o?u=e.startState.values.slice():(o=Configuration.resolve(s,c,this),u=new EditorState(o,this.doc,this.selection,o.dynamicSlots.map(()=>null),(m,_)=>_.reconfigure(m,this),null).values),new EditorState(o,e.newDoc,e.newSelection,u,(d,m)=>m.update(d,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(o=>({changes:{from:o.from,to:o.to,insert:e},range:EditorSelection.cursor(o.from+e.length)}))}changeByRange(e){let o=this.selection,s=e(o.ranges[0]),c=this.changes(s.changes),u=[s.range],d=asArray$1(s.effects);for(let m=1;m<o.ranges.length;m++){let _=e(o.ranges[m]),ue=this.changes(_.changes),gn=ue.map(c);for(let ih=0;ih<m;ih++)u[ih]=u[ih].map(gn);let nh=c.mapDesc(ue,!0);u.push(_.range.map(nh)),c=c.compose(gn),d=StateEffect.mapEffects(d,gn).concat(StateEffect.mapEffects(asArray$1(_.effects),nh))}return{changes:c,selection:EditorSelection.create(u,o.mainIndex),effects:d}}changes(e=[]){return e instanceof ChangeSet?e:ChangeSet.of(e,this.doc.length,this.facet(EditorState.lineSeparator))}toText(e){return Text.of(e.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(e=0,o=this.doc.length){return this.doc.sliceString(e,o,this.lineBreak)}facet(e){let o=this.config.address[e.id];return o==null?e.default:(ensureAddr(this,o),getAddr(this,o))}toJSON(e){let o={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let s in e){let c=e[s];c instanceof StateField&&this.config.address[c.id]!=null&&(o[s]=c.spec.toJSON(this.field(e[s]),this))}return o}static fromJSON(e,o={},s){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let c=[];if(s){for(let u in s)if(Object.prototype.hasOwnProperty.call(e,u)){let d=s[u],m=e[u];c.push(d.init(_=>d.spec.fromJSON(m,_)))}}return EditorState.create({doc:e.doc,selection:EditorSelection.fromJSON(e.selection),extensions:o.extensions?c.concat([o.extensions]):c})}static create(e={}){let o=Configuration.resolve(e.extensions||[],new Map),s=e.doc instanceof Text?e.doc:Text.of((e.doc||"").split(o.staticFacet(EditorState.lineSeparator)||DefaultSplit)),c=e.selection?e.selection instanceof EditorSelection?e.selection:EditorSelection.single(e.selection.anchor,e.selection.head):EditorSelection.single(0);return checkSelection(c,s.length),o.staticFacet(allowMultipleSelections)||(c=c.asSingle()),new EditorState(o,s,c,o.dynamicSlots.map(()=>null),(u,d)=>d.create(u),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||`
`}get readOnly(){return this.facet(readOnly)}phrase(e,...o){for(let s of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(s,e)){e=s[e];break}return o.length&&(e=e.replace(/\$(\$|\d*)/g,(s,c)=>{if(c=="$")return"$";let u=+(c||1);return!u||u>o.length?s:o[u-1]})),e}languageDataAt(e,o,s=-1){let c=[];for(let u of this.facet(languageData))for(let d of u(this,o,s))Object.prototype.hasOwnProperty.call(d,e)&&c.push(d[e]);return c}charCategorizer(e){return makeCategorizer(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:o,from:s,length:c}=this.doc.lineAt(e),u=this.charCategorizer(e),d=e-s,m=e-s;for(;d>0;){let _=findClusterBreak(o,d,!1);if(u(o.slice(_,d))!=CharCategory.Word)break;d=_}for(;m<c;){let _=findClusterBreak(o,m);if(u(o.slice(m,_))!=CharCategory.Word)break;m=_}return d==m?null:EditorSelection.range(d+s,m+s)}}EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=Facet.define({combine:n=>n.length?n[0]:4});EditorState.lineSeparator=lineSeparator;EditorState.readOnly=readOnly;EditorState.phrases=Facet.define({compare(n,e){let o=Object.keys(n),s=Object.keys(e);return o.length==s.length&&o.every(c=>n[c]==e[c])}});EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=StateEffect.define();function combineConfig(n,e,o={}){let s={};for(let c of n)for(let u of Object.keys(c)){let d=c[u],m=s[u];if(m===void 0)s[u]=d;else if(!(m===d||d===void 0))if(Object.hasOwnProperty.call(o,u))s[u]=o[u](m,d);else throw new Error("Config merge conflict for field "+u)}for(let c in e)s[c]===void 0&&(s[c]=e[c]);return s}class RangeValue{eq(e){return this==e}range(e,o=e){return Range$1.create(e,o,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=!1;RangeValue.prototype.mapMode=MapMode.TrackDel;let Range$1=class Sf{constructor(e,o,s){this.from=e,this.to=o,this.value=s}static create(e,o,s){return new Sf(e,o,s)}};function cmpRange(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class Chunk{constructor(e,o,s,c){this.from=e,this.to=o,this.value=s,this.maxPoint=c}get length(){return this.to[this.to.length-1]}findIndex(e,o,s,c=0){let u=s?this.to:this.from;for(let d=c,m=u.length;;){if(d==m)return d;let _=d+m>>1,ue=u[_]-e||(s?this.value[_].endSide:this.value[_].startSide)-o;if(_==d)return ue>=0?d:m;ue>=0?m=_:d=_+1}}between(e,o,s,c){for(let u=this.findIndex(o,-1e9,!0),d=this.findIndex(s,1e9,!1,u);u<d;u++)if(c(this.from[u]+e,this.to[u]+e,this.value[u])===!1)return!1}map(e,o){let s=[],c=[],u=[],d=-1,m=-1;for(let _=0;_<this.value.length;_++){let ue=this.value[_],gn=this.from[_]+e,nh=this.to[_]+e,ih,rh;if(gn==nh){let oh=o.mapPos(gn,ue.startSide,ue.mapMode);if(oh==null||(ih=rh=oh,ue.startSide!=ue.endSide&&(rh=o.mapPos(gn,ue.endSide),rh<ih)))continue}else if(ih=o.mapPos(gn,ue.startSide),rh=o.mapPos(nh,ue.endSide),ih>rh||ih==rh&&ue.startSide>0&&ue.endSide<=0)continue;(rh-ih||ue.endSide-ue.startSide)<0||(d<0&&(d=ih),ue.point&&(m=Math.max(m,rh-ih)),s.push(ue),c.push(ih-d),u.push(rh-d))}return{mapped:s.length?new Chunk(c,u,s,m):null,pos:d}}}class RangeSet{constructor(e,o,s,c){this.chunkPos=e,this.chunk=o,this.nextLayer=s,this.maxPoint=c}static create(e,o,s,c){return new RangeSet(e,o,s,c)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let o of this.chunk)e+=o.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:o=[],sort:s=!1,filterFrom:c=0,filterTo:u=this.length}=e,d=e.filter;if(o.length==0&&!d)return this;if(s&&(o=o.slice().sort(cmpRange)),this.isEmpty)return o.length?RangeSet.of(o):this;let m=new LayerCursor(this,null,-1).goto(0),_=0,ue=[],gn=new RangeSetBuilder;for(;m.value||_<o.length;)if(_<o.length&&(m.from-o[_].from||m.startSide-o[_].value.startSide)>=0){let nh=o[_++];gn.addInner(nh.from,nh.to,nh.value)||ue.push(nh)}else m.rangeIndex==1&&m.chunkIndex<this.chunk.length&&(_==o.length||this.chunkEnd(m.chunkIndex)<o[_].from)&&(!d||c>this.chunkEnd(m.chunkIndex)||u<this.chunkPos[m.chunkIndex])&&gn.addChunk(this.chunkPos[m.chunkIndex],this.chunk[m.chunkIndex])?m.nextChunk():((!d||c>m.to||u<m.from||d(m.from,m.to,m.value))&&(gn.addInner(m.from,m.to,m.value)||ue.push(Range$1.create(m.from,m.to,m.value))),m.next());return gn.finishInner(this.nextLayer.isEmpty&&!ue.length?RangeSet.empty:this.nextLayer.update({add:ue,filter:d,filterFrom:c,filterTo:u}))}map(e){if(e.empty||this.isEmpty)return this;let o=[],s=[],c=-1;for(let d=0;d<this.chunk.length;d++){let m=this.chunkPos[d],_=this.chunk[d],ue=e.touchesRange(m,m+_.length);if(ue===!1)c=Math.max(c,_.maxPoint),o.push(_),s.push(e.mapPos(m));else if(ue===!0){let{mapped:gn,pos:nh}=_.map(m,e);gn&&(c=Math.max(c,gn.maxPoint),o.push(gn),s.push(nh))}}let u=this.nextLayer.map(e);return o.length==0?u:new RangeSet(s,o,u||RangeSet.empty,c)}between(e,o,s){if(!this.isEmpty){for(let c=0;c<this.chunk.length;c++){let u=this.chunkPos[c],d=this.chunk[c];if(o>=u&&e<=u+d.length&&d.between(u,e-u,o-u,s)===!1)return}this.nextLayer.between(e,o,s)}}iter(e=0){return HeapCursor.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,o=0){return HeapCursor.from(e).goto(o)}static compare(e,o,s,c,u=-1){let d=e.filter(nh=>nh.maxPoint>0||!nh.isEmpty&&nh.maxPoint>=u),m=o.filter(nh=>nh.maxPoint>0||!nh.isEmpty&&nh.maxPoint>=u),_=findSharedChunks(d,m,s),ue=new SpanCursor(d,_,u),gn=new SpanCursor(m,_,u);s.iterGaps((nh,ih,rh)=>compare(ue,nh,gn,ih,rh,c)),s.empty&&s.length==0&&compare(ue,0,gn,0,0,c)}static eq(e,o,s=0,c){c==null&&(c=1e9-1);let u=e.filter(gn=>!gn.isEmpty&&o.indexOf(gn)<0),d=o.filter(gn=>!gn.isEmpty&&e.indexOf(gn)<0);if(u.length!=d.length)return!1;if(!u.length)return!0;let m=findSharedChunks(u,d),_=new SpanCursor(u,m,0).goto(s),ue=new SpanCursor(d,m,0).goto(s);for(;;){if(_.to!=ue.to||!sameValues(_.active,ue.active)||_.point&&(!ue.point||!_.point.eq(ue.point)))return!1;if(_.to>c)return!0;_.next(),ue.next()}}static spans(e,o,s,c,u=-1){let d=new SpanCursor(e,null,u).goto(o),m=o,_=d.openStart;for(;;){let ue=Math.min(d.to,s);if(d.point){let gn=d.activeForPoint(d.to),nh=d.pointFrom<o?gn.length+1:Math.min(gn.length,_);c.point(m,ue,d.point,gn,nh,d.pointRank),_=Math.min(d.openEnd(ue),gn.length)}else ue>m&&(c.span(m,ue,d.active,_),_=d.openEnd(ue));if(d.to>s)return _+(d.point&&d.to>s?1:0);m=d.to,d.next()}}static of(e,o=!1){let s=new RangeSetBuilder;for(let c of e instanceof Range$1?[e]:o?lazySort(e):e)s.add(c.from,c.to,c.value);return s.finish()}}RangeSet.empty=new RangeSet([],[],null,-1);function lazySort(n){if(n.length>1)for(let e=n[0],o=1;o<n.length;o++){let s=n[o];if(cmpRange(e,s)>0)return n.slice().sort(cmpRange);e=s}return n}RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{finishChunk(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,o,s){this.addInner(e,o,s)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(e,o,s)}addInner(e,o,s){let c=e-this.lastTo||s.startSide-this.last.endSide;if(c<=0&&(e-this.lastFrom||s.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return c<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(o-this.chunkStart),this.last=s,this.lastFrom=e,this.lastTo=o,this.value.push(s),s.point&&(this.maxPoint=Math.max(this.maxPoint,o-e)),!0)}addChunk(e,o){if((e-this.lastTo||o.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,o.maxPoint),this.chunks.push(o),this.chunkPos.push(e);let s=o.value.length-1;return this.last=o.value[s],this.lastFrom=o.from[s]+e,this.lastTo=o.to[s]+e,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let o=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,o}}function findSharedChunks(n,e,o){let s=new Map;for(let u of n)for(let d=0;d<u.chunk.length;d++)u.chunk[d].maxPoint<=0&&s.set(u.chunk[d],u.chunkPos[d]);let c=new Set;for(let u of e)for(let d=0;d<u.chunk.length;d++){let m=s.get(u.chunk[d]);m!=null&&(o?o.mapPos(m):m)==u.chunkPos[d]&&!(o!=null&&o.touchesRange(m,m+u.chunk[d].length))&&c.add(u.chunk[d])}return c}class LayerCursor{constructor(e,o,s,c=0){this.layer=e,this.skip=o,this.minPoint=s,this.rank=c}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,o=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,o,!1),this}gotoInner(e,o,s){for(;this.chunkIndex<this.layer.chunk.length;){let c=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(c)||this.layer.chunkEnd(this.chunkIndex)<e||c.maxPoint<this.minPoint))break;this.chunkIndex++,s=!1}if(this.chunkIndex<this.layer.chunk.length){let c=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],o,!0);(!s||this.rangeIndex<c)&&this.setRangeIndex(c)}this.next()}forward(e,o){(this.to-e||this.endSide-o)<0&&this.gotoInner(e,o,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],o=this.layer.chunk[this.chunkIndex],s=e+o.from[this.rangeIndex];if(this.from=s,this.to=e+o.to[this.rangeIndex],this.value=o.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class HeapCursor{constructor(e){this.heap=e}static from(e,o=null,s=-1){let c=[];for(let u=0;u<e.length;u++)for(let d=e[u];!d.isEmpty;d=d.nextLayer)d.maxPoint>=s&&c.push(new LayerCursor(d,o,s,u));return c.length==1?c[0]:new HeapCursor(c)}get startSide(){return this.value?this.value.startSide:0}goto(e,o=-1e9){for(let s of this.heap)s.goto(e,o);for(let s=this.heap.length>>1;s>=0;s--)heapBubble(this.heap,s);return this.next(),this}forward(e,o){for(let s of this.heap)s.forward(e,o);for(let s=this.heap.length>>1;s>=0;s--)heapBubble(this.heap,s);(this.to-e||this.value.endSide-o)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),heapBubble(this.heap,0)}}}function heapBubble(n,e){for(let o=n[e];;){let s=(e<<1)+1;if(s>=n.length)break;let c=n[s];if(s+1<n.length&&c.compare(n[s+1])>=0&&(c=n[s+1],s++),o.compare(c)<0)break;n[s]=o,n[e]=c,e=s}}class SpanCursor{constructor(e,o,s){this.minPoint=s,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(e,o,s)}goto(e,o=-1e9){return this.cursor.goto(e,o),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=o,this.openStart=-1,this.next(),this}forward(e,o){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-o)<0;)this.removeActive(this.minActive);this.cursor.forward(e,o)}removeActive(e){remove$1(this.active,e),remove$1(this.activeTo,e),remove$1(this.activeRank,e),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(e){let o=0,{value:s,to:c,rank:u}=this.cursor;for(;o<this.activeRank.length&&this.activeRank[o]<=u;)o++;insert(this.active,o,s),insert(this.activeTo,o,c),insert(this.activeRank,o,u),e&&insert(e,o,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let e=this.to,o=this.point;this.point=null;let s=this.openStart<0?[]:null;for(;;){let c=this.minActive;if(c>-1&&(this.activeTo[c]-this.cursor.from||this.active[c].endSide-this.cursor.startSide)<0){if(this.activeTo[c]>e){this.to=this.activeTo[c],this.endSide=this.active[c].endSide;break}this.removeActive(c),s&&remove$1(s,c)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let u=this.cursor.value;if(!u.point)this.addActive(s),this.cursor.next();else if(o&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=u,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=u.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(s){this.openStart=0;for(let c=s.length-1;c>=0&&s[c]<e;c--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let o=[];for(let s=this.active.length-1;s>=0&&!(this.activeRank[s]<this.pointRank);s--)(this.activeTo[s]>e||this.activeTo[s]==e&&this.active[s].endSide>=this.point.endSide)&&o.push(this.active[s]);return o.reverse()}openEnd(e){let o=0;for(let s=this.activeTo.length-1;s>=0&&this.activeTo[s]>e;s--)o++;return o}}function compare(n,e,o,s,c,u){n.goto(e),o.goto(s);let d=s+c,m=s,_=s-e;for(;;){let ue=n.to+_-o.to||n.endSide-o.endSide,gn=ue<0?n.to+_:o.to,nh=Math.min(gn,d);if(n.point||o.point?n.point&&o.point&&(n.point==o.point||n.point.eq(o.point))&&sameValues(n.activeForPoint(n.to),o.activeForPoint(o.to))||u.comparePoint(m,nh,n.point,o.point):nh>m&&!sameValues(n.active,o.active)&&u.compareRange(m,nh,n.active,o.active),gn>d)break;m=gn,ue<=0&&n.next(),ue>=0&&o.next()}}function sameValues(n,e){if(n.length!=e.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!=e[o]&&!n[o].eq(e[o]))return!1;return!0}function remove$1(n,e){for(let o=e,s=n.length-1;o<s;o++)n[o]=n[o+1];n.pop()}function insert(n,e,o){for(let s=n.length-1;s>=e;s--)n[s+1]=n[s];n[e]=o}function findMinIndex(n,e){let o=-1,s=1e9;for(let c=0;c<e.length;c++)(e[c]-s||n[c].endSide-n[o].endSide)<0&&(o=c,s=e[c]);return o}function countColumn(n,e,o=n.length){let s=0;for(let c=0;c<o;)n.charCodeAt(c)==9?(s+=e-s%e,c++):(s++,c=findClusterBreak(n,c));return s}function findColumn(n,e,o,s){for(let c=0,u=0;;){if(u>=e)return c;if(c==n.length)break;u+=n.charCodeAt(c)==9?o-u%o:1,c=findClusterBreak(n,c)}return s===!0?-1:n.length}const C$3="",COUNT=typeof Symbol>"u"?"__"+C$3:Symbol.for(C$3),SET=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),top=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class StyleModule{constructor(e,o){this.rules=[];let{finish:s}=o||{};function c(d){return/^@/.test(d)?[d]:d.split(/,\s*/)}function u(d,m,_,ue){let gn=[],nh=/^@(\w+)\b/.exec(d[0]),ih=nh&&nh[1]=="keyframes";if(nh&&m==null)return _.push(d[0]+";");for(let rh in m){let oh=m[rh];if(/&/.test(rh))u(rh.split(/,\s*/).map(lh=>d.map(ch=>lh.replace(/&/,ch))).reduce((lh,ch)=>lh.concat(ch)),oh,_);else if(oh&&typeof oh=="object"){if(!nh)throw new RangeError("The value of a property ("+rh+") should be a primitive value.");u(c(rh),oh,gn,ih)}else oh!=null&&gn.push(rh.replace(/_.*/,"").replace(/[A-Z]/g,lh=>"-"+lh.toLowerCase())+": "+oh+";")}(gn.length||ih)&&_.push((s&&!nh&&!ue?d.map(s):d).join(", ")+" {"+gn.join(" ")+"}")}for(let d in e)u(c(d),e[d],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=top[COUNT]||1;return top[COUNT]=e+1,C$3+e.toString(36)}static mount(e,o){(e[SET]||new StyleSet(e)).mount(Array.isArray(o)?o:[o])}}let adoptedSet=new Map;class StyleSet{constructor(e){let o=e.ownerDocument||e,s=o.defaultView;if(!e.head&&e.adoptedStyleSheets&&s.CSSStyleSheet){let c=adoptedSet.get(o);if(c)return e.adoptedStyleSheets=[c.sheet,...e.adoptedStyleSheets],e[SET]=c;this.sheet=new s.CSSStyleSheet,e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets],adoptedSet.set(o,this)}else{this.styleTag=o.createElement("style");let c=e.head||e;c.insertBefore(this.styleTag,c.firstChild)}this.modules=[],e[SET]=this}mount(e){let o=this.sheet,s=0,c=0;for(let u=0;u<e.length;u++){let d=e[u],m=this.modules.indexOf(d);if(m<c&&m>-1&&(this.modules.splice(m,1),c--,m=-1),m==-1){if(this.modules.splice(c++,0,d),o)for(let _=0;_<d.rules.length;_++)o.insertRule(d.rules[_],s++)}else{for(;c<m;)s+=this.modules[c++].rules.length;s+=d.rules.length,c++}}if(!o){let u="";for(let d=0;d<this.modules.length;d++)u+=this.modules[d].getRules()+`
`;this.styleTag.textContent=u}}}var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},chrome$2=typeof navigator<"u"&&/Chrome\/(\d+)/.exec(navigator.userAgent),mac=typeof navigator<"u"&&/Mac/.test(navigator.platform),ie$2=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),brokenModifierNames=mac||chrome$2&&+chrome$2[1]<57;for(var i$1=0;i$1<10;i$1++)base[48+i$1]=base[96+i$1]=String(i$1);for(var i$1=1;i$1<=24;i$1++)base[i$1+111]="F"+i$1;for(var i$1=65;i$1<=90;i$1++)base[i$1]=String.fromCharCode(i$1+32),shift[i$1]=String.fromCharCode(i$1);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function keyName(n){var e=brokenModifierNames&&(n.ctrlKey||n.altKey||n.metaKey)||ie$2&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",o=!e&&n.key||(n.shiftKey?shift:base)[n.keyCode]||n.key||"Unidentified";return o=="Esc"&&(o="Escape"),o=="Del"&&(o="Delete"),o=="Left"&&(o="ArrowLeft"),o=="Up"&&(o="ArrowUp"),o=="Right"&&(o="ArrowRight"),o=="Down"&&(o="ArrowDown"),o}function getSelection(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function contains$1(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function deepActiveElement(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function hasSelection(n,e){if(!e.anchorNode)return!1;try{return contains$1(n,e.anchorNode)}catch{return!1}}function clientRectsFor(n){return n.nodeType==3?textRange(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function isEquivalentPosition(n,e,o,s){return o?scanFor(n,e,o,s,-1)||scanFor(n,e,o,s,1):!1}function domIndex(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function scanFor(n,e,o,s,c){for(;;){if(n==o&&e==s)return!0;if(e==(c<0?0:maxOffset(n))){if(n.nodeName=="DIV")return!1;let u=n.parentNode;if(!u||u.nodeType!=1)return!1;e=domIndex(n)+(c<0?0:1),n=u}else if(n.nodeType==1){if(n=n.childNodes[e+(c<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=c<0?maxOffset(n):0}else return!1}}function maxOffset(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function flattenRect(n,e){let o=e?n.left:n.right;return{left:o,right:o,top:n.top,bottom:n.bottom}}function windowRect(n){return{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function scrollRectIntoView(n,e,o,s,c,u,d,m){let _=n.ownerDocument,ue=_.defaultView||window;for(let gn=n;gn;)if(gn.nodeType==1){let nh,ih=gn==_.body;if(ih)nh=windowRect(ue);else{if(gn.scrollHeight<=gn.clientHeight&&gn.scrollWidth<=gn.clientWidth){gn=gn.assignedSlot||gn.parentNode;continue}let lh=gn.getBoundingClientRect();nh={left:lh.left,right:lh.left+gn.clientWidth,top:lh.top,bottom:lh.top+gn.clientHeight}}let rh=0,oh=0;if(c=="nearest")e.top<nh.top?(oh=-(nh.top-e.top+d),o>0&&e.bottom>nh.bottom+oh&&(oh=e.bottom-nh.bottom+oh+d)):e.bottom>nh.bottom&&(oh=e.bottom-nh.bottom+d,o<0&&e.top-oh<nh.top&&(oh=-(nh.top+oh-e.top+d)));else{let lh=e.bottom-e.top,ch=nh.bottom-nh.top;oh=(c=="center"&&lh<=ch?e.top+lh/2-ch/2:c=="start"||c=="center"&&o<0?e.top-d:e.bottom-ch+d)-nh.top}if(s=="nearest"?e.left<nh.left?(rh=-(nh.left-e.left+u),o>0&&e.right>nh.right+rh&&(rh=e.right-nh.right+rh+u)):e.right>nh.right&&(rh=e.right-nh.right+u,o<0&&e.left<nh.left+rh&&(rh=-(nh.left+rh-e.left+u))):rh=(s=="center"?e.left+(e.right-e.left)/2-(nh.right-nh.left)/2:s=="start"==m?e.left-u:e.right-(nh.right-nh.left)+u)-nh.left,rh||oh)if(ih)ue.scrollBy(rh,oh);else{let lh=0,ch=0;if(oh){let dh=gn.scrollTop;gn.scrollTop+=oh,ch=gn.scrollTop-dh}if(rh){let dh=gn.scrollLeft;gn.scrollLeft+=rh,lh=gn.scrollLeft-dh}e={left:e.left-lh,top:e.top-ch,right:e.right-lh,bottom:e.bottom-ch},lh&&Math.abs(lh-rh)<1&&(s="nearest"),ch&&Math.abs(ch-oh)<1&&(c="nearest")}if(ih)break;gn=gn.assignedSlot||gn.parentNode}else if(gn.nodeType==11)gn=gn.host;else break}function scrollableParent(n){let e=n.ownerDocument;for(let o=n.parentNode;o&&o!=e.body;)if(o.nodeType==1){if(o.scrollHeight>o.clientHeight||o.scrollWidth>o.clientWidth)return o;o=o.assignedSlot||o.parentNode}else if(o.nodeType==11)o=o.host;else break;return null}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:o,focusNode:s}=e;this.set(o,Math.min(e.anchorOffset,o?maxOffset(o):0),s,Math.min(e.focusOffset,s?maxOffset(s):0))}set(e,o,s,c){this.anchorNode=e,this.anchorOffset=o,this.focusNode=s,this.focusOffset=c}}let preventScrollSupported=null;function focusPreventScroll(n){if(n.setActive)return n.setActive();if(preventScrollSupported)return n.focus(preventScrollSupported);let e=[];for(let o=n;o&&(e.push(o,o.scrollTop,o.scrollLeft),o!=o.ownerDocument);o=o.parentNode);if(n.focus(preventScrollSupported==null?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let o=0;o<e.length;){let s=e[o++],c=e[o++],u=e[o++];s.scrollTop!=c&&(s.scrollTop=c),s.scrollLeft!=u&&(s.scrollLeft=u)}}}let scratchRange;function textRange(n,e,o=e){let s=scratchRange||(scratchRange=document.createRange());return s.setEnd(n,o),s.setStart(n,e),s}function dispatchKey(n,e,o){let s={key:e,code:e,keyCode:o,which:o,cancelable:!0},c=new KeyboardEvent("keydown",s);c.synthetic=!0,n.dispatchEvent(c);let u=new KeyboardEvent("keyup",s);return u.synthetic=!0,n.dispatchEvent(u),c.defaultPrevented||u.defaultPrevented}function getRoot(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function clearAttributes(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}function atElementStart(n,e){let o=e.focusNode,s=e.focusOffset;if(!o||e.anchorNode!=o||e.anchorOffset!=s)return!1;for(s=Math.min(s,maxOffset(o));;)if(s){if(o.nodeType!=1)return!1;let c=o.childNodes[s-1];c.contentEditable=="false"?s--:(o=c,s=maxOffset(o))}else{if(o==n)return!0;s=domIndex(o),o=o.parentNode}}class DOMPos{constructor(e,o,s=!0){this.node=e,this.offset=o,this.precise=s}static before(e,o){return new DOMPos(e.parentNode,domIndex(e),o)}static after(e,o){return new DOMPos(e.parentNode,domIndex(e)+1,o)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.dirty=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let o=this.posAtStart;for(let s of this.children){if(s==e)return o;o+=s.length+s.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,o){if(this.dirty&2){let s=this.dom,c=null,u;for(let d of this.children){if(d.dirty){if(!d.dom&&(u=c?c.nextSibling:s.firstChild)){let m=ContentView.get(u);(!m||!m.parent&&m.canReuseDOM(d))&&d.reuseDOM(u)}d.sync(e,o),d.dirty=0}if(u=c?c.nextSibling:s.firstChild,o&&!o.written&&o.node==s&&u!=d.dom&&(o.written=!0),d.dom.parentNode==s)for(;u&&u!=d.dom;)u=rm$1(u);else s.insertBefore(d.dom,u);c=d.dom}for(u=c?c.nextSibling:s.firstChild,u&&o&&o.node==s&&(o.written=!0);u;)u=rm$1(u)}else if(this.dirty&1)for(let s of this.children)s.dirty&&(s.sync(e,o),s.dirty=0)}reuseDOM(e){}localPosFromDOM(e,o){let s;if(e==this.dom)s=this.dom.childNodes[o];else{let c=maxOffset(e)==0?0:o==0?-1:1;for(;;){let u=e.parentNode;if(u==this.dom)break;c==0&&u.firstChild!=u.lastChild&&(e==u.firstChild?c=-1:c=1),e=u}c<0?s=e:s=e.nextSibling}if(s==this.dom.firstChild)return 0;for(;s&&!ContentView.get(s);)s=s.nextSibling;if(!s)return this.length;for(let c=0,u=0;;c++){let d=this.children[c];if(d.dom==s)return u;u+=d.length+d.breakAfter}}domBoundsAround(e,o,s=0){let c=-1,u=-1,d=-1,m=-1;for(let _=0,ue=s,gn=s;_<this.children.length;_++){let nh=this.children[_],ih=ue+nh.length;if(ue<e&&ih>o)return nh.domBoundsAround(e,o,ue);if(ih>=e&&c==-1&&(c=_,u=ue),ue>o&&nh.dom.parentNode==this.dom){d=_,m=gn;break}gn=ih,ue=ih+nh.breakAfter}return{from:u,to:m<0?s+this.length:m,startDOM:(c?this.children[c-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:d<this.children.length&&d>=0?this.children[d].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let o=this.parent;o;o=o.parent){if(e&&(o.dirty|=2),o.dirty&1)return;o.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let o=e.parent;if(!o)return e;e=o}}replaceChildren(e,o,s=noChildren){this.markDirty();for(let c=e;c<o;c++){let u=this.children[c];u.parent==this&&u.destroy()}this.children.splice(e,o-e,...s);for(let c=0;c<s.length;c++)s[c].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ChildCursor(this.children,e,this.children.length)}childPos(e,o=1){return this.childCursor().findPos(e,o)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,o,s,c,u,d){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor}getSide(){return 0}destroy(){this.parent=null}}ContentView.prototype.breakAfter=0;function rm$1(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class ChildCursor{constructor(e,o,s){this.children=e,this.pos=o,this.i=s,this.off=0}findPos(e,o=1){for(;;){if(e>this.pos||e==this.pos&&(o>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let s=this.children[--this.i];this.pos-=s.length+s.breakAfter}}}function replaceRange(n,e,o,s,c,u,d,m,_){let{children:ue}=n,gn=ue.length?ue[e]:null,nh=u.length?u[u.length-1]:null,ih=nh?nh.breakAfter:d;if(!(e==s&&gn&&!d&&!ih&&u.length<2&&gn.merge(o,c,u.length?nh:null,o==0,m,_))){if(s<ue.length){let rh=ue[s];rh&&c<rh.length?(e==s&&(rh=rh.split(c),c=0),!ih&&nh&&rh.merge(0,c,nh,!0,0,_)?u[u.length-1]=rh:(c&&rh.merge(0,c,null,!1,0,_),u.push(rh))):rh!=null&&rh.breakAfter&&(nh?nh.breakAfter=1:d=1),s++}for(gn&&(gn.breakAfter=d,o>0&&(!d&&u.length&&gn.merge(o,gn.length,u[0],!1,m,0)?gn.breakAfter=u.shift().breakAfter:(o<gn.length||gn.children.length&&gn.children[gn.children.length-1].length==0)&&gn.merge(o,gn.length,null,!1,m,0),e++));e<s&&u.length;)if(ue[s-1].become(u[u.length-1]))s--,u.pop(),_=u.length?0:m;else if(ue[e].become(u[0]))e++,u.shift(),m=u.length?0:_;else break;!u.length&&e&&s<ue.length&&!ue[e-1].breakAfter&&ue[s].merge(0,0,ue[e-1],!1,m,_)&&e--,(e<s||u.length)&&n.replaceChildren(e,s,u)}}function mergeChildrenInto(n,e,o,s,c,u){let d=n.childCursor(),{i:m,off:_}=d.findPos(o,1),{i:ue,off:gn}=d.findPos(e,-1),nh=e-o;for(let ih of s)nh+=ih.length;n.length+=nh,replaceRange(n,ue,gn,m,_,s,0,c,u)}let nav=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},doc=typeof document<"u"?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie$1=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie$1&&/gecko\/(\d+)/i.test(nav.userAgent),chrome$1=!ie$1&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!ie$1&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser$1={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie:ie$1,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome$1,chrome_version:chrome$1?+chrome$1[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit,safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const MaxJoinLen=256;class TextView extends ContentView{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,o){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(o&&o.node==this.dom&&(o.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,o,s){return s&&(!(s instanceof TextView)||this.length-(o-e)+s.length>MaxJoinLen)?!1:(this.text=this.text.slice(0,e)+(s?s.text:"")+this.text.slice(o),this.markDirty(),!0)}split(e){let o=new TextView(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),o}localPosFromDOM(e,o){return e==this.dom?o:o?this.text.length:0}domAtPos(e){return new DOMPos(this.dom,e)}domBoundsAround(e,o,s){return{from:s,to:s+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,o){return textCoords(this.dom,e,o)}}class MarkView extends ContentView{constructor(e,o=[],s=0){super(),this.mark=e,this.children=o,this.length=s;for(let c of o)c.setParent(this)}setAttrs(e){if(clearAttributes(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let o in this.mark.attrs)e.setAttribute(o,this.mark.attrs[o]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e,o){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,o)}merge(e,o,s,c,u,d){return s&&(!(s instanceof MarkView&&s.mark.eq(this.mark))||e&&u<=0||o<this.length&&d<=0)?!1:(mergeChildrenInto(this,e,o,s?s.children:[],u-1,d-1),this.markDirty(),!0)}split(e){let o=[],s=0,c=-1,u=0;for(let m of this.children){let _=s+m.length;_>e&&o.push(s<e?m.split(e-s):m),c<0&&s>=e&&(c=u),s=_,u++}let d=this.length-e;return this.length=e,c>-1&&(this.children.length=c,this.markDirty()),new MarkView(this.mark,o,d)}domAtPos(e){return inlineDOMAtPos(this,e)}coordsAt(e,o){return coordsInChildren(this,e,o)}}function textCoords(n,e,o){let s=n.nodeValue.length;e>s&&(e=s);let c=e,u=e,d=0;e==0&&o<0||e==s&&o>=0?browser$1.chrome||browser$1.gecko||(e?(c--,d=1):u<s&&(u++,d=-1)):o<0?c--:u<s&&u++;let m=textRange(n,c,u).getClientRects();if(!m.length)return null;let _=m[(d?d<0:o>=0)?0:m.length-1];return browser$1.safari&&!d&&_.width==0&&(_=Array.prototype.find.call(m,ue=>ue.width)||_),d?flattenRect(_,d<0):_||null}class WidgetView extends ContentView{static create(e,o,s){return new(e.customView||WidgetView)(e,o,s)}constructor(e,o,s){super(),this.widget=e,this.length=o,this.side=s,this.prevWidget=null}split(e){let o=WidgetView.create(this.widget,this.length-e,this.side);return this.length-=e,o}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,o,s,c,u,d){return s&&(!(s instanceof WidgetView)||!this.widget.compare(s.widget)||e>0&&u<=0||o<this.length&&d<=0)?!1:(this.length=e+(s?s.length:0)+(this.length-o),!0)}become(e){return e instanceof WidgetView&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Text.empty;let e=this;for(;e.parent;)e=e.parent;let{view:o}=e,s=o&&o.state.doc,c=this.posAtStart;return s?s.slice(c,c+this.length):Text.empty}domAtPos(e){return(this.length?e==0:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,o){let s=this.widget.coordsAt(this.dom,e,o);if(s)return s;let c=this.dom.getClientRects(),u=null;if(!c.length)return null;for(let d=e>0?c.length-1:0;u=c[d],!(e>0?d==0:d==c.length-1||u.top<u.bottom);d+=e>0?-1:1);return this.length?u:flattenRect(u,this.side>0)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class CompositionView extends WidgetView{domAtPos(e){let{topView:o,text:s}=this.widget;return o?scanCompositionTree(e,0,o,s,this.length-o.length,(c,u)=>c.domAtPos(u),(c,u)=>new DOMPos(c,Math.min(u,c.nodeValue.length))):new DOMPos(s,Math.min(e,s.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,o){let{topView:s,text:c}=this.widget;return s?posFromDOMInCompositionTree(e,o,s,c,this.length-s.length):Math.min(o,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,o){let{topView:s,text:c}=this.widget;return s?scanCompositionTree(e,o,s,c,this.length-s.length,(u,d,m)=>u.coordsAt(d,m),(u,d,m)=>textCoords(u,d,m)):textCoords(c,e,o)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}canReuseDOM(){return!0}}function scanCompositionTree(n,e,o,s,c,u,d){if(o instanceof MarkView){for(let m=o.dom.firstChild;m;m=m.nextSibling){let _=ContentView.get(m);if(_){let ue=contains$1(m,s),gn=_.length+(ue?c:0);if(n<gn||n==gn&&_.getSide()<=0)return ue?scanCompositionTree(n,e,_,s,c,u,d):u(_,n,e);n-=gn}else{let ue=scanCompositionNode(n,e,m,d);if(typeof ue!="number")return ue;n=ue}}return u(o,o.length,-1)}else return o.dom==s?d(s,n,e):u(o,n,e)}function scanCompositionNode(n,e,o,s){if(o.nodeType==3){let c=o.nodeValue.length;if(n<=c)return s(o,n,e);n-=c}else if(o.nodeType==1&&o.contentEditable!="false")for(let c=o.firstChild;c;c=c.nextSibling){let u=scanCompositionNode(n,e,c,s);if(typeof u!="number")return u;n=u}return n}function posFromDOMInCompositionTree(n,e,o,s,c){if(o instanceof MarkView){let u=0;for(let d=o.dom.firstChild;d;d=d.nextSibling){let m=ContentView.get(d);if(m){let _=contains$1(d,s);if(contains$1(d,n))return u+(_?posFromDOMInCompositionTree(n,e,m,s,c):m.localPosFromDOM(n,e));u+=m.length+(_?c:0)}else{let _=posFromDOMInOpaqueNode(n,e,d);if(_.result!=null)return u+_.result;u+=_.size}}}else if(o.dom==s)return Math.min(e,s.nodeValue.length);return o.localPosFromDOM(n,e)}function posFromDOMInOpaqueNode(n,e,o){if(o.nodeType==3)return n==o?{result:e}:{size:o.nodeValue.length};if(o.nodeType==1&&o.contentEditable!="false"){let s=0;for(let c=o.firstChild,u=0;;c=c.nextSibling,u++){if(n==o&&u==e)return{result:s};if(!c)return{size:s};let d=posFromDOMInOpaqueNode(n,e,c);if(d.result!=null)return{result:e+d.result};s+=d.size}}else return o.contains(n)?{result:0}:{size:0}}class WidgetBufferView extends ContentView{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof WidgetBufferView&&e.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Text.empty}get isHidden(){return!0}}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;function inlineDOMAtPos(n,e){let o=n.dom,{children:s}=n,c=0;for(let u=0;c<s.length;c++){let d=s[c],m=u+d.length;if(!(m==u&&d.getSide()<=0)){if(e>u&&e<m&&d.dom.parentNode==o)return d.domAtPos(e-u);if(e<=u)break;u=m}}for(let u=c;u>0;u--){let d=s[u-1];if(d.dom.parentNode==o)return d.domAtPos(d.length)}for(let u=c;u<s.length;u++){let d=s[u];if(d.dom.parentNode==o)return d.domAtPos(0)}return new DOMPos(o,0)}function joinInlineInto(n,e,o){let s,{children:c}=n;o>0&&e instanceof MarkView&&c.length&&(s=c[c.length-1])instanceof MarkView&&s.mark.eq(e.mark)?joinInlineInto(s,e.children[0],o-1):(c.push(e),e.setParent(n)),n.length+=e.length}function coordsInChildren(n,e,o){let s=null,c=-1,u=null,d=-1;function m(ue,gn){for(let nh=0,ih=0;nh<ue.children.length&&ih<=gn;nh++){let rh=ue.children[nh],oh=ih+rh.length;oh>=gn&&(rh.children.length?m(rh,gn-ih):(!u||u.isHidden&&o>0)&&(oh>gn||ih==oh&&rh.getSide()>0)?(u=rh,d=gn-ih):(ih<gn||ih==oh&&rh.getSide()<0&&!rh.isHidden)&&(s=rh,c=gn-ih)),ih=oh}}m(n,e);let _=(o<0?s:u)||s||u;return _?_.coordsAt(Math.max(0,_==s?c:d),o):fallbackRect(n)}function fallbackRect(n){let e=n.dom.lastChild;if(!e)return n.dom.getBoundingClientRect();let o=clientRectsFor(e);return o[o.length-1]||null}function combineAttrs(n,e){for(let o in n)o=="class"&&e.class?e.class+=" "+n.class:o=="style"&&e.style?e.style+=";"+n.style:e[o]=n[o];return e}function attrsEq(n,e){if(n==e)return!0;if(!n||!e)return!1;let o=Object.keys(n),s=Object.keys(e);if(o.length!=s.length)return!1;for(let c of o)if(s.indexOf(c)==-1||n[c]!==e[c])return!1;return!0}function updateAttrs(n,e,o){let s=null;if(e)for(let c in e)o&&c in o||n.removeAttribute(s=c);if(o)for(let c in o)e&&e[c]==o[c]||n.setAttribute(s=c,o[c]);return!!s}class WidgetType{eq(e){return!1}updateDOM(e,o){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}coordsAt(e,o,s){return null}get customView(){return null}get isHidden(){return!1}destroy(e){}}var BlockType=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(e,o,s,c){super(),this.startSide=e,this.endSide=o,this.widget=s,this.spec=c}get heightRelevant(){return!1}static mark(e){return new MarkDecoration(e)}static widget(e){let o=e.side||0,s=!!e.block;return o+=s?o>0?3e8:-4e8:o>0?1e8:-1e8,new PointDecoration(e,o,o,s,e.widget||null,!1)}static replace(e){let o=!!e.block,s,c;if(e.isBlockGap)s=-5e8,c=4e8;else{let{start:u,end:d}=getInclusive(e,o);s=(u?o?-3e8:-1:5e8)-1,c=(d?o?2e8:1:-6e8)+1}return new PointDecoration(e,s,c,o,e.widget||null,!0)}static line(e){return new LineDecoration(e)}static set(e,o=!1){return RangeSet.of(e,o)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Decoration.none=RangeSet.empty;class MarkDecoration extends Decoration{constructor(e){let{start:o,end:s}=getInclusive(e);super(o?-1:5e8,s?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof MarkDecoration&&this.tagName==e.tagName&&this.class==e.class&&attrsEq(this.attrs,e.attrs)}range(e,o=e){if(e>=o)throw new RangeError("Mark decorations may not be empty");return super.range(e,o)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof LineDecoration&&this.spec.class==e.spec.class&&attrsEq(this.spec.attributes,e.spec.attributes)}range(e,o=e){if(o!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,o)}}LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(e,o,s,c,u,d){super(o,s,u,e),this.block=c,this.isReplace=d,this.mapMode=c?o<=0?MapMode.TrackBefore:MapMode.TrackAfter:MapMode.TrackDel}get type(){return this.startSide<this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof PointDecoration&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,o=e){if(this.isReplace&&(e>o||e==o&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&o!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,o)}}PointDecoration.prototype.point=!0;function getInclusive(n,e=!1){let{inclusiveStart:o,inclusiveEnd:s}=n;return o==null&&(o=n.inclusive),s==null&&(s=n.inclusive),{start:o??e,end:s??e}}function widgetsEq(n,e){return n==e||!!(n&&e&&n.compare(e))}function addRange(n,e,o,s=0){let c=o.length-1;c>=0&&o[c]+s>=n?o[c]=Math.max(o[c],e):o.push(n,e)}class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,o,s,c,u,d){if(s){if(!(s instanceof LineView))return!1;this.dom||s.transferDOM(this)}return c&&this.setDeco(s?s.attrs:null),mergeChildrenInto(this,e,o,s?s.children:[],u,d),!0}split(e){let o=new LineView;if(o.breakAfter=this.breakAfter,this.length==0)return o;let{i:s,off:c}=this.childPos(e);c&&(o.append(this.children[s].split(c),0),this.children[s].merge(c,this.children[s].length,null,!1,0,0),s++);for(let u=s;u<this.children.length;u++)o.append(this.children[u],0);for(;s>0&&this.children[s-1].length==0;)this.children[--s].destroy();return this.children.length=s,this.markDirty(),this.length=e,o}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){attrsEq(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,o){joinInlineInto(this,e,o)}addLineDeco(e){let o=e.spec.attributes,s=e.spec.class;o&&(this.attrs=combineAttrs(o,this.attrs||{})),s&&(this.attrs=combineAttrs({class:s},this.attrs||{}))}domAtPos(e){return inlineDOMAtPos(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e,o){var s;this.dom?this.dirty&4&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,o);let c=this.dom.lastChild;for(;c&&ContentView.get(c)instanceof MarkView;)c=c.lastChild;if(!c||!this.length||c.nodeName!="BR"&&((s=ContentView.get(c))===null||s===void 0?void 0:s.isEditable)==!1&&(!browser$1.ios||!this.children.some(u=>u instanceof TextView))){let u=document.createElement("BR");u.cmIgnore=!0,this.dom.appendChild(u)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,o;for(let s of this.children){if(!(s instanceof TextView)||/[^ -~]/.test(s.text))return null;let c=clientRectsFor(s.dom);if(c.length!=1)return null;e+=c[0].width,o=c[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:o}:null}coordsAt(e,o){let s=coordsInChildren(this,e,o);if(!this.children.length&&s&&this.parent){let{heightOracle:c}=this.parent.view.viewState,u=s.bottom-s.top;if(Math.abs(u-c.lineHeight)<2&&c.textHeight<u){let d=(u-c.textHeight)/2;return{top:s.top+d,bottom:s.bottom-d,left:s.left,right:s.left}}}return s}become(e){return!1}get type(){return BlockType.Text}static find(e,o){for(let s=0,c=0;s<e.children.length;s++){let u=e.children[s],d=c+u.length;if(d>=o){if(u instanceof LineView)return u;if(d>o)break}c=d+u.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(e,o,s){super(),this.widget=e,this.length=o,this.type=s,this.breakAfter=0,this.prevWidget=null}merge(e,o,s,c,u,d){return s&&(!(s instanceof BlockWidgetView)||!this.widget.compare(s.widget)||e>0&&u<=0||o<this.length&&d<=0)?!1:(this.length=e+(s?s.length:0)+(this.length-o),!0)}domAtPos(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}split(e){let o=this.length-e;this.length=e;let s=new BlockWidgetView(this.widget,o,this.type);return s.breakAfter=this.breakAfter,s}get children(){return noChildren}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}domBoundsAround(){return null}become(e){return e instanceof BlockWidgetView&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.type=e.type,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,o){return this.widget.coordsAt(this.dom,e,o)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class ContentBuilder{constructor(e,o,s,c){this.doc=e,this.pos=o,this.end=s,this.disallowBlockEffectsFor=c,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=o}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof BlockWidgetView&&e.type==BlockType.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||this.getLine()}buildText(e,o,s){for(;e>0;){if(this.textOff==this.text.length){let{value:u,lineBreak:d,done:m}=this.cursor.next(this.skip);if(this.skip=0,m)throw new Error("Ran out of text content when drawing inline views");if(d){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=u,this.textOff=0}let c=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(o.slice(o.length-s)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+c)),o),s),this.atCursorPos=!0,this.textOff+=c,e-=c,s=0}}span(e,o,s,c){this.buildText(o-e,s,c),this.pos=o,this.openStart<0&&(this.openStart=c)}point(e,o,s,c,u,d){if(this.disallowBlockEffectsFor[d]&&s instanceof PointDecoration){if(s.block)throw new RangeError("Block decorations may not be specified via plugins");if(o>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let m=o-e;if(s instanceof PointDecoration)if(s.block){let{type:_}=s;_==BlockType.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(s.widget||new NullWidget("div"),m,_))}else{let _=WidgetView.create(s.widget||new NullWidget("span"),m,m?0:s.startSide),ue=this.atCursorPos&&!_.isEditable&&u<=c.length&&(e<o||s.startSide>0),gn=!_.isEditable&&(e<o||u>c.length||s.startSide<=0),nh=this.getLine();this.pendingBuffer==2&&!ue&&!_.isEditable&&(this.pendingBuffer=0),this.flushBuffer(c),ue&&(nh.append(wrapMarks(new WidgetBufferView(1),c),u),u=c.length+Math.max(0,u-c.length)),nh.append(wrapMarks(_,c),u),this.atCursorPos=gn,this.pendingBuffer=gn?e<o||u>c.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=c.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(s);m&&(this.textOff+m<=this.text.length?this.textOff+=m:(this.skip+=m-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=o),this.openStart<0&&(this.openStart=u)}static build(e,o,s,c,u){let d=new ContentBuilder(e,o,s,u);return d.openEnd=RangeSet.spans(c,o,s,d),d.openStart<0&&(d.openStart=d.openEnd),d.finish(d.openEnd),d}}function wrapMarks(n,e){for(let o of e)n=new MarkView(o,[n],n.length);return n}class NullWidget extends WidgetType{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler$1=Facet.define(),focusChangeEffect=Facet.define(),perLineTextDirection=Facet.define({combine:n=>n.some(e=>e)}),nativeSelectionHidden=Facet.define({combine:n=>n.some(e=>e)});class ScrollTarget{constructor(e,o="nearest",s="nearest",c=5,u=5){this.range=e,this.y=o,this.x=s,this.yMargin=c,this.xMargin=u}map(e){return e.empty?this:new ScrollTarget(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const scrollIntoView$1=StateEffect.define({map:(n,e)=>n.map(e)});function logException(n,e,o){let s=n.facet(exceptionSink);s.length?s[0](e):window.onerror?window.onerror(String(e),o,void 0,void 0,e):o?console.error(o+":",e):console.error(e)}const editable=Facet.define({combine:n=>n.length?n[0]:!0});let nextPluginID=0;const viewPlugin=Facet.define();class ViewPlugin{constructor(e,o,s,c){this.id=e,this.create=o,this.domEventHandlers=s,this.extension=c(this)}static define(e,o){const{eventHandlers:s,provide:c,decorations:u}=o||{};return new ViewPlugin(nextPluginID++,e,s,d=>{let m=[viewPlugin.of(d)];return u&&m.push(decorations.of(_=>{let ue=_.plugin(d);return ue?u(ue):Decoration.none})),c&&m.push(c(d)),m})}static fromClass(e,o){return ViewPlugin.define(s=>new e(s),o)}}class PluginInstance{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let o=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(o)}catch(s){if(logException(o.state,s,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(o){logException(e.state,o,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var o;if(!((o=this.value)===null||o===void 0)&&o.destroy)try{this.value.destroy()}catch(s){logException(e.state,s,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),atomicRanges=Facet.define(),scrollMargins=Facet.define();function getScrollMargins(n){let e=0,o=0,s=0,c=0;for(let u of n.state.facet(scrollMargins)){let d=u(n);d&&(d.left!=null&&(e=Math.max(e,d.left)),d.right!=null&&(o=Math.max(o,d.right)),d.top!=null&&(s=Math.max(s,d.top)),d.bottom!=null&&(c=Math.max(c,d.bottom)))}return{left:e,right:o,top:s,bottom:c}}const styleModule=Facet.define();class ChangedRange{constructor(e,o,s,c){this.fromA=e,this.toA=o,this.fromB=s,this.toB=c}join(e){return new ChangedRange(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let o=e.length,s=this;for(;o>0;o--){let c=e[o-1];if(!(c.fromA>s.toA)){if(c.toA<s.fromA)break;s=s.join(c),e.splice(o-1,1)}}return e.splice(o,0,s),e}static extendWithRanges(e,o){if(o.length==0)return e;let s=[];for(let c=0,u=0,d=0,m=0;;c++){let _=c==e.length?null:e[c],ue=d-m,gn=_?_.fromB:1e9;for(;u<o.length&&o[u]<gn;){let nh=o[u],ih=o[u+1],rh=Math.max(m,nh),oh=Math.min(gn,ih);if(rh<=oh&&new ChangedRange(rh+ue,oh+ue,rh,oh).addToSet(s),ih>gn)break;u+=2}if(!_)return s;new ChangedRange(_.fromA,_.toA,_.fromB,_.toB).addToSet(s),d=_.toA,m=_.toB}}}class ViewUpdate{constructor(e,o,s){this.view=e,this.state=o,this.transactions=s,this.flags=0,this.startState=e.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let u of s)this.changes=this.changes.compose(u.changes);let c=[];this.changes.iterChangedRanges((u,d,m,_)=>c.push(new ChangedRange(u,d,m,_))),this.changedRanges=c}static create(e,o,s){return new ViewUpdate(e,o,s)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var Direction=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(n){let e=[];for(let o=0;o<n.length;o++)e.push(1<<+n[o]);return e}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),o=n.charCodeAt(1);Brackets[e]=o,Brackets[o]=-e}function charType(n){return n<=247?LowTypes[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?ArabicTypes[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8203?256:64336<=n&&n<=65023?4:n==8204?256:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{get dir(){return this.level%2?RTL:LTR}constructor(e,o,s){this.from=e,this.to=o,this.level=s}side(e,o){return this.dir==o==e?this.to:this.from}static find(e,o,s,c){let u=-1;for(let d=0;d<e.length;d++){let m=e[d];if(m.from<=o&&m.to>=o){if(m.level==s)return d;(u<0||(c!=0?c<0?m.from<o:m.to>o:e[u].level>m.level))&&(u=d)}}if(u<0)throw new RangeError("Index out of range");return u}}const types=[];function computeOrder(n,e){let o=n.length,s=e==LTR?1:2,c=e==LTR?2:1;if(!n||s==1&&!BidiRE.test(n))return trivialOrder(o);for(let d=0,m=s,_=s;d<o;d++){let ue=charType(n.charCodeAt(d));ue==512?ue=m:ue==8&&_==4&&(ue=16),types[d]=ue==4?2:ue,ue&7&&(_=ue),m=ue}for(let d=0,m=s,_=s;d<o;d++){let ue=types[d];if(ue==128)d<o-1&&m==types[d+1]&&m&24?ue=types[d]=m:types[d]=256;else if(ue==64){let gn=d+1;for(;gn<o&&types[gn]==64;)gn++;let nh=d&&m==8||gn<o&&types[gn]==8?_==1?1:8:256;for(let ih=d;ih<gn;ih++)types[ih]=nh;d=gn-1}else ue==8&&_==1&&(types[d]=1);m=ue,ue&7&&(_=ue)}for(let d=0,m=0,_=0,ue,gn,nh;d<o;d++)if(gn=Brackets[ue=n.charCodeAt(d)])if(gn<0){for(let ih=m-3;ih>=0;ih-=3)if(BracketStack[ih+1]==-gn){let rh=BracketStack[ih+2],oh=rh&2?s:rh&4?rh&1?c:s:0;oh&&(types[d]=types[BracketStack[ih]]=oh),m=ih;break}}else{if(BracketStack.length==189)break;BracketStack[m++]=d,BracketStack[m++]=ue,BracketStack[m++]=_}else if((nh=types[d])==2||nh==1){let ih=nh==s;_=ih?0:1;for(let rh=m-3;rh>=0;rh-=3){let oh=BracketStack[rh+2];if(oh&2)break;if(ih)BracketStack[rh+2]|=2;else{if(oh&4)break;BracketStack[rh+2]|=4}}}for(let d=0;d<o;d++)if(types[d]==256){let m=d+1;for(;m<o&&types[m]==256;)m++;let _=(d?types[d-1]:s)==1,ue=(m<o?types[m]:s)==1,gn=_==ue?_?1:2:s;for(let nh=d;nh<m;nh++)types[nh]=gn;d=m-1}let u=[];if(s==1)for(let d=0;d<o;){let m=d,_=types[d++]!=1;for(;d<o&&_==(types[d]!=1);)d++;if(_)for(let ue=d;ue>m;){let gn=ue,nh=types[--ue]!=2;for(;ue>m&&nh==(types[ue-1]!=2);)ue--;u.push(new BidiSpan(ue,gn,nh?2:1))}else u.push(new BidiSpan(m,d,0))}else for(let d=0;d<o;){let m=d,_=types[d++]==2;for(;d<o&&_==(types[d]==2);)d++;u.push(new BidiSpan(m,d,_?1:2))}return u}function trivialOrder(n){return[new BidiSpan(0,n,0)]}let movedOver="";function moveVisually(n,e,o,s,c){var u;let d=s.head-n.from,m=-1;if(d==0){if(!c||!n.length)return null;e[0].level!=o&&(d=e[0].side(!1,o),m=0)}else if(d==n.length){if(c)return null;let ih=e[e.length-1];ih.level!=o&&(d=ih.side(!0,o),m=e.length-1)}m<0&&(m=BidiSpan.find(e,d,(u=s.bidiLevel)!==null&&u!==void 0?u:-1,s.assoc));let _=e[m];d==_.side(c,o)&&(_=e[m+=c?1:-1],d=_.side(!c,o));let ue=c==(_.dir==o),gn=findClusterBreak(n.text,d,ue);if(movedOver=n.text.slice(Math.min(d,gn),Math.max(d,gn)),gn!=_.side(c,o))return EditorSelection.cursor(gn+n.from,ue?-1:1,_.level);let nh=m==(c?e.length-1:0)?null:e[m+(c?1:-1)];return!nh&&_.level!=o?EditorSelection.cursor(c?n.to:n.from,c?-1:1,o):nh&&nh.level<_.level?EditorSelection.cursor(nh.side(!c,o)+n.from,c?1:-1,nh.level):EditorSelection.cursor(gn+n.from,c?-1:1,_.level)}const LineBreakPlaceholder="";class DOMReader{constructor(e,o){this.points=e,this.text="",this.lineSeparator=o.facet(EditorState.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=LineBreakPlaceholder}readRange(e,o){if(!e)return this;let s=e.parentNode;for(let c=e;;){this.findPointBefore(s,c);let u=this.text.length;this.readNode(c);let d=c.nextSibling;if(d==o)break;let m=ContentView.get(c),_=ContentView.get(d);(m&&_?m.breakAfter:(m?m.breakAfter:isBlockElement(c))||isBlockElement(d)&&(c.nodeName!="BR"||c.cmIgnore)&&this.text.length>u)&&this.lineBreak(),c=d}return this.findPointBefore(s,o),this}readTextNode(e){let o=e.nodeValue;for(let s of this.points)s.node==e&&(s.pos=this.text.length+Math.min(s.offset,o.length));for(let s=0,c=this.lineSeparator?null:/\r\n?|\n/g;;){let u=-1,d=1,m;if(this.lineSeparator?(u=o.indexOf(this.lineSeparator,s),d=this.lineSeparator.length):(m=c.exec(o))&&(u=m.index,d=m[0].length),this.append(o.slice(s,u<0?o.length:u)),u<0)break;if(this.lineBreak(),d>1)for(let _ of this.points)_.node==e&&_.pos>this.text.length&&(_.pos-=d-1);s=u+d}}readNode(e){if(e.cmIgnore)return;let o=ContentView.get(e),s=o&&o.overrideDOMText;if(s!=null){this.findPointInside(e,s.length);for(let c=s.iter();!c.next().done;)c.lineBreak?this.lineBreak():this.append(c.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,o){for(let s of this.points)s.node==e&&e.childNodes[s.offset]==o&&(s.pos=this.text.length)}findPointInside(e,o){for(let s of this.points)(e.nodeType==3?s.node==e:e.contains(s.node))&&(s.pos=this.text.length+Math.min(o,s.offset))}}function isBlockElement(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}class DOMPoint{constructor(e,o){this.node=e,this.offset=o,this.pos=-1}}class DocView extends ContentView{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.compositionDeco=Decoration.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,e.state.doc.length)],0)}update(e){let o=e.changedRanges;this.minWidth>0&&o.length&&(o.every(({fromA:d,toA:m})=>m<this.minWidthFrom||d>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Decoration.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=computeCompositionDeco(this.view,e.changes)),(browser$1.ie||browser$1.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let s=this.decorations,c=this.updateDeco(),u=findChangedDeco(s,c,e.changes);return o=ChangedRange.extendWithRanges(o,u),this.dirty==0&&o.length==0?!1:(this.updateInner(o,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,o){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,o);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let u=browser$1.chrome||browser$1.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,u),this.dirty=0,u&&(u.written||s.selectionRange.focusNode!=u.node)&&(this.forceSelection=!0),this.dom.style.height=""});let c=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let u of this.children)u instanceof BlockWidgetView&&u.widget instanceof BlockGapWidget&&c.push(u.dom);s.updateGaps(c)}updateChildren(e,o){let s=this.childCursor(o);for(let c=e.length-1;;c--){let u=c>=0?e[c]:null;if(!u)break;let{fromA:d,toA:m,fromB:_,toB:ue}=u,{content:gn,breakAtStart:nh,openStart:ih,openEnd:rh}=ContentBuilder.build(this.view.state.doc,_,ue,this.decorations,this.dynamicDecorationMap),{i:oh,off:lh}=s.findPos(m,1),{i:ch,off:dh}=s.findPos(d,-1);replaceRange(this,ch,dh,oh,lh,gn,nh,ih,rh)}}updateSelection(e=!1,o=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let s=this.view.root.activeElement,c=s==this.dom,u=!c&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(s&&this.dom.contains(s));if(!(c||o||u))return;let d=this.forceSelection;this.forceSelection=!1;let m=this.view.state.selection.main,_=this.domAtPos(m.anchor),ue=m.empty?_:this.domAtPos(m.head);if(browser$1.gecko&&m.empty&&!this.compositionDeco.size&&betweenUneditable(_)){let nh=document.createTextNode("");this.view.observer.ignore(()=>_.node.insertBefore(nh,_.node.childNodes[_.offset]||null)),_=ue=new DOMPos(nh,0),d=!0}let gn=this.view.observer.selectionRange;(d||!gn.focusNode||!isEquivalentPosition(_.node,_.offset,gn.anchorNode,gn.anchorOffset)||!isEquivalentPosition(ue.node,ue.offset,gn.focusNode,gn.focusOffset))&&(this.view.observer.ignore(()=>{browser$1.android&&browser$1.chrome&&this.dom.contains(gn.focusNode)&&inUneditable(gn.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let nh=getSelection(this.view.root);if(nh)if(m.empty){if(browser$1.gecko){let ih=nextToUneditable(_.node,_.offset);if(ih&&ih!=3){let rh=nearbyTextNode(_.node,_.offset,ih==1?1:-1);rh&&(_=new DOMPos(rh,ih==1?0:rh.nodeValue.length))}}nh.collapse(_.node,_.offset),m.bidiLevel!=null&&gn.cursorBidiLevel!=null&&(gn.cursorBidiLevel=m.bidiLevel)}else if(nh.extend){nh.collapse(_.node,_.offset);try{nh.extend(ue.node,ue.offset)}catch{}}else{let ih=document.createRange();m.anchor>m.head&&([_,ue]=[ue,_]),ih.setEnd(ue.node,ue.offset),ih.setStart(_.node,_.offset),nh.removeAllRanges(),nh.addRange(ih)}u&&this.view.root.activeElement==this.dom&&(this.dom.blur(),s&&s.focus())}),this.view.observer.setSelectionRange(_,ue)),this.impreciseAnchor=_.precise?null:new DOMPos(gn.anchorNode,gn.anchorOffset),this.impreciseHead=ue.precise?null:new DOMPos(gn.focusNode,gn.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let{view:e}=this,o=e.state.selection.main,s=getSelection(e.root),{anchorNode:c,anchorOffset:u}=e.observer.selectionRange;if(!s||!o.empty||!o.assoc||!s.modify)return;let d=LineView.find(this,o.head);if(!d)return;let m=d.posAtStart;if(o.head==m||o.head==m+d.length)return;let _=this.coordsAt(o.head,-1),ue=this.coordsAt(o.head,1);if(!_||!ue||_.bottom>ue.top)return;let gn=this.domAtPos(o.head+o.assoc);s.collapse(gn.node,gn.offset),s.modify("move",o.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let nh=e.observer.selectionRange;e.docView.posFromDOM(nh.anchorNode,nh.anchorOffset)!=o.from&&s.collapse(c,u)}nearest(e){for(let o=e;o;){let s=ContentView.get(o);if(s&&s.rootView==this)return s;o=o.parentNode}return null}posFromDOM(e,o){let s=this.nearest(e);if(!s)throw new RangeError("Trying to find position for a DOM position outside of the document");return s.localPosFromDOM(e,o)+s.posAtStart}domAtPos(e){let{i:o,off:s}=this.childCursor().findPos(e,-1);for(;o<this.children.length-1;){let c=this.children[o];if(s<c.length||c instanceof LineView)break;o++,s=0}return this.children[o].domAtPos(s)}coordsAt(e,o){for(let s=this.length,c=this.children.length-1;;c--){let u=this.children[c],d=s-u.breakAfter-u.length;if(e>d||e==d&&u.type!=BlockType.WidgetBefore&&u.type!=BlockType.WidgetAfter&&(!c||o==2||this.children[c-1].breakAfter||this.children[c-1].type==BlockType.WidgetBefore&&o>-2))return u.coordsAt(e-d,o);s=d}}measureVisibleLineHeights(e){let o=[],{from:s,to:c}=e,u=this.view.contentDOM.clientWidth,d=u>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,m=-1,_=this.view.textDirection==Direction.LTR;for(let ue=0,gn=0;gn<this.children.length;gn++){let nh=this.children[gn],ih=ue+nh.length;if(ih>c)break;if(ue>=s){let rh=nh.dom.getBoundingClientRect();if(o.push(rh.height),d){let oh=nh.dom.lastChild,lh=oh?clientRectsFor(oh):[];if(lh.length){let ch=lh[lh.length-1],dh=_?ch.right-rh.left:rh.right-ch.left;dh>m&&(m=dh,this.minWidth=u,this.minWidthFrom=ue,this.minWidthTo=ih)}}}ue=ih+nh.breakAfter}return o}textDirectionAt(e){let{i:o}=this.childPos(e,1);return getComputedStyle(this.children[o].dom).direction=="rtl"?Direction.RTL:Direction.LTR}measureTextSize(){for(let u of this.children)if(u instanceof LineView){let d=u.measureTextSize();if(d)return d}let e=document.createElement("div"),o,s,c;return e.className="cm-line",e.style.width="99999px",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let u=clientRectsFor(e.firstChild)[0];o=e.getBoundingClientRect().height,s=u?u.width/27:7,c=u?u.height:o,e.remove()}),{lineHeight:o,charWidth:s,textHeight:c}}childCursor(e=this.length){let o=this.children.length;return o&&(e-=this.children[--o].length),new ChildCursor(this.children,e,o)}computeBlockGapDeco(){let e=[],o=this.view.viewState;for(let s=0,c=0;;c++){let u=c==o.viewports.length?null:o.viewports[c],d=u?u.from-1:this.length;if(d>s){let m=o.lineBlockAt(d).bottom-o.lineBlockAt(s).top;e.push(Decoration.replace({widget:new BlockGapWidget(m),block:!0,inclusive:!0,isBlockGap:!0}).range(s,d))}if(!u)break;s=u.to+1}return Decoration.set(e)}updateDeco(){let e=this.view.state.facet(decorations).map((o,s)=>(this.dynamicDecorationMap[s]=typeof o=="function")?o(this.view):o);for(let o=e.length;o<e.length+3;o++)this.dynamicDecorationMap[o]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:o}=e,s=this.coordsAt(o.head,o.empty?o.assoc:o.head>o.anchor?-1:1),c;if(!s)return;!o.empty&&(c=this.coordsAt(o.anchor,o.anchor>o.head?-1:1))&&(s={left:Math.min(s.left,c.left),top:Math.min(s.top,c.top),right:Math.max(s.right,c.right),bottom:Math.max(s.bottom,c.bottom)});let u=getScrollMargins(this.view),d={left:s.left-u.left,top:s.top-u.top,right:s.right+u.right,bottom:s.bottom+u.bottom};scrollRectIntoView(this.view.scrollDOM,d,o.head<o.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==Direction.LTR)}}function betweenUneditable(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}class BlockGapWidget extends WidgetType{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function compositionSurroundingNode(n){let e=n.observer.selectionRange,o=e.focusNode&&nearbyTextNode(e.focusNode,e.focusOffset,0);if(!o)return null;let s=n.docView.nearest(o);if(!s)return null;if(s instanceof LineView){let c=o;for(;c.parentNode!=s.dom;)c=c.parentNode;let u=c.previousSibling;for(;u&&!ContentView.get(u);)u=u.previousSibling;let d=u?ContentView.get(u).posAtEnd:s.posAtStart;return{from:d,to:d,node:c,text:o}}else{for(;;){let{parent:u}=s;if(!u)return null;if(u instanceof LineView)break;s=u}let c=s.posAtStart;return{from:c,to:c+s.length,node:s.dom,text:o}}}function computeCompositionDeco(n,e){let o=compositionSurroundingNode(n);if(!o)return Decoration.none;let{from:s,to:c,node:u,text:d}=o,m=e.mapPos(s,1),_=Math.max(m,e.mapPos(c,-1)),{state:ue}=n,gn=u.nodeType==3?u.nodeValue:new DOMReader([],ue).readRange(u.firstChild,null).text;if(gn.indexOf(LineBreakPlaceholder)>-1)return Decoration.none;if(_-m<gn.length)if(ue.doc.sliceString(m,Math.min(ue.doc.length,m+gn.length))==gn)_=m+gn.length;else if(ue.doc.sliceString(Math.max(0,_-gn.length),_)==gn)m=_-gn.length;else return Decoration.none;else if(ue.doc.sliceString(m,_)!=gn)return Decoration.none;let nh=ContentView.get(u);return nh instanceof CompositionView?nh=nh.widget.topView:nh&&(nh.parent=null),Decoration.set(Decoration.replace({widget:new CompositionWidget(u,d,nh),inclusive:!0}).range(m,_))}class CompositionWidget extends WidgetType{constructor(e,o,s){super(),this.top=e,this.text=o,this.topView=s}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return CompositionView}}function nearbyTextNode(n,e,o){if(o<=0)for(let s=n,c=e;;){if(s.nodeType==3)return s;if(s.nodeType==1&&c>0)s=s.childNodes[c-1],c=maxOffset(s);else break}if(o>=0)for(let s=n,c=e;;){if(s.nodeType==3)return s;if(s.nodeType==1&&c<s.childNodes.length&&o>=0)s=s.childNodes[c],c=0;else break}return null}function nextToUneditable(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}class DecorationComparator$1{constructor(){this.changes=[]}compareRange(e,o){addRange(e,o,this.changes)}comparePoint(e,o){addRange(e,o,this.changes)}}function findChangedDeco(n,e,o){let s=new DecorationComparator$1;return RangeSet.compare(n,e,o,s),s.changes}function inUneditable(n,e){for(let o=n;o&&o!=e;o=o.assignedSlot||o.parentNode)if(o.nodeType==1&&o.contentEditable=="false")return!0;return!1}function groupAt(n,e,o=1){let s=n.charCategorizer(e),c=n.doc.lineAt(e),u=e-c.from;if(c.length==0)return EditorSelection.cursor(e);u==0?o=1:u==c.length&&(o=-1);let d=u,m=u;o<0?d=findClusterBreak(c.text,u,!1):m=findClusterBreak(c.text,u);let _=s(c.text.slice(d,m));for(;d>0;){let ue=findClusterBreak(c.text,d,!1);if(s(c.text.slice(ue,d))!=_)break;d=ue}for(;m<c.length;){let ue=findClusterBreak(c.text,m);if(s(c.text.slice(m,ue))!=_)break;m=ue}return EditorSelection.range(d+c.from,m+c.from)}function getdx(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function getdy(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function yOverlap(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function upTop(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function upBot(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function domPosAtCoords(n,e,o){let s,c,u,d,m=!1,_,ue,gn,nh;for(let oh=n.firstChild;oh;oh=oh.nextSibling){let lh=clientRectsFor(oh);for(let ch=0;ch<lh.length;ch++){let dh=lh[ch];c&&yOverlap(c,dh)&&(dh=upTop(upBot(dh,c.bottom),c.top));let _h=getdx(e,dh),Sh=getdy(o,dh);if(_h==0&&Sh==0)return oh.nodeType==3?domPosInText(oh,e,o):domPosAtCoords(oh,e,o);if(!s||d>Sh||d==Sh&&u>_h){s=oh,c=dh,u=_h,d=Sh;let fh=Sh?o<dh.top?-1:1:_h?e<dh.left?-1:1:0;m=!fh||(fh>0?ch<lh.length-1:ch>0)}_h==0?o>dh.bottom&&(!gn||gn.bottom<dh.bottom)?(_=oh,gn=dh):o<dh.top&&(!nh||nh.top>dh.top)&&(ue=oh,nh=dh):gn&&yOverlap(gn,dh)?gn=upBot(gn,dh.bottom):nh&&yOverlap(nh,dh)&&(nh=upTop(nh,dh.top))}}if(gn&&gn.bottom>=o?(s=_,c=gn):nh&&nh.top<=o&&(s=ue,c=nh),!s)return{node:n,offset:0};let ih=Math.max(c.left,Math.min(c.right,e));if(s.nodeType==3)return domPosInText(s,ih,o);if(m&&s.contentEditable!="false")return domPosAtCoords(s,ih,o);let rh=Array.prototype.indexOf.call(n.childNodes,s)+(e>=(c.left+c.right)/2?1:0);return{node:n,offset:rh}}function domPosInText(n,e,o){let s=n.nodeValue.length,c=-1,u=1e9,d=0;for(let m=0;m<s;m++){let _=textRange(n,m,m+1).getClientRects();for(let ue=0;ue<_.length;ue++){let gn=_[ue];if(gn.top==gn.bottom)continue;d||(d=e-gn.left);let nh=(gn.top>o?gn.top-o:o-gn.bottom)-1;if(gn.left-1<=e&&gn.right+1>=e&&nh<u){let ih=e>=(gn.left+gn.right)/2,rh=ih;if((browser$1.chrome||browser$1.gecko)&&textRange(n,m).getBoundingClientRect().left==gn.right&&(rh=!ih),nh<=0)return{node:n,offset:m+(rh?1:0)};c=m+(rh?1:0),u=nh}}}return{node:n,offset:c>-1?c:d>0?n.nodeValue.length:0}}function posAtCoords(n,e,o,s=-1){var c,u;let d=n.contentDOM.getBoundingClientRect(),m=d.top+n.viewState.paddingTop,_,{docHeight:ue}=n.viewState,{x:gn,y:nh}=e,ih=nh-m;if(ih<0)return 0;if(ih>ue)return n.state.doc.length;for(let fh=n.defaultLineHeight/2,yh=!1;_=n.elementAtHeight(ih),_.type!=BlockType.Text;)for(;ih=s>0?_.bottom+fh:_.top-fh,!(ih>=0&&ih<=ue);){if(yh)return o?null:0;yh=!0,s=-s}nh=m+ih;let rh=_.from;if(rh<n.viewport.from)return n.viewport.from==0?0:o?null:posAtCoordsImprecise(n,d,_,gn,nh);if(rh>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:o?null:posAtCoordsImprecise(n,d,_,gn,nh);let oh=n.dom.ownerDocument,lh=n.root.elementFromPoint?n.root:oh,ch=lh.elementFromPoint(gn,nh);ch&&!n.contentDOM.contains(ch)&&(ch=null),ch||(gn=Math.max(d.left+1,Math.min(d.right-1,gn)),ch=lh.elementFromPoint(gn,nh),ch&&!n.contentDOM.contains(ch)&&(ch=null));let dh,_h=-1;if(ch&&((c=n.docView.nearest(ch))===null||c===void 0?void 0:c.isEditable)!=!1){if(oh.caretPositionFromPoint){let fh=oh.caretPositionFromPoint(gn,nh);fh&&({offsetNode:dh,offset:_h}=fh)}else if(oh.caretRangeFromPoint){let fh=oh.caretRangeFromPoint(gn,nh);fh&&({startContainer:dh,startOffset:_h}=fh,(!n.contentDOM.contains(dh)||browser$1.safari&&isSuspiciousSafariCaretResult(dh,_h,gn)||browser$1.chrome&&isSuspiciousChromeCaretResult(dh,_h,gn))&&(dh=void 0))}}if(!dh||!n.docView.dom.contains(dh)){let fh=LineView.find(n.docView,rh);if(!fh)return ih>_.top+_.height/2?_.to:_.from;({node:dh,offset:_h}=domPosAtCoords(fh.dom,gn,nh))}let Sh=n.docView.nearest(dh);if(!Sh)return null;if(Sh.isWidget&&((u=Sh.dom)===null||u===void 0?void 0:u.nodeType)==1){let fh=Sh.dom.getBoundingClientRect();return e.y<fh.top||e.y<=fh.bottom&&e.x<=(fh.left+fh.right)/2?Sh.posAtStart:Sh.posAtEnd}else return Sh.localPosFromDOM(dh,_h)+Sh.posAtStart}function posAtCoordsImprecise(n,e,o,s,c){let u=Math.round((s-e.left)*n.defaultCharacterWidth);if(n.lineWrapping&&o.height>n.defaultLineHeight*1.5){let m=Math.floor((c-o.top)/n.defaultLineHeight);u+=m*n.viewState.heightOracle.lineLength}let d=n.state.sliceDoc(o.from,o.to);return o.from+findColumn(d,u,n.state.tabSize)}function isSuspiciousSafariCaretResult(n,e,o){let s;if(n.nodeType!=3||e!=(s=n.nodeValue.length))return!1;for(let c=n.nextSibling;c;c=c.nextSibling)if(c.nodeType!=1||c.nodeName!="BR")return!1;return textRange(n,s-1,s).getBoundingClientRect().left>o}function isSuspiciousChromeCaretResult(n,e,o){if(e!=0)return!1;for(let c=n;;){let u=c.parentNode;if(!u||u.nodeType!=1||u.firstChild!=c)return!1;if(u.classList.contains("cm-line"))break;c=u}let s=n.nodeType==1?n.getBoundingClientRect():textRange(n,0,Math.max(n.nodeValue.length,1)).getBoundingClientRect();return o-s.left>5}function moveToLineBoundary(n,e,o,s){let c=n.state.doc.lineAt(e.head),u=!s||!n.lineWrapping?null:n.coordsAtPos(e.assoc<0&&e.head>c.from?e.head-1:e.head);if(u){let _=n.dom.getBoundingClientRect(),ue=n.textDirectionAt(c.from),gn=n.posAtCoords({x:o==(ue==Direction.LTR)?_.right-1:_.left+1,y:(u.top+u.bottom)/2});if(gn!=null)return EditorSelection.cursor(gn,o?-1:1)}let d=LineView.find(n.docView,e.head),m=d?o?d.posAtEnd:d.posAtStart:o?c.to:c.from;return EditorSelection.cursor(m,o?-1:1)}function moveByChar(n,e,o,s){let c=n.state.doc.lineAt(e.head),u=n.bidiSpans(c),d=n.textDirectionAt(c.from);for(let m=e,_=null;;){let ue=moveVisually(c,u,d,m,o),gn=movedOver;if(!ue){if(c.number==(o?n.state.doc.lines:1))return m;gn=`
`,c=n.state.doc.line(c.number+(o?1:-1)),u=n.bidiSpans(c),ue=EditorSelection.cursor(o?c.from:c.to)}if(_){if(!_(gn))return m}else{if(!s)return ue;_=s(gn)}m=ue}}function byGroup(n,e,o){let s=n.state.charCategorizer(e),c=s(o);return u=>{let d=s(u);return c==CharCategory.Space&&(c=d),c==d}}function moveVertically(n,e,o,s){let c=e.head,u=o?1:-1;if(c==(o?n.state.doc.length:0))return EditorSelection.cursor(c,e.assoc);let d=e.goalColumn,m,_=n.contentDOM.getBoundingClientRect(),ue=n.coordsAtPos(c),gn=n.documentTop;if(ue)d==null&&(d=ue.left-_.left),m=u<0?ue.top:ue.bottom;else{let rh=n.viewState.lineBlockAt(c);d==null&&(d=Math.min(_.right-_.left,n.defaultCharacterWidth*(c-rh.from))),m=(u<0?rh.top:rh.bottom)+gn}let nh=_.left+d,ih=s??n.defaultLineHeight>>1;for(let rh=0;;rh+=10){let oh=m+(ih+rh)*u,lh=posAtCoords(n,{x:nh,y:oh},!1,u);if(oh<_.top||oh>_.bottom||(u<0?lh<c:lh>c))return EditorSelection.cursor(lh,e.assoc,void 0,d)}}function skipAtomicRanges(n,e,o){for(;;){let s=0;for(let c of n)c.between(e-1,e+1,(u,d,m)=>{if(e>u&&e<d){let _=s||o||(e-u<d-e?-1:1);e=_<0?u:d,s=_}});if(!s)return e}}function skipAtoms(n,e,o){let s=skipAtomicRanges(n.state.facet(atomicRanges).map(c=>c(n)),o.from,e.head>o.from?-1:1);return s==o.from?o:EditorSelection.cursor(s,s<o.from?1:-1)}class InputState{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null;let o=(s,c)=>{this.ignoreDuringComposition(c)||c.type=="keydown"&&this.keydown(e,c)||(this.mustFlushObserver(c)&&e.observer.forceFlush(),this.runCustomHandlers(c.type,e,c)?c.preventDefault():s(e,c))};for(let s in handlers){let c=handlers[s];e.contentDOM.addEventListener(s,u=>{eventBelongsToEditor(e,u)&&o(c,u)},handlerOptions[s]),this.registeredEvents.push(s)}e.scrollDOM.addEventListener("mousedown",s=>{if(s.target==e.scrollDOM&&s.clientY>e.contentDOM.getBoundingClientRect().bottom&&(o(handlers.mousedown,s),!s.defaultPrevented&&s.button==2)){let c=e.contentDOM.style.minHeight;e.contentDOM.style.minHeight="100%",setTimeout(()=>e.contentDOM.style.minHeight=c,200)}}),e.scrollDOM.addEventListener("drop",s=>{s.target==e.scrollDOM&&s.clientY>e.contentDOM.getBoundingClientRect().bottom&&o(handlers.drop,s)}),browser$1.chrome&&browser$1.chrome_version==102&&e.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=e.hasFocus,browser$1.safari&&e.contentDOM.addEventListener("input",()=>null)}ensureHandlers(e,o){var s;let c;this.customHandlers=[];for(let u of o)if(c=(s=u.update(e).spec)===null||s===void 0?void 0:s.domEventHandlers){this.customHandlers.push({plugin:u.value,handlers:c});for(let d in c)this.registeredEvents.indexOf(d)<0&&d!="scroll"&&(this.registeredEvents.push(d),e.contentDOM.addEventListener(d,m=>{eventBelongsToEditor(e,m)&&this.runCustomHandlers(d,e,m)&&m.preventDefault()}))}}runCustomHandlers(e,o,s){for(let c of this.customHandlers){let u=c.handlers[e];if(u)try{if(u.call(c.plugin,s,o)||s.defaultPrevented)return!0}catch(d){logException(o.state,d)}}return!1}runScrollHandlers(e,o){this.lastScrollTop=e.scrollDOM.scrollTop,this.lastScrollLeft=e.scrollDOM.scrollLeft;for(let s of this.customHandlers){let c=s.handlers.scroll;if(c)try{c.call(s.plugin,o,e)}catch(u){logException(e.state,u)}}}keydown(e,o){if(this.lastKeyCode=o.keyCode,this.lastKeyTime=Date.now(),o.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(o.keyCode!=27&&modifierCodes.indexOf(o.keyCode)<0&&(e.inputState.lastEscPress=0),browser$1.android&&browser$1.chrome&&!o.synthetic&&(o.keyCode==13||o.keyCode==8))return e.observer.delayAndroidKey(o.key,o.keyCode),!0;let s;return browser$1.ios&&!o.synthetic&&!o.altKey&&!o.metaKey&&((s=PendingKeys.find(c=>c.keyCode==o.keyCode))&&!o.ctrlKey||EmacsyPendingKeys.indexOf(o.key)>-1&&o.ctrlKey&&!o.shiftKey)?(this.pendingIOSKey=s||o,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let o=this.pendingIOSKey;return o?(this.pendingIOSKey=void 0,dispatchKey(e.contentDOM,o.key,o.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:browser$1.safari&&!browser$1.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225],dragScrollMargin=6;function dragScrollSpeed(n){return Math.max(0,n)*.7+8}class MouseSelection{constructor(e,o,s,c){this.view=e,this.style=s,this.mustSelect=c,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=o,this.scrollParent=scrollableParent(e.contentDOM),this.atoms=e.state.facet(atomicRanges).map(d=>d(e));let u=e.contentDOM.ownerDocument;u.addEventListener("mousemove",this.move=this.move.bind(this)),u.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=o.shiftKey,this.multiple=e.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(e,o),this.dragMove=dragMovesSelection(e,o),this.dragging=isInPrimarySelection(e,o)&&getClickType(o)==1?null:!1}start(e){this.dragging===!1&&(e.preventDefault(),this.select(e))}move(e){var o;if(e.buttons==0)return this.destroy();if(this.dragging!==!1)return;this.select(this.lastEvent=e);let s=0,c=0,u=((o=this.scrollParent)===null||o===void 0?void 0:o.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},d=getScrollMargins(this.view);e.clientX-d.left<=u.left+dragScrollMargin?s=-dragScrollSpeed(u.left-e.clientX):e.clientX+d.right>=u.right-dragScrollMargin&&(s=dragScrollSpeed(e.clientX-u.right)),e.clientY-d.top<=u.top+dragScrollMargin?c=-dragScrollSpeed(u.top-e.clientY):e.clientY+d.bottom>=u.bottom-dragScrollMargin&&(c=dragScrollSpeed(e.clientY-u.bottom)),this.setScrollSpeed(s,c)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}setScrollSpeed(e,o){this.scrollSpeed={x:e,y:o},e||o?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let o=null;for(let s=0;s<e.ranges.length;s++){let c=e.ranges[s],u=null;if(c.empty){let d=skipAtomicRanges(this.atoms,c.from,0);d!=c.from&&(u=EditorSelection.cursor(d,-1))}else{let d=skipAtomicRanges(this.atoms,c.from,-1),m=skipAtomicRanges(this.atoms,c.to,1);(d!=c.from||m!=c.to)&&(u=EditorSelection.range(c.from==c.anchor?d:m,c.from==c.head?d:m))}u&&(o||(o=e.ranges.slice()),o[s]=u)}return o?EditorSelection.create(o,e.mainIndex):e}select(e){let{view:o}=this,s=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!s.eq(o.state.selection)||s.main.assoc!=o.state.selection.main.assoc)&&this.view.dispatch({selection:s,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function addsSelectionRange(n,e){let o=n.state.facet(clickAddsSelectionRange);return o.length?o[0](e):browser$1.mac?e.metaKey:e.ctrlKey}function dragMovesSelection(n,e){let o=n.state.facet(dragMovesSelection$1);return o.length?o[0](e):browser$1.mac?!e.altKey:!e.ctrlKey}function isInPrimarySelection(n,e){let{main:o}=n.state.selection;if(o.empty)return!1;let s=getSelection(n.root);if(!s||s.rangeCount==0)return!0;let c=s.getRangeAt(0).getClientRects();for(let u=0;u<c.length;u++){let d=c[u];if(d.left<=e.clientX&&d.right>=e.clientX&&d.top<=e.clientY&&d.bottom>=e.clientY)return!0}return!1}function eventBelongsToEditor(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let o=e.target,s;o!=n.contentDOM;o=o.parentNode)if(!o||o.nodeType==11||(s=ContentView.get(o))&&s.ignoreEvent(e))return!1;return!0}const handlers=Object.create(null),handlerOptions=Object.create(null),brokenClipboardAPI=browser$1.ie&&browser$1.ie_version<15||browser$1.ios&&browser$1.webkit_version<604;function capturePaste(n){let e=n.dom.parentNode;if(!e)return;let o=e.appendChild(document.createElement("textarea"));o.style.cssText="position: fixed; left: -10000px; top: 10px",o.focus(),setTimeout(()=>{n.focus(),o.remove(),doPaste(n,o.value)},50)}function doPaste(n,e){let{state:o}=n,s,c=1,u=o.toText(e),d=u.lines==o.selection.ranges.length;if(lastLinewiseCopy!=null&&o.selection.ranges.every(_=>_.empty)&&lastLinewiseCopy==u.toString()){let _=-1;s=o.changeByRange(ue=>{let gn=o.doc.lineAt(ue.from);if(gn.from==_)return{range:ue};_=gn.from;let nh=o.toText((d?u.line(c++).text:e)+o.lineBreak);return{changes:{from:gn.from,insert:nh},range:EditorSelection.cursor(ue.from+nh.length)}})}else d?s=o.changeByRange(_=>{let ue=u.line(c++);return{changes:{from:_.from,to:_.to,insert:ue.text},range:EditorSelection.cursor(_.from+ue.length)}}):s=o.replaceSelection(u);n.dispatch(s,{userEvent:"input.paste",scrollIntoView:!0})}handlers.keydown=(n,e)=>{n.inputState.setSelectionOrigin("select"),e.keyCode==27&&(n.inputState.lastEscPress=Date.now())};handlers.touchstart=(n,e)=>{n.inputState.lastTouchTime=Date.now(),n.inputState.setSelectionOrigin("select.pointer")};handlers.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")};handlerOptions.touchstart=handlerOptions.touchmove={passive:!0};handlers.mousedown=(n,e)=>{if(n.observer.flush(),n.inputState.lastTouchTime>Date.now()-2e3)return;let o=null;for(let s of n.state.facet(mouseSelectionStyle))if(o=s(n,e),o)break;if(!o&&e.button==0&&(o=basicMouseSelection(n,e)),o){let s=n.root.activeElement!=n.contentDOM;n.inputState.startMouseSelection(new MouseSelection(n,e,o,s)),s&&n.observer.ignore(()=>focusPreventScroll(n.contentDOM)),n.inputState.mouseSelection&&n.inputState.mouseSelection.start(e)}};function rangeForClick(n,e,o,s){if(s==1)return EditorSelection.cursor(e,o);if(s==2)return groupAt(n.state,e,o);{let c=LineView.find(n.docView,e),u=n.state.doc.lineAt(c?c.posAtEnd:e),d=c?c.posAtStart:u.from,m=c?c.posAtEnd:u.to;return m<n.state.doc.length&&m==u.to&&m++,EditorSelection.range(d,m)}}let insideY=(n,e)=>n>=e.top&&n<=e.bottom,inside=(n,e,o)=>insideY(e,o)&&n>=o.left&&n<=o.right;function findPositionSide(n,e,o,s){let c=LineView.find(n.docView,e);if(!c)return 1;let u=e-c.posAtStart;if(u==0)return 1;if(u==c.length)return-1;let d=c.coordsAt(u,-1);if(d&&inside(o,s,d))return-1;let m=c.coordsAt(u,1);return m&&inside(o,s,m)?1:d&&insideY(s,d)?-1:1}function queryPos(n,e){let o=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:o,bias:findPositionSide(n,o,e.clientX,e.clientY)}}const BadMouseDetail=browser$1.ie&&browser$1.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(n){if(!BadMouseDetail)return n.detail;let e=lastMouseDown,o=lastMouseDownTime;return lastMouseDown=n,lastMouseDownTime=Date.now(),lastMouseDownCount=!e||o>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(n,e){let o=queryPos(n,e),s=getClickType(e),c=n.state.selection;return{update(u){u.docChanged&&(o.pos=u.changes.mapPos(o.pos),c=c.map(u.changes))},get(u,d,m){let _=queryPos(n,u),ue,gn=rangeForClick(n,_.pos,_.bias,s);if(o.pos!=_.pos&&!d){let nh=rangeForClick(n,o.pos,o.bias,s),ih=Math.min(nh.from,gn.from),rh=Math.max(nh.to,gn.to);gn=ih<gn.from?EditorSelection.range(ih,rh):EditorSelection.range(rh,ih)}return d?c.replaceRange(c.main.extend(gn.from,gn.to)):m&&s==1&&c.ranges.length>1&&(ue=removeRangeAround(c,_.pos))?ue:m?c.addRange(gn):EditorSelection.create([gn])}}}function removeRangeAround(n,e){for(let o=0;o<n.ranges.length;o++){let{from:s,to:c}=n.ranges[o];if(s<=e&&c>=e)return EditorSelection.create(n.ranges.slice(0,o).concat(n.ranges.slice(o+1)),n.mainIndex==o?0:n.mainIndex-(n.mainIndex>o?1:0))}return null}handlers.dragstart=(n,e)=>{let{selection:{main:o}}=n.state,{mouseSelection:s}=n.inputState;s&&(s.dragging=o),e.dataTransfer&&(e.dataTransfer.setData("Text",n.state.sliceDoc(o.from,o.to)),e.dataTransfer.effectAllowed="copyMove")};function dropText(n,e,o,s){if(!o)return;let c=n.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:u}=n.inputState,d=s&&u&&u.dragging&&u.dragMove?{from:u.dragging.from,to:u.dragging.to}:null,m={from:c,insert:o},_=n.state.changes(d?[d,m]:m);n.focus(),n.dispatch({changes:_,selection:{anchor:_.mapPos(c,-1),head:_.mapPos(c,1)},userEvent:d?"move.drop":"input.drop"})}handlers.drop=(n,e)=>{if(!e.dataTransfer)return;if(n.state.readOnly)return e.preventDefault();let o=e.dataTransfer.files;if(o&&o.length){e.preventDefault();let s=Array(o.length),c=0,u=()=>{++c==o.length&&dropText(n,e,s.filter(d=>d!=null).join(n.state.lineBreak),!1)};for(let d=0;d<o.length;d++){let m=new FileReader;m.onerror=u,m.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(m.result)||(s[d]=m.result),u()},m.readAsText(o[d])}}else dropText(n,e,e.dataTransfer.getData("Text"),!0)};handlers.paste=(n,e)=>{if(n.state.readOnly)return e.preventDefault();n.observer.flush();let o=brokenClipboardAPI?null:e.clipboardData;o?(doPaste(n,o.getData("text/plain")||o.getData("text/uri-text")),e.preventDefault()):capturePaste(n)};function captureCopy(n,e){let o=n.dom.parentNode;if(!o)return;let s=o.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout(()=>{s.remove(),n.focus()},50)}function copiedRange(n){let e=[],o=[],s=!1;for(let c of n.selection.ranges)c.empty||(e.push(n.sliceDoc(c.from,c.to)),o.push(c));if(!e.length){let c=-1;for(let{from:u}of n.selection.ranges){let d=n.doc.lineAt(u);d.number>c&&(e.push(d.text),o.push({from:d.from,to:Math.min(n.doc.length,d.to+1)})),c=d.number}s=!0}return{text:e.join(n.lineBreak),ranges:o,linewise:s}}let lastLinewiseCopy=null;handlers.copy=handlers.cut=(n,e)=>{let{text:o,ranges:s,linewise:c}=copiedRange(n.state);if(!o&&!c)return;lastLinewiseCopy=c?o:null;let u=brokenClipboardAPI?null:e.clipboardData;u?(e.preventDefault(),u.clearData(),u.setData("text/plain",o)):captureCopy(n,o),e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})};const isFocusChange=Annotation.define();function focusChangeTransaction(n,e){let o=[];for(let s of n.facet(focusChangeEffect)){let c=s(n,e);c&&o.push(c)}return o?n.update({effects:o,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(n){setTimeout(()=>{let e=n.hasFocus;if(e!=n.inputState.notifiedFocused){let o=focusChangeTransaction(n.state,e);o?n.dispatch(o):n.update([])}},10)}handlers.focus=n=>{n.inputState.lastFocusTime=Date.now(),!n.scrollDOM.scrollTop&&(n.inputState.lastScrollTop||n.inputState.lastScrollLeft)&&(n.scrollDOM.scrollTop=n.inputState.lastScrollTop,n.scrollDOM.scrollLeft=n.inputState.lastScrollLeft),updateForFocusChange(n)};handlers.blur=n=>{n.observer.clearSelectionRange(),updateForFocusChange(n)};handlers.compositionstart=handlers.compositionupdate=n=>{n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0)};handlers.compositionend=n=>{n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionPendingKey=!0,n.inputState.compositionPendingChange=n.observer.pendingRecords().length>0,n.inputState.compositionFirstChange=null,browser$1.chrome&&browser$1.android?n.observer.flushSoon():n.inputState.compositionPendingChange?Promise.resolve().then(()=>n.observer.flush()):setTimeout(()=>{n.inputState.composing<0&&n.docView.compositionDeco.size&&n.update([])},50)};handlers.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()};handlers.beforeinput=(n,e)=>{var o;let s;if(browser$1.chrome&&browser$1.android&&(s=PendingKeys.find(c=>c.inputType==e.inputType))&&(n.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let c=((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0;setTimeout(()=>{var u;(((u=window.visualViewport)===null||u===void 0?void 0:u.height)||0)>c+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}};const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];class HeightOracle{constructor(e){this.lineWrapping=e,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,o){let s=this.doc.lineAt(o).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(s+=Math.max(0,Math.ceil((o-e-s*this.lineLength*.5)/this.lineLength))),this.lineHeight*s}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return wrappingWhiteSpace.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let o=!1;for(let s=0;s<e.length;s++){let c=e[s];c<0?s++:this.heightSamples[Math.floor(c*10)]||(o=!0,this.heightSamples[Math.floor(c*10)]=!0)}return o}refresh(e,o,s,c,u,d){let m=wrappingWhiteSpace.indexOf(e)>-1,_=Math.round(o)!=Math.round(this.lineHeight)||this.lineWrapping!=m;if(this.lineWrapping=m,this.lineHeight=o,this.charWidth=s,this.textHeight=c,this.lineLength=u,_){this.heightSamples={};for(let ue=0;ue<d.length;ue++){let gn=d[ue];gn<0?ue++:this.heightSamples[Math.floor(gn*10)]=!0}}return _}}class MeasuredHeights{constructor(e,o){this.from=e,this.heights=o,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(e,o,s,c,u,d){this.from=e,this.length=o,this.top=s,this.height=c,this.children=u,this.deco=d}get type(){var e,o,s;return(s=(e=this.children)!==null&&e!==void 0?e:(o=this.deco)===null||o===void 0?void 0:o.type)!==null&&s!==void 0?s:BlockType.Text}get widget(){return this.deco&&this.deco.widget}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let o=(this.children||[this]).concat(e.children||[e]);return new BlockInfo(this.from,this.length+e.length,this.top,this.height+e.height,o,null)}}var QueryType$1=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(QueryType$1||(QueryType$1={}));const Epsilon=.001;class HeightMap{constructor(e,o,s=2){this.length=e,this.height=o,this.flags=s}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,o){this.height!=o&&(Math.abs(this.height-o)>Epsilon&&(e.heightChanged=!0),this.height=o)}replace(e,o,s){return HeightMap.of(s)}decomposeLeft(e,o){o.push(this)}decomposeRight(e,o){o.push(this)}applyChanges(e,o,s,c){let u=this,d=s.doc;for(let m=c.length-1;m>=0;m--){let{fromA:_,toA:ue,fromB:gn,toB:nh}=c[m],ih=u.lineAt(_,QueryType$1.ByPosNoHeight,s.setDoc(o),0,0),rh=ih.to>=ue?ih:u.lineAt(ue,QueryType$1.ByPosNoHeight,s,0,0);for(nh+=rh.to-ue,ue=rh.to;m>0&&ih.from<=c[m-1].toA;)_=c[m-1].fromA,gn=c[m-1].fromB,m--,_<ih.from&&(ih=u.lineAt(_,QueryType$1.ByPosNoHeight,s,0,0));gn+=ih.from-_,_=ih.from;let oh=NodeBuilder.build(s.setDoc(d),e,gn,nh);u=u.replace(_,ue,oh)}return u.updateHeight(s,0)}static empty(){return new HeightMapText(0,0)}static of(e){if(e.length==1)return e[0];let o=0,s=e.length,c=0,u=0;for(;;)if(o==s)if(c>u*2){let m=e[o-1];m.break?e.splice(--o,1,m.left,null,m.right):e.splice(--o,1,m.left,m.right),s+=1+m.break,c-=m.size}else if(u>c*2){let m=e[s];m.break?e.splice(s,1,m.left,null,m.right):e.splice(s,1,m.left,m.right),s+=2+m.break,u-=m.size}else break;else if(c<u){let m=e[o++];m&&(c+=m.size)}else{let m=e[--s];m&&(u+=m.size)}let d=0;return e[o-1]==null?(d=1,o--):e[o]==null&&(d=1,s++),new HeightMapBranch(HeightMap.of(e.slice(0,o)),d,HeightMap.of(e.slice(s)))}}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(e,o,s){super(e,o),this.deco=s}blockAt(e,o,s,c){return new BlockInfo(c,this.length,s,this.height,null,this.deco)}lineAt(e,o,s,c,u){return this.blockAt(0,s,c,u)}forEachLine(e,o,s,c,u,d){e<=u+this.length&&o>=u&&d(this.blockAt(0,s,c,u))}updateHeight(e,o=0,s=!1,c){return c&&c.from<=o&&c.more&&this.setHeight(e,c.heights[c.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(e,o){super(e,o,null),this.collapsed=0,this.widgetHeight=0}replace(e,o,s){let c=s[0];return s.length==1&&(c instanceof HeightMapText||c instanceof HeightMapGap&&c.flags&4)&&Math.abs(this.length-c.length)<10?(c instanceof HeightMapGap?c=new HeightMapText(c.length,this.height):c.height=this.height,this.outdated||(c.outdated=!1),c):HeightMap.of(s)}updateHeight(e,o=0,s=!1,c){return c&&c.from<=o&&c.more?this.setHeight(e,c.heights[c.index++]):(s||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(e){super(e,0)}heightMetrics(e,o){let s=e.doc.lineAt(o).number,c=e.doc.lineAt(o+this.length).number,u=c-s+1,d,m=0;if(e.lineWrapping){let _=Math.min(this.height,e.lineHeight*u);d=_/u,this.length>u+1&&(m=(this.height-_)/(this.length-u-1))}else d=this.height/u;return{firstLine:s,lastLine:c,perLine:d,perChar:m}}blockAt(e,o,s,c){let{firstLine:u,lastLine:d,perLine:m,perChar:_}=this.heightMetrics(o,c);if(o.lineWrapping){let ue=c+Math.round(Math.max(0,Math.min(1,(e-s)/this.height))*this.length),gn=o.doc.lineAt(ue),nh=m+gn.length*_,ih=Math.max(s,e-nh/2);return new BlockInfo(gn.from,gn.length,ih,nh,null,null)}else{let ue=Math.max(0,Math.min(d-u,Math.floor((e-s)/m))),{from:gn,length:nh}=o.doc.line(u+ue);return new BlockInfo(gn,nh,s+m*ue,m,null,null)}}lineAt(e,o,s,c,u){if(o==QueryType$1.ByHeight)return this.blockAt(e,s,c,u);if(o==QueryType$1.ByPosNoHeight){let{from:rh,to:oh}=s.doc.lineAt(e);return new BlockInfo(rh,oh-rh,0,0,null,null)}let{firstLine:d,perLine:m,perChar:_}=this.heightMetrics(s,u),ue=s.doc.lineAt(e),gn=m+ue.length*_,nh=ue.number-d,ih=c+m*nh+_*(ue.from-u-nh);return new BlockInfo(ue.from,ue.length,Math.max(c,Math.min(ih,c+this.height-gn)),gn,null,null)}forEachLine(e,o,s,c,u,d){e=Math.max(e,u),o=Math.min(o,u+this.length);let{firstLine:m,perLine:_,perChar:ue}=this.heightMetrics(s,u);for(let gn=e,nh=c;gn<=o;){let ih=s.doc.lineAt(gn);if(gn==e){let oh=ih.number-m;nh+=_*oh+ue*(e-u-oh)}let rh=_+ue*ih.length;d(new BlockInfo(ih.from,ih.length,nh,rh,null,null)),nh+=rh,gn=ih.to+1}}replace(e,o,s){let c=this.length-o;if(c>0){let u=s[s.length-1];u instanceof HeightMapGap?s[s.length-1]=new HeightMapGap(u.length+c):s.push(null,new HeightMapGap(c-1))}if(e>0){let u=s[0];u instanceof HeightMapGap?s[0]=new HeightMapGap(e+u.length):s.unshift(new HeightMapGap(e-1),null)}return HeightMap.of(s)}decomposeLeft(e,o){o.push(new HeightMapGap(e-1),null)}decomposeRight(e,o){o.push(null,new HeightMapGap(this.length-e-1))}updateHeight(e,o=0,s=!1,c){let u=o+this.length;if(c&&c.from<=o+this.length&&c.more){let d=[],m=Math.max(o,c.from),_=-1;for(c.from>o&&d.push(new HeightMapGap(c.from-o-1).updateHeight(e,o));m<=u&&c.more;){let gn=e.doc.lineAt(m).length;d.length&&d.push(null);let nh=c.heights[c.index++];_==-1?_=nh:Math.abs(nh-_)>=Epsilon&&(_=-2);let ih=new HeightMapText(gn,nh);ih.outdated=!1,d.push(ih),m+=gn+1}m<=u&&d.push(null,new HeightMapGap(u-m).updateHeight(e,m));let ue=HeightMap.of(d);return(_<0||Math.abs(ue.height-this.height)>=Epsilon||Math.abs(_-this.heightMetrics(e,o).perLine)>=Epsilon)&&(e.heightChanged=!0),ue}else(s||this.outdated)&&(this.setHeight(e,e.heightForGap(o,o+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(e,o,s){super(e.length+o+s.length,e.height+s.height,o|(e.outdated||s.outdated?2:0)),this.left=e,this.right=s,this.size=e.size+s.size}get break(){return this.flags&1}blockAt(e,o,s,c){let u=s+this.left.height;return e<u?this.left.blockAt(e,o,s,c):this.right.blockAt(e,o,u,c+this.left.length+this.break)}lineAt(e,o,s,c,u){let d=c+this.left.height,m=u+this.left.length+this.break,_=o==QueryType$1.ByHeight?e<d:e<m,ue=_?this.left.lineAt(e,o,s,c,u):this.right.lineAt(e,o,s,d,m);if(this.break||(_?ue.to<m:ue.from>m))return ue;let gn=o==QueryType$1.ByPosNoHeight?QueryType$1.ByPosNoHeight:QueryType$1.ByPos;return _?ue.join(this.right.lineAt(m,gn,s,d,m)):this.left.lineAt(m,gn,s,c,u).join(ue)}forEachLine(e,o,s,c,u,d){let m=c+this.left.height,_=u+this.left.length+this.break;if(this.break)e<_&&this.left.forEachLine(e,o,s,c,u,d),o>=_&&this.right.forEachLine(e,o,s,m,_,d);else{let ue=this.lineAt(_,QueryType$1.ByPos,s,c,u);e<ue.from&&this.left.forEachLine(e,ue.from-1,s,c,u,d),ue.to>=e&&ue.from<=o&&d(ue),o>ue.to&&this.right.forEachLine(ue.to+1,o,s,m,_,d)}}replace(e,o,s){let c=this.left.length+this.break;if(o<c)return this.balanced(this.left.replace(e,o,s),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-c,o-c,s));let u=[];e>0&&this.decomposeLeft(e,u);let d=u.length;for(let m of s)u.push(m);if(e>0&&mergeGaps(u,d-1),o<this.length){let m=u.length;this.decomposeRight(o,u),mergeGaps(u,m)}return HeightMap.of(u)}decomposeLeft(e,o){let s=this.left.length;if(e<=s)return this.left.decomposeLeft(e,o);o.push(this.left),this.break&&(s++,e>=s&&o.push(null)),e>s&&this.right.decomposeLeft(e-s,o)}decomposeRight(e,o){let s=this.left.length,c=s+this.break;if(e>=c)return this.right.decomposeRight(e-c,o);e<s&&this.left.decomposeRight(e,o),this.break&&e<c&&o.push(null),o.push(this.right)}balanced(e,o){return e.size>2*o.size||o.size>2*e.size?HeightMap.of(this.break?[e,null,o]:[e,o]):(this.left=e,this.right=o,this.height=e.height+o.height,this.outdated=e.outdated||o.outdated,this.size=e.size+o.size,this.length=e.length+this.break+o.length,this)}updateHeight(e,o=0,s=!1,c){let{left:u,right:d}=this,m=o+u.length+this.break,_=null;return c&&c.from<=o+u.length&&c.more?_=u=u.updateHeight(e,o,s,c):u.updateHeight(e,o,s),c&&c.from<=m+d.length&&c.more?_=d=d.updateHeight(e,m,s,c):d.updateHeight(e,m,s),_?this.balanced(u,d):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(n,e){let o,s;n[e]==null&&(o=n[e-1])instanceof HeightMapGap&&(s=n[e+1])instanceof HeightMapGap&&n.splice(e-1,3,new HeightMapGap(o.length+1+s.length))}const relevantWidgetHeight=5;class NodeBuilder{constructor(e,o){this.pos=e,this.oracle=o,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,o){if(this.lineStart>-1){let s=Math.min(o,this.lineEnd),c=this.nodes[this.nodes.length-1];c instanceof HeightMapText?c.length+=s-this.pos:(s>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(s-this.pos,-1)),this.writtenTo=s,o>s&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=o}point(e,o,s){if(e<o||s.heightRelevant){let c=s.widget?s.widget.estimatedHeight:0;c<0&&(c=this.oracle.lineHeight);let u=o-e;s.block?this.addBlock(new HeightMapBlock(u,c,s)):(u||c>=relevantWidgetHeight)&&this.addLineDeco(c,u)}else o>e&&this.span(e,o);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:o}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=o,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new HeightMapText(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,o){let s=new HeightMapGap(o-e);return this.oracle.doc.lineAt(e).to==o&&(s.flags|=4),s}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;let o=new HeightMapText(0,-1);return this.nodes.push(o),o}addBlock(e){var o;this.enterLine();let s=(o=e.deco)===null||o===void 0?void 0:o.type;s==BlockType.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,s!=BlockType.WidgetBefore&&(this.covering=e)}addLineDeco(e,o){let s=this.ensureLine();s.length+=o,s.collapsed+=o,s.widgetHeight=Math.max(s.widgetHeight,e),this.writtenTo=this.pos=this.pos+o}finish(e){let o=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(o instanceof HeightMapText)&&!this.isCovered?this.nodes.push(new HeightMapText(0,-1)):(this.writtenTo<this.pos||o==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let s=e;for(let c of this.nodes)c instanceof HeightMapText&&c.updateHeight(this.oracle,s),s+=c?c.length:1;return this.nodes}static build(e,o,s,c){let u=new NodeBuilder(s,e);return RangeSet.spans(o,s,c,u,0),u.finish(s)}}function heightRelevantDecoChanges(n,e,o){let s=new DecorationComparator;return RangeSet.compare(n,e,o,s,0),s.changes}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(e,o,s,c){(e<o||s&&s.heightRelevant||c&&c.heightRelevant)&&addRange(e,o,this.changes,5)}}function visiblePixelRange(n,e){let o=n.getBoundingClientRect(),s=n.ownerDocument,c=s.defaultView||window,u=Math.max(0,o.left),d=Math.min(c.innerWidth,o.right),m=Math.max(0,o.top),_=Math.min(c.innerHeight,o.bottom);for(let ue=n.parentNode;ue&&ue!=s.body;)if(ue.nodeType==1){let gn=ue,nh=window.getComputedStyle(gn);if((gn.scrollHeight>gn.clientHeight||gn.scrollWidth>gn.clientWidth)&&nh.overflow!="visible"){let ih=gn.getBoundingClientRect();u=Math.max(u,ih.left),d=Math.min(d,ih.right),m=Math.max(m,ih.top),_=ue==n.parentNode?ih.bottom:Math.min(_,ih.bottom)}ue=nh.position=="absolute"||nh.position=="fixed"?gn.offsetParent:gn.parentNode}else if(ue.nodeType==11)ue=ue.host;else break;return{left:u-o.left,right:Math.max(u,d)-o.left,top:m-(o.top+e),bottom:Math.max(m,_)-(o.top+e)}}function fullPixelRange(n,e){let o=n.getBoundingClientRect();return{left:0,right:o.right-o.left,top:e,bottom:o.bottom-(o.top+e)}}class LineGap{constructor(e,o,s){this.from=e,this.to=o,this.size=s}static same(e,o){if(e.length!=o.length)return!1;for(let s=0;s<e.length;s++){let c=e[s],u=o[s];if(c.from!=u.from||c.to!=u.to||c.size!=u.size)return!1}return!0}draw(e){return Decoration.replace({widget:new LineGapWidget(this.size,e)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(e,o){super(),this.size=e,this.vertical=o}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let o=e.facet(contentAttributes).some(s=>typeof s!="function"&&s.class=="cm-lineWrapping");this.heightOracle=new HeightOracle(o),this.stateDeco=e.facet(decorations).filter(s=>typeof s!="function"),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map(s=>s.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:o}=this.state.selection;for(let s=0;s<=1;s++){let c=s?o.head:o.anchor;if(!e.some(({from:u,to:d})=>c>=u&&c<=d)){let{from:u,to:d}=this.lineBlockAt(c);e.push(new Viewport(u,d))}}this.viewports=e.sort((s,c)=>s.from-c.from),this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:scaleBlock(e,this.scaler))})}update(e,o=null){this.state=e.state;let s=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter(ue=>typeof ue!="function");let c=e.changedRanges,u=ChangedRange.extendWithRanges(c,heightRelevantDecoChanges(s,this.stateDeco,e?e.changes:ChangeSet.empty(this.state.doc.length))),d=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),u),this.heightMap.height!=d&&(e.flags|=2);let m=u.length?this.mapViewport(this.viewport,e.changes):this.viewport;(o&&(o.range.head<m.from||o.range.head>m.to)||!this.viewportIsAppropriate(m))&&(m=this.getViewport(0,o));let _=!e.changes.empty||e.flags&2||m.from!=this.viewport.from||m.to!=this.viewport.to;this.viewport=m,this.updateForViewport(),_&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>2e3<<1)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),o&&(this.scrollTarget=o),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let o=e.contentDOM,s=window.getComputedStyle(o),c=this.heightOracle,u=s.whiteSpace;this.defaultTextDirection=s.direction=="rtl"?Direction.RTL:Direction.LTR;let d=this.heightOracle.mustRefreshForWrapping(u),m=o.getBoundingClientRect(),_=d||this.mustMeasureContent||this.contentDOMHeight!=m.height;this.contentDOMHeight=m.height,this.mustMeasureContent=!1;let ue=0,gn=0,nh=parseInt(s.paddingTop)||0,ih=parseInt(s.paddingBottom)||0;(this.paddingTop!=nh||this.paddingBottom!=ih)&&(this.paddingTop=nh,this.paddingBottom=ih,ue|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(c.lineWrapping&&(_=!0),this.editorWidth=e.scrollDOM.clientWidth,ue|=8);let rh=(this.printing?fullPixelRange:visiblePixelRange)(o,this.paddingTop),oh=rh.top-this.pixelViewport.top,lh=rh.bottom-this.pixelViewport.bottom;this.pixelViewport=rh;let ch=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(ch!=this.inView&&(this.inView=ch,ch&&(_=!0)),!this.inView&&!this.scrollTarget)return 0;let dh=m.width;if((this.contentDOMWidth!=dh||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=m.width,this.editorHeight=e.scrollDOM.clientHeight,ue|=8),_){let Sh=e.docView.measureVisibleLineHeights(this.viewport);if(c.mustRefreshForHeights(Sh)&&(d=!0),d||c.lineWrapping&&Math.abs(dh-this.contentDOMWidth)>c.charWidth){let{lineHeight:fh,charWidth:yh,textHeight:mh}=e.docView.measureTextSize();d=fh>0&&c.refresh(u,fh,yh,mh,dh/yh,Sh),d&&(e.docView.minWidth=0,ue|=8)}oh>0&&lh>0?gn=Math.max(oh,lh):oh<0&&lh<0&&(gn=Math.min(oh,lh)),c.heightChanged=!1;for(let fh of this.viewports){let yh=fh.from==this.viewport.from?Sh:e.docView.measureVisibleLineHeights(fh);this.heightMap=(d?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(c,0,d,new MeasuredHeights(fh.from,yh))}c.heightChanged&&(ue|=2)}let _h=!this.viewportIsAppropriate(this.viewport,gn)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return _h&&(this.viewport=this.getViewport(gn,this.scrollTarget)),this.updateForViewport(),(ue&2||_h)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>2e3<<1)&&this.updateLineGaps(this.ensureLineGaps(d?[]:this.lineGaps,e)),ue|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),ue}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,o){let s=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),c=this.heightMap,u=this.heightOracle,{visibleTop:d,visibleBottom:m}=this,_=new Viewport(c.lineAt(d-s*1e3,QueryType$1.ByHeight,u,0,0).from,c.lineAt(m+(1-s)*1e3,QueryType$1.ByHeight,u,0,0).to);if(o){let{head:ue}=o.range;if(ue<_.from||ue>_.to){let gn=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),nh=c.lineAt(ue,QueryType$1.ByPos,u,0,0),ih;o.y=="center"?ih=(nh.top+nh.bottom)/2-gn/2:o.y=="start"||o.y=="nearest"&&ue<_.from?ih=nh.top:ih=nh.bottom-gn,_=new Viewport(c.lineAt(ih-1e3/2,QueryType$1.ByHeight,u,0,0).from,c.lineAt(ih+gn+1e3/2,QueryType$1.ByHeight,u,0,0).to)}}return _}mapViewport(e,o){let s=o.mapPos(e.from,-1),c=o.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(s,QueryType$1.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(c,QueryType$1.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:o},s=0){if(!this.inView)return!0;let{top:c}=this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),{bottom:u}=this.heightMap.lineAt(o,QueryType$1.ByPos,this.heightOracle,0,0),{visibleTop:d,visibleBottom:m}=this;return(e==0||c<=d-Math.max(10,Math.min(-s,250)))&&(o==this.state.doc.length||u>=m+Math.max(10,Math.min(s,250)))&&c>d-2*1e3&&u<m+2*1e3}mapLineGaps(e,o){if(!e.length||o.empty)return e;let s=[];for(let c of e)o.touchesRange(c.from,c.to)||s.push(new LineGap(o.mapPos(c.from),o.mapPos(c.to),c.size));return s}ensureLineGaps(e,o){let s=this.heightOracle.lineWrapping,c=s?1e4:2e3,u=c>>1,d=c<<1;if(this.defaultTextDirection!=Direction.LTR&&!s)return[];let m=[],_=(ue,gn,nh,ih)=>{if(gn-ue<u)return;let rh=this.state.selection.main,oh=[rh.from];rh.empty||oh.push(rh.to);for(let ch of oh)if(ch>ue&&ch<gn){_(ue,ch-10,nh,ih),_(ch+10,gn,nh,ih);return}let lh=find(e,ch=>ch.from>=nh.from&&ch.to<=nh.to&&Math.abs(ch.from-ue)<u&&Math.abs(ch.to-gn)<u&&!oh.some(dh=>ch.from<dh&&ch.to>dh));if(!lh){if(gn<nh.to&&o&&s&&o.visibleRanges.some(ch=>ch.from<=gn&&ch.to>=gn)){let ch=o.moveToLineBoundary(EditorSelection.cursor(gn),!1,!0).head;ch>ue&&(gn=ch)}lh=new LineGap(ue,gn,this.gapSize(nh,ue,gn,ih))}m.push(lh)};for(let ue of this.viewportLines){if(ue.length<d)continue;let gn=lineStructure(ue.from,ue.to,this.stateDeco);if(gn.total<d)continue;let nh=this.scrollTarget?this.scrollTarget.range.head:null,ih,rh;if(s){let oh=c/this.heightOracle.lineLength*this.heightOracle.lineHeight,lh,ch;if(nh!=null){let dh=findFraction(gn,nh),_h=((this.visibleBottom-this.visibleTop)/2+oh)/ue.height;lh=dh-_h,ch=dh+_h}else lh=(this.visibleTop-ue.top-oh)/ue.height,ch=(this.visibleBottom-ue.top+oh)/ue.height;ih=findPosition(gn,lh),rh=findPosition(gn,ch)}else{let oh=gn.total*this.heightOracle.charWidth,lh=c*this.heightOracle.charWidth,ch,dh;if(nh!=null){let _h=findFraction(gn,nh),Sh=((this.pixelViewport.right-this.pixelViewport.left)/2+lh)/oh;ch=_h-Sh,dh=_h+Sh}else ch=(this.pixelViewport.left-lh)/oh,dh=(this.pixelViewport.right+lh)/oh;ih=findPosition(gn,ch),rh=findPosition(gn,dh)}ih>ue.from&&_(ue.from,ih,ue,gn),rh<ue.to&&_(rh,ue.to,ue,gn)}return m}gapSize(e,o,s,c){let u=findFraction(c,s)-findFraction(c,o);return this.heightOracle.lineWrapping?e.height*u:c.total*this.heightOracle.charWidth*u}updateLineGaps(e){LineGap.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Decoration.set(e.map(o=>o.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let o=[];RangeSet.spans(e,this.viewport.from,this.viewport.to,{span(c,u){o.push({from:c,to:u})},point(){}},20);let s=o.length!=this.visibleRanges.length||this.visibleRanges.some((c,u)=>c.from!=o[u].from||c.to!=o[u].to);return this.visibleRanges=o,s?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(o=>o.from<=e&&o.to>=e)||scaleBlock(this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e),QueryType$1.ByHeight,this.heightOracle,0,0),this.scaler)}elementAtHeight(e){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(e,o){this.from=e,this.to=o}}function lineStructure(n,e,o){let s=[],c=n,u=0;return RangeSet.spans(o,n,e,{span(){},point(d,m){d>c&&(s.push({from:c,to:d}),u+=d-c),c=m}},20),c<e&&(s.push({from:c,to:e}),u+=e-c),{total:u,ranges:s}}function findPosition({total:n,ranges:e},o){if(o<=0)return e[0].from;if(o>=1)return e[e.length-1].to;let s=Math.floor(n*o);for(let c=0;;c++){let{from:u,to:d}=e[c],m=d-u;if(s<=m)return u+s;s-=m}}function findFraction(n,e){let o=0;for(let{from:s,to:c}of n.ranges){if(e<=c){o+=e-s;break}o+=c-s}return o/n.total}function find(n,e){for(let o of n)if(e(o))return o}const IdScaler={toDOM(n){return n},fromDOM(n){return n},scale:1};class BigScaler{constructor(e,o,s){let c=0,u=0,d=0;this.viewports=s.map(({from:m,to:_})=>{let ue=o.lineAt(m,QueryType$1.ByPos,e,0,0).top,gn=o.lineAt(_,QueryType$1.ByPos,e,0,0).bottom;return c+=gn-ue,{from:m,to:_,top:ue,bottom:gn,domTop:0,domBottom:0}}),this.scale=(7e6-c)/(o.height-c);for(let m of this.viewports)m.domTop=d+(m.top-u)*this.scale,d=m.domBottom=m.domTop+(m.bottom-m.top),u=m.bottom}toDOM(e){for(let o=0,s=0,c=0;;o++){let u=o<this.viewports.length?this.viewports[o]:null;if(!u||e<u.top)return c+(e-s)*this.scale;if(e<=u.bottom)return u.domTop+(e-u.top);s=u.bottom,c=u.domBottom}}fromDOM(e){for(let o=0,s=0,c=0;;o++){let u=o<this.viewports.length?this.viewports[o]:null;if(!u||e<u.domTop)return s+(e-c)/this.scale;if(e<=u.domBottom)return u.top+(e-u.domTop);s=u.bottom,c=u.domBottom}}}function scaleBlock(n,e){if(e.scale==1)return n;let o=e.toDOM(n.top),s=e.toDOM(n.bottom);return new BlockInfo(n.from,n.length,o,s-o,n.children&&n.children.map(c=>scaleBlock(c,e)),n.deco)}const theme=Facet.define({combine:n=>n.join(" ")}),darkTheme=Facet.define({combine:n=>n.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(n,e,o){return new StyleModule(e,{finish(s){return/&/.test(s)?s.replace(/&\w*/,c=>{if(c=="&")return n;if(!o||!o[c])throw new RangeError(`Unsupported selector: ${c}`);return o[c]}):n+" "+s}})}const baseTheme$1$3=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs);class DOMChange{constructor(e,o,s,c){this.typeOver=c,this.bounds=null,this.text="";let{impreciseHead:u,impreciseAnchor:d}=e.docView;if(e.state.readOnly&&o>-1)this.newSel=null;else if(o>-1&&(this.bounds=e.docView.domBoundsAround(o,s,0))){let m=u||d?[]:selectionPoints(e),_=new DOMReader(m,e.state);_.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=_.text,this.newSel=selectionFromPoints(m,this.bounds.from)}else{let m=e.observer.selectionRange,_=u&&u.node==m.focusNode&&u.offset==m.focusOffset||!contains$1(e.contentDOM,m.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(m.focusNode,m.focusOffset),ue=d&&d.node==m.anchorNode&&d.offset==m.anchorOffset||!contains$1(e.contentDOM,m.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(m.anchorNode,m.anchorOffset);this.newSel=EditorSelection.single(ue,_)}}}function applyDOMChange(n,e){let o,{newSel:s}=e,c=n.state.selection.main,u=n.inputState.lastKeyTime>Date.now()-100?n.inputState.lastKeyCode:-1;if(e.bounds){let{from:d,to:m}=e.bounds,_=c.from,ue=null;(u===8||browser$1.android&&e.text.length<m-d)&&(_=c.to,ue="end");let gn=findDiff(n.state.doc.sliceString(d,m,LineBreakPlaceholder),e.text,_-d,ue);gn&&(browser$1.chrome&&u==13&&gn.toB==gn.from+2&&e.text.slice(gn.from,gn.toB)==LineBreakPlaceholder+LineBreakPlaceholder&&gn.toB--,o={from:d+gn.from,to:d+gn.toA,insert:Text.of(e.text.slice(gn.from,gn.toB).split(LineBreakPlaceholder))})}else s&&(!n.hasFocus&&n.state.facet(editable)||s.main.eq(c))&&(s=null);if(!o&&!s)return!1;if(!o&&e.typeOver&&!c.empty&&s&&s.main.empty?o={from:c.from,to:c.to,insert:n.state.doc.slice(c.from,c.to)}:o&&o.from>=c.from&&o.to<=c.to&&(o.from!=c.from||o.to!=c.to)&&c.to-c.from-(o.to-o.from)<=4?o={from:c.from,to:c.to,insert:n.state.doc.slice(c.from,o.from).append(o.insert).append(n.state.doc.slice(o.to,c.to))}:(browser$1.mac||browser$1.android)&&o&&o.from==o.to&&o.from==c.head-1&&/^\. ?$/.test(o.insert.toString())&&n.contentDOM.getAttribute("autocorrect")=="off"?(s&&o.insert.length==2&&(s=EditorSelection.single(s.main.anchor-1,s.main.head-1)),o={from:c.from,to:c.to,insert:Text.of([" "])}):browser$1.chrome&&o&&o.from==o.to&&o.from==c.head&&o.insert.toString()==`
 `&&n.lineWrapping&&(s&&(s=EditorSelection.single(s.main.anchor-1,s.main.head-1)),o={from:c.from,to:c.to,insert:Text.of([" "])}),o){let d=n.state;if(browser$1.ios&&n.inputState.flushIOSKey(n)||browser$1.android&&(o.from==c.from&&o.to==c.to&&o.insert.length==1&&o.insert.lines==2&&dispatchKey(n.contentDOM,"Enter",13)||(o.from==c.from-1&&o.to==c.to&&o.insert.length==0||u==8&&o.insert.length<o.to-o.from)&&dispatchKey(n.contentDOM,"Backspace",8)||o.from==c.from&&o.to==c.to+1&&o.insert.length==0&&dispatchKey(n.contentDOM,"Delete",46)))return!0;let m=o.insert.toString();if(n.state.facet(inputHandler$1).some(gn=>gn(n,o.from,o.to,m)))return!0;n.inputState.composing>=0&&n.inputState.composing++;let _;if(o.from>=c.from&&o.to<=c.to&&o.to-o.from>=(c.to-c.from)/3&&(!s||s.main.empty&&s.main.from==o.from+o.insert.length)&&n.inputState.composing<0){let gn=c.from<o.from?d.sliceDoc(c.from,o.from):"",nh=c.to>o.to?d.sliceDoc(o.to,c.to):"";_=d.replaceSelection(n.state.toText(gn+o.insert.sliceString(0,void 0,n.state.lineBreak)+nh))}else{let gn=d.changes(o),nh=s&&s.main.to<=gn.newLength?s.main:void 0;if(d.selection.ranges.length>1&&n.inputState.composing>=0&&o.to<=c.to&&o.to>=c.to-10){let ih=n.state.sliceDoc(o.from,o.to),rh=compositionSurroundingNode(n)||n.state.doc.lineAt(c.head),oh=c.to-o.to,lh=c.to-c.from;_=d.changeByRange(ch=>{if(ch.from==c.from&&ch.to==c.to)return{changes:gn,range:nh||ch.map(gn)};let dh=ch.to-oh,_h=dh-ih.length;if(ch.to-ch.from!=lh||n.state.sliceDoc(_h,dh)!=ih||rh&&ch.to>=rh.from&&ch.from<=rh.to)return{range:ch};let Sh=d.changes({from:_h,to:dh,insert:o.insert}),fh=ch.to-c.to;return{changes:Sh,range:nh?EditorSelection.range(Math.max(0,nh.anchor+fh),Math.max(0,nh.head+fh)):ch.map(Sh)}})}else _={changes:gn,selection:nh&&d.selection.replaceRange(nh)}}let ue="input.type";return(n.composing||n.inputState.compositionPendingChange&&n.inputState.compositionEndedAt>Date.now()-50)&&(n.inputState.compositionPendingChange=!1,ue+=".compose",n.inputState.compositionFirstChange&&(ue+=".start",n.inputState.compositionFirstChange=!1)),n.dispatch(_,{scrollIntoView:!0,userEvent:ue}),!0}else if(s&&!s.main.eq(c)){let d=!1,m="select";return n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(d=!0),m=n.inputState.lastSelectionOrigin),n.dispatch({selection:s,scrollIntoView:d,userEvent:m}),!0}else return!1}function findDiff(n,e,o,s){let c=Math.min(n.length,e.length),u=0;for(;u<c&&n.charCodeAt(u)==e.charCodeAt(u);)u++;if(u==c&&n.length==e.length)return null;let d=n.length,m=e.length;for(;d>0&&m>0&&n.charCodeAt(d-1)==e.charCodeAt(m-1);)d--,m--;if(s=="end"){let _=Math.max(0,u-Math.min(d,m));o-=d+_-u}if(d<u&&n.length<e.length){let _=o<=u&&o>=d?u-o:0;u-=_,m=u+(m-d),d=u}else if(m<u){let _=o<=u&&o>=m?u-o:0;u-=_,d=u+(d-m),m=u}return{from:u,toA:d,toB:m}}function selectionPoints(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:o,anchorOffset:s,focusNode:c,focusOffset:u}=n.observer.selectionRange;return o&&(e.push(new DOMPoint(o,s)),(c!=o||u!=s)&&e.push(new DOMPoint(c,u))),e}function selectionFromPoints(n,e){if(n.length==0)return null;let o=n[0].pos,s=n.length==2?n[1].pos:o;return o>-1&&s>-1?EditorSelection.single(o+e,s+e):null}const observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser$1.ie&&browser$1.ie_version<=11;class DOMObserver{constructor(e){this.view=e,this.active=!1,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.resizeContent=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(o=>{for(let s of o)this.queue.push(s);(browser$1.ie&&browser$1.ie_version<=11||browser$1.ios&&e.composing)&&o.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),useCharData&&(this.onCharData=o=>{this.queue.push({target:o.target,type:"characterData",oldValue:o.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var o;((o=this.view.docView)===null||o===void 0?void 0:o.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM),this.resizeContent=new ResizeObserver(()=>this.view.requestMeasure()),this.resizeContent.observe(e.contentDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(o=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),o.length>0&&o[o.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(o=>{o.length>0&&o[o.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runScrollHandlers(this.view,e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((o,s)=>o!=e[s]))){this.gapIntersection.disconnect();for(let o of e)this.gapIntersection.observe(o);this.gaps=e}}onSelectionChange(e){let o=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:s}=this,c=this.selectionRange;if(s.state.facet(editable)?s.root.activeElement!=this.dom:!hasSelection(s.dom,c))return;let u=c.anchorNode&&s.docView.nearest(c.anchorNode);if(u&&u.ignoreEvent(e)){o||(this.selectionChanged=!1);return}(browser$1.ie&&browser$1.ie_version<=11||browser$1.android&&browser$1.chrome)&&!s.state.selection.main.empty&&c.focusNode&&isEquivalentPosition(c.focusNode,c.focusOffset,c.anchorNode,c.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,o=browser$1.safari&&e.root.nodeType==11&&deepActiveElement(this.dom.ownerDocument)==this.dom&&safariSelectionRangeHack(this.view)||getSelection(e.root);if(!o||this.selectionRange.eq(o))return!1;let s=hasSelection(this.dom,o);return s&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,o)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(o),s&&(this.selectionChanged=!0),!0)}setSelectionRange(e,o){this.selectionRange.set(e.node,e.offset,o.node,o.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,o=null;for(let s=this.dom;s;)if(s.nodeType==1)!o&&e<this.scrollTargets.length&&this.scrollTargets[e]==s?e++:o||(o=this.scrollTargets.slice(0,e)),o&&o.push(s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;if(e<this.scrollTargets.length&&!o&&(o=this.scrollTargets.slice(0,e)),o){for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);for(let s of this.scrollTargets=o)s.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,o){var s;if(!this.delayedAndroidKey){let c=()=>{let u=this.delayedAndroidKey;u&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=u.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&u.force&&dispatchKey(this.dom,u.key,u.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(c)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:o,force:this.lastChange<Date.now()-50||!!(!((s=this.delayedAndroidKey)===null||s===void 0)&&s.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let o=-1,s=-1,c=!1;for(let u of e){let d=this.readMutation(u);d&&(d.typeOver&&(c=!0),o==-1?{from:o,to:s}=d:(o=Math.min(d.from,o),s=Math.max(d.to,s)))}return{from:o,to:s,typeOver:c}}readChange(){let{from:e,to:o,typeOver:s}=this.processRecords(),c=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);return e<0&&!c?null:(e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1,new DOMChange(this.view,e,o,s))}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let o=this.readChange();if(!o)return!1;let s=this.view.state,c=applyDOMChange(this.view,o);return this.view.state==s&&this.view.update([]),c}readMutation(e){let o=this.view.docView.nearest(e.target);if(!o||o.ignoreMutation(e))return null;if(o.markDirty(e.type=="attributes"),e.type=="attributes"&&(o.dirty|=4),e.type=="childList"){let s=findChild(o,e.previousSibling||e.target.previousSibling,-1),c=findChild(o,e.nextSibling||e.target.nextSibling,1);return{from:s?o.posAfter(s):o.posAtStart,to:c?o.posBefore(c):o.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:o.posAtStart,to:o.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,o,s,c;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(o=this.gapIntersection)===null||o===void 0||o.disconnect(),(s=this.resizeScroll)===null||s===void 0||s.disconnect(),(c=this.resizeContent)===null||c===void 0||c.disconnect();for(let u of this.scrollTargets)u.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function findChild(n,e,o){for(;e;){let s=ContentView.get(e);if(s&&s.parent==n)return s;let c=e.parentNode;e=c!=n.dom?c:o>0?e.nextSibling:e.previousSibling}return null}function safariSelectionRangeHack(n){let e=null;function o(_){_.preventDefault(),_.stopImmediatePropagation(),e=_.getTargetRanges()[0]}if(n.contentDOM.addEventListener("beforeinput",o,!0),n.dom.ownerDocument.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",o,!0),!e)return null;let s=e.startContainer,c=e.startOffset,u=e.endContainer,d=e.endOffset,m=n.docView.domAtPos(n.state.selection.main.anchor);return isEquivalentPosition(m.node,m.offset,u,d)&&([s,c,u,d]=[u,d,s,c]),{anchorNode:s,anchorOffset:c,focusNode:u,focusOffset:d}}class EditorView{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: fixed; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(o=>this.update([o])),this.dispatch=this.dispatch.bind(this),this._root=e.root||getRoot(e.parent)||document,this.viewState=new ViewState(e.state||EditorState.create(e)),this.plugins=this.state.facet(viewPlugin).map(o=>new PluginInstance(o));for(let o of this.plugins)o.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}dispatch(...e){let o=e.length==1&&e[0]instanceof Transaction?e[0]:this.state.update(...e);this._dispatch(o,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let o=!1,s=!1,c,u=this.state;for(let ih of e){if(ih.startState!=u)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");u=ih.state}if(this.destroyed){this.viewState.state=u;return}let d=this.hasFocus,m=0,_=null;e.some(ih=>ih.annotation(isFocusChange))?(this.inputState.notifiedFocused=d,m=1):d!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=d,_=focusChangeTransaction(u,d),_||(m=1));let ue=this.observer.delayedAndroidKey,gn=null;if(ue?(this.observer.clearDelayedAndroidKey(),gn=this.observer.readChange(),(gn&&!this.state.doc.eq(u.doc)||!this.state.selection.eq(u.selection))&&(gn=null)):this.observer.clear(),u.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(u);c=ViewUpdate.create(this,u,e),c.flags|=m;let nh=this.viewState.scrollTarget;try{this.updateState=2;for(let ih of e){if(nh&&(nh=nh.map(ih.changes)),ih.scrollIntoView){let{main:rh}=ih.state.selection;nh=new ScrollTarget(rh.empty?rh:EditorSelection.cursor(rh.head,rh.head>rh.anchor?-1:1))}for(let rh of ih.effects)rh.is(scrollIntoView$1)&&(nh=rh.value)}this.viewState.update(c,nh),this.bidiCache=CachedOrder.update(this.bidiCache,c.changes),c.empty||(this.updatePlugins(c),this.inputState.update(c)),o=this.docView.update(c),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),s=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(o,e.some(ih=>ih.isUserEvent("select.pointer")))}finally{this.updateState=0}if(c.startState.facet(theme)!=c.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(o||s||nh||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!c.empty)for(let ih of this.state.facet(updateListener))ih(c);(_||gn)&&Promise.resolve().then(()=>{_&&this.state==_.startState&&this.dispatch(_),gn&&!applyDOMChange(this,gn)&&ue.force&&dispatchKey(this.contentDOM,ue.key,ue.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let o=this.hasFocus;try{for(let s of this.plugins)s.destroy(this);this.viewState=new ViewState(e),this.plugins=e.facet(viewPlugin).map(s=>new PluginInstance(s)),this.pluginMap.clear();for(let s of this.plugins)s.update(this);this.docView=new DocView(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}o&&this.focus(),this.requestMeasure()}updatePlugins(e){let o=e.startState.facet(viewPlugin),s=e.state.facet(viewPlugin);if(o!=s){let c=[];for(let u of s){let d=o.indexOf(u);if(d<0)c.push(new PluginInstance(u));else{let m=this.plugins[d];m.mustUpdate=e,c.push(m)}}for(let u of this.plugins)u.mustUpdate!=e&&u.destroy(this);this.plugins=c,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let c of this.plugins)c.mustUpdate=e;for(let c=0;c<this.plugins.length;c++)this.plugins[c].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.forceFlush();let o=null,{scrollHeight:s,scrollTop:c,clientHeight:u}=this.scrollDOM,d=c>s-u-4?s:c;try{for(let m=0;;m++){this.updateState=1;let _=this.viewport,ue=this.viewState.lineBlockAtHeight(d),gn=this.viewState.measure(this);if(!gn&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(m>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let nh=[];gn&4||([this.measureRequests,nh]=[nh,this.measureRequests]);let ih=nh.map(ch=>{try{return ch.read(this)}catch(dh){return logException(this.state,dh),BadMeasure}}),rh=ViewUpdate.create(this,this.state,[]),oh=!1,lh=!1;rh.flags|=gn,o?o.flags|=gn:o=rh,this.updateState=2,rh.empty||(this.updatePlugins(rh),this.inputState.update(rh),this.updateAttrs(),oh=this.docView.update(rh));for(let ch=0;ch<nh.length;ch++)if(ih[ch]!=BadMeasure)try{let dh=nh[ch];dh.write&&dh.write(ih[ch],this)}catch(dh){logException(this.state,dh)}if(this.viewState.editorHeight)if(this.viewState.scrollTarget)this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,lh=!0;else{let ch=this.viewState.lineBlockAt(ue.from).top-ue.top;(ch>1||ch<-1)&&(this.scrollDOM.scrollTop+=ch,lh=!0)}if(oh&&this.docView.updateSelection(!0),this.viewport.from==_.from&&this.viewport.to==_.to&&!lh&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(o&&!o.empty)for(let m of this.state.facet(updateListener))m(o)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let e=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),o={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser$1.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(o["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,o);let s=this.observer.ignore(()=>{let c=updateAttrs(this.contentDOM,this.contentAttrs,o),u=updateAttrs(this.dom,this.editorAttrs,e);return c||u});return this.editorAttrs=e,this.contentAttrs=o,s}showAnnouncements(e){let o=!0;for(let s of e)for(let c of s.effects)if(c.is(EditorView.announce)){o&&(this.announceDOM.textContent=""),o=!1;let u=this.announceDOM.appendChild(document.createElement("div"));u.textContent=c.value}}mountStyles(){this.styleModules=this.state.facet(styleModule),StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1$3).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let o=0;o<this.measureRequests.length;o++)if(this.measureRequests[o].key===e.key){this.measureRequests[o]=e;return}}this.measureRequests.push(e)}}plugin(e){let o=this.pluginMap.get(e);return(o===void 0||o&&o.spec!=e)&&this.pluginMap.set(e,o=this.plugins.find(s=>s.spec==e)||null),o&&o.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,o,s){return skipAtoms(this,e,moveByChar(this,e,o,s))}moveByGroup(e,o){return skipAtoms(this,e,moveByChar(this,e,o,s=>byGroup(this,e.head,s)))}moveToLineBoundary(e,o,s=!0){return moveToLineBoundary(this,e,o,s)}moveVertically(e,o,s){return skipAtoms(this,e,moveVertically(this,e,o,s))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,o=0){return this.docView.posFromDOM(e,o)}posAtCoords(e,o=!0){return this.readMeasured(),posAtCoords(this,e,o)}coordsAtPos(e,o=1){this.readMeasured();let s=this.docView.coordsAt(e,o);if(!s||s.left==s.right)return s;let c=this.state.doc.lineAt(e),u=this.bidiSpans(c),d=u[BidiSpan.find(u,e-c.from,-1,o)];return flattenRect(s,d.dir==Direction.LTR==o>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(perLineTextDirection)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>MaxBidiLine)return trivialOrder(e.length);let o=this.textDirectionAt(e.from);for(let c of this.bidiCache)if(c.from==e.from&&c.dir==o)return c.order;let s=computeOrder(e.text,o);return this.bidiCache.push(new CachedOrder(e.from,e.to,o,s)),s}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||browser$1.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,o={}){return scrollIntoView$1.of(new ScrollTarget(typeof e=="number"?EditorSelection.cursor(e):e,o.y,o.x,o.yMargin,o.xMargin))}static domEventHandlers(e){return ViewPlugin.define(()=>({}),{eventHandlers:e})}static theme(e,o){let s=StyleModule.newName(),c=[theme.of(s),styleModule.of(buildTheme(`.${s}`,e))];return o&&o.dark&&c.push(darkTheme.of(!0)),c}static baseTheme(e){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,e,lightDarkIDs)))}static findFromDOM(e){var o;let s=e.querySelector(".cm-content"),c=s&&ContentView.get(s)||ContentView.get(e);return((o=c==null?void 0:c.rootView)===null||o===void 0?void 0:o.view)||null}}EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler$1;EditorView.focusChangeEffect=focusChangeEffect;EditorView.perLineTextDirection=perLineTextDirection;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.atomicRanges=atomicRanges;EditorView.scrollMargins=scrollMargins;EditorView.darkTheme=darkTheme;EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"});EditorView.announce=StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(e,o,s,c){this.from=e,this.to=o,this.dir=s,this.order=c}static update(e,o){if(o.empty)return e;let s=[],c=e.length?e[e.length-1].dir:Direction.LTR;for(let u=Math.max(0,e.length-10);u<e.length;u++){let d=e[u];d.dir==c&&!o.touchesRange(d.from,d.to)&&s.push(new CachedOrder(o.mapPos(d.from,1),o.mapPos(d.to,-1),d.dir,d.order))}return s}}function attrsFromFacet(n,e,o){for(let s=n.state.facet(e),c=s.length-1;c>=0;c--){let u=s[c],d=typeof u=="function"?u(n):u;d&&combineAttrs(d,o)}return o}const currentPlatform=browser$1.mac?"mac":browser$1.windows?"win":browser$1.linux?"linux":"key";function normalizeKeyName(n,e){const o=n.split(/-(?!$)/);let s=o[o.length-1];s=="Space"&&(s=" ");let c,u,d,m;for(let _=0;_<o.length-1;++_){const ue=o[_];if(/^(cmd|meta|m)$/i.test(ue))m=!0;else if(/^a(lt)?$/i.test(ue))c=!0;else if(/^(c|ctrl|control)$/i.test(ue))u=!0;else if(/^s(hift)?$/i.test(ue))d=!0;else if(/^mod$/i.test(ue))e=="mac"?m=!0:u=!0;else throw new Error("Unrecognized modifier name: "+ue)}return c&&(s="Alt-"+s),u&&(s="Ctrl-"+s),m&&(s="Meta-"+s),d&&(s="Shift-"+s),s}function modifiers(n,e,o){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),o!==!1&&e.shiftKey&&(n="Shift-"+n),n}const handleKeyEvents=Prec.default(EditorView.domEventHandlers({keydown(n,e){return runHandlers(getKeymap(e.state),n,e,"editor")}})),keymap=Facet.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(n){let e=n.facet(keymap),o=Keymaps.get(e);return o||Keymaps.set(e,o=buildKeymap(e.reduce((s,c)=>s.concat(c),[]))),o}function runScopeHandlers(n,e,o){return runHandlers(getKeymap(n.state),e,n,o)}let storedPrefix=null;const PrefixTimeout=4e3;function buildKeymap(n,e=currentPlatform){let o=Object.create(null),s=Object.create(null),c=(d,m)=>{let _=s[d];if(_==null)s[d]=m;else if(_!=m)throw new Error("Key binding "+d+" is used both as a regular binding and as a multi-stroke prefix")},u=(d,m,_,ue)=>{var gn,nh;let ih=o[d]||(o[d]=Object.create(null)),rh=m.split(/ (?!$)/).map(ch=>normalizeKeyName(ch,e));for(let ch=1;ch<rh.length;ch++){let dh=rh.slice(0,ch).join(" ");c(dh,!0),ih[dh]||(ih[dh]={preventDefault:!0,run:[_h=>{let Sh=storedPrefix={view:_h,prefix:dh,scope:d};return setTimeout(()=>{storedPrefix==Sh&&(storedPrefix=null)},PrefixTimeout),!0}]})}let oh=rh.join(" ");c(oh,!1);let lh=ih[oh]||(ih[oh]={preventDefault:!1,run:((nh=(gn=ih._any)===null||gn===void 0?void 0:gn.run)===null||nh===void 0?void 0:nh.slice())||[]});_&&lh.run.push(_),ue&&(lh.preventDefault=!0)};for(let d of n){let m=d.scope?d.scope.split(" "):["editor"];if(d.any)for(let ue of m){let gn=o[ue]||(o[ue]=Object.create(null));gn._any||(gn._any={preventDefault:!1,run:[]});for(let nh in gn)gn[nh].run.push(d.any)}let _=d[e]||d.key;if(_)for(let ue of m)u(ue,_,d.run,d.preventDefault),d.shift&&u(ue,"Shift-"+_,d.shift,d.preventDefault)}return o}function runHandlers(n,e,o,s){let c=keyName(e),u=codePointAt(c,0),d=codePointSize(u)==c.length&&c!=" ",m="",_=!1;storedPrefix&&storedPrefix.view==o&&storedPrefix.scope==s&&(m=storedPrefix.prefix+" ",(_=modifierCodes.indexOf(e.keyCode)<0)&&(storedPrefix=null));let ue=new Set,gn=oh=>{if(oh){for(let lh of oh.run)if(!ue.has(lh)&&(ue.add(lh),lh(o,e)))return!0;oh.preventDefault&&(_=!0)}return!1},nh=n[s],ih,rh;if(nh){if(gn(nh[m+modifiers(c,e,!d)]))return!0;if(d&&(e.altKey||e.metaKey||e.ctrlKey)&&!(browser$1.windows&&e.ctrlKey&&e.altKey)&&(ih=base[e.keyCode])&&ih!=c){if(gn(nh[m+modifiers(ih,e,!0)]))return!0;if(e.shiftKey&&(rh=shift[e.keyCode])!=c&&rh!=ih&&gn(nh[m+modifiers(rh,e,!1)]))return!0}else if(d&&e.shiftKey&&gn(nh[m+modifiers(c,e,!0)]))return!0;if(gn(nh._any))return!0}return _}class RectangleMarker{constructor(e,o,s,c,u){this.className=e,this.left=o,this.top=s,this.width=c,this.height=u}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,o){return o.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,o,s){if(s.empty){let c=e.coordsAtPos(s.head,s.assoc||1);if(!c)return[];let u=getBase(e);return[new RectangleMarker(o,c.left-u.left,c.top-u.top,null,c.bottom-c.top)]}else return rectanglesForRange(e,o,s)}}function getBase(n){let e=n.scrollDOM.getBoundingClientRect();return{left:(n.textDirection==Direction.LTR?e.left:e.right-n.scrollDOM.clientWidth)-n.scrollDOM.scrollLeft,top:e.top-n.scrollDOM.scrollTop}}function wrappedLine(n,e,o){let s=EditorSelection.cursor(e);return{from:Math.max(o.from,n.moveToLineBoundary(s,!1,!0).from),to:Math.min(o.to,n.moveToLineBoundary(s,!0,!0).from),type:BlockType.Text}}function blockAt(n,e){let o=n.lineBlockAt(e);if(Array.isArray(o.type)){for(let s of o.type)if(s.to>e||s.to==e&&(s.to==o.to||s.type==BlockType.Text))return s}return o}function rectanglesForRange(n,e,o){if(o.to<=n.viewport.from||o.from>=n.viewport.to)return[];let s=Math.max(o.from,n.viewport.from),c=Math.min(o.to,n.viewport.to),u=n.textDirection==Direction.LTR,d=n.contentDOM,m=d.getBoundingClientRect(),_=getBase(n),ue=d.querySelector(".cm-line"),gn=ue&&window.getComputedStyle(ue),nh=m.left+(gn?parseInt(gn.paddingLeft)+Math.min(0,parseInt(gn.textIndent)):0),ih=m.right-(gn?parseInt(gn.paddingRight):0),rh=blockAt(n,s),oh=blockAt(n,c),lh=rh.type==BlockType.Text?rh:null,ch=oh.type==BlockType.Text?oh:null;if(n.lineWrapping&&(lh&&(lh=wrappedLine(n,s,lh)),ch&&(ch=wrappedLine(n,c,ch))),lh&&ch&&lh.from==ch.from)return _h(Sh(o.from,o.to,lh));{let yh=lh?Sh(o.from,null,lh):fh(rh,!1),mh=ch?Sh(null,o.to,ch):fh(oh,!0),Ch=[];return(lh||rh).to<(ch||oh).from-(lh&&ch?1:0)?Ch.push(dh(nh,yh.bottom,ih,mh.top)):yh.bottom<mh.top&&n.elementAtHeight((yh.bottom+mh.top)/2).type==BlockType.Text&&(yh.bottom=mh.top=(yh.bottom+mh.top)/2),_h(yh).concat(Ch).concat(_h(mh))}function dh(yh,mh,Ch,Mh){return new RectangleMarker(e,yh-_.left,mh-_.top-.01,Ch-yh,Mh-mh+.01)}function _h({top:yh,bottom:mh,horizontal:Ch}){let Mh=[];for(let Ph=0;Ph<Ch.length;Ph+=2)Mh.push(dh(Ch[Ph],yh,Ch[Ph+1],mh));return Mh}function Sh(yh,mh,Ch){let Mh=1e9,Ph=-1e9,Eh=[];function Nh(gh,Ah,wh,$h,Rh){let Oh=n.coordsAtPos(gh,gh==Ch.to?-2:2),Lh=n.coordsAtPos(wh,wh==Ch.from?2:-2);!Oh||!Lh||(Mh=Math.min(Oh.top,Lh.top,Mh),Ph=Math.max(Oh.bottom,Lh.bottom,Ph),Rh==Direction.LTR?Eh.push(u&&Ah?nh:Oh.left,u&&$h?ih:Lh.right):Eh.push(!u&&$h?nh:Lh.left,!u&&Ah?ih:Oh.right))}let Wh=yh??Ch.from,Yh=mh??Ch.to;for(let gh of n.visibleRanges)if(gh.to>Wh&&gh.from<Yh)for(let Ah=Math.max(gh.from,Wh),wh=Math.min(gh.to,Yh);;){let $h=n.state.doc.lineAt(Ah);for(let Rh of n.bidiSpans($h)){let Oh=Rh.from+$h.from,Lh=Rh.to+$h.from;if(Oh>=wh)break;Lh>Ah&&Nh(Math.max(Oh,Ah),yh==null&&Oh<=Wh,Math.min(Lh,wh),mh==null&&Lh>=Yh,Rh.dir)}if(Ah=$h.to+1,Ah>=wh)break}return Eh.length==0&&Nh(Wh,yh==null,Yh,mh==null,n.textDirection),{top:Mh,bottom:Ph,horizontal:Eh}}function fh(yh,mh){let Ch=m.top+(mh?yh.top:yh.bottom);return{top:Ch,bottom:Ch,horizontal:[]}}}function sameMarker(n,e){return n.constructor==e.constructor&&n.eq(e)}class LayerView{constructor(e,o){this.view=e,this.layer=o,this.drawn=[],this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),o.above&&this.dom.classList.add("cm-layer-above"),o.class&&this.dom.classList.add(o.class),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),o.mount&&o.mount(this.dom,e)}update(e){e.startState.facet(layerOrder)!=e.state.facet(layerOrder)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&e.view.requestMeasure(this.measureReq)}setOrder(e){let o=0,s=e.facet(layerOrder);for(;o<s.length&&s[o]!=this.layer;)o++;this.dom.style.zIndex=String((this.layer.above?150:-1)-o)}measure(){return this.layer.markers(this.view)}draw(e){if(e.length!=this.drawn.length||e.some((o,s)=>!sameMarker(o,this.drawn[s]))){let o=this.dom.firstChild,s=0;for(let c of e)c.update&&o&&c.constructor&&this.drawn[s].constructor&&c.update(o,this.drawn[s])?(o=o.nextSibling,s++):this.dom.insertBefore(c.draw(),o);for(;o;){let c=o.nextSibling;o.remove(),o=c}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const layerOrder=Facet.define();function layer(n){return[ViewPlugin.define(e=>new LayerView(e,n)),layerOrder.of(n)]}const CanHidePrimary=!browser$1.ios,selectionConfig=Facet.define({combine(n){return combineConfig(n,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,o)=>Math.min(e,o),drawRangeCursor:(e,o)=>e||o})}});function drawSelection(n={}){return[selectionConfig.of(n),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(!0)]}function configChanged(n){return n.startState.facet(selectionConfig)!=n.state.facet(selectionConfig)}const cursorLayer=layer({above:!0,markers(n){let{state:e}=n,o=e.facet(selectionConfig),s=[];for(let c of e.selection.ranges){let u=c==e.selection.main;if(c.empty?!u||CanHidePrimary:o.drawRangeCursor){let d=u?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",m=c.empty?c:EditorSelection.cursor(c.head,c.head>c.anchor?-1:1);for(let _ of RectangleMarker.forRange(n,d,m))s.push(_)}}return s},update(n,e){n.transactions.some(s=>s.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let o=configChanged(n);return o&&setBlinkRate(n.state,e),n.docChanged||n.selectionSet||o},mount(n,e){setBlinkRate(e.state,n)},class:"cm-cursorLayer"});function setBlinkRate(n,e){e.style.animationDuration=n.facet(selectionConfig).cursorBlinkRate+"ms"}const selectionLayer=layer({above:!1,markers(n){return n.state.selection.ranges.map(e=>e.empty?[]:RectangleMarker.forRange(n,"cm-selectionBackground",e)).reduce((e,o)=>e.concat(o))},update(n,e){return n.docChanged||n.selectionSet||n.viewportChanged||configChanged(n)},class:"cm-selectionLayer"}),themeSpec={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor="transparent !important");const hideNativeSelection=Prec.highest(EditorView.theme(themeSpec)),setDropCursorPos=StateEffect.define({map(n,e){return n==null?null:e.mapPos(n)}}),dropCursorPos=StateField.define({create(){return null},update(n,e){return n!=null&&(n=e.changes.mapPos(n)),e.effects.reduce((o,s)=>s.is(setDropCursorPos)?s.value:o,n)}}),drawDropCursor=ViewPlugin.fromClass(class{constructor(n){this.view=n,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(n){var e;let o=n.state.field(dropCursorPos);o==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(n.startState.field(dropCursorPos)!=o||n.docChanged||n.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let n=this.view.state.field(dropCursorPos),e=n!=null&&this.view.coordsAtPos(n);if(!e)return null;let o=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-o.left+this.view.scrollDOM.scrollLeft,top:e.top-o.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(n){this.cursor&&(n?(this.cursor.style.left=n.left+"px",this.cursor.style.top=n.top+"px",this.cursor.style.height=n.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(n){this.view.state.field(dropCursorPos)!=n&&this.view.dispatch({effects:setDropCursorPos.of(n)})}},{eventHandlers:{dragover(n){this.setDropPos(this.view.posAtCoords({x:n.clientX,y:n.clientY}))},dragleave(n){(n.target==this.view.contentDOM||!this.view.contentDOM.contains(n.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function dropCursor(){return[dropCursorPos,drawDropCursor]}function iterMatches(n,e,o,s,c){e.lastIndex=0;for(let u=n.iterRange(o,s),d=o,m;!u.next().done;d+=u.value.length)if(!u.lineBreak)for(;m=e.exec(u.value);)c(d+m.index,m)}function matchRanges(n,e){let o=n.visibleRanges;if(o.length==1&&o[0].from==n.viewport.from&&o[0].to==n.viewport.to)return o;let s=[];for(let{from:c,to:u}of o)c=Math.max(n.state.doc.lineAt(c).from,c-e),u=Math.min(n.state.doc.lineAt(u).to,u+e),s.length&&s[s.length-1].to>=c?s[s.length-1].to=u:s.push({from:c,to:u});return s}class MatchDecorator{constructor(e){const{regexp:o,decoration:s,decorate:c,boundary:u,maxLength:d=1e3}=e;if(!o.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=o,c)this.addMatch=(m,_,ue,gn)=>c(gn,ue,ue+m[0].length,m,_);else if(typeof s=="function")this.addMatch=(m,_,ue,gn)=>{let nh=s(m,_,ue);nh&&gn(ue,ue+m[0].length,nh)};else if(s)this.addMatch=(m,_,ue,gn)=>gn(ue,ue+m[0].length,s);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=u,this.maxLength=d}createDeco(e){let o=new RangeSetBuilder,s=o.add.bind(o);for(let{from:c,to:u}of matchRanges(e,this.maxLength))iterMatches(e.state.doc,this.regexp,c,u,(d,m)=>this.addMatch(m,e,d,s));return o.finish()}updateDeco(e,o){let s=1e9,c=-1;return e.docChanged&&e.changes.iterChanges((u,d,m,_)=>{_>e.view.viewport.from&&m<e.view.viewport.to&&(s=Math.min(m,s),c=Math.max(_,c))}),e.viewportChanged||c-s>1e3?this.createDeco(e.view):c>-1?this.updateRange(e.view,o.map(e.changes),s,c):o}updateRange(e,o,s,c){for(let u of e.visibleRanges){let d=Math.max(u.from,s),m=Math.min(u.to,c);if(m>d){let _=e.state.doc.lineAt(d),ue=_.to<m?e.state.doc.lineAt(m):_,gn=Math.max(u.from,_.from),nh=Math.min(u.to,ue.to);if(this.boundary){for(;d>_.from;d--)if(this.boundary.test(_.text[d-1-_.from])){gn=d;break}for(;m<ue.to;m++)if(this.boundary.test(ue.text[m-ue.from])){nh=m;break}}let ih=[],rh,oh=(lh,ch,dh)=>ih.push(dh.range(lh,ch));if(_==ue)for(this.regexp.lastIndex=gn-_.from;(rh=this.regexp.exec(_.text))&&rh.index<nh-_.from;)this.addMatch(rh,e,rh.index+_.from,oh);else iterMatches(e.state.doc,this.regexp,gn,nh,(lh,ch)=>this.addMatch(ch,e,lh,oh));o=o.update({filterFrom:gn,filterTo:nh,filter:(lh,ch)=>lh<gn||ch>nh,add:ih})}}return o}}const UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g",Specials=new RegExp(`[\0-\b
--\u2028\u2029\uFEFF-]`,UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;function supportsTabSize(){var n;if(_supportsTabSize==null&&typeof document<"u"&&document.body){let e=document.body.style;_supportsTabSize=((n=e.tabSize)!==null&&n!==void 0?n:e.MozTabSize)!=null}return _supportsTabSize||!1}const specialCharConfig=Facet.define({combine(n){let e=combineConfig(n,{render:null,specialChars:Specials,addSpecialChars:null});return(e.replaceTabs=!supportsTabSize())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,UnicodeRegexpSupport)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,UnicodeRegexpSupport)),e}});function highlightSpecialChars(n={}){return[specialCharConfig.of(n),specialCharPlugin()]}let _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(class{constructor(n){this.view=n,this.decorations=Decoration.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(n.state.facet(specialCharConfig)),this.decorations=this.decorator.createDeco(n)}makeDecorator(n){return new MatchDecorator({regexp:n.specialChars,decoration:(e,o,s)=>{let{doc:c}=o.state,u=codePointAt(e[0],0);if(u==9){let d=c.lineAt(s),m=o.state.tabSize,_=countColumn(d.text,m,s-d.from);return Decoration.replace({widget:new TabWidget((m-_%m)*this.view.defaultCharacterWidth)})}return this.decorationCache[u]||(this.decorationCache[u]=Decoration.replace({widget:new SpecialCharWidget(n,u)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(n){let e=n.state.facet(specialCharConfig);n.startState.facet(specialCharConfig)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(n.view)):this.decorations=this.decorator.updateDeco(n,this.decorations)}},{decorations:n=>n.decorations}))}const DefaultPlaceholder="";function placeholder$1(n){return n>=32?DefaultPlaceholder:n==10?"":String.fromCharCode(9216+n)}class SpecialCharWidget extends WidgetType{constructor(e,o){super(),this.options=e,this.code=o}eq(e){return e.code==this.code}toDOM(e){let o=placeholder$1(this.code),s=e.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16)),c=this.options.render&&this.options.render(this.code,s,o);if(c)return c;let u=document.createElement("span");return u.textContent=o,u.title=s,u.setAttribute("aria-label",s),u.className="cm-specialChar",u}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function highlightActiveLine(){return activeLineHighlighter}const lineDeco=Decoration.line({class:"cm-activeLine"}),activeLineHighlighter=ViewPlugin.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.docChanged||n.selectionSet)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=-1,o=[];for(let s of n.state.selection.ranges){let c=n.lineBlockAt(s.head);c.from>e&&(o.push(lineDeco.range(c.from)),e=c.from)}return Decoration.set(o)}},{decorations:n=>n.decorations});class Placeholder extends WidgetType{constructor(e){super(),this.content=e}toDOM(){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?e.setAttribute("aria-label","placeholder "+this.content):e.setAttribute("aria-hidden","true"),e}coordsAt(e){let o=e.firstChild?clientRectsFor(e.firstChild):[];if(!o.length)return null;let s=window.getComputedStyle(e.parentNode),c=flattenRect(o[0],s.direction!="rtl"),u=parseInt(s.lineHeight);return c.bottom-c.top>u*1.5?{left:c.left,right:c.right,top:c.top,bottom:c.top+u}:c}ignoreEvent(){return!1}}function placeholder(n){return ViewPlugin.fromClass(class{constructor(e){this.view=e,this.placeholder=Decoration.set([Decoration.widget({widget:new Placeholder(n),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?Decoration.none:this.placeholder}},{decorations:e=>e.decorations})}const MaxOff=2e3;function rectangleFor(n,e,o){let s=Math.min(e.line,o.line),c=Math.max(e.line,o.line),u=[];if(e.off>MaxOff||o.off>MaxOff||e.col<0||o.col<0){let d=Math.min(e.off,o.off),m=Math.max(e.off,o.off);for(let _=s;_<=c;_++){let ue=n.doc.line(_);ue.length<=m&&u.push(EditorSelection.range(ue.from+d,ue.to+m))}}else{let d=Math.min(e.col,o.col),m=Math.max(e.col,o.col);for(let _=s;_<=c;_++){let ue=n.doc.line(_),gn=findColumn(ue.text,d,n.tabSize,!0);if(gn<0)u.push(EditorSelection.cursor(ue.to));else{let nh=findColumn(ue.text,m,n.tabSize);u.push(EditorSelection.range(ue.from+gn,ue.from+nh))}}}return u}function absoluteColumn(n,e){let o=n.coordsAtPos(n.viewport.from);return o?Math.round(Math.abs((o.left-e)/n.defaultCharacterWidth)):-1}function getPos(n,e){let o=n.posAtCoords({x:e.clientX,y:e.clientY},!1),s=n.state.doc.lineAt(o),c=o-s.from,u=c>MaxOff?-1:c==s.length?absoluteColumn(n,e.clientX):countColumn(s.text,n.state.tabSize,o-s.from);return{line:s.number,col:u,off:c}}function rectangleSelectionStyle(n,e){let o=getPos(n,e),s=n.state.selection;return o?{update(c){if(c.docChanged){let u=c.changes.mapPos(c.startState.doc.line(o.line).from),d=c.state.doc.lineAt(u);o={line:d.number,col:o.col,off:Math.min(o.off,d.length)},s=s.map(c.changes)}},get(c,u,d){let m=getPos(n,c);if(!m)return s;let _=rectangleFor(n.state,o,m);return _.length?d?EditorSelection.create(_.concat(s.ranges)):EditorSelection.create(_):s}}:null}function rectangularSelection(n){let e=(n==null?void 0:n.eventFilter)||(o=>o.altKey&&o.button==0);return EditorView.mouseSelectionStyle.of((o,s)=>e(s)?rectangleSelectionStyle(o,s):null)}const keys={Alt:[18,n=>!!n.altKey],Control:[17,n=>!!n.ctrlKey],Shift:[16,n=>!!n.shiftKey],Meta:[91,n=>!!n.metaKey]},showCrosshair={style:"cursor: crosshair"};function crosshairCursor(n={}){let[e,o]=keys[n.key||"Alt"],s=ViewPlugin.fromClass(class{constructor(c){this.view=c,this.isDown=!1}set(c){this.isDown!=c&&(this.isDown=c,this.view.update([]))}},{eventHandlers:{keydown(c){this.set(c.keyCode==e||o(c))},keyup(c){(c.keyCode==e||!o(c))&&this.set(!1)},mousemove(c){this.set(o(c))}}});return[s,EditorView.contentAttributes.of(c=>{var u;return!((u=c.plugin(s))===null||u===void 0)&&u.isDown?showCrosshair:null})]}const Outside="-10000px";class TooltipViewManager{constructor(e,o,s){this.facet=o,this.createTooltipView=s,this.input=e.state.facet(o),this.tooltips=this.input.filter(c=>c),this.tooltipViews=this.tooltips.map(s)}update(e){var o;let s=e.state.facet(this.facet),c=s.filter(d=>d);if(s===this.input){for(let d of this.tooltipViews)d.update&&d.update(e);return!1}let u=[];for(let d=0;d<c.length;d++){let m=c[d],_=-1;if(m){for(let ue=0;ue<this.tooltips.length;ue++){let gn=this.tooltips[ue];gn&&gn.create==m.create&&(_=ue)}if(_<0)u[d]=this.createTooltipView(m);else{let ue=u[d]=this.tooltipViews[_];ue.update&&ue.update(e)}}}for(let d of this.tooltipViews)u.indexOf(d)<0&&(d.dom.remove(),(o=d.destroy)===null||o===void 0||o.call(d));return this.input=s,this.tooltips=c,this.tooltipViews=u,!0}}function windowSpace(n){let{win:e}=n;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const tooltipConfig=Facet.define({combine:n=>{var e,o,s;return{position:browser$1.ios?"absolute":((e=n.find(c=>c.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((o=n.find(c=>c.parent))===null||o===void 0?void 0:o.parent)||null,tooltipSpace:((s=n.find(c=>c.tooltipSpace))===null||s===void 0?void 0:s.tooltipSpace)||windowSpace}}}),knownHeight=new WeakMap,tooltipPlugin=ViewPlugin.fromClass(class{constructor(n){this.view=n,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let e=n.state.facet(tooltipConfig);this.position=e.position,this.parent=e.parent,this.classes=n.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new TooltipViewManager(n,showTooltip,o=>this.createTooltip(o)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(o=>{Date.now()>this.lastTransaction-50&&o.length>0&&o[o.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),n.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let n of this.manager.tooltipViews)this.intersectionObserver.observe(n.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(n){n.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(n);e&&this.observeIntersection();let o=e||n.geometryChanged,s=n.state.facet(tooltipConfig);if(s.position!=this.position){this.position=s.position;for(let c of this.manager.tooltipViews)c.dom.style.position=this.position;o=!0}if(s.parent!=this.parent){this.parent&&this.container.remove(),this.parent=s.parent,this.createContainer();for(let c of this.manager.tooltipViews)this.container.appendChild(c.dom);o=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);o&&this.maybeMeasure()}createTooltip(n){let e=n.create(this.view);if(e.dom.classList.add("cm-tooltip"),n.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let o=document.createElement("div");o.className="cm-tooltip-arrow",e.dom.appendChild(o)}return e.dom.style.position=this.position,e.dom.style.top=Outside,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var n,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let o of this.manager.tooltipViews)o.dom.remove(),(n=o.destroy)===null||n===void 0||n.call(o);(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let n=this.view.dom.getBoundingClientRect();return{editor:n,parent:this.parent?this.container.getBoundingClientRect():n,pos:this.manager.tooltips.map((e,o)=>{let s=this.manager.tooltipViews[o];return s.getCoords?s.getCoords(e.pos):this.view.coordsAtPos(e.pos)}),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view)}}writeMeasure(n){var e;let{editor:o,space:s}=n,c=[];for(let u=0;u<this.manager.tooltips.length;u++){let d=this.manager.tooltips[u],m=this.manager.tooltipViews[u],{dom:_}=m,ue=n.pos[u],gn=n.size[u];if(!ue||ue.bottom<=Math.max(o.top,s.top)||ue.top>=Math.min(o.bottom,s.bottom)||ue.right<Math.max(o.left,s.left)-.1||ue.left>Math.min(o.right,s.right)+.1){_.style.top=Outside;continue}let nh=d.arrow?m.dom.querySelector(".cm-tooltip-arrow"):null,ih=nh?7:0,rh=gn.right-gn.left,oh=(e=knownHeight.get(m))!==null&&e!==void 0?e:gn.bottom-gn.top,lh=m.offset||noOffset,ch=this.view.textDirection==Direction.LTR,dh=gn.width>s.right-s.left?ch?s.left:s.right-gn.width:ch?Math.min(ue.left-(nh?14:0)+lh.x,s.right-rh):Math.max(s.left,ue.left-rh+(nh?14:0)-lh.x),_h=!!d.above;!d.strictSide&&(_h?ue.top-(gn.bottom-gn.top)-lh.y<s.top:ue.bottom+(gn.bottom-gn.top)+lh.y>s.bottom)&&_h==s.bottom-ue.bottom>ue.top-s.top&&(_h=!_h);let Sh=(_h?ue.top-s.top:s.bottom-ue.bottom)-ih;if(Sh<oh&&m.resize!==!1){if(Sh<this.view.defaultLineHeight){_.style.top=Outside;continue}knownHeight.set(m,oh),_.style.height=(oh=Sh)+"px"}else _.style.height&&(_.style.height="");let fh=_h?ue.top-oh-ih-lh.y:ue.bottom+ih+lh.y,yh=dh+rh;if(m.overlap!==!0)for(let mh of c)mh.left<yh&&mh.right>dh&&mh.top<fh+oh&&mh.bottom>fh&&(fh=_h?mh.top-oh-2-ih:mh.bottom+ih+2);this.position=="absolute"?(_.style.top=fh-n.parent.top+"px",_.style.left=dh-n.parent.left+"px"):(_.style.top=fh+"px",_.style.left=dh+"px"),nh&&(nh.style.left=`${ue.left+(ch?lh.x:-lh.x)-(dh+14-7)}px`),m.overlap!==!0&&c.push({left:dh,top:fh,right:yh,bottom:fh+oh}),_.classList.toggle("cm-tooltip-above",_h),_.classList.toggle("cm-tooltip-below",!_h),m.positioned&&m.positioned(n.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let n of this.manager.tooltipViews)n.dom.style.top=Outside}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),baseTheme$4=EditorView.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),noOffset={x:0,y:0},showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$4]}),showHoverTooltip=Facet.define();class HoverTooltipHost{static create(e){return new HoverTooltipHost(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new TooltipViewManager(e,showHoverTooltip,o=>this.createHostedView(o))}createHostedView(e){let o=e.create(this.view);return o.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(o.dom),this.mounted&&o.mount&&o.mount(this.view),o}mount(e){for(let o of this.manager.tooltipViews)o.mount&&o.mount(e);this.mounted=!0}positioned(e){for(let o of this.manager.tooltipViews)o.positioned&&o.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let o of this.manager.tooltipViews)(e=o.destroy)===null||e===void 0||e.call(o)}}const showHoverTooltipHost=showTooltip.compute([showHoverTooltip],n=>{let e=n.facet(showHoverTooltip).filter(o=>o);return e.length===0?null:{pos:Math.min(...e.map(o=>o.pos)),end:Math.max(...e.filter(o=>o.end!=null).map(o=>o.end)),create:HoverTooltipHost.create,above:e[0].above,arrow:e.some(o=>o.arrow)}});class HoverPlugin{constructor(e,o,s,c,u){this.view=e,this.source=o,this.field=s,this.setHover=c,this.hoverTime=u,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:e}=this,o=this.view.contentDOM.contains(e.target)?this.view.posAtCoords(e):null;if(o==null)return;let s=this.view.coordsAtPos(o);if(s==null||e.y<s.top||e.y>s.bottom||e.x<s.left-this.view.defaultCharacterWidth||e.x>s.right+this.view.defaultCharacterWidth)return;let c=this.view.bidiSpans(this.view.state.doc.lineAt(o)).find(m=>m.from<=o&&m.to>=o),u=c&&c.dir==Direction.RTL?-1:1,d=this.source(this.view,o,e.x<s.left?-u:u);if(d!=null&&d.then){let m=this.pending={pos:o};d.then(_=>{this.pending==m&&(this.pending=null,_&&this.view.dispatch({effects:this.setHover.of(_)}))},_=>logException(this.view.state,_,"hover tooltip"))}else d&&this.view.dispatch({effects:this.setHover.of(d)})}mousemove(e){var o;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let s=this.active;if(s&&!isInTooltip(this.lastMove.target)||this.pending){let{pos:c}=s||this.pending,u=(o=s==null?void 0:s.end)!==null&&o!==void 0?o:c;(c==u?this.view.posAtCoords(this.lastMove)!=c:!isOverRange(this.view,c,u,e.clientX,e.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&!isInTooltip(e.relatedTarget)&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function isInTooltip(n){for(let e=n;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function isOverRange(n,e,o,s,c,u){let d=document.createRange(),m=n.domAtPos(e),_=n.domAtPos(o);d.setEnd(_.node,_.offset),d.setStart(m.node,m.offset);let ue=d.getClientRects();d.detach();for(let gn=0;gn<ue.length;gn++){let nh=ue[gn];if(Math.max(nh.top-c,c-nh.bottom,nh.left-s,s-nh.right)<=u)return!0}return!1}function hoverTooltip(n,e={}){let o=StateEffect.define(),s=StateField.define({create(){return null},update(c,u){if(c&&(e.hideOnChange&&(u.docChanged||u.selection)||e.hideOn&&e.hideOn(u,c)))return null;if(c&&u.docChanged){let d=u.changes.mapPos(c.pos,-1,MapMode.TrackDel);if(d==null)return null;let m=Object.assign(Object.create(null),c);m.pos=d,c.end!=null&&(m.end=u.changes.mapPos(c.end)),c=m}for(let d of u.effects)d.is(o)&&(c=d.value),d.is(closeHoverTooltipEffect)&&(c=null);return c},provide:c=>showHoverTooltip.from(c)});return[s,ViewPlugin.define(c=>new HoverPlugin(c,n,s,o,e.hoverTime||300)),showHoverTooltipHost]}function getTooltip(n,e){let o=n.plugin(tooltipPlugin);if(!o)return null;let s=o.manager.tooltips.indexOf(e);return s<0?null:o.manager.tooltipViews[s]}const closeHoverTooltipEffect=StateEffect.define(),panelConfig=Facet.define({combine(n){let e,o;for(let s of n)e=e||s.topContainer,o=o||s.bottomContainer;return{topContainer:e,bottomContainer:o}}});function getPanel(n,e){let o=n.plugin(panelPlugin),s=o?o.specs.indexOf(e):-1;return s>-1?o.panels[s]:null}const panelPlugin=ViewPlugin.fromClass(class{constructor(n){this.input=n.state.facet(showPanel),this.specs=this.input.filter(o=>o),this.panels=this.specs.map(o=>o(n));let e=n.state.facet(panelConfig);this.top=new PanelGroup(n,!0,e.topContainer),this.bottom=new PanelGroup(n,!1,e.bottomContainer),this.top.sync(this.panels.filter(o=>o.top)),this.bottom.sync(this.panels.filter(o=>!o.top));for(let o of this.panels)o.dom.classList.add("cm-panel"),o.mount&&o.mount()}update(n){let e=n.state.facet(panelConfig);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new PanelGroup(n.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new PanelGroup(n.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let o=n.state.facet(showPanel);if(o!=this.input){let s=o.filter(_=>_),c=[],u=[],d=[],m=[];for(let _ of s){let ue=this.specs.indexOf(_),gn;ue<0?(gn=_(n.view),m.push(gn)):(gn=this.panels[ue],gn.update&&gn.update(n)),c.push(gn),(gn.top?u:d).push(gn)}this.specs=s,this.panels=c,this.top.sync(u),this.bottom.sync(d);for(let _ of m)_.dom.classList.add("cm-panel"),_.mount&&_.mount()}else for(let s of this.panels)s.update&&s.update(n)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:n=>EditorView.scrollMargins.of(e=>{let o=e.plugin(n);return o&&{top:o.top.scrollMargin(),bottom:o.bottom.scrollMargin()}})});class PanelGroup{constructor(e,o,s){this.view=e,this.top=o,this.container=s,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let o of this.panels)o.destroy&&e.indexOf(o)<0&&o.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let o=this.container||this.view.dom;o.insertBefore(this.dom,this.top?o.firstChild:null)}let e=this.dom.firstChild;for(let o of this.panels)if(o.dom.parentNode==this.dom){for(;e!=o.dom;)e=rm(e);e=e.nextSibling}else this.dom.insertBefore(o.dom,e);for(;e;)e=rm(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function rm(n){let e=n.nextSibling;return n.remove(),e}const showPanel=Facet.define({enables:panelPlugin});class GutterMarker extends RangeValue{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=void 0;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=!0;const gutterLineClass=Facet.define(),defaults$1={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>RangeSet.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},activeGutters=Facet.define();function gutter(n){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults$1),n))]}const unfixGutters=Facet.define({combine:n=>n.some(e=>e)});function gutters(n){let e=[gutterView];return n&&n.fixed===!1&&e.push(unfixGutters.of(!0)),e}const gutterView=ViewPlugin.fromClass(class{constructor(n){this.view=n,this.prevViewport=n.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=n.state.facet(activeGutters).map(e=>new SingleGutterView(n,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!n.state.facet(unfixGutters),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),n.scrollDOM.insertBefore(this.dom,n.contentDOM)}update(n){if(this.updateGutters(n)){let e=this.prevViewport,o=n.view.viewport,s=Math.min(e.to,o.to)-Math.max(e.from,o.from);this.syncGutters(s<(o.to-o.from)*.8)}n.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=n.view.viewport}syncGutters(n){let e=this.dom.nextSibling;n&&this.dom.remove();let o=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from),s=[],c=this.gutters.map(u=>new UpdateContext(u,this.view.viewport,-this.view.documentPadding.top));for(let u of this.view.viewportLineBlocks)if(s.length&&(s=[]),Array.isArray(u.type)){let d=!0;for(let m of u.type)if(m.type==BlockType.Text&&d){advanceCursor(o,s,m.from);for(let _ of c)_.line(this.view,m,s);d=!1}else if(m.widget)for(let _ of c)_.widget(this.view,m)}else if(u.type==BlockType.Text){advanceCursor(o,s,u.from);for(let d of c)d.line(this.view,u,s)}for(let u of c)u.finish();n&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(n){let e=n.startState.facet(activeGutters),o=n.state.facet(activeGutters),s=n.docChanged||n.heightChanged||n.viewportChanged||!RangeSet.eq(n.startState.facet(gutterLineClass),n.state.facet(gutterLineClass),n.view.viewport.from,n.view.viewport.to);if(e==o)for(let c of this.gutters)c.update(n)&&(s=!0);else{s=!0;let c=[];for(let u of o){let d=e.indexOf(u);d<0?c.push(new SingleGutterView(this.view,u)):(this.gutters[d].update(n),c.push(this.gutters[d]))}for(let u of this.gutters)u.dom.remove(),c.indexOf(u)<0&&u.destroy();for(let u of c)this.dom.appendChild(u.dom);this.gutters=c}return s}destroy(){for(let n of this.gutters)n.destroy();this.dom.remove()}},{provide:n=>EditorView.scrollMargins.of(e=>{let o=e.plugin(n);return!o||o.gutters.length==0||!o.fixed?null:e.textDirection==Direction.LTR?{left:o.dom.offsetWidth}:{right:o.dom.offsetWidth}})});function asArray(n){return Array.isArray(n)?n:[n]}function advanceCursor(n,e,o){for(;n.value&&n.from<=o;)n.from==o&&e.push(n.value),n.next()}class UpdateContext{constructor(e,o,s){this.gutter=e,this.height=s,this.i=0,this.cursor=RangeSet.iter(e.markers,o.from)}addElement(e,o,s){let{gutter:c}=this,u=o.top-this.height;if(this.i==c.elements.length){let d=new GutterElement(e,o.height,u,s);c.elements.push(d),c.dom.appendChild(d.dom)}else c.elements[this.i].update(e,o.height,u,s);this.height=o.bottom,this.i++}line(e,o,s){let c=[];advanceCursor(this.cursor,c,o.from),s.length&&(c=c.concat(s));let u=this.gutter.config.lineMarker(e,o,c);u&&c.unshift(u);let d=this.gutter;c.length==0&&!d.config.renderEmptyElements||this.addElement(e,o,c)}widget(e,o){let s=this.gutter.config.widgetMarker(e,o.widget,o);s&&this.addElement(e,o,[s])}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let o=e.elements.pop();e.dom.removeChild(o.dom),o.destroy()}}}class SingleGutterView{constructor(e,o){this.view=e,this.config=o,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let s in o.domEventHandlers)this.dom.addEventListener(s,c=>{let u=c.target,d;if(u!=this.dom&&this.dom.contains(u)){for(;u.parentNode!=this.dom;)u=u.parentNode;let _=u.getBoundingClientRect();d=(_.top+_.bottom)/2}else d=c.clientY;let m=e.lineBlockAtHeight(d-e.documentTop);o.domEventHandlers[s](e,m,c)&&c.preventDefault()});this.markers=asArray(o.markers(e)),o.initialSpacer&&(this.spacer=new GutterElement(e,0,0,[o.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let o=this.markers;if(this.markers=asArray(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let c=this.config.updateSpacer(this.spacer.markers[0],e);c!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[c])}let s=e.view.viewport;return!RangeSet.eq(this.markers,o,s.from,s.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class GutterElement{constructor(e,o,s,c){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,o,s,c)}update(e,o,s,c){this.height!=o&&(this.dom.style.height=(this.height=o)+"px"),this.above!=s&&(this.dom.style.marginTop=(this.above=s)?s+"px":""),sameMarkers(this.markers,c)||this.setMarkers(e,c)}setMarkers(e,o){let s="cm-gutterElement",c=this.dom.firstChild;for(let u=0,d=0;;){let m=d,_=u<o.length?o[u++]:null,ue=!1;if(_){let gn=_.elementClass;gn&&(s+=" "+gn);for(let nh=d;nh<this.markers.length;nh++)if(this.markers[nh].compare(_)){m=nh,ue=!0;break}}else m=this.markers.length;for(;d<m;){let gn=this.markers[d++];if(gn.toDOM){gn.destroy(c);let nh=c.nextSibling;c.remove(),c=nh}}if(!_)break;_.toDOM&&(ue?c=c.nextSibling:this.dom.insertBefore(_.toDOM(e),c)),ue&&d++}this.dom.className=s,this.markers=o}destroy(){this.setMarkers(null,[])}}function sameMarkers(n,e){if(n.length!=e.length)return!1;for(let o=0;o<n.length;o++)if(!n[o].compare(e[o]))return!1;return!0}const lineNumberMarkers=Facet.define(),lineNumberConfig=Facet.define({combine(n){return combineConfig(n,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,o){let s=Object.assign({},e);for(let c in o){let u=s[c],d=o[c];s[c]=u?(m,_,ue)=>u(m,_,ue)||d(m,_,ue):d}return s}})}});class NumberMarker extends GutterMarker{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function formatNumber(n,e){return n.state.facet(lineNumberConfig).formatNumber(e,n.state)}const lineNumberGutter=activeGutters.compute([lineNumberConfig],n=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(lineNumberMarkers)},lineMarker(e,o,s){return s.some(c=>c.toDOM)?null:new NumberMarker(formatNumber(e,e.state.doc.lineAt(o.from).number))},widgetMarker:()=>null,lineMarkerChange:e=>e.startState.facet(lineNumberConfig)!=e.state.facet(lineNumberConfig),initialSpacer(e){return new NumberMarker(formatNumber(e,maxLineNumber(e.state.doc.lines)))},updateSpacer(e,o){let s=formatNumber(o.view,maxLineNumber(o.view.state.doc.lines));return s==e.number?e:new NumberMarker(s)},domEventHandlers:n.facet(lineNumberConfig).domEventHandlers}));function lineNumbers(n={}){return[lineNumberConfig.of(n),gutters(),lineNumberGutter]}function maxLineNumber(n){let e=9;for(;e<n;)e=e*10+9;return e}const activeLineGutterMarker=new class extends GutterMarker{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},activeLineGutterHighlighter=gutterLineClass.compute(["selection"],n=>{let e=[],o=-1;for(let s of n.selection.ranges){let c=n.doc.lineAt(s.head).from;c>o&&(o=c,e.push(activeLineGutterMarker.range(c)))}return RangeSet.of(e)});function highlightActiveLineGutter(){return activeLineGutterHighlighter}const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(e,o){this.from=e,this.to=o}}class NodeProp{constructor(e={}){this.id=nextPropID++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=NodeType.match(e)),o=>{let s=e(o);return s===void 0?null:[this,s]}}}NodeProp.closedBy=new NodeProp({deserialize:n=>n.split(" ")});NodeProp.openedBy=new NodeProp({deserialize:n=>n.split(" ")});NodeProp.group=new NodeProp({deserialize:n=>n.split(" ")});NodeProp.contextHash=new NodeProp({perNode:!0});NodeProp.lookAhead=new NodeProp({perNode:!0});NodeProp.mounted=new NodeProp({perNode:!0});const noProps=Object.create(null);class NodeType{constructor(e,o,s,c=0){this.name=e,this.props=o,this.id=s,this.flags=c}static define(e){let o=e.props&&e.props.length?Object.create(null):noProps,s=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),c=new NodeType(e.name||"",o,e.id,s);if(e.props){for(let u of e.props)if(Array.isArray(u)||(u=u(c)),u){if(u[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");o[u[0].id]=u[1]}}return c}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let o=this.prop(NodeProp.group);return o?o.indexOf(e)>-1:!1}return this.id==e}static match(e){let o=Object.create(null);for(let s in e)for(let c of s.split(" "))o[c]=e[s];return s=>{for(let c=s.prop(NodeProp.group),u=-1;u<(c?c.length:0);u++){let d=o[u<0?s.name:c[u]];if(d)return d}}}}NodeType.none=new NodeType("",Object.create(null),0,8);class NodeSet{constructor(e){this.types=e;for(let o=0;o<e.length;o++)if(e[o].id!=o)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let o=[];for(let s of this.types){let c=null;for(let u of e){let d=u(s);d&&(c||(c=Object.assign({},s.props)),c[d[0].id]=d[1])}o.push(c?new NodeType(s.name,c,s.id,s.flags):s)}return new NodeSet(o)}}const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode;(function(n){n[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays"})(IterMode||(IterMode={}));let Tree$1=class mf{constructor(e,o,s,c,u){if(this.type=e,this.children=o,this.positions=s,this.length=c,this.props=null,u&&u.length){this.props=Object.create(null);for(let[d,m]of u)this.props[typeof d=="number"?d:d.id]=m}}toString(){let e=this.prop(NodeProp.mounted);if(e&&!e.overlay)return e.tree.toString();let o="";for(let s of this.children){let c=s.toString();c&&(o&&(o+=","),o+=c)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(o.length?"("+o+")":""):o}cursor(e=0){return new TreeCursor(this.topNode,e)}cursorAt(e,o=0,s=0){let c=CachedNode.get(this)||this.topNode,u=new TreeCursor(c);return u.moveTo(e,o),CachedNode.set(this,u._tree),u}get topNode(){return new TreeNode(this,0,0,null)}resolve(e,o=0){let s=resolveNode(CachedNode.get(this)||this.topNode,e,o,!1);return CachedNode.set(this,s),s}resolveInner(e,o=0){let s=resolveNode(CachedInnerNode.get(this)||this.topNode,e,o,!0);return CachedInnerNode.set(this,s),s}iterate(e){let{enter:o,leave:s,from:c=0,to:u=this.length}=e;for(let d=this.cursor((e.mode||0)|IterMode.IncludeAnonymous);;){let m=!1;if(d.from<=u&&d.to>=c&&(d.type.isAnonymous||o(d)!==!1)){if(d.firstChild())continue;m=!0}for(;m&&s&&!d.type.isAnonymous&&s(d),!d.nextSibling();){if(!d.parent())return;m=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let o in this.props)e.push([+o,this.props[o]]);return e}balance(e={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(o,s,c)=>new mf(this.type,o,s,c,this.propValues),e.makeTree||((o,s,c)=>new mf(NodeType.none,o,s,c)))}static build(e){return buildTree(e)}};Tree$1.empty=new Tree$1(NodeType.none,[],[],0);class FlatBufferCursor{constructor(e,o){this.buffer=e,this.index=o}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(e,o,s){this.buffer=e,this.length=o,this.set=s}get type(){return NodeType.none}toString(){let e=[];for(let o=0;o<this.buffer.length;)e.push(this.childString(o)),o=this.buffer[o+3];return e.join(",")}childString(e){let o=this.buffer[e],s=this.buffer[e+3],c=this.set.types[o],u=c.name;if(/\W/.test(u)&&!c.isError&&(u=JSON.stringify(u)),e+=4,s==e)return u;let d=[];for(;e<s;)d.push(this.childString(e)),e=this.buffer[e+3];return u+"("+d.join(",")+")"}findChild(e,o,s,c,u){let{buffer:d}=this,m=-1;for(let _=e;_!=o&&!(checkSide(u,c,d[_+1],d[_+2])&&(m=_,s>0));_=d[_+3]);return m}slice(e,o,s){let c=this.buffer,u=new Uint16Array(o-e),d=0;for(let m=e,_=0;m<o;){u[_++]=c[m++],u[_++]=c[m++]-s;let ue=u[_++]=c[m++]-s;u[_++]=c[m++]-e,d=Math.max(d,ue)}return new TreeBuffer(u,d,this.set)}}function checkSide(n,e,o,s){switch(n){case-2:return o<e;case-1:return s>=e&&o<e;case 0:return o<e&&s>e;case 1:return o<=e&&s>e;case 2:return s>e;case 4:return!0}}function enterUnfinishedNodesBefore(n,e){let o=n.childBefore(e);for(;o;){let s=o.lastChild;if(!s||s.to!=o.to)break;s.type.isError&&s.from==s.to?(n=o,o=s.prevSibling):o=s}return n}function resolveNode(n,e,o,s){for(var c;n.from==n.to||(o<1?n.from>=e:n.from>e)||(o>-1?n.to<=e:n.to<e);){let d=!s&&n instanceof TreeNode&&n.index<0?null:n.parent;if(!d)return n;n=d}let u=s?0:IterMode.IgnoreOverlays;if(s)for(let d=n,m=d.parent;m;d=m,m=d.parent)d instanceof TreeNode&&d.index<0&&((c=m.enter(e,o,u))===null||c===void 0?void 0:c.from)!=d.from&&(n=m);for(;;){let d=n.enter(e,o,u);if(!d)return n;n=d}}class TreeNode{constructor(e,o,s,c){this._tree=e,this.from=o,this.index=s,this._parent=c}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,o,s,c,u=0){for(let d=this;;){for(let{children:m,positions:_}=d._tree,ue=o>0?m.length:-1;e!=ue;e+=o){let gn=m[e],nh=_[e]+d.from;if(checkSide(c,s,nh,nh+gn.length)){if(gn instanceof TreeBuffer){if(u&IterMode.ExcludeBuffers)continue;let ih=gn.findChild(0,gn.buffer.length,o,s-nh,c);if(ih>-1)return new BufferNode(new BufferContext(d,gn,e,nh),null,ih)}else if(u&IterMode.IncludeAnonymous||!gn.type.isAnonymous||hasChild(gn)){let ih;if(!(u&IterMode.IgnoreMounts)&&gn.props&&(ih=gn.prop(NodeProp.mounted))&&!ih.overlay)return new TreeNode(ih.tree,nh,e,d);let rh=new TreeNode(gn,nh,e,d);return u&IterMode.IncludeAnonymous||!rh.type.isAnonymous?rh:rh.nextChild(o<0?gn.children.length-1:0,o,s,c)}}}if(u&IterMode.IncludeAnonymous||!d.type.isAnonymous||(d.index>=0?e=d.index+o:e=o<0?-1:d._parent._tree.children.length,d=d._parent,!d))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,o,s=0){let c;if(!(s&IterMode.IgnoreOverlays)&&(c=this._tree.prop(NodeProp.mounted))&&c.overlay){let u=e-this.from;for(let{from:d,to:m}of c.overlay)if((o>0?d<=u:d<u)&&(o<0?m>=u:m>u))return new TreeNode(c.tree,c.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,o,s)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new TreeCursor(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,o=0){return resolveNode(this,e,o,!1)}resolveInner(e,o=0){return resolveNode(this,e,o,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}getChild(e,o=null,s=null){let c=getChildren(this,e,o,s);return c.length?c[0]:null}getChildren(e,o=null,s=null){return getChildren(this,e,o,s)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return matchNodeContext(this,e)}}function getChildren(n,e,o,s){let c=n.cursor(),u=[];if(!c.firstChild())return u;if(o!=null){for(;!c.type.is(o);)if(!c.nextSibling())return u}for(;;){if(s!=null&&c.type.is(s))return u;if(c.type.is(e)&&u.push(c.node),!c.nextSibling())return s==null?u:[]}}function matchNodeContext(n,e,o=e.length-1){for(let s=n.parent;o>=0;s=s.parent){if(!s)return!1;if(!s.type.isAnonymous){if(e[o]&&e[o]!=s.name)return!1;o--}}return!0}class BufferContext{constructor(e,o,s,c){this.parent=e,this.buffer=o,this.index=s,this.start=c}}class BufferNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,o,s){this.context=e,this._parent=o,this.index=s,this.type=e.buffer.set.types[e.buffer.buffer[s]]}child(e,o,s){let{buffer:c}=this.context,u=c.findChild(this.index+4,c.buffer[this.index+3],e,o-this.context.start,s);return u<0?null:new BufferNode(this.context,this,u)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,o,s=0){if(s&IterMode.ExcludeBuffers)return null;let{buffer:c}=this.context,u=c.findChild(this.index+4,c.buffer[this.index+3],o>0?1:-1,e-this.context.start,o);return u<0?null:new BufferNode(this.context,this,u)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,o=e.buffer[this.index+3];return o<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,o):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,o=this._parent?this._parent.index+4:0;return this.index==o?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(o,this.index,-1,0,4))}cursor(e=0){return new TreeCursor(this,e)}get tree(){return null}toTree(){let e=[],o=[],{buffer:s}=this.context,c=this.index+4,u=s.buffer[this.index+3];if(u>c){let d=s.buffer[this.index+1];e.push(s.slice(c,u,d)),o.push(0)}return new Tree$1(this.type,e,o,this.to-this.from)}resolve(e,o=0){return resolveNode(this,e,o,!1)}resolveInner(e,o=0){return resolveNode(this,e,o,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,o=null,s=null){let c=getChildren(this,e,o,s);return c.length?c[0]:null}getChildren(e,o=null,s=null){return getChildren(this,e,o,s)}get node(){return this}matchContext(e){return matchNodeContext(this,e)}}class TreeCursor{get name(){return this.type.name}constructor(e,o=0){if(this.mode=o,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let s=e._parent;s;s=s._parent)this.stack.unshift(s.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,o){this.index=e;let{start:s,buffer:c}=this.buffer;return this.type=o||c.set.types[c.buffer[e]],this.from=s+c.buffer[e+1],this.to=s+c.buffer[e+2],!0}yield(e){return e?e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,o,s){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,o,s,this.mode));let{buffer:c}=this.buffer,u=c.findChild(this.index+4,c.buffer[this.index+3],e,o-this.buffer.start,s);return u<0?!1:(this.stack.push(this.index),this.yieldBuf(u))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,o,s=this.mode){return this.buffer?s&IterMode.ExcludeBuffers?!1:this.enterChild(1,e,o):this.yield(this._tree.enter(e,o,s))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:o}=this.buffer,s=this.stack.length-1;if(e<0){let c=s<0?0:this.stack[s]+4;if(this.index!=c)return this.yieldBuf(o.findChild(c,this.index,-1,0,4))}else{let c=o.buffer[this.index+3];if(c<(s<0?o.buffer.length:o.buffer[this.stack[s]+3]))return this.yieldBuf(c)}return s<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let o,s,{buffer:c}=this;if(c){if(e>0){if(this.index<c.buffer.buffer.length)return!1}else for(let u=0;u<this.index;u++)if(c.buffer.buffer[u+3]<this.index)return!1;({index:o,parent:s}=c)}else({index:o,_parent:s}=this._tree);for(;s;{index:o,_parent:s}=s)if(o>-1)for(let u=o+e,d=e<0?-1:s._tree.children.length;u!=d;u+=e){let m=s._tree.children[u];if(this.mode&IterMode.IncludeAnonymous||m instanceof TreeBuffer||!m.type.isAnonymous||hasChild(m))return!1}return!0}move(e,o){if(o&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,o=0){for(;(this.from==this.to||(o<1?this.from>=e:this.from>e)||(o>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,o););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,o=null,s=0;if(e&&e.context==this.buffer)e:for(let c=this.index,u=this.stack.length;u>=0;){for(let d=e;d;d=d._parent)if(d.index==c){if(c==this.index)return d;o=d,s=u+1;break e}c=this.stack[--u]}for(let c=s;c<this.stack.length;c++)o=new BufferNode(this.buffer,o,this.stack[c]);return this.bufferNode=new BufferNode(this.buffer,o,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,o){for(let s=0;;){let c=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){s++;continue}this.type.isAnonymous||(c=!0)}for(;c&&o&&o(this),c=this.type.isAnonymous,!this.nextSibling();){if(!s)return;this.parent(),s--,c=!0}}}matchContext(e){if(!this.buffer)return matchNodeContext(this.node,e);let{buffer:o}=this.buffer,{types:s}=o.set;for(let c=e.length-1,u=this.stack.length-1;c>=0;u--){if(u<0)return matchNodeContext(this.node,e,c);let d=s[o.buffer[this.stack[u]]];if(!d.isAnonymous){if(e[c]&&e[c]!=d.name)return!1;c--}}return!0}}function hasChild(n){return n.children.some(e=>e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))}function buildTree(n){var e;let{buffer:o,nodeSet:s,maxBufferLength:c=DefaultBufferLength,reused:u=[],minRepeatType:d=s.types.length}=n,m=Array.isArray(o)?new FlatBufferCursor(o,o.length):o,_=s.types,ue=0,gn=0;function nh(fh,yh,mh,Ch,Mh){let{id:Ph,start:Eh,end:Nh,size:Wh}=m,Yh=gn;for(;Wh<0;)if(m.next(),Wh==-1){let Rh=u[Ph];mh.push(Rh),Ch.push(Eh-fh);return}else if(Wh==-3){ue=Ph;return}else if(Wh==-4){gn=Ph;return}else throw new RangeError(`Unrecognized record size: ${Wh}`);let gh=_[Ph],Ah,wh,$h=Eh-fh;if(Nh-Eh<=c&&(wh=lh(m.pos-yh,Mh))){let Rh=new Uint16Array(wh.size-wh.skip),Oh=m.pos-wh.size,Lh=Rh.length;for(;m.pos>Oh;)Lh=ch(wh.start,Rh,Lh);Ah=new TreeBuffer(Rh,Nh-wh.start,s),$h=wh.start-fh}else{let Rh=m.pos-Wh;m.next();let Oh=[],Lh=[],qh=Ph>=d?Ph:-1,Hh=0,Xh=Nh;for(;m.pos>Rh;)qh>=0&&m.id==qh&&m.size>=0?(m.end<=Xh-c&&(rh(Oh,Lh,Eh,Hh,m.end,Xh,qh,Yh),Hh=Oh.length,Xh=m.end),m.next()):nh(Eh,Rh,Oh,Lh,qh);if(qh>=0&&Hh>0&&Hh<Oh.length&&rh(Oh,Lh,Eh,Hh,Eh,Xh,qh,Yh),Oh.reverse(),Lh.reverse(),qh>-1&&Hh>0){let Qh=ih(gh);Ah=balanceRange(gh,Oh,Lh,0,Oh.length,0,Nh-Eh,Qh,Qh)}else Ah=oh(gh,Oh,Lh,Nh-Eh,Yh-Nh)}mh.push(Ah),Ch.push($h)}function ih(fh){return(yh,mh,Ch)=>{let Mh=0,Ph=yh.length-1,Eh,Nh;if(Ph>=0&&(Eh=yh[Ph])instanceof Tree$1){if(!Ph&&Eh.type==fh&&Eh.length==Ch)return Eh;(Nh=Eh.prop(NodeProp.lookAhead))&&(Mh=mh[Ph]+Eh.length+Nh)}return oh(fh,yh,mh,Ch,Mh)}}function rh(fh,yh,mh,Ch,Mh,Ph,Eh,Nh){let Wh=[],Yh=[];for(;fh.length>Ch;)Wh.push(fh.pop()),Yh.push(yh.pop()+mh-Mh);fh.push(oh(s.types[Eh],Wh,Yh,Ph-Mh,Nh-Ph)),yh.push(Mh-mh)}function oh(fh,yh,mh,Ch,Mh=0,Ph){if(ue){let Eh=[NodeProp.contextHash,ue];Ph=Ph?[Eh].concat(Ph):[Eh]}if(Mh>25){let Eh=[NodeProp.lookAhead,Mh];Ph=Ph?[Eh].concat(Ph):[Eh]}return new Tree$1(fh,yh,mh,Ch,Ph)}function lh(fh,yh){let mh=m.fork(),Ch=0,Mh=0,Ph=0,Eh=mh.end-c,Nh={size:0,start:0,skip:0};e:for(let Wh=mh.pos-fh;mh.pos>Wh;){let Yh=mh.size;if(mh.id==yh&&Yh>=0){Nh.size=Ch,Nh.start=Mh,Nh.skip=Ph,Ph+=4,Ch+=4,mh.next();continue}let gh=mh.pos-Yh;if(Yh<0||gh<Wh||mh.start<Eh)break;let Ah=mh.id>=d?4:0,wh=mh.start;for(mh.next();mh.pos>gh;){if(mh.size<0)if(mh.size==-3)Ah+=4;else break e;else mh.id>=d&&(Ah+=4);mh.next()}Mh=wh,Ch+=Yh,Ph+=Ah}return(yh<0||Ch==fh)&&(Nh.size=Ch,Nh.start=Mh,Nh.skip=Ph),Nh.size>4?Nh:void 0}function ch(fh,yh,mh){let{id:Ch,start:Mh,end:Ph,size:Eh}=m;if(m.next(),Eh>=0&&Ch<d){let Nh=mh;if(Eh>4){let Wh=m.pos-(Eh-4);for(;m.pos>Wh;)mh=ch(fh,yh,mh)}yh[--mh]=Nh,yh[--mh]=Ph-fh,yh[--mh]=Mh-fh,yh[--mh]=Ch}else Eh==-3?ue=Ch:Eh==-4&&(gn=Ch);return mh}let dh=[],_h=[];for(;m.pos>0;)nh(n.start||0,n.bufferStart||0,dh,_h,-1);let Sh=(e=n.length)!==null&&e!==void 0?e:dh.length?_h[0]+dh[0].length:0;return new Tree$1(_[n.topID],dh.reverse(),_h.reverse(),Sh)}const nodeSizeCache=new WeakMap;function nodeSize(n,e){if(!n.isAnonymous||e instanceof TreeBuffer||e.type!=n)return 1;let o=nodeSizeCache.get(e);if(o==null){o=1;for(let s of e.children){if(s.type!=n||!(s instanceof Tree$1)){o=1;break}o+=nodeSize(n,s)}nodeSizeCache.set(e,o)}return o}function balanceRange(n,e,o,s,c,u,d,m,_){let ue=0;for(let oh=s;oh<c;oh++)ue+=nodeSize(n,e[oh]);let gn=Math.ceil(ue*1.5/8),nh=[],ih=[];function rh(oh,lh,ch,dh,_h){for(let Sh=ch;Sh<dh;){let fh=Sh,yh=lh[Sh],mh=nodeSize(n,oh[Sh]);for(Sh++;Sh<dh;Sh++){let Ch=nodeSize(n,oh[Sh]);if(mh+Ch>=gn)break;mh+=Ch}if(Sh==fh+1){if(mh>gn){let Ch=oh[fh];rh(Ch.children,Ch.positions,0,Ch.children.length,lh[fh]+_h);continue}nh.push(oh[fh])}else{let Ch=lh[Sh-1]+oh[Sh-1].length-yh;nh.push(balanceRange(n,oh,lh,fh,Sh,yh,Ch,null,_))}ih.push(yh+_h-u)}}return rh(e,o,s,c,0),(m||_)(nh,ih,d)}class TreeFragment{constructor(e,o,s,c,u=!1,d=!1){this.from=e,this.to=o,this.tree=s,this.offset=c,this.open=(u?1:0)|(d?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,o=[],s=!1){let c=[new TreeFragment(0,e.length,e,0,!1,s)];for(let u of o)u.to>e.length&&c.push(u);return c}static applyChanges(e,o,s=128){if(!o.length)return e;let c=[],u=1,d=e.length?e[0]:null;for(let m=0,_=0,ue=0;;m++){let gn=m<o.length?o[m]:null,nh=gn?gn.fromA:1e9;if(nh-_>=s)for(;d&&d.from<nh;){let ih=d;if(_>=ih.from||nh<=ih.to||ue){let rh=Math.max(ih.from,_)-ue,oh=Math.min(ih.to,nh)-ue;ih=rh>=oh?null:new TreeFragment(rh,oh,ih.tree,ih.offset+ue,m>0,!!gn)}if(ih&&c.push(ih),d.to>nh)break;d=u<e.length?e[u++]:null}if(!gn)break;_=gn.toA,ue=gn.toA-gn.toB}return c}}class Parser{startParse(e,o,s){return typeof e=="string"&&(e=new StringInput(e)),s=s?s.length?s.map(c=>new Range(c.from,c.to)):[new Range(0,0)]:[new Range(0,e.length)],this.createParse(e,o||[],s)}parse(e,o,s){let c=this.startParse(e,o,s);for(;;){let u=c.advance();if(u)return u}}}class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,o){return this.string.slice(e,o)}}new NodeProp({perNode:!0});let nextTagID=0;class Tag{constructor(e,o,s){this.set=e,this.base=o,this.modified=s,this.id=nextTagID++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let o=new Tag([],null,[]);if(o.set.push(o),e)for(let s of e.set)o.set.push(s);return o}static defineModifier(){let e=new Modifier;return o=>o.modified.indexOf(e)>-1?o:Modifier.get(o.base||o,o.modified.concat(e).sort((s,c)=>s.id-c.id))}}let nextModifierID=0;class Modifier{constructor(){this.instances=[],this.id=nextModifierID++}static get(e,o){if(!o.length)return e;let s=o[0].instances.find(m=>m.base==e&&sameArray(o,m.modified));if(s)return s;let c=[],u=new Tag(c,e,o);for(let m of o)m.instances.push(u);let d=powerSet(o);for(let m of e.set)if(!m.modified.length)for(let _ of d)c.push(Modifier.get(m,_));return u}}function sameArray(n,e){return n.length==e.length&&n.every((o,s)=>o==e[s])}function powerSet(n){let e=[[]];for(let o=0;o<n.length;o++)for(let s=0,c=e.length;s<c;s++)e.push(e[s].concat(n[o]));return e.sort((o,s)=>s.length-o.length)}function styleTags(n){let e=Object.create(null);for(let o in n){let s=n[o];Array.isArray(s)||(s=[s]);for(let c of o.split(" "))if(c){let u=[],d=2,m=c;for(let nh=0;;){if(m=="..."&&nh>0&&nh+3==c.length){d=1;break}let ih=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(m);if(!ih)throw new RangeError("Invalid path: "+c);if(u.push(ih[0]=="*"?"":ih[0][0]=='"'?JSON.parse(ih[0]):ih[0]),nh+=ih[0].length,nh==c.length)break;let rh=c[nh++];if(nh==c.length&&rh=="!"){d=0;break}if(rh!="/")throw new RangeError("Invalid path: "+c);m=c.slice(nh)}let _=u.length-1,ue=u[_];if(!ue)throw new RangeError("Invalid path: "+c);let gn=new Rule(s,d,_>0?u.slice(0,_):null);e[ue]=gn.sort(e[ue])}}return ruleNodeProp.add(e)}const ruleNodeProp=new NodeProp;class Rule{constructor(e,o,s,c){this.tags=e,this.mode=o,this.context=s,this.next=c}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Rule.empty=new Rule([],2,null);function tagHighlighter(n,e){let o=Object.create(null);for(let u of n)if(!Array.isArray(u.tag))o[u.tag.id]=u.class;else for(let d of u.tag)o[d.id]=u.class;let{scope:s,all:c=null}=e||{};return{style:u=>{let d=c;for(let m of u)for(let _ of m.set){let ue=o[_.id];if(ue){d=d?d+" "+ue:ue;break}}return d},scope:s}}function highlightTags(n,e){let o=null;for(let s of n){let c=s.style(e);c&&(o=o?o+" "+c:c)}return o}function highlightTree(n,e,o,s=0,c=n.length){let u=new HighlightBuilder(s,Array.isArray(e)?e:[e],o);u.highlightRange(n.cursor(),s,c,"",u.highlighters),u.flush(c)}class HighlightBuilder{constructor(e,o,s){this.at=e,this.highlighters=o,this.span=s,this.class=""}startSpan(e,o){o!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=o)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,o,s,c,u){let{type:d,from:m,to:_}=e;if(m>=s||_<=o)return;d.isTop&&(u=this.highlighters.filter(rh=>!rh.scope||rh.scope(d)));let ue=c,gn=getStyleTags(e)||Rule.empty,nh=highlightTags(u,gn.tags);if(nh&&(ue&&(ue+=" "),ue+=nh,gn.mode==1&&(c+=(c?" ":"")+nh)),this.startSpan(Math.max(o,m),ue),gn.opaque)return;let ih=e.tree&&e.tree.prop(NodeProp.mounted);if(ih&&ih.overlay){let rh=e.node.enter(ih.overlay[0].from+m,1),oh=this.highlighters.filter(ch=>!ch.scope||ch.scope(ih.tree.type)),lh=e.firstChild();for(let ch=0,dh=m;;ch++){let _h=ch<ih.overlay.length?ih.overlay[ch]:null,Sh=_h?_h.from+m:_,fh=Math.max(o,dh),yh=Math.min(s,Sh);if(fh<yh&&lh)for(;e.from<yh&&(this.highlightRange(e,fh,yh,c,u),this.startSpan(Math.min(yh,e.to),ue),!(e.to>=Sh||!e.nextSibling())););if(!_h||Sh>s)break;dh=_h.to+m,dh>o&&(this.highlightRange(rh.cursor(),Math.max(o,_h.from+m),Math.min(s,dh),"",oh),this.startSpan(Math.min(s,dh),ue))}lh&&e.parent()}else if(e.firstChild()){ih&&(c="");do if(!(e.to<=o)){if(e.from>=s)break;this.highlightRange(e,o,s,c,u),this.startSpan(Math.min(s,e.to),ue)}while(e.nextSibling());e.parent()}}}function getStyleTags(n){let e=n.type.prop(ruleNodeProp);for(;e&&e.context&&!n.matchContext(e.context);)e=e.next;return e||null}const t=Tag.define,comment=t(),name$q=t(),typeName=t(name$q),propertyName=t(name$q),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t(),tags={comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name:name$q,variableName:t(name$q),typeName,tagName:t(typeName),propertyName,attributeName:t(propertyName),className:t(name$q),labelName:t(name$q),namespace:t(name$q),macroName:t(name$q),literal,string,docString:t(string),character:t(string),attributeValue:t(string),number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation,separator:t(punctuation),bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content,heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier(),constant:Tag.defineModifier(),function:Tag.defineModifier(),standard:Tag.defineModifier(),local:Tag.defineModifier(),special:Tag.defineModifier()};tagHighlighter([{tag:tags.link,class:"tok-link"},{tag:tags.heading,class:"tok-heading"},{tag:tags.emphasis,class:"tok-emphasis"},{tag:tags.strong,class:"tok-strong"},{tag:tags.keyword,class:"tok-keyword"},{tag:tags.atom,class:"tok-atom"},{tag:tags.bool,class:"tok-bool"},{tag:tags.url,class:"tok-url"},{tag:tags.labelName,class:"tok-labelName"},{tag:tags.inserted,class:"tok-inserted"},{tag:tags.deleted,class:"tok-deleted"},{tag:tags.literal,class:"tok-literal"},{tag:tags.string,class:"tok-string"},{tag:tags.number,class:"tok-number"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],class:"tok-string2"},{tag:tags.variableName,class:"tok-variableName"},{tag:tags.local(tags.variableName),class:"tok-variableName tok-local"},{tag:tags.definition(tags.variableName),class:"tok-variableName tok-definition"},{tag:tags.special(tags.variableName),class:"tok-variableName2"},{tag:tags.definition(tags.propertyName),class:"tok-propertyName tok-definition"},{tag:tags.typeName,class:"tok-typeName"},{tag:tags.namespace,class:"tok-namespace"},{tag:tags.className,class:"tok-className"},{tag:tags.macroName,class:"tok-macroName"},{tag:tags.propertyName,class:"tok-propertyName"},{tag:tags.operator,class:"tok-operator"},{tag:tags.comment,class:"tok-comment"},{tag:tags.meta,class:"tok-meta"},{tag:tags.invalid,class:"tok-invalid"},{tag:tags.punctuation,class:"tok-punctuation"}]);var _a$1;const languageDataProp=new NodeProp;function defineLanguageFacet(n){return Facet.define({combine:n?e=>e.concat(n):void 0})}const sublanguageProp=new NodeProp;class Language{constructor(e,o,s=[],c=""){this.data=e,this.name=c,EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(EditorState.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=o,this.extension=[language.of(this),EditorState.languageData.of((u,d,m)=>{let _=topNodeAt(u,d,m),ue=_.type.prop(languageDataProp);if(!ue)return[];let gn=u.facet(ue),nh=_.type.prop(sublanguageProp);if(nh){let ih=_.resolve(d-_.from,m);for(let rh of nh)if(rh.test(ih,u)){let oh=u.facet(rh.facet);return rh.type=="replace"?oh:oh.concat(gn)}}return gn})].concat(s)}isActiveAt(e,o,s=-1){return topNodeAt(e,o,s).type.prop(languageDataProp)==this.data}findRegions(e){let o=e.facet(language);if((o==null?void 0:o.data)==this.data)return[{from:0,to:e.doc.length}];if(!o||!o.allowsNesting)return[];let s=[],c=(u,d)=>{if(u.prop(languageDataProp)==this.data){s.push({from:d,to:d+u.length});return}let m=u.prop(NodeProp.mounted);if(m){if(m.tree.prop(languageDataProp)==this.data){if(m.overlay)for(let _ of m.overlay)s.push({from:_.from+d,to:_.to+d});else s.push({from:d,to:d+u.length});return}else if(m.overlay){let _=s.length;if(c(m.tree,m.overlay[0].from+d),s.length>_)return}}for(let _=0;_<u.children.length;_++){let ue=u.children[_];ue instanceof Tree$1&&c(ue,u.positions[_]+d)}};return c(syntaxTree(e),0),s}get allowsNesting(){return!0}}Language.setState=StateEffect.define();function topNodeAt(n,e,o){let s=n.facet(language),c=syntaxTree(n).topNode;if(!s||s.allowsNesting)for(let u=c;u;u=u.enter(e,o,IterMode.ExcludeBuffers))u.type.isTop&&(c=u);return c}class LRLanguage extends Language{constructor(e,o,s){super(e,o,[],s),this.parser=o}static define(e){let o=defineLanguageFacet(e.languageData);return new LRLanguage(o,e.parser.configure({props:[languageDataProp.add(s=>s.isTop?o:void 0)]}),e.name)}configure(e,o){return new LRLanguage(this.data,this.parser.configure(e),o||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function syntaxTree(n){let e=n.field(Language.state,!1);return e?e.tree:Tree$1.empty}class DocInput{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,o){let s=this.cursorPos-this.string.length;return e<s||o>=this.cursorPos?this.doc.sliceString(e,o):this.string.slice(e-s,o-s)}}let currentContext=null;class ParseContext{constructor(e,o,s=[],c,u,d,m,_){this.parser=e,this.state=o,this.fragments=s,this.tree=c,this.treeLen=u,this.viewport=d,this.skipped=m,this.scheduleOn=_,this.parse=null,this.tempSkipped=[]}static create(e,o,s){return new ParseContext(e,o,[],Tree$1.empty,0,s,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(e,o){return o!=null&&o>=this.state.doc.length&&(o=void 0),this.tree!=Tree$1.empty&&this.isDone(o??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var s;if(typeof e=="number"){let c=Date.now()+e;e=()=>Date.now()>c}for(this.parse||(this.parse=this.startParse()),o!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>o)&&o<this.state.doc.length&&this.parse.stopAt(o);;){let c=this.parse.advance();if(c)if(this.fragments=this.withoutTempSkipped(TreeFragment.addTree(c,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(s=this.parse.stoppedAt)!==null&&s!==void 0?s:this.state.doc.length,this.tree=c,this.parse=null,this.treeLen<(o??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,o;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(o=this.parse.advance()););}),this.treeLen=e,this.tree=o,this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let o=currentContext;currentContext=this;try{return e()}finally{currentContext=o}}withoutTempSkipped(e){for(let o;o=this.tempSkipped.pop();)e=cutFragments(e,o.from,o.to);return e}changes(e,o){let{fragments:s,tree:c,treeLen:u,viewport:d,skipped:m}=this;if(this.takeTree(),!e.empty){let _=[];if(e.iterChangedRanges((ue,gn,nh,ih)=>_.push({fromA:ue,toA:gn,fromB:nh,toB:ih})),s=TreeFragment.applyChanges(s,_),c=Tree$1.empty,u=0,d={from:e.mapPos(d.from,-1),to:e.mapPos(d.to,1)},this.skipped.length){m=[];for(let ue of this.skipped){let gn=e.mapPos(ue.from,1),nh=e.mapPos(ue.to,-1);gn<nh&&m.push({from:gn,to:nh})}}}return new ParseContext(this.parser,o,s,c,u,d,m,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let o=this.skipped.length;for(let s=0;s<this.skipped.length;s++){let{from:c,to:u}=this.skipped[s];c<e.to&&u>e.from&&(this.fragments=cutFragments(this.fragments,c,u),this.skipped.splice(s--,1))}return this.skipped.length>=o?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,o){this.skipped.push({from:e,to:o})}static getSkippingParser(e){return new class extends Parser{createParse(o,s,c){let u=c[0].from,d=c[c.length-1].to;return{parsedPos:u,advance(){let _=currentContext;if(_){for(let ue of c)_.tempSkipped.push(ue);e&&(_.scheduleOn=_.scheduleOn?Promise.all([_.scheduleOn,e]):e)}return this.parsedPos=d,new Tree$1(NodeType.none,[],[],d-u)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let o=this.fragments;return this.treeLen>=e&&o.length&&o[0].from==0&&o[0].to>=e}static get(){return currentContext}}function cutFragments(n,e,o){return TreeFragment.applyChanges(n,[{fromA:e,toA:o,fromB:e,toB:o}])}class LanguageState{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let o=this.context.changes(e.changes,e.state),s=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),o.viewport.to);return o.work(20,s)||o.takeTree(),new LanguageState(o)}static init(e){let o=Math.min(3e3,e.doc.length),s=ParseContext.create(e.facet(language).parser,e,{from:0,to:o});return s.work(20,o)||s.takeTree(),new LanguageState(s)}}Language.state=StateField.define({create:LanguageState.init,update(n,e){for(let o of e.effects)if(o.is(Language.setState))return o.value;return e.startState.facet(language)!=e.state.facet(language)?LanguageState.init(e.state):n.apply(e)}});let requestIdle=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(requestIdle=n=>{let e=-1,o=setTimeout(()=>{e=requestIdleCallback(n,{timeout:500-100})},100);return()=>e<0?clearTimeout(o):cancelIdleCallback(e)});const isInputPending=typeof navigator<"u"&&(!((_a$1=navigator.scheduling)===null||_a$1===void 0)&&_a$1.isInputPending)?()=>navigator.scheduling.isInputPending():null,parseWorker=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let o=this.view.state.field(Language.state).context;(o.updateViewport(e.view.viewport)||this.view.viewport.to>o.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(o)}scheduleWork(){if(this.working)return;let{state:e}=this.view,o=e.field(Language.state);(o.tree!=o.context.tree||!o.context.isDone(e.doc.length))&&(this.working=requestIdle(this.work))}work(e){this.working=null;let o=Date.now();if(this.chunkEnd<o&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=o+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:s,viewport:{to:c}}=this.view,u=s.field(Language.state);if(u.tree==u.context.tree&&u.context.isDone(c+1e5))return;let d=Date.now()+Math.min(this.chunkBudget,100,e&&!isInputPending?Math.max(25,e.timeRemaining()-5):1e9),m=u.context.treeLen<c&&s.doc.length>c+1e3,_=u.context.work(()=>isInputPending&&isInputPending()||Date.now()>d,c+(m?0:1e5));this.chunkBudget-=Date.now()-o,(_||this.chunkBudget<=0)&&(u.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(u.context))})),this.chunkBudget>0&&!(_&&!m)&&this.scheduleWork(),this.checkAsyncSchedule(u.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(o=>logException(this.view.state,o)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=Facet.define({combine(n){return n.length?n[0]:null},enables:n=>[Language.state,parseWorker,EditorView.contentAttributes.compute([n],e=>{let o=e.facet(n);return o&&o.name?{"data-language":o.name}:{}})]});class LanguageSupport{constructor(e,o=[]){this.language=e,this.support=o,this.extension=[e,o]}}const indentService=Facet.define(),indentUnit=Facet.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(o=>o!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function getIndentUnit(n){let e=n.facet(indentUnit);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function indentString(n,e){let o="",s=n.tabSize,c=n.facet(indentUnit)[0];if(c=="	"){for(;e>=s;)o+="	",e-=s;c=" "}for(let u=0;u<e;u++)o+=c;return o}function getIndentation(n,e){n instanceof EditorState&&(n=new IndentContext(n));for(let s of n.state.facet(indentService)){let c=s(n,e);if(c!==void 0)return c}let o=syntaxTree(n.state);return o?syntaxIndentation(n,o,e):null}class IndentContext{constructor(e,o={}){this.state=e,this.options=o,this.unit=getIndentUnit(e)}lineAt(e,o=1){let s=this.state.doc.lineAt(e),{simulateBreak:c,simulateDoubleBreak:u}=this.options;return c!=null&&c>=s.from&&c<=s.to?u&&c==e?{text:"",from:e}:(o<0?c<e:c<=e)?{text:s.text.slice(c-s.from),from:c}:{text:s.text.slice(0,c-s.from),from:s.from}:s}textAfterPos(e,o=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:s,from:c}=this.lineAt(e,o);return s.slice(e-c,Math.min(s.length,e+100-c))}column(e,o=1){let{text:s,from:c}=this.lineAt(e,o),u=this.countColumn(s,e-c),d=this.options.overrideIndentation?this.options.overrideIndentation(c):-1;return d>-1&&(u+=d-this.countColumn(s,s.search(/\S|$/))),u}countColumn(e,o=e.length){return countColumn(e,this.state.tabSize,o)}lineIndent(e,o=1){let{text:s,from:c}=this.lineAt(e,o),u=this.options.overrideIndentation;if(u){let d=u(c);if(d>-1)return d}return this.countColumn(s,s.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const indentNodeProp=new NodeProp;function syntaxIndentation(n,e,o){return indentFrom(e.resolveInner(o).enterUnfinishedNodesBefore(o),o,n)}function ignoreClosed(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function indentStrategy(n){let e=n.type.prop(indentNodeProp);if(e)return e;let o=n.firstChild,s;if(o&&(s=o.type.prop(NodeProp.closedBy))){let c=n.lastChild,u=c&&s.indexOf(c.name)>-1;return d=>delimitedStrategy(d,!0,1,void 0,u&&!ignoreClosed(d)?c.from:void 0)}return n.parent==null?topIndent:null}function indentFrom(n,e,o){for(;n;n=n.parent){let s=indentStrategy(n);if(s)return s(TreeIndentContext.create(o,e,n))}return null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(e,o,s){super(e.state,e.options),this.base=e,this.pos=o,this.node=s}static create(e,o,s){return new TreeIndentContext(e,o,s)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let o=this.node.resolve(e.from);for(;o.parent&&o.parent.from==o.from;)o=o.parent;if(isParent(o,this.node))break;e=this.state.doc.lineAt(o.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?indentFrom(e,this.pos,this.base):0}}function isParent(n,e){for(let o=e;o;o=o.parent)if(n==o)return!0;return!1}function bracketedAligned(n){let e=n.node,o=e.childAfter(e.from),s=e.lastChild;if(!o)return null;let c=n.options.simulateBreak,u=n.state.doc.lineAt(o.from),d=c==null||c<=u.from?u.to:Math.min(u.to,c);for(let m=o.to;;){let _=e.childAfter(m);if(!_||_==s)return null;if(!_.type.isSkipped)return _.from<d?o:null;m=_.to}}function delimitedStrategy(n,e,o,s,c){let u=n.textAfter,d=u.match(/^\s*/)[0].length,m=s&&u.slice(d,d+s.length)==s||c==n.pos+d,_=e?bracketedAligned(n):null;return _?m?n.column(_.from):n.column(_.to):n.baseIndent+(m?0:n.unit*o)}function continuedIndent({except:n,units:e=1}={}){return o=>{let s=n&&n.test(o.textAfter);return o.baseIndent+(s?0:e*o.unit)}}const DontIndentBeyond=200;function indentOnInput(){return EditorState.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let o=n.newDoc,{head:s}=n.newSelection.main,c=o.lineAt(s);if(s>c.from+DontIndentBeyond)return n;let u=o.sliceString(c.from,s);if(!e.some(ue=>ue.test(u)))return n;let{state:d}=n,m=-1,_=[];for(let{head:ue}of d.selection.ranges){let gn=d.doc.lineAt(ue);if(gn.from==m)continue;m=gn.from;let nh=getIndentation(d,gn.from);if(nh==null)continue;let ih=/^\s*/.exec(gn.text)[0],rh=indentString(d,nh);ih!=rh&&_.push({from:gn.from,to:gn.from+ih.length,insert:rh})}return _.length?[n,{changes:_,sequential:!0}]:n})}const foldService=Facet.define(),foldNodeProp=new NodeProp;function foldInside(n){let e=n.firstChild,o=n.lastChild;return e&&e.to<o.from?{from:e.to,to:o.type.isError?n.to:o.from}:null}function syntaxFolding(n,e,o){let s=syntaxTree(n);if(s.length<o)return null;let c=s.resolveInner(o,1),u=null;for(let d=c;d;d=d.parent){if(d.to<=o||d.from>o)continue;if(u&&d.from<e)break;let m=d.type.prop(foldNodeProp);if(m&&(d.to<s.length-50||s.length==n.doc.length||!isUnfinished(d))){let _=m(d,n);_&&_.from<=o&&_.from>=e&&_.to>o&&(u=_)}}return u}function isUnfinished(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function foldable(n,e,o){for(let s of n.facet(foldService)){let c=s(n,e,o);if(c)return c}return syntaxFolding(n,e,o)}function mapRange(n,e){let o=e.mapPos(n.from,1),s=e.mapPos(n.to,-1);return o>=s?void 0:{from:o,to:s}}const foldEffect=StateEffect.define({map:mapRange}),unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(n){let e=[];for(let{head:o}of n.state.selection.ranges)e.some(s=>s.from<=o&&s.to>=o)||e.push(n.lineBlockAt(o));return e}const foldState=StateField.define({create(){return Decoration.none},update(n,e){n=n.map(e.changes);for(let o of e.effects)o.is(foldEffect)&&!foldExists(n,o.value.from,o.value.to)?n=n.update({add:[foldWidget.range(o.value.from,o.value.to)]}):o.is(unfoldEffect)&&(n=n.update({filter:(s,c)=>o.value.from!=s||o.value.to!=c,filterFrom:o.value.from,filterTo:o.value.to}));if(e.selection){let o=!1,{head:s}=e.selection.main;n.between(s,s,(c,u)=>{c<s&&u>s&&(o=!0)}),o&&(n=n.update({filterFrom:s,filterTo:s,filter:(c,u)=>u<=s||c>=s}))}return n},provide:n=>EditorView.decorations.from(n),toJSON(n,e){let o=[];return n.between(0,e.doc.length,(s,c)=>{o.push(s,c)}),o},fromJSON(n){if(!Array.isArray(n)||n.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let o=0;o<n.length;){let s=n[o++],c=n[o++];if(typeof s!="number"||typeof c!="number")throw new RangeError("Invalid JSON for fold state");e.push(foldWidget.range(s,c))}return Decoration.set(e,!0)}});function findFold(n,e,o){var s;let c=null;return(s=n.field(foldState,!1))===null||s===void 0||s.between(e,o,(u,d)=>{(!c||c.from>u)&&(c={from:u,to:d})}),c}function foldExists(n,e,o){let s=!1;return n.between(e,e,(c,u)=>{c==e&&u==o&&(s=!0)}),s}function maybeEnable(n,e){return n.field(foldState,!1)?e:e.concat(StateEffect.appendConfig.of(codeFolding()))}const foldCode=n=>{for(let e of selectedLines(n)){let o=foldable(n.state,e.from,e.to);if(o)return n.dispatch({effects:maybeEnable(n.state,[foldEffect.of(o),announceFold(n,o)])}),!0}return!1},unfoldCode=n=>{if(!n.state.field(foldState,!1))return!1;let e=[];for(let o of selectedLines(n)){let s=findFold(n.state,o.from,o.to);s&&e.push(unfoldEffect.of(s),announceFold(n,s,!1))}return e.length&&n.dispatch({effects:e}),e.length>0};function announceFold(n,e,o=!0){let s=n.state.doc.lineAt(e.from).number,c=n.state.doc.lineAt(e.to).number;return EditorView.announce.of(`${n.state.phrase(o?"Folded lines":"Unfolded lines")} ${s} ${n.state.phrase("to")} ${c}.`)}const foldAll=n=>{let{state:e}=n,o=[];for(let s=0;s<e.doc.length;){let c=n.lineBlockAt(s),u=foldable(e,c.from,c.to);u&&o.push(foldEffect.of(u)),s=(u?n.lineBlockAt(u.to):c).to+1}return o.length&&n.dispatch({effects:maybeEnable(n.state,o)}),!!o.length},unfoldAll=n=>{let e=n.state.field(foldState,!1);if(!e||!e.size)return!1;let o=[];return e.between(0,n.state.doc.length,(s,c)=>{o.push(unfoldEffect.of({from:s,to:c}))}),n.dispatch({effects:o}),!0},foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}],defaultConfig={placeholderDOM:null,placeholderText:""},foldConfig=Facet.define({combine(n){return combineConfig(n,defaultConfig)}});function codeFolding(n){let e=[foldState,baseTheme$1$2];return n&&e.push(foldConfig.of(n)),e}const foldWidget=Decoration.replace({widget:new class extends WidgetType{toDOM(n){let{state:e}=n,o=e.facet(foldConfig),s=u=>{let d=n.lineBlockAt(n.posAtDOM(u.target)),m=findFold(n.state,d.from,d.to);m&&n.dispatch({effects:unfoldEffect.of(m)}),u.preventDefault()};if(o.placeholderDOM)return o.placeholderDOM(n,s);let c=document.createElement("span");return c.textContent=o.placeholderText,c.setAttribute("aria-label",e.phrase("folded code")),c.title=e.phrase("unfold"),c.className="cm-foldPlaceholder",c.onclick=s,c}}}),foldGutterDefaults={openText:"",closedText:"",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class FoldMarker extends GutterMarker{constructor(e,o){super(),this.config=e,this.open=o}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let o=document.createElement("span");return o.textContent=this.open?this.config.openText:this.config.closedText,o.title=e.state.phrase(this.open?"Fold line":"Unfold line"),o}}function foldGutter(n={}){let e=Object.assign(Object.assign({},foldGutterDefaults),n),o=new FoldMarker(e,!0),s=new FoldMarker(e,!1),c=ViewPlugin.fromClass(class{constructor(d){this.from=d.viewport.from,this.markers=this.buildMarkers(d)}update(d){(d.docChanged||d.viewportChanged||d.startState.facet(language)!=d.state.facet(language)||d.startState.field(foldState,!1)!=d.state.field(foldState,!1)||syntaxTree(d.startState)!=syntaxTree(d.state)||e.foldingChanged(d))&&(this.markers=this.buildMarkers(d.view))}buildMarkers(d){let m=new RangeSetBuilder;for(let _ of d.viewportLineBlocks){let ue=findFold(d.state,_.from,_.to)?s:foldable(d.state,_.from,_.to)?o:null;ue&&m.add(_.from,_.from,ue)}return m.finish()}}),{domEventHandlers:u}=e;return[c,gutter({class:"cm-foldGutter",markers(d){var m;return((m=d.plugin(c))===null||m===void 0?void 0:m.markers)||RangeSet.empty},initialSpacer(){return new FoldMarker(e,!1)},domEventHandlers:Object.assign(Object.assign({},u),{click:(d,m,_)=>{if(u.click&&u.click(d,m,_))return!0;let ue=findFold(d.state,m.from,m.to);if(ue)return d.dispatch({effects:unfoldEffect.of(ue)}),!0;let gn=foldable(d.state,m.from,m.to);return gn?(d.dispatch({effects:foldEffect.of(gn)}),!0):!1}})}),codeFolding()]}const baseTheme$1$2=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class HighlightStyle{constructor(e,o){this.specs=e;let s;function c(m){let _=StyleModule.newName();return(s||(s=Object.create(null)))["."+_]=m,_}const u=typeof o.all=="string"?o.all:o.all?c(o.all):void 0,d=o.scope;this.scope=d instanceof Language?m=>m.prop(languageDataProp)==d.data:d?m=>m==d:void 0,this.style=tagHighlighter(e.map(m=>({tag:m.tag,class:m.class||c(Object.assign({},m,{tag:null}))})),{all:u}).style,this.module=s?new StyleModule(s):null,this.themeType=o.themeType}static define(e,o){return new HighlightStyle(e,o||{})}}const highlighterFacet=Facet.define(),fallbackHighlighter=Facet.define({combine(n){return n.length?[n[0]]:null}});function getHighlighters(n){let e=n.facet(highlighterFacet);return e.length?e:n.facet(fallbackHighlighter)}function syntaxHighlighting(n,e){let o=[treeHighlighter],s;return n instanceof HighlightStyle&&(n.module&&o.push(EditorView.styleModule.of(n.module)),s=n.themeType),e!=null&&e.fallback?o.push(fallbackHighlighter.of(n)):s?o.push(highlighterFacet.computeN([EditorView.darkTheme],c=>c.facet(EditorView.darkTheme)==(s=="dark")?[n]:[])):o.push(highlighterFacet.of(n)),o}class TreeHighlighter{constructor(e){this.markCache=Object.create(null),this.tree=syntaxTree(e.state),this.decorations=this.buildDeco(e,getHighlighters(e.state))}update(e){let o=syntaxTree(e.state),s=getHighlighters(e.state),c=s!=getHighlighters(e.startState);o.length<e.view.viewport.to&&!c&&o.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(o!=this.tree||e.viewportChanged||c)&&(this.tree=o,this.decorations=this.buildDeco(e.view,s))}buildDeco(e,o){if(!o||!this.tree.length)return Decoration.none;let s=new RangeSetBuilder;for(let{from:c,to:u}of e.visibleRanges)highlightTree(this.tree,o,(d,m,_)=>{s.add(d,m,this.markCache[_]||(this.markCache[_]=Decoration.mark({class:_})))},c,u);return s.finish()}}const treeHighlighter=Prec.high(ViewPlugin.fromClass(TreeHighlighter,{decorations:n=>n.decorations})),defaultHighlightStyle=HighlightStyle.define([{tag:tags.meta,color:"#404740"},{tag:tags.link,textDecoration:"underline"},{tag:tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strong,fontWeight:"bold"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.keyword,color:"#708"},{tag:[tags.atom,tags.bool,tags.url,tags.contentSeparator,tags.labelName],color:"#219"},{tag:[tags.literal,tags.inserted],color:"#164"},{tag:[tags.string,tags.deleted],color:"#a11"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],color:"#e40"},{tag:tags.definition(tags.variableName),color:"#00f"},{tag:tags.local(tags.variableName),color:"#30a"},{tag:[tags.typeName,tags.namespace],color:"#085"},{tag:tags.className,color:"#167"},{tag:[tags.special(tags.variableName),tags.macroName],color:"#256"},{tag:tags.definition(tags.propertyName),color:"#00c"},{tag:tags.comment,color:"#940"},{tag:tags.invalid,color:"#f00"}]),baseTheme$3=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),DefaultScanDist=1e4,DefaultBrackets="()[]{}",bracketMatchingConfig=Facet.define({combine(n){return combineConfig(n,{afterCursor:!0,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}}),matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});function defaultRenderMatch(n){let e=[],o=n.matched?matchingMark:nonmatchingMark;return e.push(o.range(n.start.from,n.start.to)),n.end&&e.push(o.range(n.end.from,n.end.to)),e}const bracketMatchingState=StateField.define({create(){return Decoration.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let o=[],s=e.state.facet(bracketMatchingConfig);for(let c of e.state.selection.ranges){if(!c.empty)continue;let u=matchBrackets(e.state,c.head,-1,s)||c.head>0&&matchBrackets(e.state,c.head-1,1,s)||s.afterCursor&&(matchBrackets(e.state,c.head,1,s)||c.head<e.state.doc.length&&matchBrackets(e.state,c.head+1,-1,s));u&&(o=o.concat(s.renderMatch(u,e.state)))}return Decoration.set(o,!0)},provide:n=>EditorView.decorations.from(n)}),bracketMatchingUnique=[bracketMatchingState,baseTheme$3];function bracketMatching(n={}){return[bracketMatchingConfig.of(n),bracketMatchingUnique]}const bracketMatchingHandle=new NodeProp;function matchingNodes(n,e,o){let s=n.prop(e<0?NodeProp.openedBy:NodeProp.closedBy);if(s)return s;if(n.name.length==1){let c=o.indexOf(n.name);if(c>-1&&c%2==(e<0?1:0))return[o[c+e]]}return null}function findHandle(n){let e=n.type.prop(bracketMatchingHandle);return e?e(n.node):n}function matchBrackets(n,e,o,s={}){let c=s.maxScanDistance||DefaultScanDist,u=s.brackets||DefaultBrackets,d=syntaxTree(n),m=d.resolveInner(e,o);for(let _=m;_;_=_.parent){let ue=matchingNodes(_.type,o,u);if(ue&&_.from<_.to){let gn=findHandle(_);if(gn&&(o>0?e>=gn.from&&e<gn.to:e>gn.from&&e<=gn.to))return matchMarkedBrackets(n,e,o,_,gn,ue,u)}}return matchPlainBrackets(n,e,o,d,m.type,c,u)}function matchMarkedBrackets(n,e,o,s,c,u,d){let m=s.parent,_={from:c.from,to:c.to},ue=0,gn=m==null?void 0:m.cursor();if(gn&&(o<0?gn.childBefore(s.from):gn.childAfter(s.to)))do if(o<0?gn.to<=s.from:gn.from>=s.to){if(ue==0&&u.indexOf(gn.type.name)>-1&&gn.from<gn.to){let nh=findHandle(gn);return{start:_,end:nh?{from:nh.from,to:nh.to}:void 0,matched:!0}}else if(matchingNodes(gn.type,o,d))ue++;else if(matchingNodes(gn.type,-o,d)){if(ue==0){let nh=findHandle(gn);return{start:_,end:nh&&nh.from<nh.to?{from:nh.from,to:nh.to}:void 0,matched:!1}}ue--}}while(o<0?gn.prevSibling():gn.nextSibling());return{start:_,matched:!1}}function matchPlainBrackets(n,e,o,s,c,u,d){let m=o<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),_=d.indexOf(m);if(_<0||_%2==0!=o>0)return null;let ue={from:o<0?e-1:e,to:o>0?e+1:e},gn=n.doc.iterRange(e,o>0?n.doc.length:0),nh=0;for(let ih=0;!gn.next().done&&ih<=u;){let rh=gn.value;o<0&&(ih+=rh.length);let oh=e+ih*o;for(let lh=o>0?0:rh.length-1,ch=o>0?rh.length:-1;lh!=ch;lh+=o){let dh=d.indexOf(rh[lh]);if(!(dh<0||s.resolveInner(oh+lh,1).type!=c))if(dh%2==0==o>0)nh++;else{if(nh==1)return{start:ue,end:{from:oh+lh,to:oh+lh+1},matched:dh>>1==_>>1};nh--}}o>0&&(ih+=rh.length)}return gn.done?{start:ue,matched:!1}:null}const noTokens=Object.create(null),typeArray=[NodeType.none],warned=[],defaultTable=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[n]=createTokenType(noTokens,e);function warnForPart(n,e){warned.indexOf(n)>-1||(warned.push(n),console.warn(e))}function createTokenType(n,e){let o=null;for(let u of e.split(".")){let d=n[u]||tags[u];d?typeof d=="function"?o?o=d(o):warnForPart(u,`Modifier ${u} used at start of tag`):o?warnForPart(u,`Tag ${u} used as modifier`):o=d:warnForPart(u,`Unknown highlighting tag ${u}`)}if(!o)return 0;let s=e.replace(/ /g,"_"),c=NodeType.define({id:typeArray.length,name:s,props:[styleTags({[s]:o})]});return typeArray.push(c),c.id}const toggleComment=n=>{let{state:e}=n,o=e.doc.lineAt(e.selection.main.from),s=getConfig(n.state,o.from);return s.line?toggleLineComment(n):s.block?toggleBlockCommentByLine(n):!1};function command(n,e){return({state:o,dispatch:s})=>{if(o.readOnly)return!1;let c=n(e,o);return c?(s(o.update(c)),!0):!1}}const toggleLineComment=command(changeLineComment,0),toggleBlockComment=command(changeBlockComment,0),toggleBlockCommentByLine=command((n,e)=>changeBlockComment(n,e,selectedLineRanges(e)),0);function getConfig(n,e){let o=n.languageDataAt("commentTokens",e);return o.length?o[0]:{}}const SearchMargin=50;function findBlockComment(n,{open:e,close:o},s,c){let u=n.sliceDoc(s-SearchMargin,s),d=n.sliceDoc(c,c+SearchMargin),m=/\s*$/.exec(u)[0].length,_=/^\s*/.exec(d)[0].length,ue=u.length-m;if(u.slice(ue-e.length,ue)==e&&d.slice(_,_+o.length)==o)return{open:{pos:s-m,margin:m&&1},close:{pos:c+_,margin:_&&1}};let gn,nh;c-s<=2*SearchMargin?gn=nh=n.sliceDoc(s,c):(gn=n.sliceDoc(s,s+SearchMargin),nh=n.sliceDoc(c-SearchMargin,c));let ih=/^\s*/.exec(gn)[0].length,rh=/\s*$/.exec(nh)[0].length,oh=nh.length-rh-o.length;return gn.slice(ih,ih+e.length)==e&&nh.slice(oh,oh+o.length)==o?{open:{pos:s+ih+e.length,margin:/\s/.test(gn.charAt(ih+e.length))?1:0},close:{pos:c-rh-o.length,margin:/\s/.test(nh.charAt(oh-1))?1:0}}:null}function selectedLineRanges(n){let e=[];for(let o of n.selection.ranges){let s=n.doc.lineAt(o.from),c=o.to<=s.to?s:n.doc.lineAt(o.to),u=e.length-1;u>=0&&e[u].to>s.from?e[u].to=c.to:e.push({from:s.from+/^\s*/.exec(s.text)[0].length,to:c.to})}return e}function changeBlockComment(n,e,o=e.selection.ranges){let s=o.map(u=>getConfig(e,u.from).block);if(!s.every(u=>u))return null;let c=o.map((u,d)=>findBlockComment(e,s[d],u.from,u.to));if(n!=2&&!c.every(u=>u))return{changes:e.changes(o.map((u,d)=>c[d]?[]:[{from:u.from,insert:s[d].open+" "},{from:u.to,insert:" "+s[d].close}]))};if(n!=1&&c.some(u=>u)){let u=[];for(let d=0,m;d<c.length;d++)if(m=c[d]){let _=s[d],{open:ue,close:gn}=m;u.push({from:ue.pos-_.open.length,to:ue.pos+ue.margin},{from:gn.pos-gn.margin,to:gn.pos+_.close.length})}return{changes:u}}return null}function changeLineComment(n,e,o=e.selection.ranges){let s=[],c=-1;for(let{from:u,to:d}of o){let m=s.length,_=1e9,ue=getConfig(e,u).line;if(ue){for(let gn=u;gn<=d;){let nh=e.doc.lineAt(gn);if(nh.from>c&&(u==d||d>nh.from)){c=nh.from;let ih=/^\s*/.exec(nh.text)[0].length,rh=ih==nh.length,oh=nh.text.slice(ih,ih+ue.length)==ue?ih:-1;ih<nh.text.length&&ih<_&&(_=ih),s.push({line:nh,comment:oh,token:ue,indent:ih,empty:rh,single:!1})}gn=nh.to+1}if(_<1e9)for(let gn=m;gn<s.length;gn++)s[gn].indent<s[gn].line.text.length&&(s[gn].indent=_);s.length==m+1&&(s[m].single=!0)}}if(n!=2&&s.some(u=>u.comment<0&&(!u.empty||u.single))){let u=[];for(let{line:m,token:_,indent:ue,empty:gn,single:nh}of s)(nh||!gn)&&u.push({from:m.from+ue,insert:_+" "});let d=e.changes(u);return{changes:d,selection:e.selection.map(d,1)}}else if(n!=1&&s.some(u=>u.comment>=0)){let u=[];for(let{line:d,comment:m,token:_}of s)if(m>=0){let ue=d.from+m,gn=ue+_.length;d.text[gn-d.from]==" "&&gn++,u.push({from:ue,to:gn})}return{changes:u}}return null}const fromHistory=Annotation.define(),isolateHistory=Annotation.define(),invertedEffects=Facet.define(),historyConfig=Facet.define({combine(n){return combineConfig(n,{minDepth:100,newGroupDelay:500,joinToEvent:(e,o)=>o},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,o)=>(s,c)=>e(s,c)||o(s,c)})}});function changeEnd(n){let e=0;return n.iterChangedRanges((o,s)=>e=s),e}const historyField_=StateField.define({create(){return HistoryState.empty},update(n,e){let o=e.state.facet(historyConfig),s=e.annotation(fromHistory);if(s){let _=e.docChanged?EditorSelection.single(changeEnd(e.changes)):void 0,ue=HistEvent.fromTransaction(e,_),gn=s.side,nh=gn==0?n.undone:n.done;return ue?nh=updateBranch(nh,nh.length,o.minDepth,ue):nh=addSelection(nh,e.startState.selection),new HistoryState(gn==0?s.rest:nh,gn==0?nh:s.rest)}let c=e.annotation(isolateHistory);if((c=="full"||c=="before")&&(n=n.isolate()),e.annotation(Transaction.addToHistory)===!1)return e.changes.empty?n:n.addMapping(e.changes.desc);let u=HistEvent.fromTransaction(e),d=e.annotation(Transaction.time),m=e.annotation(Transaction.userEvent);return u?n=n.addChanges(u,d,m,o,e):e.selection&&(n=n.addSelection(e.startState.selection,d,m,o.newGroupDelay)),(c=="full"||c=="after")&&(n=n.isolate()),n},toJSON(n){return{done:n.done.map(e=>e.toJSON()),undone:n.undone.map(e=>e.toJSON())}},fromJSON(n){return new HistoryState(n.done.map(HistEvent.fromJSON),n.undone.map(HistEvent.fromJSON))}});function history$1(n={}){return[historyField_,historyConfig.of(n),EditorView.domEventHandlers({beforeinput(e,o){let s=e.inputType=="historyUndo"?undo:e.inputType=="historyRedo"?redo:null;return s?(e.preventDefault(),s(o)):!1}})]}function cmd(n,e){return function({state:o,dispatch:s}){if(!e&&o.readOnly)return!1;let c=o.field(historyField_,!1);if(!c)return!1;let u=c.pop(n,o,e);return u?(s(u),!0):!1}}const undo=cmd(0,!1),redo=cmd(1,!1),undoSelection=cmd(0,!0),redoSelection=cmd(1,!0);class HistEvent{constructor(e,o,s,c,u){this.changes=e,this.effects=o,this.mapped=s,this.startSelection=c,this.selectionsAfter=u}setSelAfter(e){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,o,s;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(o=this.mapped)===null||o===void 0?void 0:o.toJSON(),startSelection:(s=this.startSelection)===null||s===void 0?void 0:s.toJSON(),selectionsAfter:this.selectionsAfter.map(c=>c.toJSON())}}static fromJSON(e){return new HistEvent(e.changes&&ChangeSet.fromJSON(e.changes),[],e.mapped&&ChangeDesc.fromJSON(e.mapped),e.startSelection&&EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(EditorSelection.fromJSON))}static fromTransaction(e,o){let s=none$1;for(let c of e.startState.facet(invertedEffects)){let u=c(e);u.length&&(s=s.concat(u))}return!s.length&&e.changes.empty?null:new HistEvent(e.changes.invert(e.startState.doc),s,void 0,o||e.startState.selection,none$1)}static selection(e){return new HistEvent(void 0,none$1,void 0,void 0,e)}}function updateBranch(n,e,o,s){let c=e+1>o+20?e-o-1:0,u=n.slice(c,e);return u.push(s),u}function isAdjacent(n,e){let o=[],s=!1;return n.iterChangedRanges((c,u)=>o.push(c,u)),e.iterChangedRanges((c,u,d,m)=>{for(let _=0;_<o.length;){let ue=o[_++],gn=o[_++];m>=ue&&d<=gn&&(s=!0)}}),s}function eqSelectionShape(n,e){return n.ranges.length==e.ranges.length&&n.ranges.filter((o,s)=>o.empty!=e.ranges[s].empty).length===0}function conc(n,e){return n.length?e.length?n.concat(e):n:e}const none$1=[],MaxSelectionsPerEvent=200;function addSelection(n,e){if(n.length){let o=n[n.length-1],s=o.selectionsAfter.slice(Math.max(0,o.selectionsAfter.length-MaxSelectionsPerEvent));return s.length&&s[s.length-1].eq(e)?n:(s.push(e),updateBranch(n,n.length-1,1e9,o.setSelAfter(s)))}else return[HistEvent.selection([e])]}function popSelection(n){let e=n[n.length-1],o=n.slice();return o[n.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),o}function addMappingToBranch(n,e){if(!n.length)return n;let o=n.length,s=none$1;for(;o;){let c=mapEvent(n[o-1],e,s);if(c.changes&&!c.changes.empty||c.effects.length){let u=n.slice(0,o);return u[o-1]=c,u}else e=c.mapped,o--,s=c.selectionsAfter}return s.length?[HistEvent.selection(s)]:none$1}function mapEvent(n,e,o){let s=conc(n.selectionsAfter.length?n.selectionsAfter.map(m=>m.map(e)):none$1,o);if(!n.changes)return HistEvent.selection(s);let c=n.changes.map(e),u=e.mapDesc(n.changes,!0),d=n.mapped?n.mapped.composeDesc(u):u;return new HistEvent(c,StateEffect.mapEffects(n.effects,e),d,n.startSelection.map(u),s)}const joinableUserEvent=/^(input\.type|delete)($|\.)/;class HistoryState{constructor(e,o,s=0,c=void 0){this.done=e,this.undone=o,this.prevTime=s,this.prevUserEvent=c}isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this}addChanges(e,o,s,c,u){let d=this.done,m=d[d.length-1];return m&&m.changes&&!m.changes.empty&&e.changes&&(!s||joinableUserEvent.test(s))&&(!m.selectionsAfter.length&&o-this.prevTime<c.newGroupDelay&&c.joinToEvent(u,isAdjacent(m.changes,e.changes))||s=="input.type.compose")?d=updateBranch(d,d.length-1,c.minDepth,new HistEvent(e.changes.compose(m.changes),conc(e.effects,m.effects),m.mapped,m.startSelection,none$1)):d=updateBranch(d,d.length,c.minDepth,e),new HistoryState(d,none$1,o,s)}addSelection(e,o,s,c){let u=this.done.length?this.done[this.done.length-1].selectionsAfter:none$1;return u.length>0&&o-this.prevTime<c&&s==this.prevUserEvent&&s&&/^select($|\.)/.test(s)&&eqSelectionShape(u[u.length-1],e)?this:new HistoryState(addSelection(this.done,e),this.undone,o,s)}addMapping(e){return new HistoryState(addMappingToBranch(this.done,e),addMappingToBranch(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,o,s){let c=e==0?this.done:this.undone;if(c.length==0)return null;let u=c[c.length-1];if(s&&u.selectionsAfter.length)return o.update({selection:u.selectionsAfter[u.selectionsAfter.length-1],annotations:fromHistory.of({side:e,rest:popSelection(c)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(u.changes){let d=c.length==1?none$1:c.slice(0,c.length-1);return u.mapped&&(d=addMappingToBranch(d,u.mapped)),o.update({changes:u.changes,selection:u.startSelection,effects:u.effects,annotations:fromHistory.of({side:e,rest:d}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}HistoryState.empty=new HistoryState(none$1,none$1);const historyKeymap=[{key:"Mod-z",run:undo,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:!0},{linux:"Ctrl-Shift-z",run:redo,preventDefault:!0},{key:"Mod-u",run:undoSelection,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:!0}];function updateSel(n,e){return EditorSelection.create(n.ranges.map(e),n.mainIndex)}function setSel(n,e){return n.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function moveSel({state:n,dispatch:e},o){let s=updateSel(n.selection,o);return s.eq(n.selection)?!1:(e(setSel(n,s)),!0)}function rangeEnd(n,e){return EditorSelection.cursor(e?n.to:n.from)}function cursorByChar(n,e){return moveSel(n,o=>o.empty?n.moveByChar(o,e):rangeEnd(o,e))}function ltrAtCursor(n){return n.textDirectionAt(n.state.selection.main.head)==Direction.LTR}const cursorCharLeft=n=>cursorByChar(n,!ltrAtCursor(n)),cursorCharRight=n=>cursorByChar(n,ltrAtCursor(n));function cursorByGroup(n,e){return moveSel(n,o=>o.empty?n.moveByGroup(o,e):rangeEnd(o,e))}const cursorGroupLeft=n=>cursorByGroup(n,!ltrAtCursor(n)),cursorGroupRight=n=>cursorByGroup(n,ltrAtCursor(n));function interestingNode(n,e,o){if(e.type.prop(o))return!0;let s=e.to-e.from;return s&&(s>2||/[^\s,.;:]/.test(n.sliceDoc(e.from,e.to)))||e.firstChild}function moveBySyntax(n,e,o){let s=syntaxTree(n).resolveInner(e.head),c=o?NodeProp.closedBy:NodeProp.openedBy;for(let _=e.head;;){let ue=o?s.childAfter(_):s.childBefore(_);if(!ue)break;interestingNode(n,ue,c)?s=ue:_=o?ue.to:ue.from}let u=s.type.prop(c),d,m;return u&&(d=o?matchBrackets(n,s.from,1):matchBrackets(n,s.to,-1))&&d.matched?m=o?d.end.to:d.end.from:m=o?s.to:s.from,EditorSelection.cursor(m,o?-1:1)}const cursorSyntaxLeft=n=>moveSel(n,e=>moveBySyntax(n.state,e,!ltrAtCursor(n))),cursorSyntaxRight=n=>moveSel(n,e=>moveBySyntax(n.state,e,ltrAtCursor(n)));function cursorByLine(n,e){return moveSel(n,o=>{if(!o.empty)return rangeEnd(o,e);let s=n.moveVertically(o,e);return s.head!=o.head?s:n.moveToLineBoundary(o,e)})}const cursorLineUp=n=>cursorByLine(n,!1),cursorLineDown=n=>cursorByLine(n,!0);function pageInfo(n){let e=n.scrollDOM.clientHeight<n.scrollDOM.scrollHeight-2,o=0,s=0,c;if(e){for(let u of n.state.facet(EditorView.scrollMargins)){let d=u(n);d!=null&&d.top&&(o=Math.max(d==null?void 0:d.top,o)),d!=null&&d.bottom&&(s=Math.max(d==null?void 0:d.bottom,s))}c=n.scrollDOM.clientHeight-o-s}else c=(n.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:o,marginBottom:s,selfScroll:e,height:Math.max(n.defaultLineHeight,c-5)}}function cursorByPage(n,e){let o=pageInfo(n),{state:s}=n,c=updateSel(s.selection,d=>d.empty?n.moveVertically(d,e,o.height):rangeEnd(d,e));if(c.eq(s.selection))return!1;let u;if(o.selfScroll){let d=n.coordsAtPos(s.selection.main.head),m=n.scrollDOM.getBoundingClientRect(),_=m.top+o.marginTop,ue=m.bottom-o.marginBottom;d&&d.top>_&&d.bottom<ue&&(u=EditorView.scrollIntoView(c.main.head,{y:"start",yMargin:d.top-_}))}return n.dispatch(setSel(s,c),{effects:u}),!0}const cursorPageUp=n=>cursorByPage(n,!1),cursorPageDown=n=>cursorByPage(n,!0);function moveByLineBoundary(n,e,o){let s=n.lineBlockAt(e.head),c=n.moveToLineBoundary(e,o);if(c.head==e.head&&c.head!=(o?s.to:s.from)&&(c=n.moveToLineBoundary(e,o,!1)),!o&&c.head==s.from&&s.length){let u=/^\s*/.exec(n.state.sliceDoc(s.from,Math.min(s.from+100,s.to)))[0].length;u&&e.head!=s.from+u&&(c=EditorSelection.cursor(s.from+u))}return c}const cursorLineBoundaryForward=n=>moveSel(n,e=>moveByLineBoundary(n,e,!0)),cursorLineBoundaryBackward=n=>moveSel(n,e=>moveByLineBoundary(n,e,!1)),cursorLineBoundaryLeft=n=>moveSel(n,e=>moveByLineBoundary(n,e,!ltrAtCursor(n))),cursorLineBoundaryRight=n=>moveSel(n,e=>moveByLineBoundary(n,e,ltrAtCursor(n))),cursorLineStart=n=>moveSel(n,e=>EditorSelection.cursor(n.lineBlockAt(e.head).from,1)),cursorLineEnd=n=>moveSel(n,e=>EditorSelection.cursor(n.lineBlockAt(e.head).to,-1));function toMatchingBracket(n,e,o){let s=!1,c=updateSel(n.selection,u=>{let d=matchBrackets(n,u.head,-1)||matchBrackets(n,u.head,1)||u.head>0&&matchBrackets(n,u.head-1,1)||u.head<n.doc.length&&matchBrackets(n,u.head+1,-1);if(!d||!d.end)return u;s=!0;let m=d.start.from==u.head?d.end.to:d.end.from;return o?EditorSelection.range(u.anchor,m):EditorSelection.cursor(m)});return s?(e(setSel(n,c)),!0):!1}const cursorMatchingBracket=({state:n,dispatch:e})=>toMatchingBracket(n,e,!1);function extendSel(n,e){let o=updateSel(n.state.selection,s=>{let c=e(s);return EditorSelection.range(s.anchor,c.head,c.goalColumn,c.bidiLevel||void 0)});return o.eq(n.state.selection)?!1:(n.dispatch(setSel(n.state,o)),!0)}function selectByChar(n,e){return extendSel(n,o=>n.moveByChar(o,e))}const selectCharLeft=n=>selectByChar(n,!ltrAtCursor(n)),selectCharRight=n=>selectByChar(n,ltrAtCursor(n));function selectByGroup(n,e){return extendSel(n,o=>n.moveByGroup(o,e))}const selectGroupLeft=n=>selectByGroup(n,!ltrAtCursor(n)),selectGroupRight=n=>selectByGroup(n,ltrAtCursor(n)),selectSyntaxLeft=n=>extendSel(n,e=>moveBySyntax(n.state,e,!ltrAtCursor(n))),selectSyntaxRight=n=>extendSel(n,e=>moveBySyntax(n.state,e,ltrAtCursor(n)));function selectByLine(n,e){return extendSel(n,o=>n.moveVertically(o,e))}const selectLineUp=n=>selectByLine(n,!1),selectLineDown=n=>selectByLine(n,!0);function selectByPage(n,e){return extendSel(n,o=>n.moveVertically(o,e,pageInfo(n).height))}const selectPageUp=n=>selectByPage(n,!1),selectPageDown=n=>selectByPage(n,!0),selectLineBoundaryForward=n=>extendSel(n,e=>moveByLineBoundary(n,e,!0)),selectLineBoundaryBackward=n=>extendSel(n,e=>moveByLineBoundary(n,e,!1)),selectLineBoundaryLeft=n=>extendSel(n,e=>moveByLineBoundary(n,e,!ltrAtCursor(n))),selectLineBoundaryRight=n=>extendSel(n,e=>moveByLineBoundary(n,e,ltrAtCursor(n))),selectLineStart=n=>extendSel(n,e=>EditorSelection.cursor(n.lineBlockAt(e.head).from)),selectLineEnd=n=>extendSel(n,e=>EditorSelection.cursor(n.lineBlockAt(e.head).to)),cursorDocStart=({state:n,dispatch:e})=>(e(setSel(n,{anchor:0})),!0),cursorDocEnd=({state:n,dispatch:e})=>(e(setSel(n,{anchor:n.doc.length})),!0),selectDocStart=({state:n,dispatch:e})=>(e(setSel(n,{anchor:n.selection.main.anchor,head:0})),!0),selectDocEnd=({state:n,dispatch:e})=>(e(setSel(n,{anchor:n.selection.main.anchor,head:n.doc.length})),!0),selectAll=({state:n,dispatch:e})=>(e(n.update({selection:{anchor:0,head:n.doc.length},userEvent:"select"})),!0),selectLine=({state:n,dispatch:e})=>{let o=selectedLineBlocks(n).map(({from:s,to:c})=>EditorSelection.range(s,Math.min(c+1,n.doc.length)));return e(n.update({selection:EditorSelection.create(o),userEvent:"select"})),!0},selectParentSyntax=({state:n,dispatch:e})=>{let o=updateSel(n.selection,s=>{var c;let u=syntaxTree(n).resolveInner(s.head,1);for(;!(u.from<s.from&&u.to>=s.to||u.to>s.to&&u.from<=s.from||!(!((c=u.parent)===null||c===void 0)&&c.parent));)u=u.parent;return EditorSelection.range(u.to,u.from)});return e(setSel(n,o)),!0},simplifySelection=({state:n,dispatch:e})=>{let o=n.selection,s=null;return o.ranges.length>1?s=EditorSelection.create([o.main]):o.main.empty||(s=EditorSelection.create([EditorSelection.cursor(o.main.head)])),s?(e(setSel(n,s)),!0):!1};function deleteBy(n,e){if(n.state.readOnly)return!1;let o="delete.selection",{state:s}=n,c=s.changeByRange(u=>{let{from:d,to:m}=u;if(d==m){let _=e(d);_<d?(o="delete.backward",_=skipAtomic(n,_,!1)):_>d&&(o="delete.forward",_=skipAtomic(n,_,!0)),d=Math.min(d,_),m=Math.max(m,_)}else d=skipAtomic(n,d,!1),m=skipAtomic(n,m,!0);return d==m?{range:u}:{changes:{from:d,to:m},range:EditorSelection.cursor(d)}});return c.changes.empty?!1:(n.dispatch(s.update(c,{scrollIntoView:!0,userEvent:o,effects:o=="delete.selection"?EditorView.announce.of(s.phrase("Selection deleted")):void 0})),!0)}function skipAtomic(n,e,o){if(n instanceof EditorView)for(let s of n.state.facet(EditorView.atomicRanges).map(c=>c(n)))s.between(e,e,(c,u)=>{c<e&&u>e&&(e=o?u:c)});return e}const deleteByChar=(n,e)=>deleteBy(n,o=>{let{state:s}=n,c=s.doc.lineAt(o),u,d;if(!e&&o>c.from&&o<c.from+200&&!/[^ \t]/.test(u=c.text.slice(0,o-c.from))){if(u[u.length-1]=="	")return o-1;let m=countColumn(u,s.tabSize),_=m%getIndentUnit(s)||getIndentUnit(s);for(let ue=0;ue<_&&u[u.length-1-ue]==" ";ue++)o--;d=o}else d=findClusterBreak(c.text,o-c.from,e,e)+c.from,d==o&&c.number!=(e?s.doc.lines:1)&&(d+=e?1:-1);return d}),deleteCharBackward=n=>deleteByChar(n,!1),deleteCharForward=n=>deleteByChar(n,!0),deleteByGroup=(n,e)=>deleteBy(n,o=>{let s=o,{state:c}=n,u=c.doc.lineAt(s),d=c.charCategorizer(s);for(let m=null;;){if(s==(e?u.to:u.from)){s==o&&u.number!=(e?c.doc.lines:1)&&(s+=e?1:-1);break}let _=findClusterBreak(u.text,s-u.from,e)+u.from,ue=u.text.slice(Math.min(s,_)-u.from,Math.max(s,_)-u.from),gn=d(ue);if(m!=null&&gn!=m)break;(ue!=" "||s!=o)&&(m=gn),s=_}return s}),deleteGroupBackward=n=>deleteByGroup(n,!1),deleteGroupForward=n=>deleteByGroup(n,!0),deleteToLineEnd=n=>deleteBy(n,e=>{let o=n.lineBlockAt(e).to;return e<o?o:Math.min(n.state.doc.length,e+1)}),deleteToLineStart=n=>deleteBy(n,e=>{let o=n.lineBlockAt(e).from;return e>o?o:Math.max(0,e-1)}),splitLine=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let o=n.changeByRange(s=>({changes:{from:s.from,to:s.to,insert:Text.of(["",""])},range:EditorSelection.cursor(s.from)}));return e(n.update(o,{scrollIntoView:!0,userEvent:"input"})),!0},transposeChars=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let o=n.changeByRange(s=>{if(!s.empty||s.from==0||s.from==n.doc.length)return{range:s};let c=s.from,u=n.doc.lineAt(c),d=c==u.from?c-1:findClusterBreak(u.text,c-u.from,!1)+u.from,m=c==u.to?c+1:findClusterBreak(u.text,c-u.from,!0)+u.from;return{changes:{from:d,to:m,insert:n.doc.slice(c,m).append(n.doc.slice(d,c))},range:EditorSelection.cursor(m)}});return o.changes.empty?!1:(e(n.update(o,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function selectedLineBlocks(n){let e=[],o=-1;for(let s of n.selection.ranges){let c=n.doc.lineAt(s.from),u=n.doc.lineAt(s.to);if(!s.empty&&s.to==u.from&&(u=n.doc.lineAt(s.to-1)),o>=c.number){let d=e[e.length-1];d.to=u.to,d.ranges.push(s)}else e.push({from:c.from,to:u.to,ranges:[s]});o=u.number+1}return e}function moveLine(n,e,o){if(n.readOnly)return!1;let s=[],c=[];for(let u of selectedLineBlocks(n)){if(o?u.to==n.doc.length:u.from==0)continue;let d=n.doc.lineAt(o?u.to+1:u.from-1),m=d.length+1;if(o){s.push({from:u.to,to:d.to},{from:u.from,insert:d.text+n.lineBreak});for(let _ of u.ranges)c.push(EditorSelection.range(Math.min(n.doc.length,_.anchor+m),Math.min(n.doc.length,_.head+m)))}else{s.push({from:d.from,to:u.from},{from:u.to,insert:n.lineBreak+d.text});for(let _ of u.ranges)c.push(EditorSelection.range(_.anchor-m,_.head-m))}}return s.length?(e(n.update({changes:s,scrollIntoView:!0,selection:EditorSelection.create(c,n.selection.mainIndex),userEvent:"move.line"})),!0):!1}const moveLineUp=({state:n,dispatch:e})=>moveLine(n,e,!1),moveLineDown=({state:n,dispatch:e})=>moveLine(n,e,!0);function copyLine(n,e,o){if(n.readOnly)return!1;let s=[];for(let c of selectedLineBlocks(n))o?s.push({from:c.from,insert:n.doc.slice(c.from,c.to)+n.lineBreak}):s.push({from:c.to,insert:n.lineBreak+n.doc.slice(c.from,c.to)});return e(n.update({changes:s,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const copyLineUp=({state:n,dispatch:e})=>copyLine(n,e,!1),copyLineDown=({state:n,dispatch:e})=>copyLine(n,e,!0),deleteLine=n=>{if(n.state.readOnly)return!1;let{state:e}=n,o=e.changes(selectedLineBlocks(e).map(({from:c,to:u})=>(c>0?c--:u<e.doc.length&&u++,{from:c,to:u}))),s=updateSel(e.selection,c=>n.moveVertically(c,!0)).map(o);return n.dispatch({changes:o,selection:s,scrollIntoView:!0,userEvent:"delete.line"}),!0};function isBetweenBrackets(n,e){if(/\(\)|\[\]|\{\}/.test(n.sliceDoc(e-1,e+1)))return{from:e,to:e};let o=syntaxTree(n).resolveInner(e),s=o.childBefore(e),c=o.childAfter(e),u;return s&&c&&s.to<=e&&c.from>=e&&(u=s.type.prop(NodeProp.closedBy))&&u.indexOf(c.name)>-1&&n.doc.lineAt(s.to).from==n.doc.lineAt(c.from).from?{from:s.to,to:c.from}:null}const insertNewlineAndIndent=newlineAndIndent(!1),insertBlankLine=newlineAndIndent(!0);function newlineAndIndent(n){return({state:e,dispatch:o})=>{if(e.readOnly)return!1;let s=e.changeByRange(c=>{let{from:u,to:d}=c,m=e.doc.lineAt(u),_=!n&&u==d&&isBetweenBrackets(e,u);n&&(u=d=(d<=m.to?m:e.doc.lineAt(d)).to);let ue=new IndentContext(e,{simulateBreak:u,simulateDoubleBreak:!!_}),gn=getIndentation(ue,u);for(gn==null&&(gn=/^\s*/.exec(e.doc.lineAt(u).text)[0].length);d<m.to&&/\s/.test(m.text[d-m.from]);)d++;_?{from:u,to:d}=_:u>m.from&&u<m.from+100&&!/\S/.test(m.text.slice(0,u))&&(u=m.from);let nh=["",indentString(e,gn)];return _&&nh.push(indentString(e,ue.lineIndent(m.from,-1))),{changes:{from:u,to:d,insert:Text.of(nh)},range:EditorSelection.cursor(u+1+nh[1].length)}});return o(e.update(s,{scrollIntoView:!0,userEvent:"input"})),!0}}function changeBySelectedLine(n,e){let o=-1;return n.changeByRange(s=>{let c=[];for(let d=s.from;d<=s.to;){let m=n.doc.lineAt(d);m.number>o&&(s.empty||s.to>m.from)&&(e(m,c,s),o=m.number),d=m.to+1}let u=n.changes(c);return{changes:c,range:EditorSelection.range(u.mapPos(s.anchor,1),u.mapPos(s.head,1))}})}const indentSelection=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let o=Object.create(null),s=new IndentContext(n,{overrideIndentation:u=>{let d=o[u];return d??-1}}),c=changeBySelectedLine(n,(u,d,m)=>{let _=getIndentation(s,u.from);if(_==null)return;/\S/.test(u.text)||(_=0);let ue=/^\s*/.exec(u.text)[0],gn=indentString(n,_);(ue!=gn||m.from<u.from+ue.length)&&(o[u.from]=_,d.push({from:u.from,to:u.from+ue.length,insert:gn}))});return c.changes.empty||e(n.update(c,{userEvent:"indent"})),!0},indentMore=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(changeBySelectedLine(n,(o,s)=>{s.push({from:o.from,insert:n.facet(indentUnit)})}),{userEvent:"input.indent"})),!0),indentLess=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(changeBySelectedLine(n,(o,s)=>{let c=/^\s*/.exec(o.text)[0];if(!c)return;let u=countColumn(c,n.tabSize),d=0,m=indentString(n,Math.max(0,u-getIndentUnit(n)));for(;d<c.length&&d<m.length&&c.charCodeAt(d)==m.charCodeAt(d);)d++;s.push({from:o.from+d,to:o.from+c.length,insert:m.slice(d)})}),{userEvent:"delete.dedent"})),!0),emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}],standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:!0},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:!0},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:!0},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:!0},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:!0},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:!0},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:!0},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteToLineStart},{mac:"Mod-Delete",run:deleteToLineEnd}].concat(emacsStyleKeymap.map(n=>({mac:n.key,run:n.run,shift:n.shift}))),defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:!0},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment}].concat(standardKeymap),indentWithTab={key:"Tab",run:indentMore,shift:indentLess};function crelt(){var n=arguments[0];typeof n=="string"&&(n=document.createElement(n));var e=1,o=arguments[1];if(o&&typeof o=="object"&&o.nodeType==null&&!Array.isArray(o)){for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){var c=o[s];typeof c=="string"?n.setAttribute(s,c):c!=null&&(n[s]=c)}e++}for(;e<arguments.length;e++)add(n,arguments[e]);return n}function add(n,e){if(typeof e=="string")n.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)n.appendChild(e);else if(Array.isArray(e))for(var o=0;o<e.length;o++)add(n,e[o]);else throw new RangeError("Unsupported child node: "+e)}const basicNormalize=typeof String.prototype.normalize=="function"?n=>n.normalize("NFKD"):n=>n;class SearchCursor{constructor(e,o,s=0,c=e.length,u,d){this.test=d,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(s,c),this.bufferStart=s,this.normalize=u?m=>u(basicNormalize(m)):basicNormalize,this.query=this.normalize(o)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return codePointAt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let o=fromCodePoint(e),s=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(e);let c=this.normalize(o);for(let u=0,d=s;;u++){let m=c.charCodeAt(u),_=this.match(m,d);if(_)return this.value=_,this;if(u==c.length-1)break;d==s&&u<o.length&&o.charCodeAt(u)==m&&d++}}}match(e,o){let s=null;for(let c=0;c<this.matches.length;c+=2){let u=this.matches[c],d=!1;this.query.charCodeAt(u)==e&&(u==this.query.length-1?s={from:this.matches[c+1],to:o+1}:(this.matches[c]++,d=!0)),d||(this.matches.splice(c,2),c-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?s={from:o,to:o+1}:this.matches.push(1,o)),s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferPos)&&(s=null),s}}typeof Symbol<"u"&&(SearchCursor.prototype[Symbol.iterator]=function(){return this});const empty={from:-1,to:-1,match:/.*/.exec("")},baseFlags="gm"+(/x/.unicode==null?"":"u");class RegExpCursor{constructor(e,o,s,c=0,u=e.length){if(this.text=e,this.to=u,this.curLine="",this.done=!1,this.value=empty,/\\[sWDnr]|\n|\r|\[\^/.test(o))return new MultilineRegExpCursor(e,o,s,c,u);this.re=new RegExp(o,baseFlags+(s!=null&&s.ignoreCase?"i":"")),this.test=s==null?void 0:s.test,this.iter=e.iter();let d=e.lineAt(c);this.curLineStart=d.from,this.matchPos=toCharEnd(e,c),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let o=this.matchPos<=this.to&&this.re.exec(this.curLine);if(o){let s=this.curLineStart+o.index,c=s+o[0].length;if(this.matchPos=toCharEnd(this.text,c+(s==c?1:0)),s==this.curLineStart+this.curLine.length&&this.nextLine(),(s<c||s>this.value.to)&&(!this.test||this.test(s,c,o)))return this.value={from:s,to:c,match:o},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const flattened=new WeakMap;class FlattenedDoc{constructor(e,o){this.from=e,this.text=o}get to(){return this.from+this.text.length}static get(e,o,s){let c=flattened.get(e);if(!c||c.from>=s||c.to<=o){let m=new FlattenedDoc(o,e.sliceString(o,s));return flattened.set(e,m),m}if(c.from==o&&c.to==s)return c;let{text:u,from:d}=c;return d>o&&(u=e.sliceString(o,d)+u,d=o),c.to<s&&(u+=e.sliceString(c.to,s)),flattened.set(e,new FlattenedDoc(d,u)),new FlattenedDoc(o,u.slice(o-d,s-d))}}class MultilineRegExpCursor{constructor(e,o,s,c,u){this.text=e,this.to=u,this.done=!1,this.value=empty,this.matchPos=toCharEnd(e,c),this.re=new RegExp(o,baseFlags+(s!=null&&s.ignoreCase?"i":"")),this.test=s==null?void 0:s.test,this.flat=FlattenedDoc.get(e,c,this.chunkEnd(c+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,o=this.re.exec(this.flat.text);if(o&&!o[0]&&o.index==e&&(this.re.lastIndex=e+1,o=this.re.exec(this.flat.text)),o){let s=this.flat.from+o.index,c=s+o[0].length;if((this.flat.to>=this.to||o.index+o[0].length<=this.flat.text.length-10)&&(!this.test||this.test(s,c,o)))return this.value={from:s,to:c,match:o},this.matchPos=toCharEnd(this.text,c+(s==c?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this});function validRegExp(n){try{return new RegExp(n,baseFlags),!0}catch{return!1}}function toCharEnd(n,e){if(e>=n.length)return e;let o=n.lineAt(e),s;for(;e<o.to&&(s=o.text.charCodeAt(e-o.from))>=56320&&s<57344;)e++;return e}function createLineDialog(n){let e=crelt("input",{class:"cm-textfield",name:"line"}),o=crelt("form",{class:"cm-gotoLine",onkeydown:c=>{c.keyCode==27?(c.preventDefault(),n.dispatch({effects:dialogEffect.of(!1)}),n.focus()):c.keyCode==13&&(c.preventDefault(),s())},onsubmit:c=>{c.preventDefault(),s()}},crelt("label",n.state.phrase("Go to line"),": ",e)," ",crelt("button",{class:"cm-button",type:"submit"},n.state.phrase("go")));function s(){let c=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!c)return;let{state:u}=n,d=u.doc.lineAt(u.selection.main.head),[,m,_,ue,gn]=c,nh=ue?+ue.slice(1):0,ih=_?+_:d.number;if(_&&gn){let oh=ih/100;m&&(oh=oh*(m=="-"?-1:1)+d.number/u.doc.lines),ih=Math.round(u.doc.lines*oh)}else _&&m&&(ih=ih*(m=="-"?-1:1)+d.number);let rh=u.doc.line(Math.max(1,Math.min(u.doc.lines,ih)));n.dispatch({effects:dialogEffect.of(!1),selection:EditorSelection.cursor(rh.from+Math.max(0,Math.min(nh,rh.length))),scrollIntoView:!0}),n.focus()}return{dom:o}}const dialogEffect=StateEffect.define(),dialogField=StateField.define({create(){return!0},update(n,e){for(let o of e.effects)o.is(dialogEffect)&&(n=o.value);return n},provide:n=>showPanel.from(n,e=>e?createLineDialog:null)}),gotoLine=n=>{let e=getPanel(n,createLineDialog);if(!e){let o=[dialogEffect.of(!0)];n.state.field(dialogField,!1)==null&&o.push(StateEffect.appendConfig.of([dialogField,baseTheme$1$1])),n.dispatch({effects:o}),e=getPanel(n,createLineDialog)}return e&&e.dom.querySelector("input").focus(),!0},baseTheme$1$1=EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),defaultHighlightOptions={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},highlightConfig=Facet.define({combine(n){return combineConfig(n,defaultHighlightOptions,{highlightWordAroundCursor:(e,o)=>e||o,minSelectionLength:Math.min,maxMatches:Math.min})}});function highlightSelectionMatches(n){let e=[defaultTheme,matchHighlighter];return n&&e.push(highlightConfig.of(n)),e}const matchDeco=Decoration.mark({class:"cm-selectionMatch"}),mainMatchDeco=Decoration.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function insideWordBoundaries(n,e,o,s){return(o==0||n(e.sliceDoc(o-1,o))!=CharCategory.Word)&&(s==e.doc.length||n(e.sliceDoc(s,s+1))!=CharCategory.Word)}function insideWord(n,e,o,s){return n(e.sliceDoc(o,o+1))==CharCategory.Word&&n(e.sliceDoc(s-1,s))==CharCategory.Word}const matchHighlighter=ViewPlugin.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.selectionSet||n.docChanged||n.viewportChanged)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=n.state.facet(highlightConfig),{state:o}=n,s=o.selection;if(s.ranges.length>1)return Decoration.none;let c=s.main,u,d=null;if(c.empty){if(!e.highlightWordAroundCursor)return Decoration.none;let _=o.wordAt(c.head);if(!_)return Decoration.none;d=o.charCategorizer(c.head),u=o.sliceDoc(_.from,_.to)}else{let _=c.to-c.from;if(_<e.minSelectionLength||_>200)return Decoration.none;if(e.wholeWords){if(u=o.sliceDoc(c.from,c.to),d=o.charCategorizer(c.head),!(insideWordBoundaries(d,o,c.from,c.to)&&insideWord(d,o,c.from,c.to)))return Decoration.none}else if(u=o.sliceDoc(c.from,c.to).trim(),!u)return Decoration.none}let m=[];for(let _ of n.visibleRanges){let ue=new SearchCursor(o.doc,u,_.from,_.to);for(;!ue.next().done;){let{from:gn,to:nh}=ue.value;if((!d||insideWordBoundaries(d,o,gn,nh))&&(c.empty&&gn<=c.from&&nh>=c.to?m.push(mainMatchDeco.range(gn,nh)):(gn>=c.to||nh<=c.from)&&m.push(matchDeco.range(gn,nh)),m.length>e.maxMatches))return Decoration.none}}return Decoration.set(m)}},{decorations:n=>n.decorations}),defaultTheme=EditorView.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),selectWord=({state:n,dispatch:e})=>{let{selection:o}=n,s=EditorSelection.create(o.ranges.map(c=>n.wordAt(c.head)||EditorSelection.cursor(c.head)),o.mainIndex);return s.eq(o)?!1:(e(n.update({selection:s})),!0)};function findNextOccurrence(n,e){let{main:o,ranges:s}=n.selection,c=n.wordAt(o.head),u=c&&c.from==o.from&&c.to==o.to;for(let d=!1,m=new SearchCursor(n.doc,e,s[s.length-1].to);;)if(m.next(),m.done){if(d)return null;m=new SearchCursor(n.doc,e,0,Math.max(0,s[s.length-1].from-1)),d=!0}else{if(d&&s.some(_=>_.from==m.value.from))continue;if(u){let _=n.wordAt(m.value.from);if(!_||_.from!=m.value.from||_.to!=m.value.to)continue}return m.value}}const selectNextOccurrence=({state:n,dispatch:e})=>{let{ranges:o}=n.selection;if(o.some(u=>u.from===u.to))return selectWord({state:n,dispatch:e});let s=n.sliceDoc(o[0].from,o[0].to);if(n.selection.ranges.some(u=>n.sliceDoc(u.from,u.to)!=s))return!1;let c=findNextOccurrence(n,s);return c?(e(n.update({selection:n.selection.addRange(EditorSelection.range(c.from,c.to),!1),effects:EditorView.scrollIntoView(c.to)})),!0):!1},searchConfigFacet=Facet.define({combine(n){return combineConfig(n,{top:!1,caseSensitive:!1,literal:!1,wholeWord:!1,createPanel:e=>new SearchPanel(e),scrollToMatch:e=>EditorView.scrollIntoView(e)})}});class SearchQuery{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||validRegExp(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(o,s)=>s=="n"?`
`:s=="r"?"\r":s=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new RegExpQuery(this):new StringQuery(this)}getCursor(e,o=0,s){let c=e.doc?e:EditorState.create({doc:e});return s==null&&(s=c.doc.length),this.regexp?regexpCursor(this,c,o,s):stringCursor(this,c,o,s)}}class QueryType{constructor(e){this.spec=e}}function stringCursor(n,e,o,s){return new SearchCursor(e.doc,n.unquoted,o,s,n.caseSensitive?void 0:c=>c.toLowerCase(),n.wholeWord?stringWordTest(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function stringWordTest(n,e){return(o,s,c,u)=>((u>o||u+c.length<s)&&(u=Math.max(0,o-2),c=n.sliceString(u,Math.min(n.length,s+2))),(e(charBefore(c,o-u))!=CharCategory.Word||e(charAfter(c,o-u))!=CharCategory.Word)&&(e(charAfter(c,s-u))!=CharCategory.Word||e(charBefore(c,s-u))!=CharCategory.Word))}class StringQuery extends QueryType{constructor(e){super(e)}nextMatch(e,o,s){let c=stringCursor(this.spec,e,s,e.doc.length).nextOverlapping();return c.done&&(c=stringCursor(this.spec,e,0,o).nextOverlapping()),c.done?null:c.value}prevMatchInRange(e,o,s){for(let c=s;;){let u=Math.max(o,c-1e4-this.spec.unquoted.length),d=stringCursor(this.spec,e,u,c),m=null;for(;!d.nextOverlapping().done;)m=d.value;if(m)return m;if(u==o)return null;c-=1e4}}prevMatch(e,o,s){return this.prevMatchInRange(e,0,o)||this.prevMatchInRange(e,s,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,o){let s=stringCursor(this.spec,e,0,e.doc.length),c=[];for(;!s.next().done;){if(c.length>=o)return null;c.push(s.value)}return c}highlight(e,o,s,c){let u=stringCursor(this.spec,e,Math.max(0,o-this.spec.unquoted.length),Math.min(s+this.spec.unquoted.length,e.doc.length));for(;!u.next().done;)c(u.value.from,u.value.to)}}function regexpCursor(n,e,o,s){return new RegExpCursor(e.doc,n.search,{ignoreCase:!n.caseSensitive,test:n.wholeWord?regexpWordTest(e.charCategorizer(e.selection.main.head)):void 0},o,s)}function charBefore(n,e){return n.slice(findClusterBreak(n,e,!1),e)}function charAfter(n,e){return n.slice(e,findClusterBreak(n,e))}function regexpWordTest(n){return(e,o,s)=>!s[0].length||(n(charBefore(s.input,s.index))!=CharCategory.Word||n(charAfter(s.input,s.index))!=CharCategory.Word)&&(n(charAfter(s.input,s.index+s[0].length))!=CharCategory.Word||n(charBefore(s.input,s.index+s[0].length))!=CharCategory.Word)}class RegExpQuery extends QueryType{nextMatch(e,o,s){let c=regexpCursor(this.spec,e,s,e.doc.length).next();return c.done&&(c=regexpCursor(this.spec,e,0,o).next()),c.done?null:c.value}prevMatchInRange(e,o,s){for(let c=1;;c++){let u=Math.max(o,s-c*1e4),d=regexpCursor(this.spec,e,u,s),m=null;for(;!d.next().done;)m=d.value;if(m&&(u==o||m.from>u+10))return m;if(u==o)return null}}prevMatch(e,o,s){return this.prevMatchInRange(e,0,o)||this.prevMatchInRange(e,s,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(o,s)=>s=="$"?"$":s=="&"?e.match[0]:s!="0"&&+s<e.match.length?e.match[s]:o))}matchAll(e,o){let s=regexpCursor(this.spec,e,0,e.doc.length),c=[];for(;!s.next().done;){if(c.length>=o)return null;c.push(s.value)}return c}highlight(e,o,s,c){let u=regexpCursor(this.spec,e,Math.max(0,o-250),Math.min(s+250,e.doc.length));for(;!u.next().done;)c(u.value.from,u.value.to)}}const setSearchQuery=StateEffect.define(),togglePanel$1=StateEffect.define(),searchState=StateField.define({create(n){return new SearchState(defaultQuery(n).create(),null)},update(n,e){for(let o of e.effects)o.is(setSearchQuery)?n=new SearchState(o.value.create(),n.panel):o.is(togglePanel$1)&&(n=new SearchState(n.query,o.value?createSearchPanel:null));return n},provide:n=>showPanel.from(n,e=>e.panel)});class SearchState{constructor(e,o){this.query=e,this.panel=o}}const matchMark=Decoration.mark({class:"cm-searchMatch"}),selectedMatchMark=Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"}),searchHighlighter=ViewPlugin.fromClass(class{constructor(n){this.view=n,this.decorations=this.highlight(n.state.field(searchState))}update(n){let e=n.state.field(searchState);(e!=n.startState.field(searchState)||n.docChanged||n.selectionSet||n.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:n,panel:e}){if(!e||!n.spec.valid)return Decoration.none;let{view:o}=this,s=new RangeSetBuilder;for(let c=0,u=o.visibleRanges,d=u.length;c<d;c++){let{from:m,to:_}=u[c];for(;c<d-1&&_>u[c+1].from-2*250;)_=u[++c].to;n.highlight(o.state,m,_,(ue,gn)=>{let nh=o.state.selection.ranges.some(ih=>ih.from==ue&&ih.to==gn);s.add(ue,gn,nh?selectedMatchMark:matchMark)})}return s.finish()}},{decorations:n=>n.decorations});function searchCommand(n){return e=>{let o=e.state.field(searchState,!1);return o&&o.query.spec.valid?n(e,o):openSearchPanel(e)}}const findNext=searchCommand((n,{query:e})=>{let{to:o}=n.state.selection.main,s=e.nextMatch(n.state,o,o);if(!s)return!1;let c=EditorSelection.single(s.from,s.to),u=n.state.facet(searchConfigFacet);return n.dispatch({selection:c,effects:[announceMatch(n,s),u.scrollToMatch(c.main,n)],userEvent:"select.search"}),selectSearchInput(n),!0}),findPrevious=searchCommand((n,{query:e})=>{let{state:o}=n,{from:s}=o.selection.main,c=e.prevMatch(o,s,s);if(!c)return!1;let u=EditorSelection.single(c.from,c.to),d=n.state.facet(searchConfigFacet);return n.dispatch({selection:u,effects:[announceMatch(n,c),d.scrollToMatch(u.main,n)],userEvent:"select.search"}),selectSearchInput(n),!0}),selectMatches=searchCommand((n,{query:e})=>{let o=e.matchAll(n.state,1e3);return!o||!o.length?!1:(n.dispatch({selection:EditorSelection.create(o.map(s=>EditorSelection.range(s.from,s.to))),userEvent:"select.search.matches"}),!0)}),selectSelectionMatches=({state:n,dispatch:e})=>{let o=n.selection;if(o.ranges.length>1||o.main.empty)return!1;let{from:s,to:c}=o.main,u=[],d=0;for(let m=new SearchCursor(n.doc,n.sliceDoc(s,c));!m.next().done;){if(u.length>1e3)return!1;m.value.from==s&&(d=u.length),u.push(EditorSelection.range(m.value.from,m.value.to))}return e(n.update({selection:EditorSelection.create(u,d),userEvent:"select.search.matches"})),!0},replaceNext=searchCommand((n,{query:e})=>{let{state:o}=n,{from:s,to:c}=o.selection.main;if(o.readOnly)return!1;let u=e.nextMatch(o,s,s);if(!u)return!1;let d=[],m,_,ue=[];if(u.from==s&&u.to==c&&(_=o.toText(e.getReplacement(u)),d.push({from:u.from,to:u.to,insert:_}),u=e.nextMatch(o,u.from,u.to),ue.push(EditorView.announce.of(o.phrase("replaced match on line $",o.doc.lineAt(s).number)+"."))),u){let gn=d.length==0||d[0].from>=u.to?0:u.to-u.from-_.length;m=EditorSelection.single(u.from-gn,u.to-gn),ue.push(announceMatch(n,u)),ue.push(o.facet(searchConfigFacet).scrollToMatch(m.main,n))}return n.dispatch({changes:d,selection:m,effects:ue,userEvent:"input.replace"}),!0}),replaceAll=searchCommand((n,{query:e})=>{if(n.state.readOnly)return!1;let o=e.matchAll(n.state,1e9).map(c=>{let{from:u,to:d}=c;return{from:u,to:d,insert:e.getReplacement(c)}});if(!o.length)return!1;let s=n.state.phrase("replaced $ matches",o.length)+".";return n.dispatch({changes:o,effects:EditorView.announce.of(s),userEvent:"input.replace.all"}),!0});function createSearchPanel(n){return n.state.facet(searchConfigFacet).createPanel(n)}function defaultQuery(n,e){var o,s,c,u;let d=n.selection.main,m=d.empty||d.to>d.from+100?"":n.sliceDoc(d.from,d.to);if(e&&!m)return e;let _=n.facet(searchConfigFacet);return new SearchQuery({search:((o=e==null?void 0:e.literal)!==null&&o!==void 0?o:_.literal)?m:m.replace(/\n/g,"\\n"),caseSensitive:(s=e==null?void 0:e.caseSensitive)!==null&&s!==void 0?s:_.caseSensitive,literal:(c=e==null?void 0:e.literal)!==null&&c!==void 0?c:_.literal,wholeWord:(u=e==null?void 0:e.wholeWord)!==null&&u!==void 0?u:_.wholeWord})}function getSearchInput(n){let e=getPanel(n,createSearchPanel);return e&&e.dom.querySelector("[main-field]")}function selectSearchInput(n){let e=getSearchInput(n);e&&e==n.root.activeElement&&e.select()}const openSearchPanel=n=>{let e=n.state.field(searchState,!1);if(e&&e.panel){let o=getSearchInput(n);if(o&&o!=n.root.activeElement){let s=defaultQuery(n.state,e.query.spec);s.valid&&n.dispatch({effects:setSearchQuery.of(s)}),o.focus(),o.select()}}else n.dispatch({effects:[togglePanel$1.of(!0),e?setSearchQuery.of(defaultQuery(n.state,e.query.spec)):StateEffect.appendConfig.of(searchExtensions)]});return!0},closeSearchPanel=n=>{let e=n.state.field(searchState,!1);if(!e||!e.panel)return!1;let o=getPanel(n,createSearchPanel);return o&&o.dom.contains(n.root.activeElement)&&n.focus(),n.dispatch({effects:togglePanel$1.of(!1)}),!0},searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence,preventDefault:!0}];class SearchPanel{constructor(e){this.view=e;let o=this.query=e.state.field(searchState).query.spec;this.commit=this.commit.bind(this),this.searchField=crelt("input",{value:o.search,placeholder:phrase(e,"Find"),"aria-label":phrase(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=crelt("input",{value:o.replace,placeholder:phrase(e,"Replace"),"aria-label":phrase(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=crelt("input",{type:"checkbox",name:"case",form:"",checked:o.caseSensitive,onchange:this.commit}),this.reField=crelt("input",{type:"checkbox",name:"re",form:"",checked:o.regexp,onchange:this.commit}),this.wordField=crelt("input",{type:"checkbox",name:"word",form:"",checked:o.wholeWord,onchange:this.commit});function s(c,u,d){return crelt("button",{class:"cm-button",name:c,onclick:u,type:"button"},d)}this.dom=crelt("div",{onkeydown:c=>this.keydown(c),class:"cm-search"},[this.searchField,s("next",()=>findNext(e),[phrase(e,"next")]),s("prev",()=>findPrevious(e),[phrase(e,"previous")]),s("select",()=>selectMatches(e),[phrase(e,"all")]),crelt("label",null,[this.caseField,phrase(e,"match case")]),crelt("label",null,[this.reField,phrase(e,"regexp")]),crelt("label",null,[this.wordField,phrase(e,"by word")]),...e.state.readOnly?[]:[crelt("br"),this.replaceField,s("replace",()=>replaceNext(e),[phrase(e,"replace")]),s("replaceAll",()=>replaceAll(e),[phrase(e,"replace all")])],crelt("button",{name:"close",onclick:()=>closeSearchPanel(e),"aria-label":phrase(e,"close"),type:"button"},[""])])}commit(){let e=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:setSearchQuery.of(e)}))}keydown(e){runScopeHandlers(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?findPrevious:findNext)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),replaceNext(this.view))}update(e){for(let o of e.transactions)for(let s of o.effects)s.is(setSearchQuery)&&!s.value.eq(this.query)&&this.setQuery(s.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(searchConfigFacet).top}}function phrase(n,e){return n.state.phrase(e)}const AnnounceMargin=30,Break=/[\s\.,:;?!]/;function announceMatch(n,{from:e,to:o}){let s=n.state.doc.lineAt(e),c=n.state.doc.lineAt(o).to,u=Math.max(s.from,e-AnnounceMargin),d=Math.min(c,o+AnnounceMargin),m=n.state.sliceDoc(u,d);if(u!=s.from){for(let _=0;_<AnnounceMargin;_++)if(!Break.test(m[_+1])&&Break.test(m[_])){m=m.slice(_);break}}if(d!=c){for(let _=m.length-1;_>m.length-AnnounceMargin;_--)if(!Break.test(m[_-1])&&Break.test(m[_])){m=m.slice(0,_);break}}return EditorView.announce.of(`${n.state.phrase("current match")}. ${m} ${n.state.phrase("on line")} ${s.number}.`)}const baseTheme$2=EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),searchExtensions=[searchState,Prec.lowest(searchHighlighter),baseTheme$2];class CompletionContext{constructor(e,o,s){this.state=e,this.pos=o,this.explicit=s,this.abortListeners=[]}tokenBefore(e){let o=syntaxTree(this.state).resolveInner(this.pos,-1);for(;o&&e.indexOf(o.name)<0;)o=o.parent;return o?{from:o.from,to:this.pos,text:this.state.sliceDoc(o.from,this.pos),type:o.type}:null}matchBefore(e){let o=this.state.doc.lineAt(this.pos),s=Math.max(o.from,this.pos-250),c=o.text.slice(s-o.from,this.pos-o.from),u=c.search(ensureAnchor(e,!1));return u<0?null:{from:s+u,to:this.pos,text:c.slice(u)}}get aborted(){return this.abortListeners==null}addEventListener(e,o){e=="abort"&&this.abortListeners&&this.abortListeners.push(o)}}function toSet(n){let e=Object.keys(n).join(""),o=/\w/.test(e);return o&&(e=e.replace(/\w/g,"")),`[${o?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function prefixMatch(n){let e=Object.create(null),o=Object.create(null);for(let{label:c}of n){e[c[0]]=!0;for(let u=1;u<c.length;u++)o[c[u]]=!0}let s=toSet(e)+toSet(o)+"*$";return[new RegExp("^"+s),new RegExp(s)]}function completeFromList(n){let e=n.map(c=>typeof c=="string"?{label:c}:c),[o,s]=e.every(c=>/^\w+$/.test(c.label))?[/\w*$/,/\w+$/]:prefixMatch(e);return c=>{let u=c.matchBefore(s);return u||c.explicit?{from:u?u.from:c.pos,options:e,validFor:o}:null}}class Option{constructor(e,o,s,c){this.completion=e,this.source=o,this.match=s,this.score=c}}function cur(n){return n.selection.main.from}function ensureAnchor(n,e){var o;let{source:s}=n,c=e&&s[0]!="^",u=s[s.length-1]!="$";return!c&&!u?n:new RegExp(`${c?"^":""}(?:${s})${u?"$":""}`,(o=n.flags)!==null&&o!==void 0?o:n.ignoreCase?"i":"")}const pickedCompletion=Annotation.define();function insertCompletionText(n,e,o,s){let{main:c}=n.selection,u=o-c.from,d=s-c.from;return Object.assign(Object.assign({},n.changeByRange(m=>m!=c&&o!=s&&n.sliceDoc(m.from+u,m.from+d)!=n.sliceDoc(o,s)?{range:m}:{changes:{from:m.from+u,to:s==c.from?m.to:m.from+d,insert:e},range:EditorSelection.cursor(m.from+u+e.length)})),{userEvent:"input.complete"})}const SourceCache=new WeakMap;function asSource(n){if(!Array.isArray(n))return n;let e=SourceCache.get(n);return e||SourceCache.set(n,e=completeFromList(n)),e}const startCompletionEffect=StateEffect.define(),closeCompletionEffect=StateEffect.define();class FuzzyMatcher{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let o=0;o<e.length;){let s=codePointAt(e,o),c=codePointSize(s);this.chars.push(s);let u=e.slice(o,o+c),d=u.toUpperCase();this.folded.push(codePointAt(d==u?u.toLowerCase():d,0)),o+=c}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[-100];if(e.length<this.pattern.length)return null;let{chars:o,folded:s,any:c,precise:u,byWord:d}=this;if(o.length==1){let _h=codePointAt(e,0),Sh=codePointSize(_h),fh=Sh==e.length?0:-100;if(_h!=o[0])if(_h==s[0])fh+=-200;else return null;return[fh,0,Sh]}let m=e.indexOf(this.pattern);if(m==0)return[e.length==this.pattern.length?0:-100,0,this.pattern.length];let _=o.length,ue=0;if(m<0){for(let _h=0,Sh=Math.min(e.length,200);_h<Sh&&ue<_;){let fh=codePointAt(e,_h);(fh==o[ue]||fh==s[ue])&&(c[ue++]=_h),_h+=codePointSize(fh)}if(ue<_)return null}let gn=0,nh=0,ih=!1,rh=0,oh=-1,lh=-1,ch=/[a-z]/.test(e),dh=!0;for(let _h=0,Sh=Math.min(e.length,200),fh=0;_h<Sh&&nh<_;){let yh=codePointAt(e,_h);m<0&&(gn<_&&yh==o[gn]&&(u[gn++]=_h),rh<_&&(yh==o[rh]||yh==s[rh]?(rh==0&&(oh=_h),lh=_h+1,rh++):rh=0));let mh,Ch=yh<255?yh>=48&&yh<=57||yh>=97&&yh<=122?2:yh>=65&&yh<=90?1:0:(mh=fromCodePoint(yh))!=mh.toLowerCase()?1:mh!=mh.toUpperCase()?2:0;(!_h||Ch==1&&ch||fh==0&&Ch!=0)&&(o[nh]==yh||s[nh]==yh&&(ih=!0)?d[nh++]=_h:d.length&&(dh=!1)),fh=Ch,_h+=codePointSize(yh)}return nh==_&&d[0]==0&&dh?this.result(-100+(ih?-200:0),d,e):rh==_&&oh==0?[-200-e.length+(lh==e.length?0:-100),0,lh]:m>-1?[-700-e.length,m,m+this.pattern.length]:rh==_?[-200+-700-e.length,oh,lh]:nh==_?this.result(-100+(ih?-200:0)+-700+(dh?0:-1100),d,e):o.length==2?null:this.result((c[0]?-700:0)+-200+-1100,c,e)}result(e,o,s){let c=[e-s.length],u=1;for(let d of o){let m=d+(this.astral?codePointSize(codePointAt(s,d)):1);u>1&&c[u-1]==d?c[u-1]=m:(c[u++]=d,c[u++]=m)}return c}}const completionConfig=Facet.define({combine(n){return combineConfig(n,{activateOnTyping:!0,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:defaultPositionInfo,compareCompletions:(e,o)=>e.label.localeCompare(o.label),interactionDelay:75},{defaultKeymap:(e,o)=>e&&o,closeOnBlur:(e,o)=>e&&o,icons:(e,o)=>e&&o,tooltipClass:(e,o)=>s=>joinClass(e(s),o(s)),optionClass:(e,o)=>s=>joinClass(e(s),o(s)),addToOptions:(e,o)=>e.concat(o)})}});function joinClass(n,e){return n?e?n+" "+e:n:e}function defaultPositionInfo(n,e,o,s,c){let u=n.textDirection==Direction.RTL,d=u,m=!1,_="top",ue,gn,nh=e.left-c.left,ih=c.right-e.right,rh=s.right-s.left,oh=s.bottom-s.top;if(d&&nh<Math.min(rh,ih)?d=!1:!d&&ih<Math.min(rh,nh)&&(d=!0),rh<=(d?nh:ih))ue=Math.max(c.top,Math.min(o.top,c.bottom-oh))-e.top,gn=Math.min(400,d?nh:ih);else{m=!0,gn=Math.min(400,(u?e.right:c.right-e.left)-30);let lh=c.bottom-e.bottom;lh>=oh||lh>e.top?ue=o.bottom-e.top:(_="bottom",ue=e.bottom-o.top)}return{style:`${_}: ${ue}px; max-width: ${gn}px`,class:"cm-completionInfo-"+(m?u?"left-narrow":"right-narrow":d?"left":"right")}}function moveCompletionSelection(n,e="option"){return o=>{let s=o.state.field(completionState,!1);if(!s||!s.open||s.open.disabled||Date.now()-s.open.timestamp<o.state.facet(completionConfig).interactionDelay)return!1;let c=1,u;e=="page"&&(u=getTooltip(o,s.open.tooltip))&&(c=Math.max(2,Math.floor(u.dom.offsetHeight/u.dom.querySelector("li").offsetHeight)-1));let{length:d}=s.open.options,m=s.open.selected>-1?s.open.selected+c*(n?1:-1):n?0:d-1;return m<0?m=e=="page"?0:d-1:m>=d&&(m=e=="page"?d-1:0),o.dispatch({effects:setSelectedEffect.of(m)}),!0}}const acceptCompletion=n=>{let e=n.state.field(completionState,!1);return n.state.readOnly||!e||!e.open||e.open.selected<0||Date.now()-e.open.timestamp<n.state.facet(completionConfig).interactionDelay?!1:e.open.disabled?!0:applyCompletion(n,e.open.options[e.open.selected])},startCompletion=n=>n.state.field(completionState,!1)?(n.dispatch({effects:startCompletionEffect.of(!0)}),!0):!1,closeCompletion=n=>{let e=n.state.field(completionState,!1);return!e||!e.active.some(o=>o.state!=0)?!1:(n.dispatch({effects:closeCompletionEffect.of(null)}),!0)};class RunningQuery{constructor(e,o){this.active=e,this.context=o,this.time=Date.now(),this.updates=[],this.done=void 0}}const DebounceTime=50,MaxUpdateCount=50,MinAbortTime=1e3,completionPlugin=ViewPlugin.fromClass(class{constructor(n){this.view=n,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of n.state.field(completionState).active)e.state==1&&this.startQuery(e)}update(n){let e=n.state.field(completionState);if(!n.selectionSet&&!n.docChanged&&n.startState.field(completionState)==e)return;let o=n.transactions.some(s=>(s.selection||s.docChanged)&&!getUserEvent(s));for(let s=0;s<this.running.length;s++){let c=this.running[s];if(o||c.updates.length+n.transactions.length>MaxUpdateCount&&Date.now()-c.time>MinAbortTime){for(let u of c.context.abortListeners)try{u()}catch(d){logException(this.view.state,d)}c.context.abortListeners=null,this.running.splice(s--,1)}else c.updates.push(...n.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(s=>s.state==1&&!this.running.some(c=>c.active.source==s.source))?setTimeout(()=>this.startUpdate(),DebounceTime):-1,this.composing!=0)for(let s of n.transactions)getUserEvent(s)=="input"?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:n}=this.view,e=n.field(completionState);for(let o of e.active)o.state==1&&!this.running.some(s=>s.active.source==o.source)&&this.startQuery(o)}startQuery(n){let{state:e}=this.view,o=cur(e),s=new CompletionContext(e,o,n.explicitPos==o),c=new RunningQuery(n,s);this.running.push(c),Promise.resolve(n.source(s)).then(u=>{c.context.aborted||(c.done=u||null,this.scheduleAccept())},u=>{this.view.dispatch({effects:closeCompletionEffect.of(null)}),logException(this.view.state,u)})}scheduleAccept(){this.running.every(n=>n.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),DebounceTime))}accept(){var n;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],o=this.view.state.facet(completionConfig);for(let s=0;s<this.running.length;s++){let c=this.running[s];if(c.done===void 0)continue;if(this.running.splice(s--,1),c.done){let d=new ActiveResult(c.active.source,c.active.explicitPos,c.done,c.done.from,(n=c.done.to)!==null&&n!==void 0?n:cur(c.updates.length?c.updates[0].startState:this.view.state));for(let m of c.updates)d=d.update(m,o);if(d.hasResult()){e.push(d);continue}}let u=this.view.state.field(completionState).active.find(d=>d.source==c.active.source);if(u&&u.state==1)if(c.done==null){let d=new ActiveSource(c.active.source,0);for(let m of c.updates)d=d.update(m,o);d.state!=1&&e.push(d)}else this.startQuery(u)}e.length&&this.view.dispatch({effects:setActiveEffect.of(e)})}},{eventHandlers:{blur(n){let e=this.view.state.field(completionState,!1);if(e&&e.tooltip&&this.view.state.facet(completionConfig).closeOnBlur){let o=e.open&&getTooltip(this.view,e.open.tooltip);(!o||!o.dom.contains(n.relatedTarget))&&this.view.dispatch({effects:closeCompletionEffect.of(null)})}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:startCompletionEffect.of(!1)}),20),this.composing=0}}});function applyCompletion(n,e){const o=e.completion.apply||e.completion.label;let s=n.state.field(completionState).active.find(c=>c.source==e.source);return s instanceof ActiveResult?(typeof o=="string"?n.dispatch(Object.assign(Object.assign({},insertCompletionText(n.state,o,s.from,s.to)),{annotations:pickedCompletion.of(e.completion)})):o(n,e.completion,s.from,s.to),!0):!1}function optionContent(n){let e=n.addToOptions.slice();return n.icons&&e.push({render(o){let s=document.createElement("div");return s.classList.add("cm-completionIcon"),o.type&&s.classList.add(...o.type.split(/\s+/g).map(c=>"cm-completionIcon-"+c)),s.setAttribute("aria-hidden","true"),s},position:20}),e.push({render(o,s,c){let u=document.createElement("span");u.className="cm-completionLabel";let{label:d}=o,m=0;for(let _=1;_<c.length;){let ue=c[_++],gn=c[_++];ue>m&&u.appendChild(document.createTextNode(d.slice(m,ue)));let nh=u.appendChild(document.createElement("span"));nh.appendChild(document.createTextNode(d.slice(ue,gn))),nh.className="cm-completionMatchedText",m=gn}return m<d.length&&u.appendChild(document.createTextNode(d.slice(m))),u},position:50},{render(o){if(!o.detail)return null;let s=document.createElement("span");return s.className="cm-completionDetail",s.textContent=o.detail,s},position:80}),e.sort((o,s)=>o.position-s.position).map(o=>o.render)}function rangeAroundSelected(n,e,o){if(n<=o)return{from:0,to:n};if(e<0&&(e=0),e<=n>>1){let c=Math.floor(e/o);return{from:c*o,to:(c+1)*o}}let s=Math.floor((n-e)/o);return{from:n-(s+1)*o,to:n-s*o}}class CompletionTooltip{constructor(e,o){this.view=e,this.stateField=o,this.info=null,this.placeInfoReq={read:()=>this.measureInfo(),write:m=>this.placeInfo(m),key:this},this.space=null,this.currentClass="";let s=e.state.field(o),{options:c,selected:u}=s.open,d=e.state.facet(completionConfig);this.optionContent=optionContent(d),this.optionClass=d.optionClass,this.tooltipClass=d.tooltipClass,this.range=rangeAroundSelected(c.length,u,d.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",m=>{for(let _=m.target,ue;_&&_!=this.dom;_=_.parentNode)if(_.nodeName=="LI"&&(ue=/-(\d+)$/.exec(_.id))&&+ue[1]<c.length){applyCompletion(e,c[+ue[1]]),m.preventDefault();return}}),this.dom.addEventListener("focusout",m=>{let _=e.state.field(this.stateField,!1);_&&_.tooltip&&e.state.facet(completionConfig).closeOnBlur&&m.relatedTarget!=e.contentDOM&&e.dispatch({effects:closeCompletionEffect.of(null)})}),this.list=this.dom.appendChild(this.createListBox(c,s.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}mount(){this.updateSel()}update(e){var o,s,c;let u=e.state.field(this.stateField),d=e.startState.field(this.stateField);this.updateTooltipClass(e.state),u!=d&&(this.updateSel(),((o=u.open)===null||o===void 0?void 0:o.disabled)!=((s=d.open)===null||s===void 0?void 0:s.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!(!((c=u.open)===null||c===void 0)&&c.disabled)))}updateTooltipClass(e){let o=this.tooltipClass(e);if(o!=this.currentClass){for(let s of this.currentClass.split(" "))s&&this.dom.classList.remove(s);for(let s of o.split(" "))s&&this.dom.classList.add(s);this.currentClass=o}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),o=e.open;if((o.selected>-1&&o.selected<this.range.from||o.selected>=this.range.to)&&(this.range=rangeAroundSelected(o.options.length,o.selected,this.view.state.facet(completionConfig).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(o.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})),this.updateSelectedOption(o.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:s}=o.options[o.selected],{info:c}=s;if(!c)return;let u=typeof c=="string"?document.createTextNode(c):c(s);if(!u)return;"then"in u?u.then(d=>{d&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(d)}).catch(d=>logException(this.view.state,d,"completion info")):this.addInfoPane(u)}}addInfoPane(e){let o=this.info=document.createElement("div");o.className="cm-tooltip cm-completionInfo",o.appendChild(e),this.dom.appendChild(o),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let o=null;for(let s=this.list.firstChild,c=this.range.from;s;s=s.nextSibling,c++)s.nodeName!="LI"||!s.id?c--:c==e?s.hasAttribute("aria-selected")||(s.setAttribute("aria-selected","true"),o=s):s.hasAttribute("aria-selected")&&s.removeAttribute("aria-selected");return o&&scrollIntoView(this.list,o),o}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let o=this.dom.getBoundingClientRect(),s=this.info.getBoundingClientRect(),c=e.getBoundingClientRect(),u=this.space;if(!u){let d=this.dom.ownerDocument.defaultView||window;u={left:0,top:0,right:d.innerWidth,bottom:d.innerHeight}}return c.top>Math.min(u.bottom,o.bottom)-10||c.bottom<Math.max(u.top,o.top)+10?null:this.view.state.facet(completionConfig).positionInfo(this.view,o,c,s,u)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,o,s){const c=document.createElement("ul");c.id=o,c.setAttribute("role","listbox"),c.setAttribute("aria-expanded","true"),c.setAttribute("aria-label",this.view.state.phrase("Completions"));let u=null;for(let d=s.from;d<s.to;d++){let{completion:m,match:_}=e[d],{section:ue}=m;if(ue){let ih=typeof ue=="string"?ue:ue.name;if(ih!=u&&(d>s.from||s.from==0))if(u=ih,typeof ue!="string"&&ue.header)c.appendChild(ue.header(ue));else{let rh=c.appendChild(document.createElement("completion-section"));rh.textContent=ih}}const gn=c.appendChild(document.createElement("li"));gn.id=o+"-"+d,gn.setAttribute("role","option");let nh=this.optionClass(m);nh&&(gn.className=nh);for(let ih of this.optionContent){let rh=ih(m,this.view.state,_);rh&&gn.appendChild(rh)}}return s.from&&c.classList.add("cm-completionListIncompleteTop"),s.to<e.length&&c.classList.add("cm-completionListIncompleteBottom"),c}}function completionTooltip(n){return e=>new CompletionTooltip(e,n)}function scrollIntoView(n,e){let o=n.getBoundingClientRect(),s=e.getBoundingClientRect();s.top<o.top?n.scrollTop-=o.top-s.top:s.bottom>o.bottom&&(n.scrollTop+=s.bottom-o.bottom)}function score(n){return(n.boost||0)*100+(n.apply?10:0)+(n.info?5:0)+(n.type?1:0)}function sortOptions(n,e){let o=[],s=null,c=_=>{o.push(_);let{section:ue}=_.completion;if(ue){s||(s=[]);let gn=typeof ue=="string"?ue:ue.name;s.some(nh=>nh.name==gn)||s.push(typeof ue=="string"?{name:gn}:ue)}};for(let _ of n)if(_.hasResult())if(_.result.filter===!1){let ue=_.result.getMatch;for(let gn of _.result.options){let nh=[1e9-o.length];if(ue)for(let ih of ue(gn))nh.push(ih);c(new Option(gn,_.source,nh,nh[0]))}}else{let ue=new FuzzyMatcher(e.sliceDoc(_.from,_.to)),gn;for(let nh of _.result.options)(gn=ue.match(nh.label))&&c(new Option(nh,_.source,gn,gn[0]+(nh.boost||0)))}if(s){let _=Object.create(null),ue=0,gn=(nh,ih)=>{var rh,oh;return((rh=nh.rank)!==null&&rh!==void 0?rh:1e9)-((oh=ih.rank)!==null&&oh!==void 0?oh:1e9)||(nh.name<ih.name?-1:1)};for(let nh of s.sort(gn))ue-=1e5,_[nh.name]=ue;for(let nh of o){let{section:ih}=nh.completion;ih&&(nh.score+=_[typeof ih=="string"?ih:ih.name])}}let u=[],d=null,m=e.facet(completionConfig).compareCompletions;for(let _ of o.sort((ue,gn)=>gn.score-ue.score||m(ue.completion,gn.completion)))!d||d.label!=_.completion.label||d.detail!=_.completion.detail||d.type!=null&&_.completion.type!=null&&d.type!=_.completion.type||d.apply!=_.completion.apply?u.push(_):score(_.completion)>score(d)&&(u[u.length-1]=_),d=_.completion;return u}class CompletionDialog{constructor(e,o,s,c,u,d){this.options=e,this.attrs=o,this.tooltip=s,this.timestamp=c,this.selected=u,this.disabled=d}setSelected(e,o){return e==this.selected||e>=this.options.length?this:new CompletionDialog(this.options,makeAttrs(o,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,o,s,c,u){let d=sortOptions(e,o);if(!d.length)return c&&e.some(_=>_.state==1)?new CompletionDialog(c.options,c.attrs,c.tooltip,c.timestamp,c.selected,!0):null;let m=o.facet(completionConfig).selectOnOpen?0:-1;if(c&&c.selected!=m&&c.selected!=-1){let _=c.options[c.selected].completion;for(let ue=0;ue<d.length;ue++)if(d[ue].completion==_){m=ue;break}}return new CompletionDialog(d,makeAttrs(s,m),{pos:e.reduce((_,ue)=>ue.hasResult()?Math.min(_,ue.from):_,1e8),create:completionTooltip(completionState),above:u.aboveCursor},c?c.timestamp:Date.now(),m,!1)}map(e){return new CompletionDialog(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class CompletionState{constructor(e,o,s){this.active=e,this.id=o,this.open=s}static start(){return new CompletionState(none,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:o}=e,s=o.facet(completionConfig),u=(s.override||o.languageDataAt("autocomplete",cur(o)).map(asSource)).map(m=>(this.active.find(ue=>ue.source==m)||new ActiveSource(m,this.active.some(ue=>ue.state!=0)?1:0)).update(e,s));u.length==this.active.length&&u.every((m,_)=>m==this.active[_])&&(u=this.active);let d=this.open;d&&e.docChanged&&(d=d.map(e.changes)),e.selection||u.some(m=>m.hasResult()&&e.changes.touchesRange(m.from,m.to))||!sameResults(u,this.active)?d=CompletionDialog.build(u,o,this.id,d,s):d&&d.disabled&&!u.some(m=>m.state==1)&&(d=null),!d&&u.every(m=>m.state!=1)&&u.some(m=>m.hasResult())&&(u=u.map(m=>m.hasResult()?new ActiveSource(m.source,0):m));for(let m of e.effects)m.is(setSelectedEffect)&&(d=d&&d.setSelected(m.value,this.id));return u==this.active&&d==this.open?this:new CompletionState(u,this.id,d)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:baseAttrs}}function sameResults(n,e){if(n==e)return!0;for(let o=0,s=0;;){for(;o<n.length&&!n[o].hasResult;)o++;for(;s<e.length&&!e[s].hasResult;)s++;let c=o==n.length,u=s==e.length;if(c||u)return c==u;if(n[o++].result!=e[s++].result)return!1}}const baseAttrs={"aria-autocomplete":"list"};function makeAttrs(n,e){let o={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":n};return e>-1&&(o["aria-activedescendant"]=n+"-"+e),o}const none=[];function getUserEvent(n){return n.isUserEvent("input.type")?"input":n.isUserEvent("delete.backward")?"delete":null}class ActiveSource{constructor(e,o,s=-1){this.source=e,this.state=o,this.explicitPos=s}hasResult(){return!1}update(e,o){let s=getUserEvent(e),c=this;s?c=c.handleUserEvent(e,s,o):e.docChanged?c=c.handleChange(e):e.selection&&c.state!=0&&(c=new ActiveSource(c.source,0));for(let u of e.effects)if(u.is(startCompletionEffect))c=new ActiveSource(c.source,1,u.value?cur(e.state):-1);else if(u.is(closeCompletionEffect))c=new ActiveSource(c.source,0);else if(u.is(setActiveEffect))for(let d of u.value)d.source==c.source&&(c=d);return c}handleUserEvent(e,o,s){return o=="delete"||!s.activateOnTyping?this.map(e.changes):new ActiveSource(this.source,1)}handleChange(e){return e.changes.touchesRange(cur(e.startState))?new ActiveSource(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new ActiveSource(this.source,this.state,e.mapPos(this.explicitPos))}}class ActiveResult extends ActiveSource{constructor(e,o,s,c,u){super(e,2,o),this.result=s,this.from=c,this.to=u}hasResult(){return!0}handleUserEvent(e,o,s){var c;let u=e.changes.mapPos(this.from),d=e.changes.mapPos(this.to,1),m=cur(e.state);if((this.explicitPos<0?m<=u:m<this.from)||m>d||o=="delete"&&cur(e.startState)==this.from)return new ActiveSource(this.source,o=="input"&&s.activateOnTyping?1:0);let _=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),ue;return checkValid(this.result.validFor,e.state,u,d)?new ActiveResult(this.source,_,this.result,u,d):this.result.update&&(ue=this.result.update(this.result,u,d,new CompletionContext(e.state,m,_>=0)))?new ActiveResult(this.source,_,ue,ue.from,(c=ue.to)!==null&&c!==void 0?c:cur(e.state)):new ActiveSource(this.source,1,_)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new ActiveSource(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new ActiveResult(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}function checkValid(n,e,o,s){if(!n)return!1;let c=e.sliceDoc(o,s);return typeof n=="function"?n(c,o,s,e):ensureAnchor(n,!0).test(c)}const setActiveEffect=StateEffect.define({map(n,e){return n.map(o=>o.map(e))}}),setSelectedEffect=StateEffect.define(),completionState=StateField.define({create(){return CompletionState.start()},update(n,e){return n.update(e)},provide:n=>[showTooltip.from(n,e=>e.tooltip),EditorView.contentAttributes.from(n,e=>e.attrs)]}),baseTheme$1=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'""',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"''"}},".cm-completionIcon-class":{"&:after":{content:"''"}},".cm-completionIcon-interface":{"&:after":{content:"''"}},".cm-completionIcon-variable":{"&:after":{content:"''"}},".cm-completionIcon-constant":{"&:after":{content:"''"}},".cm-completionIcon-type":{"&:after":{content:"''"}},".cm-completionIcon-enum":{"&:after":{content:"''"}},".cm-completionIcon-property":{"&:after":{content:"''"}},".cm-completionIcon-keyword":{"&:after":{content:"''"}},".cm-completionIcon-namespace":{"&:after":{content:"''"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),defaults={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},closeBracketEffect=StateEffect.define({map(n,e){let o=e.mapPos(n,-1,MapMode.TrackAfter);return o??void 0}}),closedBracket=new class extends RangeValue{};closedBracket.startSide=1;closedBracket.endSide=-1;const bracketState=StateField.define({create(){return RangeSet.empty},update(n,e){if(e.selection){let o=e.state.doc.lineAt(e.selection.main.head).from,s=e.startState.doc.lineAt(e.startState.selection.main.head).from;o!=e.changes.mapPos(s,-1)&&(n=RangeSet.empty)}n=n.map(e.changes);for(let o of e.effects)o.is(closeBracketEffect)&&(n=n.update({add:[closedBracket.range(o.value,o.value+1)]}));return n}});function closeBrackets(){return[inputHandler,bracketState]}const definedClosing="()[]{}<>";function closing(n){for(let e=0;e<definedClosing.length;e+=2)if(definedClosing.charCodeAt(e)==n)return definedClosing.charAt(e+1);return fromCodePoint(n<128?n:n+1)}function config(n,e){return n.languageDataAt("closeBrackets",e)[0]||defaults}const android=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),inputHandler=EditorView.inputHandler.of((n,e,o,s)=>{if((android?n.composing:n.compositionStarted)||n.state.readOnly)return!1;let c=n.state.selection.main;if(s.length>2||s.length==2&&codePointSize(codePointAt(s,0))==1||e!=c.from||o!=c.to)return!1;let u=insertBracket(n.state,s);return u?(n.dispatch(u),!0):!1}),deleteBracketPair=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let s=config(n,n.selection.main.head).brackets||defaults.brackets,c=null,u=n.changeByRange(d=>{if(d.empty){let m=prevChar(n.doc,d.head);for(let _ of s)if(_==m&&nextChar(n.doc,d.head)==closing(codePointAt(_,0)))return{changes:{from:d.head-_.length,to:d.head+_.length},range:EditorSelection.cursor(d.head-_.length)}}return{range:c=d}});return c||e(n.update(u,{scrollIntoView:!0,userEvent:"delete.backward"})),!c},closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(n,e){let o=config(n,n.selection.main.head),s=o.brackets||defaults.brackets;for(let c of s){let u=closing(codePointAt(c,0));if(e==c)return u==c?handleSame(n,c,s.indexOf(c+c+c)>-1,o):handleOpen(n,c,u,o.before||defaults.before);if(e==u&&closedBracketAt(n,n.selection.main.from))return handleClose(n,c,u)}return null}function closedBracketAt(n,e){let o=!1;return n.field(bracketState).between(0,n.doc.length,s=>{s==e&&(o=!0)}),o}function nextChar(n,e){let o=n.sliceString(e,e+2);return o.slice(0,codePointSize(codePointAt(o,0)))}function prevChar(n,e){let o=n.sliceString(e-2,e);return codePointSize(codePointAt(o,0))==o.length?o:o.slice(1)}function handleOpen(n,e,o,s){let c=null,u=n.changeByRange(d=>{if(!d.empty)return{changes:[{insert:e,from:d.from},{insert:o,from:d.to}],effects:closeBracketEffect.of(d.to+e.length),range:EditorSelection.range(d.anchor+e.length,d.head+e.length)};let m=nextChar(n.doc,d.head);return!m||/\s/.test(m)||s.indexOf(m)>-1?{changes:{insert:e+o,from:d.head},effects:closeBracketEffect.of(d.head+e.length),range:EditorSelection.cursor(d.head+e.length)}:{range:c=d}});return c?null:n.update(u,{scrollIntoView:!0,userEvent:"input.type"})}function handleClose(n,e,o){let s=null,c=n.changeByRange(u=>u.empty&&nextChar(n.doc,u.head)==o?{changes:{from:u.head,to:u.head+o.length,insert:o},range:EditorSelection.cursor(u.head+o.length)}:s={range:u});return s?null:n.update(c,{scrollIntoView:!0,userEvent:"input.type"})}function handleSame(n,e,o,s){let c=s.stringPrefixes||defaults.stringPrefixes,u=null,d=n.changeByRange(m=>{if(!m.empty)return{changes:[{insert:e,from:m.from},{insert:e,from:m.to}],effects:closeBracketEffect.of(m.to+e.length),range:EditorSelection.range(m.anchor+e.length,m.head+e.length)};let _=m.head,ue=nextChar(n.doc,_),gn;if(ue==e){if(nodeStart(n,_))return{changes:{insert:e+e,from:_},effects:closeBracketEffect.of(_+e.length),range:EditorSelection.cursor(_+e.length)};if(closedBracketAt(n,_)){let ih=o&&n.sliceDoc(_,_+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:_,to:_+ih.length,insert:ih},range:EditorSelection.cursor(_+ih.length)}}}else{if(o&&n.sliceDoc(_-2*e.length,_)==e+e&&(gn=canStartStringAt(n,_-2*e.length,c))>-1&&nodeStart(n,gn))return{changes:{insert:e+e+e+e,from:_},effects:closeBracketEffect.of(_+e.length),range:EditorSelection.cursor(_+e.length)};if(n.charCategorizer(_)(ue)!=CharCategory.Word&&canStartStringAt(n,_,c)>-1&&!probablyInString(n,_,e,c))return{changes:{insert:e+e,from:_},effects:closeBracketEffect.of(_+e.length),range:EditorSelection.cursor(_+e.length)}}return{range:u=m}});return u?null:n.update(d,{scrollIntoView:!0,userEvent:"input.type"})}function nodeStart(n,e){let o=syntaxTree(n).resolveInner(e+1);return o.parent&&o.from==e}function probablyInString(n,e,o,s){let c=syntaxTree(n).resolveInner(e,-1),u=s.reduce((d,m)=>Math.max(d,m.length),0);for(let d=0;d<5;d++){let m=n.sliceDoc(c.from,Math.min(c.to,c.from+o.length+u)),_=m.indexOf(o);if(!_||_>-1&&s.indexOf(m.slice(0,_))>-1){let gn=c.firstChild;for(;gn&&gn.from==c.from&&gn.to-gn.from>o.length+_;){if(n.sliceDoc(gn.to-o.length,gn.to)==o)return!1;gn=gn.firstChild}return!0}let ue=c.to==e&&c.parent;if(!ue)break;c=ue}return!1}function canStartStringAt(n,e,o){let s=n.charCategorizer(e);if(s(n.sliceDoc(e-1,e))!=CharCategory.Word)return e;for(let c of o){let u=e-c.length;if(n.sliceDoc(u,e)==c&&s(n.sliceDoc(u-1,u))!=CharCategory.Word)return u}return-1}function autocompletion(n={}){return[completionState,completionConfig.of(n),completionPlugin,completionKeymapExt,baseTheme$1]}const completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(!0)},{key:"ArrowUp",run:moveCompletionSelection(!1)},{key:"PageDown",run:moveCompletionSelection(!0,"page")},{key:"PageUp",run:moveCompletionSelection(!1,"page")},{key:"Enter",run:acceptCompletion}],completionKeymapExt=Prec.highest(keymap.computeN([completionConfig],n=>n.facet(completionConfig).defaultKeymap?[completionKeymap]:[]));class SelectedDiagnostic{constructor(e,o,s){this.from=e,this.to=o,this.diagnostic=s}}class LintState{constructor(e,o,s){this.diagnostics=e,this.panel=o,this.selected=s}static init(e,o,s){let c=e,u=s.facet(lintConfig).markerFilter;u&&(c=u(c));let d=Decoration.set(c.map(m=>m.from==m.to||m.from==m.to-1&&s.doc.lineAt(m.from).to==m.from?Decoration.widget({widget:new DiagnosticWidget(m),diagnostic:m}).range(m.from):Decoration.mark({attributes:{class:"cm-lintRange cm-lintRange-"+m.severity},diagnostic:m}).range(m.from,m.to)),!0);return new LintState(d,o,findDiagnostic(d))}}function findDiagnostic(n,e=null,o=0){let s=null;return n.between(o,1e9,(c,u,{spec:d})=>{if(!(e&&d.diagnostic!=e))return s=new SelectedDiagnostic(c,u,d.diagnostic),!1}),s}function hideTooltip(n,e){return!!(n.effects.some(o=>o.is(setDiagnosticsEffect))||n.changes.touchesRange(e.pos))}function maybeEnableLint(n,e){return n.field(lintState,!1)?e:e.concat(StateEffect.appendConfig.of(lintExtensions))}const setDiagnosticsEffect=StateEffect.define(),togglePanel=StateEffect.define(),movePanelSelection=StateEffect.define(),lintState=StateField.define({create(){return new LintState(Decoration.none,null,null)},update(n,e){if(e.docChanged){let o=n.diagnostics.map(e.changes),s=null;if(n.selected){let c=e.changes.mapPos(n.selected.from,1);s=findDiagnostic(o,n.selected.diagnostic,c)||findDiagnostic(o,null,c)}n=new LintState(o,n.panel,s)}for(let o of e.effects)o.is(setDiagnosticsEffect)?n=LintState.init(o.value,n.panel,e.state):o.is(togglePanel)?n=new LintState(n.diagnostics,o.value?LintPanel.open:null,n.selected):o.is(movePanelSelection)&&(n=new LintState(n.diagnostics,n.panel,o.value));return n},provide:n=>[showPanel.from(n,e=>e.panel),EditorView.decorations.from(n,e=>e.diagnostics)]}),activeMark=Decoration.mark({class:"cm-lintRange cm-lintRange-active"});function lintTooltip(n,e,o){let{diagnostics:s}=n.state.field(lintState),c=[],u=2e8,d=0;s.between(e-(o<0?1:0),e+(o>0?1:0),(_,ue,{spec:gn})=>{e>=_&&e<=ue&&(_==ue||(e>_||o>0)&&(e<ue||o<0))&&(c.push(gn.diagnostic),u=Math.min(_,u),d=Math.max(ue,d))});let m=n.state.facet(lintConfig).tooltipFilter;return m&&(c=m(c)),c.length?{pos:u,end:d,above:n.state.doc.lineAt(u).to<d,create(){return{dom:diagnosticsTooltip(n,c)}}}:null}function diagnosticsTooltip(n,e){return crelt("ul",{class:"cm-tooltip-lint"},e.map(o=>renderDiagnostic(n,o,!1)))}const openLintPanel=n=>{let e=n.state.field(lintState,!1);(!e||!e.panel)&&n.dispatch({effects:maybeEnableLint(n.state,[togglePanel.of(!0)])});let o=getPanel(n,LintPanel.open);return o&&o.dom.querySelector(".cm-panel-lint ul").focus(),!0},closeLintPanel=n=>{let e=n.state.field(lintState,!1);return!e||!e.panel?!1:(n.dispatch({effects:togglePanel.of(!1)}),!0)},nextDiagnostic=n=>{let e=n.state.field(lintState,!1);if(!e)return!1;let o=n.state.selection.main,s=e.diagnostics.iter(o.to+1);return!s.value&&(s=e.diagnostics.iter(0),!s.value||s.from==o.from&&s.to==o.to)?!1:(n.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0}),!0)},lintKeymap=[{key:"Mod-Shift-m",run:openLintPanel,preventDefault:!0},{key:"F8",run:nextDiagnostic}],lintConfig=Facet.define({combine(n){return Object.assign({sources:n.map(e=>e.source)},combineConfig(n.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(e,o)=>e?o?s=>e(s)||o(s):e:o}))}});function assignKeys(n){let e=[];if(n)e:for(let{name:o}of n){for(let s=0;s<o.length;s++){let c=o[s];if(/[a-zA-Z]/.test(c)&&!e.some(u=>u.toLowerCase()==c.toLowerCase())){e.push(c);continue e}}e.push("")}return e}function renderDiagnostic(n,e,o){var s;let c=o?assignKeys(e.actions):[];return crelt("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},crelt("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(s=e.actions)===null||s===void 0?void 0:s.map((u,d)=>{let m=!1,_=ih=>{if(ih.preventDefault(),m)return;m=!0;let rh=findDiagnostic(n.state.field(lintState).diagnostics,e);rh&&u.apply(n,rh.from,rh.to)},{name:ue}=u,gn=c[d]?ue.indexOf(c[d]):-1,nh=gn<0?ue:[ue.slice(0,gn),crelt("u",ue.slice(gn,gn+1)),ue.slice(gn+1)];return crelt("button",{type:"button",class:"cm-diagnosticAction",onclick:_,onmousedown:_,"aria-label":` Action: ${ue}${gn<0?"":` (access key "${c[d]})"`}.`},nh)}),e.source&&crelt("div",{class:"cm-diagnosticSource"},e.source))}class DiagnosticWidget extends WidgetType{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return crelt("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class PanelItem{constructor(e,o){this.diagnostic=o,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=renderDiagnostic(e,o,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class LintPanel{constructor(e){this.view=e,this.items=[];let o=c=>{if(c.keyCode==27)closeLintPanel(this.view),this.view.focus();else if(c.keyCode==38||c.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(c.keyCode==40||c.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(c.keyCode==36)this.moveSelection(0);else if(c.keyCode==35)this.moveSelection(this.items.length-1);else if(c.keyCode==13)this.view.focus();else if(c.keyCode>=65&&c.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:u}=this.items[this.selectedIndex],d=assignKeys(u.actions);for(let m=0;m<d.length;m++)if(d[m].toUpperCase().charCodeAt(0)==c.keyCode){let _=findDiagnostic(this.view.state.field(lintState).diagnostics,u);_&&u.actions[m].apply(e,_.from,_.to)}}else return;c.preventDefault()},s=c=>{for(let u=0;u<this.items.length;u++)this.items[u].dom.contains(c.target)&&this.moveSelection(u)};this.list=crelt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:o,onclick:s}),this.dom=crelt("div",{class:"cm-panel-lint"},this.list,crelt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>closeLintPanel(this.view)},"")),this.update()}get selectedIndex(){let e=this.view.state.field(lintState).selected;if(!e)return-1;for(let o=0;o<this.items.length;o++)if(this.items[o].diagnostic==e.diagnostic)return o;return-1}update(){let{diagnostics:e,selected:o}=this.view.state.field(lintState),s=0,c=!1,u=null;for(e.between(0,this.view.state.doc.length,(d,m,{spec:_})=>{let ue=-1,gn;for(let nh=s;nh<this.items.length;nh++)if(this.items[nh].diagnostic==_.diagnostic){ue=nh;break}ue<0?(gn=new PanelItem(this.view,_.diagnostic),this.items.splice(s,0,gn),c=!0):(gn=this.items[ue],ue>s&&(this.items.splice(s,ue-s),c=!0)),o&&gn.diagnostic==o.diagnostic?gn.dom.hasAttribute("aria-selected")||(gn.dom.setAttribute("aria-selected","true"),u=gn):gn.dom.hasAttribute("aria-selected")&&gn.dom.removeAttribute("aria-selected"),s++});s<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)c=!0,this.items.pop();this.items.length==0&&(this.items.push(new PanelItem(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),c=!0),u?(this.list.setAttribute("aria-activedescendant",u.id),this.view.requestMeasure({key:this,read:()=>({sel:u.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:d,panel:m})=>{d.top<m.top?this.list.scrollTop-=m.top-d.top:d.bottom>m.bottom&&(this.list.scrollTop+=d.bottom-m.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),c&&this.sync()}sync(){let e=this.list.firstChild;function o(){let s=e;e=s.nextSibling,s.remove()}for(let s of this.items)if(s.dom.parentNode==this.list){for(;e!=s.dom;)o();e=s.dom.nextSibling}else this.list.insertBefore(s.dom,e);for(;e;)o()}moveSelection(e){if(this.selectedIndex<0)return;let o=this.view.state.field(lintState),s=findDiagnostic(o.diagnostics,this.items[e].diagnostic);s&&this.view.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:movePanelSelection.of(s)})}static open(e){return new LintPanel(e)}}function svg(n,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(n)}</svg>')`}function underline(n){return svg(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${n}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const baseTheme=EditorView.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:underline("#d11")},".cm-lintRange-warning":{backgroundImage:underline("orange")},".cm-lintRange-info":{backgroundImage:underline("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),lintExtensions=[lintState,EditorView.decorations.compute([lintState],n=>{let{selected:e,panel:o}=n.field(lintState);return!e||!o||e.from==e.to?Decoration.none:Decoration.set([activeMark.range(e.from,e.to)])}),hoverTooltip(lintTooltip,{hideOn:hideTooltip}),baseTheme],basicSetup=(()=>[lineNumbers(),highlightActiveLineGutter(),highlightSpecialChars(),history$1(),foldGutter(),drawSelection(),dropCursor(),EditorState.allowMultipleSelections.of(!0),indentOnInput(),syntaxHighlighting(defaultHighlightStyle,{fallback:!0}),bracketMatching(),closeBrackets(),autocompletion(),rectangularSelection(),crosshairCursor(),highlightActiveLine(),highlightSelectionMatches(),keymap.of([...closeBracketsKeymap,...defaultKeymap,...searchKeymap,...historyKeymap,...foldKeymap,...completionKeymap,...lintKeymap])])();/*!
* VueCodemirror v6.1.1
* Copyright (c) Surmon. All rights reserved.
* Released under the MIT License.
* Surmon
*/var h=Object.freeze({autofocus:!1,disabled:!1,indentWithTab:!0,tabSize:2,placeholder:"",autoDestroy:!0,extensions:[basicSetup]}),y$1=Symbol("vue-codemirror-global-config"),O$4,j$3=function(n){var e=n.onUpdate,o=n.onChange,s=n.onFocus,c=n.onBlur,u=function(d,m){var _={};for(var ue in d)Object.prototype.hasOwnProperty.call(d,ue)&&m.indexOf(ue)<0&&(_[ue]=d[ue]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function"){var gn=0;for(ue=Object.getOwnPropertySymbols(d);gn<ue.length;gn++)m.indexOf(ue[gn])<0&&Object.prototype.propertyIsEnumerable.call(d,ue[gn])&&(_[ue[gn]]=d[ue[gn]])}return _}(n,["onUpdate","onChange","onFocus","onBlur"]);return EditorState.create({doc:u.doc,selection:u.selection,extensions:(Array.isArray(u.extensions)?u.extensions:[u.extensions]).concat([EditorView.updateListener.of(function(d){e(d),d.docChanged&&o(d.state.doc.toString(),d),d.focusChanged&&(d.view.hasFocus?s(d):c(d))})])})},S$4=function(n){var e=new Compartment;return{compartment:e,run:function(o){e.get(n.state)?n.dispatch({effects:e.reconfigure(o)}):n.dispatch({effects:StateEffect.appendConfig.of(e.of(o))})}}},x$2=function(n,e){var o=S$4(n),s=o.compartment,c=o.run;return function(u){var d=s.get(n.state);c(u??d!==e?e:[])}},C$2={type:Boolean,default:void 0},D$3={autofocus:C$2,disabled:C$2,indentWithTab:C$2,tabSize:Number,placeholder:String,style:Object,autoDestroy:C$2,phrases:Object,root:Object,extensions:Array,selection:Object},U$4={modelValue:{type:String,default:""}},w$2=Object.assign(Object.assign({},D$3),U$4);(function(n){n.Change="change",n.Update="update",n.Focus="focus",n.Blur="blur",n.Ready="ready",n.ModelUpdate="update:modelValue"})(O$4||(O$4={}));var z$4={};z$4[O$4.Change]=function(n,e){return!0},z$4[O$4.Update]=function(n){return!0},z$4[O$4.Focus]=function(n){return!0},z$4[O$4.Blur]=function(n){return!0},z$4[O$4.Ready]=function(n){return!0};var B$3={};B$3[O$4.ModelUpdate]=z$4[O$4.Change];var F$4=Object.assign(Object.assign({},z$4),B$3),P$1=defineComponent({name:"VueCodemirror",props:Object.assign({},w$2),emits:Object.assign({},F$4),setup:function(n,e){var o=shallowRef(),s=shallowRef(),c=shallowRef(),u=Object.assign(Object.assign({},h),inject(y$1,{})),d=computed(function(){var m={};return Object.keys(toRaw(n)).forEach(function(_){var ue;_!=="modelValue"&&(m[_]=(ue=n[_])!==null&&ue!==void 0?ue:u[_])}),m});return onMounted(function(){var m;s.value=j$3({doc:n.modelValue,selection:d.value.selection,extensions:(m=u.extensions)!==null&&m!==void 0?m:[],onFocus:function(ue){return e.emit(O$4.Focus,ue)},onBlur:function(ue){return e.emit(O$4.Blur,ue)},onUpdate:function(ue){return e.emit(O$4.Update,ue)},onChange:function(ue,gn){ue!==n.modelValue&&(e.emit(O$4.Change,ue,gn),e.emit(O$4.ModelUpdate,ue,gn))}}),c.value=function(ue){return new EditorView(Object.assign({},ue))}({state:s.value,parent:o.value,root:d.value.root});var _=function(ue){var gn=function(){return ue.state.doc.toString()},nh=S$4(ue).run,ih=x$2(ue,[EditorView.editable.of(!1),EditorState.readOnly.of(!0)]),rh=x$2(ue,keymap.of([indentWithTab])),oh=S$4(ue).run,lh=S$4(ue).run,ch=S$4(ue).run,dh=S$4(ue).run;return{focus:function(){return ue.focus()},getDoc:gn,setDoc:function(_h){_h!==gn()&&ue.dispatch({changes:{from:0,to:ue.state.doc.length,insert:_h}})},reExtensions:nh,toggleDisabled:ih,toggleIndentWithTab:rh,setTabSize:function(_h){oh([EditorState.tabSize.of(_h),indentUnit.of(" ".repeat(_h))])},setPhrases:function(_h){lh([EditorState.phrases.of(_h)])},setPlaceholder:function(_h){ch(placeholder(_h))},setStyle:function(_h){_h===void 0&&(_h={}),dh(EditorView.theme({"&":Object.assign({},_h)}))}}}(c.value);watch(function(){return n.modelValue},function(ue){ue!==_.getDoc()&&_.setDoc(ue)}),watch(function(){return n.extensions},function(ue){return _.reExtensions(ue||[])},{immediate:!0}),watch(function(){return d.value.disabled},function(ue){return _.toggleDisabled(ue)},{immediate:!0}),watch(function(){return d.value.indentWithTab},function(ue){return _.toggleIndentWithTab(ue)},{immediate:!0}),watch(function(){return d.value.tabSize},function(ue){return _.setTabSize(ue)},{immediate:!0}),watch(function(){return d.value.phrases},function(ue){return _.setPhrases(ue||{})},{immediate:!0}),watch(function(){return d.value.placeholder},function(ue){return _.setPlaceholder(ue)},{immediate:!0}),watch(function(){return d.value.style},function(ue){return _.setStyle(ue)},{immediate:!0}),d.value.autofocus&&_.focus(),e.emit(O$4.Ready,{state:s.value,view:c.value,container:o.value})}),onBeforeUnmount(function(){d.value.autoDestroy&&c.value&&function(m){m.destroy()}(c.value)}),function(){return h$1("div",{class:"v-codemirror",style:{display:"contents"},ref:o})}}}),T$2=P$1,V$2=function(n,e){n.component(P$1.name,P$1),n.component("Codemirror",P$1),function(o,s){o.provide(y$1,s)}(n,e)},W$5={Codemirror:T$2,install:V$2};const U$3={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},$$1={LIGHT:"light",DARK:"dark",COLORED:"colored",AUTO:"auto"},g={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},Ne$1={BOUNCE:"bounce",SLIDE:"slide",FLIP:"flip",ZOOM:"zoom"},de$1={dangerouslyHTMLString:!1,multiple:!0,position:U$3.TOP_RIGHT,autoClose:5e3,transition:"bounce",hideProgressBar:!1,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,className:"",bodyClassName:"",style:{},progressClassName:"",progressStyle:{},role:"alert",theme:"light"},Ie$2={rtl:!1,newestOnTop:!1,toastClassName:""},ce$1={...de$1,...Ie$2};({...de$1,type:g.DEFAULT});var r$1=(n=>(n[n.COLLAPSE_DURATION=300]="COLLAPSE_DURATION",n[n.DEBOUNCE_DURATION=50]="DEBOUNCE_DURATION",n.CSS_NAMESPACE="Toastify",n))(r$1||{}),X$2=(n=>(n.ENTRANCE_ANIMATION_END="d",n))(X$2||{});const _e$1={enter:"Toastify--animate Toastify__bounce-enter",exit:"Toastify--animate Toastify__bounce-exit",appendPosition:!0},he$1={enter:"Toastify--animate Toastify__slide-enter",exit:"Toastify--animate Toastify__slide-exit",appendPosition:!0},Oe$3={enter:"Toastify--animate Toastify__zoom-enter",exit:"Toastify--animate Toastify__zoom-exit"},be$3={enter:"Toastify--animate Toastify__flip-enter",exit:"Toastify--animate Toastify__flip-exit"};function fe$2(n){let e=_e$1;if(!n||typeof n=="string")switch(n){case"flip":e=be$3;break;case"zoom":e=Oe$3;break;case"slide":e=he$1;break}else e=n;return e}function Pe$1(n){return n.containerId||String(n.position)}const Q$4="will-unmount";function Le$1(n=U$3.TOP_RIGHT){return!!document.querySelector(`.${r$1.CSS_NAMESPACE}__toast-container--${n}`)}function $e$2(n=U$3.TOP_RIGHT){return`${r$1.CSS_NAMESPACE}__toast-container--${n}`}function qe$1(n,e,o=!1){const s=[`${r$1.CSS_NAMESPACE}__toast-container`,`${r$1.CSS_NAMESPACE}__toast-container--${n}`,o?`${r$1.CSS_NAMESPACE}__toast-container--rtl`:null].filter(Boolean).join(" ");return L$4(e)?e({position:n,rtl:o,defaultClassName:s}):`${s} ${e||""}`}function Be$2(n){var e;const{position:o,containerClassName:s,rtl:c=!1,style:u={}}=n,d=r$1.CSS_NAMESPACE,m=$e$2(o),_=document.querySelector(`.${d}`),ue=document.querySelector(`.${m}`),gn=!!ue&&!((e=ue.className)!=null&&e.includes(Q$4)),nh=_||document.createElement("div"),ih=document.createElement("div");ih.className=qe$1(o,s,c),ih.dataset.testid=`${r$1.CSS_NAMESPACE}__toast-container--${o}`,ih.id=Pe$1(n);for(const rh in u)if(Object.prototype.hasOwnProperty.call(u,rh)){const oh=u[rh];ih.style[rh]=oh}return _||(nh.className=r$1.CSS_NAMESPACE,document.body.appendChild(nh)),gn||nh.appendChild(ih),ih}function J$5(n){var e,o,s;const c=typeof n=="string"?n:((e=n.currentTarget)==null?void 0:e.id)||((o=n.target)==null?void 0:o.id),u=document.getElementById(c);u&&u.removeEventListener("animationend",J$5,!1);try{F$3[c].unmount(),(s=document.getElementById(c))==null||s.remove(),delete F$3[c],delete f[c]}catch{}}const F$3=reactive({});function Me$2(n,e){const o=document.getElementById(String(e));o&&(F$3[o.id]=n)}function ee$1(n,e=!0){const o=String(n);if(!F$3[o])return;const s=document.getElementById(o);s&&s.classList.add(Q$4),e?(Re$2(n),s&&s.addEventListener("animationend",J$5,!1)):J$5(o),A$2.items=A$2.items.filter(c=>c.containerId!==n)}function we$1(n){for(const e in F$3)ee$1(e,n);A$2.items=[]}function me$1(n,e){const o=document.getElementById(n.toastId);if(o){let s=n;s={...s,...fe$2(s.transition)};const c=s.appendPosition?`${s.exit}--${s.position}`:s.exit;o.className+=` ${c}`,e&&e(o)}}function Re$2(n){for(const e in f)if(e===n)for(const o of f[e]||[])me$1(o)}function Fe$2(n){const e=x$1().find(o=>o.toastId===n);return e==null?void 0:e.containerId}function oe$1(n){return document.getElementById(n)}function Ue$2(n){const e=oe$1(n.containerId);return e&&e.classList.contains(Q$4)}function se$1(n){var e;const o=isVNode(n.content)?toRaw(n.content.props):null;return o??toRaw((e=n.data)!=null?e:{})}function xe$2(n){return n?A$2.items.filter(e=>e.containerId===n).length>0:A$2.items.length>0}function De$2(){if(A$2.items.length>0){const n=A$2.items.shift();H$2(n==null?void 0:n.toastContent,n==null?void 0:n.toastProps)}}const f=reactive({}),A$2=reactive({items:[]});function x$1(){const n=toRaw(f);return Object.values(n).reduce((e,o)=>[...e,...o],[])}function ke$2(n){return x$1().find(e=>e.toastId===n)}function H$2(n,e={}){if(Ue$2(e)){const o=oe$1(e.containerId);o&&o.addEventListener("animationend",te$1.bind(null,n,e),!1)}else te$1(n,e)}function te$1(n,e={}){const o=oe$1(e.containerId);o&&o.removeEventListener("animationend",te$1.bind(null,n,e),!1);const s=f[e.containerId]||[],c=s.length>0;if(!c&&!Le$1(e.position)){const u=Be$2(e),d=createApp(rt$1,e);d.mount(u),Me$2(d,u.id)}c&&(e.position=s[0].position),nextTick(()=>{e.updateId?p$1.update(e):p$1.add(n,e)})}const p$1={add(n,e){const{containerId:o=""}=e;o&&(f[o]=f[o]||[],f[o].find(s=>s.toastId===e.toastId)||setTimeout(()=>{var s,c;e.newestOnTop?(s=f[o])==null||s.unshift(e):(c=f[o])==null||c.push(e),e.onOpen&&e.onOpen(se$1(e))},e.delay||0))},remove(n){if(n){const e=Fe$2(n);if(e){const o=f[e];let s=o.find(c=>c.toastId===n);f[e]=o.filter(c=>c.toastId!==n),!f[e].length&&!xe$2(e)&&ee$1(e,!1),De$2(),nextTick(()=>{s!=null&&s.onClose&&(s.onClose(se$1(s)),s=void 0)})}}},update(n={}){const{containerId:e=""}=n;if(e&&n.updateId){f[e]=f[e]||[];const o=f[e].find(s=>s.toastId===n.toastId);o&&setTimeout(()=>{for(const s in n)if(Object.prototype.hasOwnProperty.call(n,s)){const c=n[s];o[s]=c}},n.delay||0)}},clear(n,e=!0){n?ee$1(n,e):we$1(e)},dismissCallback(n){var e;const o=(e=n.currentTarget)==null?void 0:e.id,s=document.getElementById(o);s&&(s.removeEventListener("animationend",p$1.dismissCallback,!1),setTimeout(()=>{p$1.remove(o)}))},dismiss(n){if(n){const e=x$1();for(const o of e)if(o.toastId===n){me$1(o,s=>{s.addEventListener("animationend",p$1.dismissCallback,!1)});break}}}},ge$1=reactive({}),G$3=reactive({});function Ce$2(){return Math.random().toString(36).substring(2,9)}function He$2(n){return typeof n=="number"&&!isNaN(n)}function ne$1(n){return typeof n=="string"}function L$4(n){return typeof n=="function"}function W$4(...n){return mergeProps(...n)}function z$3(n){return typeof n=="object"&&(!!(n!=null&&n.render)||!!(n!=null&&n.setup)||typeof(n==null?void 0:n.type)=="object")}function ze$1(n={}){ge$1[`${r$1.CSS_NAMESPACE}-default-options`]=n}function je$2(){return ge$1[`${r$1.CSS_NAMESPACE}-default-options`]||ce$1}function Ge$1(){return document.documentElement.classList.contains("dark")?"dark":"light"}var j$2=(n=>(n[n.Enter=0]="Enter",n[n.Exit=1]="Exit",n))(j$2||{});const ye$2={containerId:{type:[String,Number],required:!1,default:""},clearOnUrlChange:{type:Boolean,required:!1,default:!0},dangerouslyHTMLString:{type:Boolean,required:!1,default:!1},multiple:{type:Boolean,required:!1,default:!0},limit:{type:Number,required:!1,default:void 0},position:{type:String,required:!1,default:U$3.TOP_LEFT},bodyClassName:{type:String,required:!1,default:""},autoClose:{type:[Number,Boolean],required:!1,default:!1},closeButton:{type:[Boolean,Function,Object],required:!1,default:void 0},transition:{type:[String,Object],required:!1,default:"bounce"},hideProgressBar:{type:Boolean,required:!1,default:!1},pauseOnHover:{type:Boolean,required:!1,default:!0},pauseOnFocusLoss:{type:Boolean,required:!1,default:!0},closeOnClick:{type:Boolean,required:!1,default:!0},progress:{type:Number,required:!1,default:void 0},progressClassName:{type:String,required:!1,default:""},toastStyle:{type:Object,required:!1,default(){return{}}},progressStyle:{type:Object,required:!1,default(){return{}}},role:{type:String,required:!1,default:"alert"},theme:{type:String,required:!1,default:$$1.AUTO},content:{type:[String,Object,Function],required:!1,default:""},toastId:{type:[String,Number],required:!1,default:""},data:{type:[Object,String],required:!1,default(){return{}}},type:{type:String,required:!1,default:g.DEFAULT},icon:{type:[Boolean,String,Number,Object,Function],required:!1,default:void 0},delay:{type:Number,required:!1,default:void 0},onOpen:{type:Function,required:!1,default:void 0},onClose:{type:Function,required:!1,default:void 0},onClick:{type:Function,required:!1,default:void 0},isLoading:{type:Boolean,required:!1,default:void 0},rtl:{type:Boolean,required:!1,default:!1},toastClassName:{type:String,required:!1,default:""},updateId:{type:[String,Number],required:!1,default:""}},Ve$2={autoClose:{type:[Number,Boolean],required:!0},isRunning:{type:Boolean,required:!1,default:void 0},type:{type:String,required:!1,default:g.DEFAULT},theme:{type:String,required:!1,default:$$1.AUTO},hide:{type:Boolean,required:!1,default:void 0},className:{type:[String,Function],required:!1,default:""},controlledProgress:{type:Boolean,required:!1,default:void 0},rtl:{type:Boolean,required:!1,default:void 0},isIn:{type:Boolean,required:!1,default:void 0},progress:{type:Number,required:!1,default:void 0},closeToast:{type:Function,required:!1,default:void 0}},Qe$2=defineComponent({name:"ProgressBar",props:Ve$2,setup(n,{attrs:e}){const o=ref$1(),s=computed(()=>n.hide?"true":"false"),c=computed(()=>({...e.style||{},animationDuration:`${n.autoClose===!0?5e3:n.autoClose}ms`,animationPlayState:n.isRunning?"running":"paused",opacity:n.hide?0:1,transform:n.controlledProgress?`scaleX(${n.progress})`:"none"})),u=computed(()=>[`${r$1.CSS_NAMESPACE}__progress-bar`,n.controlledProgress?`${r$1.CSS_NAMESPACE}__progress-bar--controlled`:`${r$1.CSS_NAMESPACE}__progress-bar--animated`,`${r$1.CSS_NAMESPACE}__progress-bar-theme--${n.theme}`,`${r$1.CSS_NAMESPACE}__progress-bar--${n.type}`,n.rtl?`${r$1.CSS_NAMESPACE}__progress-bar--rtl`:null].filter(Boolean).join(" ")),d=computed(()=>`${u.value} ${(e==null?void 0:e.class)||""}`),m=()=>{o.value&&(o.value.onanimationend=null,o.value.ontransitionend=null)},_=()=>{n.isIn&&n.closeToast&&n.autoClose!==!1&&(n.closeToast(),m())},ue=computed(()=>n.controlledProgress?null:_),gn=computed(()=>n.controlledProgress?_:null);return watchEffect(()=>{o.value&&(m(),o.value.onanimationend=ue.value,o.value.ontransitionend=gn.value)}),()=>createVNode("div",{ref:o,role:"progressbar","aria-hidden":s.value,"aria-label":"notification timer",class:d.value,style:c.value},null)}}),We$1=defineComponent({name:"CloseButton",inheritAttrs:!1,props:{theme:{type:String,required:!1,default:$$1.AUTO},type:{type:String,required:!1,default:$$1.LIGHT},ariaLabel:{type:String,required:!1,default:"close"},closeToast:{type:Function,required:!1,default:void 0}},setup(n){return()=>createVNode("button",{class:`${r$1.CSS_NAMESPACE}__close-button ${r$1.CSS_NAMESPACE}__close-button--${n.theme}`,type:"button",onClick:e=>{e.stopPropagation(),n.closeToast&&n.closeToast(e)},"aria-label":n.ariaLabel},[createVNode("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},[createVNode("path",{"fill-rule":"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"},null)])])}}),K$4=({theme:n,type:e,path:o,...s})=>createVNode("svg",mergeProps({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:n==="colored"?"currentColor":`var(--toastify-icon-color-${e})`},s),[createVNode("path",{d:o},null)]);function Ke$1(n){return createVNode(K$4,mergeProps(n,{path:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}),null)}function Ye$1(n){return createVNode(K$4,mergeProps(n,{path:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}),null)}function Ze$1(n){return createVNode(K$4,mergeProps(n,{path:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}),null)}function Xe$2(n){return createVNode(K$4,mergeProps(n,{path:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}),null)}function Je$1(){return createVNode("div",{class:`${r$1.CSS_NAMESPACE}__spinner`},null)}const ae$2={info:Ye$1,warning:Ke$1,success:Ze$1,error:Xe$2,spinner:Je$1},et$2=n=>n in ae$2;function tt$3({theme:n,type:e,isLoading:o,icon:s}){let c;const u={theme:n,type:e};return o?c=ae$2.spinner():s===!1?c=void 0:z$3(s)?c=toRaw(s):L$4(s)?c=s(u):isVNode(s)?c=cloneVNode(s,u):ne$1(s)||He$2(s)?c=s:et$2(e)&&(c=ae$2[e](u)),c}const nt$2=()=>{};function at$2(n,e,o=r$1.COLLAPSE_DURATION){const{scrollHeight:s,style:c}=n,u=o;requestAnimationFrame(()=>{c.minHeight="initial",c.height=s+"px",c.transition=`all ${u}ms`,requestAnimationFrame(()=>{c.height="0",c.padding="0",c.margin="0",setTimeout(e,u)})})}function ot$1(n){const e=ref$1(!1),o=ref$1(!1),s=ref$1(!1),c=ref$1(j$2.Enter),u=reactive({...n,appendPosition:n.appendPosition||!1,collapse:typeof n.collapse>"u"?!0:n.collapse,collapseDuration:n.collapseDuration||r$1.COLLAPSE_DURATION}),d=u.done||nt$2,m=computed(()=>u.appendPosition?`${u.enter}--${u.position}`:u.enter),_=computed(()=>u.appendPosition?`${u.exit}--${u.position}`:u.exit),ue=computed(()=>n.pauseOnHover?{onMouseenter:ch,onMouseleave:lh}:{});function gn(){const _h=m.value.split(" ");ih().addEventListener(X$2.ENTRANCE_ANIMATION_END,lh,{once:!0});const Sh=yh=>{const mh=ih();yh.target===mh&&(mh.dispatchEvent(new Event(X$2.ENTRANCE_ANIMATION_END)),mh.removeEventListener("animationend",Sh),mh.removeEventListener("animationcancel",Sh),c.value===j$2.Enter&&yh.type!=="animationcancel"&&mh.classList.remove(..._h))},fh=()=>{const yh=ih();yh.classList.add(..._h),yh.addEventListener("animationend",Sh),yh.addEventListener("animationcancel",Sh)};n.pauseOnFocusLoss&&rh(),fh()}function nh(){if(!ih())return;const _h=()=>{const fh=ih();fh.removeEventListener("animationend",_h),u.collapse?at$2(fh,d,u.collapseDuration):d()},Sh=()=>{const fh=ih();c.value=j$2.Exit,fh&&(fh.className+=` ${_.value}`,fh.addEventListener("animationend",_h))};o.value||(s.value?_h():setTimeout(Sh))}function ih(){return n.toastRef.value}function rh(){document.hasFocus()||ch(),window.addEventListener("focus",lh),window.addEventListener("blur",ch)}function oh(){window.removeEventListener("focus",lh),window.removeEventListener("blur",ch)}function lh(){(!n.loading.value||n.isLoading===void 0)&&(e.value=!0)}function ch(){e.value=!1}function dh(_h){_h&&(_h.stopPropagation(),_h.preventDefault()),o.value=!1}return watchEffect(nh),watchEffect(()=>{const _h=x$1();o.value=_h.findIndex(Sh=>Sh.toastId===u.toastId)>-1}),watchEffect(()=>{n.isLoading!==void 0&&(n.loading.value?ch():lh())}),onMounted(gn),onUnmounted(()=>{n.pauseOnFocusLoss&&oh()}),{isIn:o,isRunning:e,hideToast:dh,eventHandlers:ue}}const st$2=defineComponent({name:"ToastItem",inheritAttrs:!1,props:ye$2,setup(n){const e=ref$1(),o=computed(()=>!!n.isLoading),s=computed(()=>n.progress!==void 0&&n.progress!==null),c=computed(()=>tt$3(n)),u=computed(()=>[`${r$1.CSS_NAMESPACE}__toast`,`${r$1.CSS_NAMESPACE}__toast-theme--${n.theme}`,`${r$1.CSS_NAMESPACE}__toast--${n.type}`,n.rtl?`${r$1.CSS_NAMESPACE}__toast--rtl`:void 0,n.toastClassName||""].filter(Boolean).join(" ")),{isRunning:d,isIn:m,hideToast:_,eventHandlers:ue}=ot$1({toastRef:e,loading:o,done:()=>{p$1.remove(n.toastId)},...fe$2(n.transition),...n});return()=>createVNode("div",mergeProps({id:n.toastId,class:u.value,style:n.toastStyle||{},ref:e,"data-testid":`toast-item-${n.toastId}`,onClick:gn=>{n.closeOnClick&&_(),n.onClick&&n.onClick(gn)}},ue.value),[createVNode("div",{role:n.role,"data-testid":"toast-body",class:`${r$1.CSS_NAMESPACE}__toast-body ${n.bodyClassName||""}`},[c.value!=null&&createVNode("div",{"data-testid":`toast-icon-${n.type}`,class:[`${r$1.CSS_NAMESPACE}__toast-icon`,n.isLoading?"":`${r$1.CSS_NAMESPACE}--animate-icon ${r$1.CSS_NAMESPACE}__zoom-enter`].join(" ")},[z$3(c.value)?h$1(toRaw(c.value),{theme:n.theme,type:n.type}):L$4(c.value)?c.value({theme:n.theme,type:n.type}):c.value]),createVNode("div",{"data-testid":"toast-content"},[z$3(n.content)?h$1(toRaw(n.content),{toastProps:toRaw(n),closeToast:_,data:n.data}):L$4(n.content)?n.content({toastProps:toRaw(n),closeToast:_,data:n.data}):n.dangerouslyHTMLString?h$1("div",{innerHTML:n.content}):n.content])]),(n.closeButton===void 0||n.closeButton===!0)&&createVNode(We$1,{theme:n.theme,closeToast:gn=>{gn.stopPropagation(),gn.preventDefault(),_()}},null),z$3(n.closeButton)?h$1(toRaw(n.closeButton),{closeToast:_,type:n.type,theme:n.theme}):L$4(n.closeButton)?n.closeButton({closeToast:_,type:n.type,theme:n.theme}):null,createVNode(Qe$2,{className:n.progressClassName,style:n.progressStyle,rtl:n.rtl,theme:n.theme,isIn:m.value,type:n.type,hide:n.hideProgressBar,isRunning:d.value,autoClose:n.autoClose,controlledProgress:s.value,progress:n.progress,closeToast:n.isLoading?void 0:_},null)])}});let R$2=0;function Ee$1(){typeof window>"u"||(R$2&&window.cancelAnimationFrame(R$2),R$2=window.requestAnimationFrame(Ee$1),G$3.lastUrl!==window.location.href&&(G$3.lastUrl=window.location.href,p$1.clear()))}const rt$1=defineComponent({name:"ToastifyContainer",inheritAttrs:!1,props:ye$2,setup(n){const e=computed(()=>n.containerId),o=computed(()=>f[e.value]||[]),s=computed(()=>o.value.filter(c=>c.position===n.position));return onMounted(()=>{typeof window<"u"&&n.clearOnUrlChange&&window.requestAnimationFrame(Ee$1)}),onUnmounted(()=>{typeof window<"u"&&R$2&&(window.cancelAnimationFrame(R$2),G$3.lastUrl="")}),()=>createVNode(Fragment,null,[s.value.map(c=>{const{toastId:u=""}=c;return createVNode(st$2,mergeProps({key:u},c),null)})])}});let Z$3=!1;function Se$1(){const n=[];return x$1().forEach(e=>{const o=document.getElementById(e.containerId);o&&!o.classList.contains(Q$4)&&n.push(e)}),n}function it$1(n){const e=Se$1().length,o=n??0;return o>0&&e+A$2.items.length>=o}function lt$1(n){it$1(n.limit)&&!n.updateId&&A$2.items.push({toastId:n.toastId,containerId:n.containerId,toastContent:n.content,toastProps:n})}function O$3(n,e,o={}){if(Z$3)return;o=W$4(je$2(),{type:e},toRaw(o)),(!o.toastId||typeof o.toastId!="string"&&typeof o.toastId!="number")&&(o.toastId=Ce$2()),o={...o,content:n,containerId:o.containerId||String(o.position)};const s=Number(o==null?void 0:o.progress);return s<0&&(o.progress=0),s>1&&(o.progress=1),o.theme==="auto"&&(o.theme=Ge$1()),lt$1(o),G$3.lastUrl=window.location.href,o.multiple?A$2.items.length?o.updateId&&H$2(n,o):H$2(n,o):(Z$3=!0,i.clearAll(void 0,!1),setTimeout(()=>{H$2(n,o)},0),setTimeout(()=>{Z$3=!1},390)),o.toastId}const i=(n,e)=>O$3(n,g.DEFAULT,e);i.info=(n,e)=>O$3(n,g.DEFAULT,{...e,type:g.INFO});i.error=(n,e)=>O$3(n,g.DEFAULT,{...e,type:g.ERROR});i.warning=(n,e)=>O$3(n,g.DEFAULT,{...e,type:g.WARNING});i.warn=i.warning;i.success=(n,e)=>O$3(n,g.DEFAULT,{...e,type:g.SUCCESS});i.loading=(n,e)=>O$3(n,g.DEFAULT,W$4(e,{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1}));i.dark=(n,e)=>O$3(n,g.DEFAULT,W$4(e,{theme:$$1.DARK}));i.remove=n=>{n?p$1.dismiss(n):p$1.clear()};i.clearAll=(n,e)=>{p$1.clear(n,e)};i.isActive=n=>{let e=!1;return e=Se$1().findIndex(o=>o.toastId===n)>-1,e};i.update=(n,e={})=>{setTimeout(()=>{const o=ke$2(n);if(o){const s=toRaw(o),{content:c}=s,u={...s,...e,toastId:e.toastId||n,updateId:Ce$2()},d=u.render||c;delete u.render,O$3(d,u.type,u)}},0)};i.done=n=>{i.update(n,{isLoading:!1,progress:1})};i.promise=ut;function ut(n,{pending:e,error:o,success:s},c){let u;e&&(u=ne$1(e)?i.loading(e,c):i.loading(e.render,{...c,...e}));const d={isLoading:void 0,autoClose:null,closeOnClick:null,closeButton:null,draggable:null,delay:100},m=(ue,gn,nh)=>{if(gn==null){i.remove(u);return}const ih={type:ue,...d,...c,data:nh},rh=ne$1(gn)?{render:gn}:gn;return u?i.update(u,{...ih,...rh,isLoading:!1,autoClose:!0}):i(rh.render,{...ih,...rh,isLoading:!1,autoClose:!0}),nh},_=L$4(n)?n():n;return _.then(ue=>{m("success",s,ue)}).catch(ue=>{m("error",o,ue)}),_}i.POSITION=U$3;i.THEME=$$1;i.TYPE=g;i.TRANSITIONS=Ne$1;const dt$2={install(n,e={}){ct$2(e)}};typeof window<"u"&&(window.Vue3Toastify=dt$2);function ct$2(n={}){const e=W$4(ce$1,n);ze$1(e)}const index="";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CONSTANTS={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const assert=function(n,e){if(!n)throw assertionError(e)},assertionError=function(n){return new Error("Firebase Database ("+CONSTANTS.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(n){const e=[];let o=0;for(let s=0;s<n.length;s++){let c=n.charCodeAt(s);c<128?e[o++]=c:c<2048?(e[o++]=c>>6|192,e[o++]=c&63|128):(c&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(c=65536+((c&1023)<<10)+(n.charCodeAt(++s)&1023),e[o++]=c>>18|240,e[o++]=c>>12&63|128,e[o++]=c>>6&63|128,e[o++]=c&63|128):(e[o++]=c>>12|224,e[o++]=c>>6&63|128,e[o++]=c&63|128)}return e},byteArrayToString=function(n){const e=[];let o=0,s=0;for(;o<n.length;){const c=n[o++];if(c<128)e[s++]=String.fromCharCode(c);else if(c>191&&c<224){const u=n[o++];e[s++]=String.fromCharCode((c&31)<<6|u&63)}else if(c>239&&c<365){const u=n[o++],d=n[o++],m=n[o++],_=((c&7)<<18|(u&63)<<12|(d&63)<<6|m&63)-65536;e[s++]=String.fromCharCode(55296+(_>>10)),e[s++]=String.fromCharCode(56320+(_&1023))}else{const u=n[o++],d=n[o++];e[s++]=String.fromCharCode((c&15)<<12|(u&63)<<6|d&63)}}return e.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const o=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let c=0;c<n.length;c+=3){const u=n[c],d=c+1<n.length,m=d?n[c+1]:0,_=c+2<n.length,ue=_?n[c+2]:0,gn=u>>2,nh=(u&3)<<4|m>>4;let ih=(m&15)<<2|ue>>6,rh=ue&63;_||(rh=64,d||(ih=64)),s.push(o[gn],o[nh],o[ih],o[rh])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(stringToByteArray$1(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):byteArrayToString(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const o=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let c=0;c<n.length;){const u=o[n.charAt(c++)],m=c<n.length?o[n.charAt(c)]:0;++c;const ue=c<n.length?o[n.charAt(c)]:64;++c;const nh=c<n.length?o[n.charAt(c)]:64;if(++c,u==null||m==null||ue==null||nh==null)throw new DecodeBase64StringError;const ih=u<<2|m>>4;if(s.push(ih),ue!==64){const rh=m<<4&240|ue>>2;if(s.push(rh),nh!==64){const oh=ue<<6&192|nh;s.push(oh)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(n){const e=stringToByteArray$1(n);return base64.encodeByteArray(e,!0)},base64urlEncodeWithoutPadding=function(n){return base64Encode(n).replace(/\./g,"")},base64Decode=function(n){try{return base64.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function deepCopy(n){return deepExtend(void 0,n)}function deepExtend(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const o=e;return new Date(o.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const o in e)!e.hasOwnProperty(o)||!isValidKey$1(o)||(n[o]=deepExtend(n[o],e[o]));return n}function isValidKey$1(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&base64Decode(n[1]);return e&&JSON.parse(e)},getDefaults=()=>{try{return getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},getDefaultEmulatorHost=n=>{var e,o;return(o=(e=getDefaults())===null||e===void 0?void 0:e.emulatorHosts)===null||o===void 0?void 0:o[n]},getDefaultEmulatorHostnameAndPort=n=>{const e=getDefaultEmulatorHost(n);if(!e)return;const o=e.lastIndexOf(":");if(o<=0||o+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(o+1),10);return e[0]==="["?[e.substring(1,o-1),s]:[e.substring(0,o),s]},getDefaultAppConfig=()=>{var n;return(n=getDefaults())===null||n===void 0?void 0:n.config},getExperimentalSetting=n=>{var e;return(e=getDefaults())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,o)=>{this.resolve=e,this.reject=o})}wrapCallback(e){return(o,s)=>{o?this.reject(o):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(o):e(o,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const o={alg:"none",type:"JWT"},s=e||"demo-project",c=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const d=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:c,exp:c+3600,auth_time:c,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n),m="";return[base64urlEncodeWithoutPadding(JSON.stringify(o)),base64urlEncodeWithoutPadding(JSON.stringify(d)),m].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isMobileCordova(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isBrowserExtension(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function isReactNative(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function isIE(){const n=getUA();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function isNodeSdk(){return CONSTANTS.NODE_ADMIN===!0}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((n,e)=>{try{let o=!0;const s="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(s);c.onsuccess=()=>{c.result.close(),o||self.indexedDB.deleteDatabase(s),n(!0)},c.onupgradeneeded=()=>{o=!1},c.onerror=()=>{var u;e(((u=c.error)===null||u===void 0?void 0:u.message)||"")}}catch(o){e(o)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(e,o,s){super(o),this.code=e,this.customData=s,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,o,s){this.service=e,this.serviceName=o,this.errors=s}create(e,...o){const s=o[0]||{},c=`${this.service}/${e}`,u=this.errors[e],d=u?replaceTemplate(u,s):"Error",m=`${this.serviceName}: ${d} (${c}).`;return new FirebaseError(c,m,s)}}function replaceTemplate(n,e){return n.replace(PATTERN,(o,s)=>{const c=e[s];return c!=null?String(c):`<${s}?>`})}const PATTERN=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jsonEval(n){return JSON.parse(n)}function stringify(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const decode$1=function(n){let e={},o={},s={},c="";try{const u=n.split(".");e=jsonEval(base64Decode(u[0])||""),o=jsonEval(base64Decode(u[1])||""),c=u[2],s=o.d||{},delete o.d}catch{}return{header:e,claims:o,data:s,signature:c}},isValidFormat=function(n){const e=decode$1(n),o=e.claims;return!!o&&typeof o=="object"&&o.hasOwnProperty("iat")},isAdmin=function(n){const e=decode$1(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function contains(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function safeGet(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function isEmpty(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function map(n,e,o){const s={};for(const c in n)Object.prototype.hasOwnProperty.call(n,c)&&(s[c]=e.call(o,n[c],c,n));return s}function deepEqual(n,e){if(n===e)return!0;const o=Object.keys(n),s=Object.keys(e);for(const c of o){if(!s.includes(c))return!1;const u=n[c],d=e[c];if(isObject$1(u)&&isObject$1(d)){if(!deepEqual(u,d))return!1}else if(u!==d)return!1}for(const c of s)if(!o.includes(c))return!1;return!0}function isObject$1(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function querystring(n){const e=[];for(const[o,s]of Object.entries(n))Array.isArray(s)?s.forEach(c=>{e.push(encodeURIComponent(o)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(o)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function querystringDecode(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[c,u]=s.split("=");e[decodeURIComponent(c)]=decodeURIComponent(u)}}),e}function extractQuerystring(n){const e=n.indexOf("?");if(!e)return"";const o=n.indexOf("#",e);return n.substring(e,o>0?o:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sha1{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,o){o||(o=0);const s=this.W_;if(typeof e=="string")for(let nh=0;nh<16;nh++)s[nh]=e.charCodeAt(o)<<24|e.charCodeAt(o+1)<<16|e.charCodeAt(o+2)<<8|e.charCodeAt(o+3),o+=4;else for(let nh=0;nh<16;nh++)s[nh]=e[o]<<24|e[o+1]<<16|e[o+2]<<8|e[o+3],o+=4;for(let nh=16;nh<80;nh++){const ih=s[nh-3]^s[nh-8]^s[nh-14]^s[nh-16];s[nh]=(ih<<1|ih>>>31)&4294967295}let c=this.chain_[0],u=this.chain_[1],d=this.chain_[2],m=this.chain_[3],_=this.chain_[4],ue,gn;for(let nh=0;nh<80;nh++){nh<40?nh<20?(ue=m^u&(d^m),gn=1518500249):(ue=u^d^m,gn=1859775393):nh<60?(ue=u&d|m&(u|d),gn=2400959708):(ue=u^d^m,gn=3395469782);const ih=(c<<5|c>>>27)+ue+_+gn+s[nh]&4294967295;_=m,m=d,d=(u<<30|u>>>2)&4294967295,u=c,c=ih}this.chain_[0]=this.chain_[0]+c&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+d&4294967295,this.chain_[3]=this.chain_[3]+m&4294967295,this.chain_[4]=this.chain_[4]+_&4294967295}update(e,o){if(e==null)return;o===void 0&&(o=e.length);const s=o-this.blockSize;let c=0;const u=this.buf_;let d=this.inbuf_;for(;c<o;){if(d===0)for(;c<=s;)this.compress_(e,c),c+=this.blockSize;if(typeof e=="string"){for(;c<o;)if(u[d]=e.charCodeAt(c),++d,++c,d===this.blockSize){this.compress_(u),d=0;break}}else for(;c<o;)if(u[d]=e[c],++d,++c,d===this.blockSize){this.compress_(u),d=0;break}}this.inbuf_=d,this.total_+=o}digest(){const e=[];let o=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let c=this.blockSize-1;c>=56;c--)this.buf_[c]=o&255,o/=256;this.compress_(this.buf_);let s=0;for(let c=0;c<5;c++)for(let u=24;u>=0;u-=8)e[s]=this.chain_[c]>>u&255,++s;return e}}function createSubscribe(n,e){const o=new ObserverProxy(n,e);return o.subscribe.bind(o)}class ObserverProxy{constructor(e,o){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=o,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(o=>{o.next(e)})}error(e){this.forEachObserver(o=>{o.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,o,s){let c;if(e===void 0&&o===void 0&&s===void 0)throw new Error("Missing Observer.");implementsAnyMethods(e,["next","error","complete"])?c=e:c={next:e,error:o,complete:s},c.next===void 0&&(c.next=noop$2),c.error===void 0&&(c.error=noop$2),c.complete===void 0&&(c.complete=noop$2);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let o=0;o<this.observers.length;o++)this.sendOne(o,e)}sendOne(e,o){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{o(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function implementsAnyMethods(n,e){if(typeof n!="object"||n===null)return!1;for(const o of e)if(o in n&&typeof n[o]=="function")return!0;return!1}function noop$2(){}function errorPrefix(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray=function(n){const e=[];let o=0;for(let s=0;s<n.length;s++){let c=n.charCodeAt(s);if(c>=55296&&c<=56319){const u=c-55296;s++,assert(s<n.length,"Surrogate pair missing trail surrogate.");const d=n.charCodeAt(s)-56320;c=65536+(u<<10)+d}c<128?e[o++]=c:c<2048?(e[o++]=c>>6|192,e[o++]=c&63|128):c<65536?(e[o++]=c>>12|224,e[o++]=c>>6&63|128,e[o++]=c&63|128):(e[o++]=c>>18|240,e[o++]=c>>12&63|128,e[o++]=c>>6&63|128,e[o++]=c&63|128)}return e},stringLength=function(n){let e=0;for(let o=0;o<n.length;o++){const s=n.charCodeAt(o);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,o++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(n){return n&&n._delegate?n._delegate:n}class Component{constructor(e,o,s){this.name=e,this.instanceFactory=o,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(e,o){this.name=e,this.container=o,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const o=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(o)){const s=new Deferred;if(this.instancesDeferred.set(o,s),this.isInitialized(o)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:o});c&&s.resolve(c)}catch{}}return this.instancesDeferred.get(o).promise}getImmediate(e){var o;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),c=(o=e==null?void 0:e.optional)!==null&&o!==void 0?o:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(u){if(c)return null;throw u}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(isComponentEager(e))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[o,s]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(o);try{const u=this.getOrInitializeService({instanceIdentifier:c});s.resolve(u)}catch{}}}}clearInstance(e=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(o=>"INTERNAL"in o).map(o=>o.INTERNAL.delete()),...e.filter(o=>"_delete"in o).map(o=>o._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=DEFAULT_ENTRY_NAME$1){return this.instances.has(e)}getOptions(e=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:o={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:s,options:o});for(const[u,d]of this.instancesDeferred.entries()){const m=this.normalizeInstanceIdentifier(u);s===m&&d.resolve(c)}return c}onInit(e,o){var s;const c=this.normalizeInstanceIdentifier(o),u=(s=this.onInitCallbacks.get(c))!==null&&s!==void 0?s:new Set;u.add(e),this.onInitCallbacks.set(c,u);const d=this.instances.get(c);return d&&e(d,c),()=>{u.delete(e)}}invokeOnInitCallbacks(e,o){const s=this.onInitCallbacks.get(o);if(s)for(const c of s)try{c(e,o)}catch{}}getOrInitializeService({instanceIdentifier:e,options:o={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(e),options:o}),this.instances.set(e,s),this.instancesOptions.set(e,o),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?e:DEFAULT_ENTRY_NAME$1:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(n){return n===DEFAULT_ENTRY_NAME$1?void 0:n}function isComponentEager(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const o=this.getProvider(e.name);if(o.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);o.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const o=new Provider(e,this);return this.providers.set(e,o),o}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(n,e,...o)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),c=ConsoleMethod[e];if(c)console[c](`[${s}]  ${n.name}:`,...o);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Logger{constructor(e){this.name=e,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in LogLevel))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?levelStringToEnum[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...e),this._logHandler(this,LogLevel.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...e),this._logHandler(this,LogLevel.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...e),this._logHandler(this,LogLevel.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...e),this._logHandler(this,LogLevel.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...e),this._logHandler(this,LogLevel.ERROR,...e)}}const instanceOfAny=(n,e)=>e.some(o=>n instanceof o);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(n){const e=new Promise((o,s)=>{const c=()=>{n.removeEventListener("success",u),n.removeEventListener("error",d)},u=()=>{o(wrap(n.result)),c()},d=()=>{s(n.error),c()};n.addEventListener("success",u),n.addEventListener("error",d)});return e.then(o=>{o instanceof IDBCursor&&cursorRequestMap.set(o,n)}).catch(()=>{}),reverseTransformCache.set(e,n),e}function cacheDonePromiseForTransaction(n){if(transactionDoneMap.has(n))return;const e=new Promise((o,s)=>{const c=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",d),n.removeEventListener("abort",d)},u=()=>{o(),c()},d=()=>{s(n.error||new DOMException("AbortError","AbortError")),c()};n.addEventListener("complete",u),n.addEventListener("error",d),n.addEventListener("abort",d)});transactionDoneMap.set(n,e)}let idbProxyTraps={get(n,e,o){if(n instanceof IDBTransaction){if(e==="done")return transactionDoneMap.get(n);if(e==="objectStoreNames")return n.objectStoreNames||transactionStoreNamesMap.get(n);if(e==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return wrap(n[e])},set(n,e,o){return n[e]=o,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function replaceTraps(n){idbProxyTraps=n(idbProxyTraps)}function wrapFunction(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...o){const s=n.call(unwrap(this),e,...o);return transactionStoreNamesMap.set(s,e.sort?e.sort():[e]),wrap(s)}:getCursorAdvanceMethods().includes(n)?function(...e){return n.apply(unwrap(this),e),wrap(cursorRequestMap.get(this))}:function(...e){return wrap(n.apply(unwrap(this),e))}}function transformCachableValue(n){return typeof n=="function"?wrapFunction(n):(n instanceof IDBTransaction&&cacheDonePromiseForTransaction(n),instanceOfAny(n,getIdbProxyableTypes())?new Proxy(n,idbProxyTraps):n)}function wrap(n){if(n instanceof IDBRequest)return promisifyRequest(n);if(transformCache.has(n))return transformCache.get(n);const e=transformCachableValue(n);return e!==n&&(transformCache.set(n,e),reverseTransformCache.set(e,n)),e}const unwrap=n=>reverseTransformCache.get(n);function openDB(n,e,{blocked:o,upgrade:s,blocking:c,terminated:u}={}){const d=indexedDB.open(n,e),m=wrap(d);return s&&d.addEventListener("upgradeneeded",_=>{s(wrap(d.result),_.oldVersion,_.newVersion,wrap(d.transaction),_)}),o&&d.addEventListener("blocked",_=>o(_.oldVersion,_.newVersion,_)),m.then(_=>{u&&_.addEventListener("close",()=>u()),c&&_.addEventListener("versionchange",ue=>c(ue.oldVersion,ue.newVersion,ue))}).catch(()=>{}),m}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(cachedMethods.get(e))return cachedMethods.get(e);const o=e.replace(/FromIndex$/,""),s=e!==o,c=writeMethods.includes(o);if(!(o in(s?IDBIndex:IDBObjectStore).prototype)||!(c||readMethods.includes(o)))return;const u=async function(d,...m){const _=this.transaction(d,c?"readwrite":"readonly");let ue=_.store;return s&&(ue=ue.index(m.shift())),(await Promise.all([ue[o](...m),c&&_.done]))[0]};return cachedMethods.set(e,u),u}replaceTraps(n=>({...n,get:(e,o,s)=>getMethod(e,o)||n.get(e,o,s),has:(e,o)=>!!getMethod(e,o)||n.has(e,o)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(o=>{if(isVersionServiceProvider(o)){const s=o.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(o=>o).join(" ")}}function isVersionServiceProvider(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const name$o="@firebase/app",version$1$1="0.9.11";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger$2=new Logger("@firebase/app"),name$n="@firebase/app-compat",name$m="@firebase/analytics-compat",name$l="@firebase/analytics",name$k="@firebase/app-check-compat",name$j="@firebase/app-check",name$i="@firebase/auth",name$h="@firebase/auth-compat",name$g="@firebase/database",name$f="@firebase/database-compat",name$e="@firebase/functions",name$d="@firebase/functions-compat",name$c="@firebase/installations",name$b="@firebase/installations-compat",name$a="@firebase/messaging",name$9="@firebase/messaging-compat",name$8="@firebase/performance",name$7="@firebase/performance-compat",name$6="@firebase/remote-config",name$5="@firebase/remote-config-compat",name$4$1="@firebase/storage",name$3$1="@firebase/storage-compat",name$2$1="@firebase/firestore",name$1$1="@firebase/firestore-compat",name$p="firebase",version$5="9.22.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$o]:"fire-core",[name$n]:"fire-core-compat",[name$l]:"fire-analytics",[name$m]:"fire-analytics-compat",[name$j]:"fire-app-check",[name$k]:"fire-app-check-compat",[name$i]:"fire-auth",[name$h]:"fire-auth-compat",[name$g]:"fire-rtdb",[name$f]:"fire-rtdb-compat",[name$e]:"fire-fn",[name$d]:"fire-fn-compat",[name$c]:"fire-iid",[name$b]:"fire-iid-compat",[name$a]:"fire-fcm",[name$9]:"fire-fcm-compat",[name$8]:"fire-perf",[name$7]:"fire-perf-compat",[name$6]:"fire-rc",[name$5]:"fire-rc-compat",[name$4$1]:"fire-gcs",[name$3$1]:"fire-gcs-compat",[name$2$1]:"fire-fst",[name$1$1]:"fire-fst-compat","fire-js":"fire-js",[name$p]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_components=new Map;function _addComponent(n,e){try{n.container.addComponent(e)}catch(o){logger$2.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,o)}}function _registerComponent(n){const e=n.name;if(_components.has(e))return logger$2.debug(`There were multiple attempts to register component ${e}.`),!1;_components.set(e,n);for(const o of _apps.values())_addComponent(o,n);return!0}function _getProvider(n,e){const o=n.container.getProvider("heartbeat").getImmediate({optional:!0});return o&&o.triggerHeartbeat(),n.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS$1={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},ERROR_FACTORY$1=new ErrorFactory("app","Firebase",ERRORS$1);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(e,o,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},o),this._name=o.name,this._automaticDataCollectionEnabled=o.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY$1.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION$1=version$5;function initializeApp(n,e={}){let o=n;typeof e!="object"&&(e={name:e});const s=Object.assign({name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!1},e),c=s.name;if(typeof c!="string"||!c)throw ERROR_FACTORY$1.create("bad-app-name",{appName:String(c)});if(o||(o=getDefaultAppConfig()),!o)throw ERROR_FACTORY$1.create("no-options");const u=_apps.get(c);if(u){if(deepEqual(o,u.options)&&deepEqual(s,u.config))return u;throw ERROR_FACTORY$1.create("duplicate-app",{appName:c})}const d=new ComponentContainer(c);for(const _ of _components.values())d.addComponent(_);const m=new FirebaseAppImpl(o,s,d);return _apps.set(c,m),m}function getApp(n=DEFAULT_ENTRY_NAME){const e=_apps.get(n);if(!e&&n===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!e)throw ERROR_FACTORY$1.create("no-app",{appName:n});return e}function registerVersion(n,e,o){var s;let c=(s=PLATFORM_LOG_STRING[n])!==null&&s!==void 0?s:n;o&&(c+=`-${o}`);const u=c.match(/\s|\//),d=e.match(/\s|\//);if(u||d){const m=[`Unable to register library "${c}" with version "${e}":`];u&&m.push(`library name "${c}" contains illegal characters (whitespace or "/")`),u&&d&&m.push("and"),d&&m.push(`version name "${e}" contains illegal characters (whitespace or "/")`),logger$2.warn(m.join(" "));return}_registerComponent(new Component(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME$2="firebase-heartbeat-database",DB_VERSION$2=1,STORE_NAME$1="firebase-heartbeat-store";let dbPromise$1=null;function getDbPromise(){return dbPromise$1||(dbPromise$1=openDB(DB_NAME$2,DB_VERSION$2,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(STORE_NAME$1)}}}).catch(n=>{throw ERROR_FACTORY$1.create("idb-open",{originalErrorMessage:n.message})})),dbPromise$1}async function readHeartbeatsFromIndexedDB(n){try{return await(await getDbPromise()).transaction(STORE_NAME$1).objectStore(STORE_NAME$1).get(computeKey$1(n))}catch(e){if(e instanceof FirebaseError)logger$2.warn(e.message);else{const o=ERROR_FACTORY$1.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});logger$2.warn(o.message)}}}async function writeHeartbeatsToIndexedDB(n,e){try{const s=(await getDbPromise()).transaction(STORE_NAME$1,"readwrite");await s.objectStore(STORE_NAME$1).put(e,computeKey$1(n)),await s.done}catch(o){if(o instanceof FirebaseError)logger$2.warn(o.message);else{const s=ERROR_FACTORY$1.create("idb-set",{originalErrorMessage:o==null?void 0:o.message});logger$2.warn(s.message)}}}function computeKey$1(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_HEADER_BYTES=1024,STORED_HEARTBEAT_RETENTION_MAX_MILLIS=30*24*60*60*1e3;class HeartbeatServiceImpl{constructor(e){this.container=e,this._heartbeatsCache=null;const o=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(o),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){const o=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=getUTCDateString();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(c=>c.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:o}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(c=>{const u=new Date(c.date).valueOf();return Date.now()-u<=STORED_HEARTBEAT_RETENTION_MAX_MILLIS}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=getUTCDateString(),{heartbeatsToSend:o,unsentEntries:s}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),c=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),c}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(n,e=MAX_HEADER_BYTES){const o=[];let s=n.slice();for(const c of n){const u=o.find(d=>d.agent===c.agent);if(u){if(u.dates.push(c.date),countBytes(o)>e){u.dates.pop();break}}else if(o.push({agent:c.agent,dates:[c.date]}),countBytes(o)>e){o.pop();break}s=s.slice(1)}return{heartbeatsToSend:o,unsentEntries:s}}class HeartbeatStorageImpl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await readHeartbeatsFromIndexedDB(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var o;if(await this._canUseIndexedDBPromise){const c=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(o=e.lastSentHeartbeatDate)!==null&&o!==void 0?o:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var o;if(await this._canUseIndexedDBPromise){const c=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(o=e.lastSentHeartbeatDate)!==null&&o!==void 0?o:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function countBytes(n){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(n){_registerComponent(new Component("platform-logger",e=>new PlatformLoggerServiceImpl(e),"PRIVATE")),_registerComponent(new Component("heartbeat",e=>new HeartbeatServiceImpl(e),"PRIVATE")),registerVersion(name$o,version$1$1,n),registerVersion(name$o,version$1$1,"esm2017"),registerVersion("fire-js","")}registerCoreComponents("");var name$4="firebase",version$4="9.22.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$4,version$4,"app");const name$3="@firebase/database",version$3="0.14.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SDK_VERSION="";function setSDKVersion(n){SDK_VERSION=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DOMStorageWrapper{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,o){o==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),stringify(o))}get(e){const o=this.domStorage_.getItem(this.prefixedName_(e));return o==null?null:jsonEval(o)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MemoryStorage{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,o){o==null?delete this.cache_[e]:this.cache_[e]=o}get(e){return contains(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const createStoragefor=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new DOMStorageWrapper(e)}}catch{}return new MemoryStorage},PersistentStorage=createStoragefor("localStorage"),SessionStorage=createStoragefor("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient$1=new Logger("@firebase/database"),LUIDGenerator=function(){let n=1;return function(){return n++}}(),sha1=function(n){const e=stringToByteArray(n),o=new Sha1;o.update(e);const s=o.digest();return base64.encodeByteArray(s)},buildLogMessage_=function(...n){let e="";for(let o=0;o<n.length;o++){const s=n[o];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=buildLogMessage_.apply(null,s):typeof s=="object"?e+=stringify(s):e+=s,e+=" "}return e};let logger$1=null,firstLog_=!0;const enableLogging$1=function(n,e){assert(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(logClient$1.logLevel=LogLevel.VERBOSE,logger$1=logClient$1.log.bind(logClient$1),e&&SessionStorage.set("logging_enabled",!0)):typeof n=="function"?logger$1=n:(logger$1=null,SessionStorage.remove("logging_enabled"))},log=function(...n){if(firstLog_===!0&&(firstLog_=!1,logger$1===null&&SessionStorage.get("logging_enabled")===!0&&enableLogging$1(!0)),logger$1){const e=buildLogMessage_.apply(null,n);logger$1(e)}},logWrapper=function(n){return function(...e){log(n,...e)}},error=function(...n){const e="FIREBASE INTERNAL ERROR: "+buildLogMessage_(...n);logClient$1.error(e)},fatal=function(...n){const e=`FIREBASE FATAL ERROR: ${buildLogMessage_(...n)}`;throw logClient$1.error(e),new Error(e)},warn=function(...n){const e="FIREBASE WARNING: "+buildLogMessage_(...n);logClient$1.warn(e)},warnIfPageIsSecure=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},isInvalidJSONNumber=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},executeWhenDOMReady=function(n){if(document.readyState==="complete")n();else{let e=!1;const o=function(){if(!document.body){setTimeout(o,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&o()}),window.attachEvent("onload",o))}},MIN_NAME="[MIN_NAME]",MAX_NAME="[MAX_NAME]",nameCompare=function(n,e){if(n===e)return 0;if(n===MIN_NAME||e===MAX_NAME)return-1;if(e===MIN_NAME||n===MAX_NAME)return 1;{const o=tryParseInt(n),s=tryParseInt(e);return o!==null?s!==null?o-s===0?n.length-e.length:o-s:-1:s!==null?1:n<e?-1:1}},stringCompare=function(n,e){return n===e?0:n<e?-1:1},requireKey=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+stringify(e))},ObjectToUniqueKey=function(n){if(typeof n!="object"||n===null)return stringify(n);const e=[];for(const s in n)e.push(s);e.sort();let o="{";for(let s=0;s<e.length;s++)s!==0&&(o+=","),o+=stringify(e[s]),o+=":",o+=ObjectToUniqueKey(n[e[s]]);return o+="}",o},splitStringBySize=function(n,e){const o=n.length;if(o<=e)return[n];const s=[];for(let c=0;c<o;c+=e)c+e>o?s.push(n.substring(c,o)):s.push(n.substring(c,c+e));return s};function each(n,e){for(const o in n)n.hasOwnProperty(o)&&e(o,n[o])}const doubleToIEEE754String=function(n){assert(!isInvalidJSONNumber(n),"Invalid JSON number");const e=11,o=52,s=(1<<e-1)-1;let c,u,d,m,_;n===0?(u=0,d=0,c=1/n===-1/0?1:0):(c=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(m=Math.min(Math.floor(Math.log(n)/Math.LN2),s),u=m+s,d=Math.round(n*Math.pow(2,o-m)-Math.pow(2,o))):(u=0,d=Math.round(n/Math.pow(2,1-s-o))));const ue=[];for(_=o;_;_-=1)ue.push(d%2?1:0),d=Math.floor(d/2);for(_=e;_;_-=1)ue.push(u%2?1:0),u=Math.floor(u/2);ue.push(c?1:0),ue.reverse();const gn=ue.join("");let nh="";for(_=0;_<64;_+=8){let ih=parseInt(gn.substr(_,8),2).toString(16);ih.length===1&&(ih="0"+ih),nh=nh+ih}return nh.toLowerCase()},isChromeExtensionContentScript=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},isWindowsStoreApp=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function errorForServerCode(n,e){let o="Unknown Error";n==="too_big"?o="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?o="Client doesn't have permission to access the desired data.":n==="unavailable"&&(o="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+o);return s.code=n.toUpperCase(),s}const INTEGER_REGEXP_=new RegExp("^-?(0*)\\d{1,10}$"),INTEGER_32_MIN=-2147483648,INTEGER_32_MAX=2147483647,tryParseInt=function(n){if(INTEGER_REGEXP_.test(n)){const e=Number(n);if(e>=INTEGER_32_MIN&&e<=INTEGER_32_MAX)return e}return null},exceptionGuard=function(n){try{n()}catch(e){setTimeout(()=>{const o=e.stack||"";throw warn("Exception was thrown by user callback.",o),e},Math.floor(0))}},beingCrawled=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},setTimeoutNonBlocking=function(n,e){const o=setTimeout(n,e);return typeof o=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(o):typeof o=="object"&&o.unref&&o.unref(),o};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AppCheckTokenProvider{constructor(e,o){this.appName_=e,this.appCheckProvider=o,this.appCheck=o==null?void 0:o.getImmediate({optional:!0}),this.appCheck||o==null||o.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((o,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(o,s):o(null)},0)})}addTokenChangeListener(e){var o;(o=this.appCheckProvider)===null||o===void 0||o.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){warn(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAuthTokenProvider{constructor(e,o,s){this.appName_=e,this.firebaseOptions_=o,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(c=>this.auth_=c)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(o=>o&&o.code==="auth/token-not-initialized"?(log("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(o)):new Promise((o,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(o,s):o(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(o=>o.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(o=>o.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',warn(e)}}class EmulatorTokenProvider{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}EmulatorTokenProvider.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PROTOCOL_VERSION="5",VERSION_PARAM="v",TRANSPORT_SESSION_PARAM="s",REFERER_PARAM="r",FORGE_REF="f",FORGE_DOMAIN_RE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,LAST_SESSION_PARAM="ls",APPLICATION_ID_PARAM="p",APP_CHECK_TOKEN_PARAM="ac",WEBSOCKET="websocket",LONG_POLLING="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RepoInfo{constructor(e,o,s,c,u=!1,d="",m=!1,_=!1){this.secure=o,this.namespace=s,this.webSocketOnly=c,this.nodeAdmin=u,this.persistenceKey=d,this.includeNamespaceInQueryParams=m,this.isUsingEmulator=_,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=PersistentStorage.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&PersistentStorage.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",o=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${o}`}}function repoInfoNeedsQueryParam(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function repoInfoConnectionURL(n,e,o){assert(typeof e=="string","typeof type must == string"),assert(typeof o=="object","typeof params must == object");let s;if(e===WEBSOCKET)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===LONG_POLLING)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);repoInfoNeedsQueryParam(n)&&(o.ns=n.namespace);const c=[];return each(o,(u,d)=>{c.push(u+"="+d)}),s+c.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsCollection{constructor(){this.counters_={}}incrementCounter(e,o=1){contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=o}get(){return deepCopy(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const collections={},reporters={};function statsManagerGetCollection(n){const e=n.toString();return collections[e]||(collections[e]=new StatsCollection),collections[e]}function statsManagerGetOrCreateReporter(n,e){const o=n.toString();return reporters[o]||(reporters[o]=e()),reporters[o]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PacketReceiver{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,o){this.closeAfterResponse=e,this.onClose=o,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,o){for(this.pendingResponses[e]=o;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let c=0;c<s.length;++c)s[c]&&exceptionGuard(()=>{this.onMessage_(s[c])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_LONGPOLL_START_PARAM="start",FIREBASE_LONGPOLL_CLOSE_COMMAND="close",FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand",FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB",FIREBASE_LONGPOLL_ID_PARAM="id",FIREBASE_LONGPOLL_PW_PARAM="pw",FIREBASE_LONGPOLL_SERIAL_PARAM="ser",FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb",FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg",FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts",FIREBASE_LONGPOLL_DATA_PARAM="d",FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe",MAX_URL_DATA_SIZE=1870,SEG_HEADER_SIZE=30,MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE,KEEPALIVE_REQUEST_INTERVAL=25e3,LP_CONNECT_TIMEOUT=3e4;class BrowserPollConnection{constructor(e,o,s,c,u,d,m){this.connId=e,this.repoInfo=o,this.applicationId=s,this.appCheckToken=c,this.authToken=u,this.transportSessionId=d,this.lastSessionId=m,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=logWrapper(e),this.stats_=statsManagerGetCollection(o),this.urlFn=_=>(this.appCheckToken&&(_[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),repoInfoConnectionURL(o,LONG_POLLING,_))}open(e,o){this.curSegmentNum=0,this.onDisconnect_=o,this.myPacketOrderer=new PacketReceiver(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(LP_CONNECT_TIMEOUT)),executeWhenDOMReady(()=>{if(this.isClosed_)return;this.scriptTagHolder=new FirebaseIFrameScriptHolder((...u)=>{const[d,m,_,ue,gn]=u;if(this.incrementIncomingBytes_(u),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,d===FIREBASE_LONGPOLL_START_PARAM)this.id=m,this.password=_;else if(d===FIREBASE_LONGPOLL_CLOSE_COMMAND)m?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(m,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+d)},(...u)=>{const[d,m]=u;this.incrementIncomingBytes_(u),this.myPacketOrderer.handleResponse(d,m)},()=>{this.onClosed_()},this.urlFn);const s={};s[FIREBASE_LONGPOLL_START_PARAM]="t",s[FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=this.scriptTagHolder.uniqueCallbackIdentifier),s[VERSION_PARAM]=PROTOCOL_VERSION,this.transportSessionId&&(s[TRANSPORT_SESSION_PARAM]=this.transportSessionId),this.lastSessionId&&(s[LAST_SESSION_PARAM]=this.lastSessionId),this.applicationId&&(s[APPLICATION_ID_PARAM]=this.applicationId),this.appCheckToken&&(s[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(s[REFERER_PARAM]=FORGE_REF);const c=this.urlFn(s);this.log_("Connecting via long-poll to "+c),this.scriptTagHolder.addTag(c,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){BrowserPollConnection.forceAllow_=!0}static forceDisallow(){BrowserPollConnection.forceDisallow_=!0}static isAvailable(){return BrowserPollConnection.forceAllow_?!0:!BrowserPollConnection.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!isChromeExtensionContentScript()&&!isWindowsStoreApp()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const o=stringify(e);this.bytesSent+=o.length,this.stats_.incrementCounter("bytes_sent",o.length);const s=base64Encode(o),c=splitStringBySize(s,MAX_PAYLOAD_SIZE);for(let u=0;u<c.length;u++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[u]),this.curSegmentNum++}addDisconnectPingFrame(e,o){this.myDisconnFrame=document.createElement("iframe");const s={};s[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t",s[FIREBASE_LONGPOLL_ID_PARAM]=e,s[FIREBASE_LONGPOLL_PW_PARAM]=o,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const o=stringify(e).length;this.bytesReceived+=o,this.stats_.incrementCounter("bytes_received",o)}}class FirebaseIFrameScriptHolder{constructor(e,o,s,c){this.onDisconnect=s,this.urlFn=c,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=LUIDGenerator(),window[FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=e,window[FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=o,this.myIFrame=FirebaseIFrameScriptHolder.createIFrame_();let u="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(u='<script>document.domain="'+document.domain+'";<\/script>');const d="<html><body>"+u+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(d),this.myIFrame.doc.close()}catch(m){log("frame writing exception"),m.stack&&log(m.stack),log(m)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||log("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,o){for(this.myID=e,this.myPW=o,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,e[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,e[FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;let o=this.urlFn(e),s="",c=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+SEG_HEADER_SIZE+s.length<=MAX_URL_DATA_SIZE;){const d=this.pendingSegs.shift();s=s+"&"+FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+c+"="+d.seg+"&"+FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+c+"="+d.ts+"&"+FIREBASE_LONGPOLL_DATA_PARAM+c+"="+d.d,c++}return o=o+s,this.addLongPollTag_(o,this.currentSerial),!0}else return!1}enqueueSegment(e,o,s){this.pendingSegs.push({seg:e,ts:o,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,o){this.outstandingRequests.add(o);const s=()=>{this.outstandingRequests.delete(o),this.newRequest_()},c=setTimeout(s,Math.floor(KEEPALIVE_REQUEST_INTERVAL)),u=()=>{clearTimeout(c),s()};this.addTag(e,u)}addTag(e,o){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const c=s.readyState;(!c||c==="loaded"||c==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),o())},s.onerror=()=>{log("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEBSOCKET_MAX_FRAME_SIZE=16384,WEBSOCKET_KEEPALIVE_INTERVAL=45e3;let WebSocketImpl=null;typeof MozWebSocket<"u"?WebSocketImpl=MozWebSocket:typeof WebSocket<"u"&&(WebSocketImpl=WebSocket);class WebSocketConnection{constructor(e,o,s,c,u,d,m){this.connId=e,this.applicationId=s,this.appCheckToken=c,this.authToken=u,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=logWrapper(this.connId),this.stats_=statsManagerGetCollection(o),this.connURL=WebSocketConnection.connectionURL_(o,d,m,c,s),this.nodeAdmin=o.nodeAdmin}static connectionURL_(e,o,s,c,u){const d={};return d[VERSION_PARAM]=PROTOCOL_VERSION,typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(d[REFERER_PARAM]=FORGE_REF),o&&(d[TRANSPORT_SESSION_PARAM]=o),s&&(d[LAST_SESSION_PARAM]=s),c&&(d[APP_CHECK_TOKEN_PARAM]=c),u&&(d[APPLICATION_ID_PARAM]=u),repoInfoConnectionURL(e,WEBSOCKET,d)}open(e,o){this.onDisconnect=o,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,PersistentStorage.set("previous_websocket_failure",!0);try{let s;isNodeSdk(),this.mySock=new WebSocketImpl(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const c=s.message||s.data;c&&this.log_(c),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const c=s.message||s.data;c&&this.log_(c),this.onClosed_()}}start(){}static forceDisallow(){WebSocketConnection.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const o=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(o);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&WebSocketImpl!==null&&!WebSocketConnection.forceDisallow_}static previouslyFailed(){return PersistentStorage.isInMemoryStorage||PersistentStorage.get("previous_websocket_failure")===!0}markConnectionHealthy(){PersistentStorage.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const o=this.frames.join("");this.frames=null;const s=jsonEval(o);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(assert(this.frames===null,"We already have a frame buffer"),e.length<=6){const o=Number(e);if(!isNaN(o))return this.handleNewFrameCount_(o),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const o=e.data;if(this.bytesReceived+=o.length,this.stats_.incrementCounter("bytes_received",o.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(o);else{const s=this.extractFrameCount_(o);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const o=stringify(e);this.bytesSent+=o.length,this.stats_.incrementCounter("bytes_sent",o.length);const s=splitStringBySize(o,WEBSOCKET_MAX_FRAME_SIZE);s.length>1&&this.sendString_(String(s.length));for(let c=0;c<s.length;c++)this.sendString_(s[c])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))}sendString_(e){try{this.mySock.send(e)}catch(o){this.log_("Exception thrown from WebSocket.send():",o.message||o.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}WebSocketConnection.responsesRequiredToBeHealthy=2;WebSocketConnection.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TransportManager{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[BrowserPollConnection,WebSocketConnection]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const o=WebSocketConnection&&WebSocketConnection.isAvailable();let s=o&&!WebSocketConnection.previouslyFailed();if(e.webSocketOnly&&(o||warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[WebSocketConnection];else{const c=this.transports_=[];for(const u of TransportManager.ALL_TRANSPORTS)u&&u.isAvailable()&&c.push(u);TransportManager.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}TransportManager.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UPGRADE_TIMEOUT=6e4,DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10*1024,BYTES_RECEIVED_HEALTHY_OVERRIDE=100*1024,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h";class Connection{constructor(e,o,s,c,u,d,m,_,ue,gn){this.id=e,this.repoInfo_=o,this.applicationId_=s,this.appCheckToken_=c,this.authToken_=u,this.onMessage_=d,this.onReady_=m,this.onDisconnect_=_,this.onKill_=ue,this.lastSessionId=gn,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=logWrapper("c:"+this.id+":"),this.transportManager_=new TransportManager(o),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const o=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(o,s)},Math.floor(0));const c=e.healthyTimeout||0;c>0&&(this.healthyTimeout_=setTimeoutNonBlocking(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(c)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return o=>{e===this.conn_?this.onConnectionLost_(o):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return o=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(o):e===this.secondaryConn_?this.onSecondaryMessageReceived_(o):this.log_("message on old connection"))}}sendRequest(e){const o={t:"d",d:e};this.sendData_(o)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(MESSAGE_TYPE in e){const o=e[MESSAGE_TYPE];o===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():o===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):o===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const o=requireKey("t",e),s=requireKey("d",e);if(o==="c")this.onSecondaryControl_(s);else if(o==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+o)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const o=requireKey("t",e),s=requireKey("d",e);o==="c"?this.onControl_(s):o==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const o=requireKey(MESSAGE_TYPE,e);if(MESSAGE_DATA in e){const s=e[MESSAGE_DATA];if(o===SERVER_HELLO){const c=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(c.h=this.repoInfo_.host),this.onHandshake_(c)}else if(o===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let c=0;c<this.pendingDataMessages.length;++c)this.onDataMessage_(this.pendingDataMessages[c]);this.pendingDataMessages=[],this.tryCleanupConnection()}else o===CONTROL_SHUTDOWN?this.onConnectionShutdown_(s):o===CONTROL_RESET?this.onReset_(s):o===CONTROL_ERROR?error("Server Error: "+s):o===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):error("Unknown control packet command: "+o)}}onHandshake_(e){const o=e.ts,s=e.v,c=e.h;this.sessionId=e.s,this.repoInfo_.host=c,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,o),PROTOCOL_VERSION!==s&&warn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const o=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(o,s),setTimeoutNonBlocking(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,o){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(o,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeoutNonBlocking(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ServerActions{put(e,o,s,c){}merge(e,o,s,c){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,o,s){}onDisconnectMerge(e,o,s){}onDisconnectCancel(e,o){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventEmitter{constructor(e){this.allowedEvents_=e,this.listeners_={},assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...o){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let c=0;c<s.length;c++)s[c].callback.apply(s[c].context,o)}}on(e,o,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:o,context:s});const c=this.getInitialEvent(e);c&&o.apply(s,c)}off(e,o,s){this.validateEventType_(e);const c=this.listeners_[e]||[];for(let u=0;u<c.length;u++)if(c[u].callback===o&&(!s||s===c[u].context)){c.splice(u,1);return}}validateEventType_(e){assert(this.allowedEvents_.find(o=>o===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OnlineMonitor extends EventEmitter{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!isMobileCordova()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new OnlineMonitor}getInitialEvent(e){return assert(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_PATH_DEPTH=32,MAX_PATH_LENGTH_BYTES=768;class Path{constructor(e,o){if(o===void 0){this.pieces_=e.split("/");let s=0;for(let c=0;c<this.pieces_.length;c++)this.pieces_[c].length>0&&(this.pieces_[s]=this.pieces_[c],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=o}toString(){let e="";for(let o=this.pieceNum_;o<this.pieces_.length;o++)this.pieces_[o]!==""&&(e+="/"+this.pieces_[o]);return e||"/"}}function newEmptyPath(){return new Path("")}function pathGetFront(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function pathGetLength(n){return n.pieces_.length-n.pieceNum_}function pathPopFront(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Path(n.pieces_,e)}function pathGetBack(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function pathToUrlEncodedString(n){let e="";for(let o=n.pieceNum_;o<n.pieces_.length;o++)n.pieces_[o]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[o])));return e||"/"}function pathSlice(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function pathParent(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let o=n.pieceNum_;o<n.pieces_.length-1;o++)e.push(n.pieces_[o]);return new Path(e,0)}function pathChild(n,e){const o=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)o.push(n.pieces_[s]);if(e instanceof Path)for(let s=e.pieceNum_;s<e.pieces_.length;s++)o.push(e.pieces_[s]);else{const s=e.split("/");for(let c=0;c<s.length;c++)s[c].length>0&&o.push(s[c])}return new Path(o,0)}function pathIsEmpty(n){return n.pieceNum_>=n.pieces_.length}function newRelativePath(n,e){const o=pathGetFront(n),s=pathGetFront(e);if(o===null)return e;if(o===s)return newRelativePath(pathPopFront(n),pathPopFront(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function pathCompare(n,e){const o=pathSlice(n,0),s=pathSlice(e,0);for(let c=0;c<o.length&&c<s.length;c++){const u=nameCompare(o[c],s[c]);if(u!==0)return u}return o.length===s.length?0:o.length<s.length?-1:1}function pathEquals(n,e){if(pathGetLength(n)!==pathGetLength(e))return!1;for(let o=n.pieceNum_,s=e.pieceNum_;o<=n.pieces_.length;o++,s++)if(n.pieces_[o]!==e.pieces_[s])return!1;return!0}function pathContains(n,e){let o=n.pieceNum_,s=e.pieceNum_;if(pathGetLength(n)>pathGetLength(e))return!1;for(;o<n.pieces_.length;){if(n.pieces_[o]!==e.pieces_[s])return!1;++o,++s}return!0}class ValidationPath{constructor(e,o){this.errorPrefix_=o,this.parts_=pathSlice(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=stringLength(this.parts_[s]);validationPathCheckValid(this)}}function validationPathPush(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=stringLength(e),validationPathCheckValid(n)}function validationPathPop(n){const e=n.parts_.pop();n.byteLength_-=stringLength(e),n.parts_.length>0&&(n.byteLength_-=1)}function validationPathCheckValid(n){if(n.byteLength_>MAX_PATH_LENGTH_BYTES)throw new Error(n.errorPrefix_+"has a key path longer than "+MAX_PATH_LENGTH_BYTES+" bytes ("+n.byteLength_+").");if(n.parts_.length>MAX_PATH_DEPTH)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+MAX_PATH_DEPTH+") or object contains a cycle "+validationPathToErrorString(n))}function validationPathToErrorString(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VisibilityMonitor extends EventEmitter{constructor(){super(["visible"]);let e,o;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(o="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(o="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(o="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(o="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,o&&document.addEventListener(o,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new VisibilityMonitor}getInitialEvent(e){return assert(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RECONNECT_MIN_DELAY=1e3,RECONNECT_MAX_DELAY_DEFAULT=60*5*1e3,RECONNECT_MAX_DELAY_FOR_ADMINS=30*1e3,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4,SERVER_KILL_INTERRUPT_REASON="server_kill",INVALID_TOKEN_THRESHOLD=3;class PersistentConnection extends ServerActions{constructor(e,o,s,c,u,d,m,_){if(super(),this.repoInfo_=e,this.applicationId_=o,this.onDataUpdate_=s,this.onConnectStatus_=c,this.onServerInfoUpdate_=u,this.authTokenProvider_=d,this.appCheckTokenProvider_=m,this.authOverride_=_,this.id=PersistentConnection.nextPersistentConnectionId_++,this.log_=logWrapper("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,_&&!isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");VisibilityMonitor.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&OnlineMonitor.getInstance().on("online",this.onOnline_,this)}sendRequest(e,o,s){const c=++this.requestNumber_,u={r:c,a:e,b:o};this.log_(stringify(u)),assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(u),s&&(this.requestCBHash_[c]=s)}get(e){this.initConnection_();const o=new Deferred,c={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:d=>{const m=d.d;d.s==="ok"?o.resolve(m):o.reject(m)}};this.outstandingGets_.push(c),this.outstandingGetCount_++;const u=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(u),o.promise}listen(e,o,s,c){this.initConnection_();const u=e._queryIdentifier,d=e._path.toString();this.log_("Listen called for "+d+" "+u),this.listens.has(d)||this.listens.set(d,new Map),assert(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),assert(!this.listens.get(d).has(u),"listen() called twice for same path/queryId.");const m={onComplete:c,hashFn:o,query:e,tag:s};this.listens.get(d).set(u,m),this.connected_&&this.sendListen_(m)}sendGet_(e){const o=this.outstandingGets_[e];this.sendRequest("g",o.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),o.onComplete&&o.onComplete(s)})}sendListen_(e){const o=e.query,s=o._path.toString(),c=o._queryIdentifier;this.log_("Listen on "+s+" for "+c);const u={p:s},d="q";e.tag&&(u.q=o._queryObject,u.t=e.tag),u.h=e.hashFn(),this.sendRequest(d,u,m=>{const _=m.d,ue=m.s;PersistentConnection.warnOnListenWarnings_(_,o),(this.listens.get(s)&&this.listens.get(s).get(c))===e&&(this.log_("listen response",m),ue!=="ok"&&this.removeListen_(s,c),e.onComplete&&e.onComplete(ue,_))})}static warnOnListenWarnings_(e,o){if(e&&typeof e=="object"&&contains(e,"w")){const s=safeGet(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const c='".indexOn": "'+o._queryParams.getIndex().toString()+'"',u=o._path.toString();warn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${c} at ${u} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||isAdmin(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,o=isValidFormat(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(o,s,c=>{const u=c.s,d=c.d||"error";this.authToken_===e&&(u==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(u,d))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const o=e.s,s=e.d||"error";o==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(o,s)})}unlisten(e,o){const s=e._path.toString(),c=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+c),assert(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,c)&&this.connected_&&this.sendUnlisten_(s,c,e._queryObject,o)}sendUnlisten_(e,o,s,c){this.log_("Unlisten on "+e+" for "+o);const u={p:e},d="n";c&&(u.q=s,u.t=c),this.sendRequest(d,u)}onDisconnectPut(e,o,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,o,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:o,onComplete:s})}onDisconnectMerge(e,o,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,o,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:o,onComplete:s})}onDisconnectCancel(e,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:o})}sendOnDisconnect_(e,o,s,c){const u={p:o,d:s};this.log_("onDisconnect "+e,u),this.sendRequest(e,u,d=>{c&&setTimeout(()=>{c(d.s,d.d)},Math.floor(0))})}put(e,o,s,c){this.putInternal("p",e,o,s,c)}merge(e,o,s,c){this.putInternal("m",e,o,s,c)}putInternal(e,o,s,c,u){this.initConnection_();const d={p:o,d:s};u!==void 0&&(d.h=u),this.outstandingPuts_.push({action:e,request:d,onComplete:c}),this.outstandingPutCount_++;const m=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(m):this.log_("Buffering put: "+o)}sendPut_(e){const o=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,c=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(o,s,u=>{this.log_(o+" response",u),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),c&&c(u.s,u.d)})}reportStats(e){if(this.connected_){const o={c:e};this.log_("reportStats",o),this.sendRequest("s",o,s=>{if(s.s!=="ok"){const u=s.d;this.log_("reportStats","Error sending stats: "+u)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+stringify(e));const o=e.r,s=this.requestCBHash_[o];s&&(delete this.requestCBHash_[o],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,o){this.log_("handleServerMessage",e,o),e==="d"?this.onDataUpdate_(o.p,o.d,!1,o.t):e==="m"?this.onDataUpdate_(o.p,o.d,!0,o.t):e==="c"?this.onListenRevoked_(o.p,o.q):e==="ac"?this.onAuthRevoked_(o.s,o.d):e==="apc"?this.onAppCheckRevoked_(o.s,o.d):e==="sd"?this.onSecurityDebugPacket_(o):error("Unrecognized action received from server: "+stringify(e)+`
Are you using the latest client?`)}onReady_(e,o){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=o,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>RECONNECT_DELAY_RESET_TIMEOUT&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let o=Math.max(0,this.reconnectDelay_-e);o=Math.random()*o,this.log_("Trying to reconnect in "+o+"ms"),this.scheduleConnect_(o),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),o=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),c=this.id+":"+PersistentConnection.nextConnectionId_++,u=this.lastSessionId;let d=!1,m=null;const _=function(){m?m.close():(d=!0,s())},ue=function(nh){assert(m,"sendRequest call when we're not connected not allowed."),m.sendRequest(nh)};this.realtime_={close:_,sendRequest:ue};const gn=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[nh,ih]=await Promise.all([this.authTokenProvider_.getToken(gn),this.appCheckTokenProvider_.getToken(gn)]);d?log("getToken() completed but was canceled"):(log("getToken() completed. Creating connection."),this.authToken_=nh&&nh.accessToken,this.appCheckToken_=ih&&ih.token,m=new Connection(c,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,o,s,rh=>{warn(rh+" ("+this.repoInfo_.toString()+")"),this.interrupt(SERVER_KILL_INTERRUPT_REASON)},u))}catch(nh){this.log_("Failed to get token: "+nh),d||(this.repoInfo_.nodeAdmin&&warn(nh),_())}}}interrupt(e){log("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){log("Resuming connection for reason: "+e),delete this.interruptReasons_[e],isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const o=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:o})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const o=this.outstandingPuts_[e];o&&"h"in o.request&&o.queued&&(o.onComplete&&o.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,o){let s;o?s=o.map(u=>ObjectToUniqueKey(u)).join("$"):s="default";const c=this.removeListen_(e,s);c&&c.onComplete&&c.onComplete("permission_denied")}removeListen_(e,o){const s=new Path(e).toString();let c;if(this.listens.has(s)){const u=this.listens.get(s);c=u.get(o),u.delete(o),u.size===0&&this.listens.delete(s)}else c=void 0;return c}onAuthRevoked_(e,o){log("Auth token revoked: "+e+"/"+o),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=INVALID_TOKEN_THRESHOLD&&(this.reconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,o){log("App check token revoked: "+e+"/"+o),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=INVALID_TOKEN_THRESHOLD&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const o of e.values())this.sendListen_(o);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let o="js";e["sdk."+o+"."+SDK_VERSION.replace(/\./g,"-")]=1,isMobileCordova()?e["framework.cordova"]=1:isReactNative()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=OnlineMonitor.getInstance().currentlyOnline();return isEmpty(this.interruptReasons_)&&e}}PersistentConnection.nextPersistentConnectionId_=0;PersistentConnection.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NamedNode{constructor(e,o){this.name=e,this.node=o}static Wrap(e,o){return new NamedNode(e,o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Index{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,o){const s=new NamedNode(MIN_NAME,e),c=new NamedNode(MIN_NAME,o);return this.compare(s,c)!==0}minPost(){return NamedNode.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __EMPTY_NODE;class KeyIndex extends Index{static get __EMPTY_NODE(){return __EMPTY_NODE}static set __EMPTY_NODE(e){__EMPTY_NODE=e}compare(e,o){return nameCompare(e.name,o.name)}isDefinedOn(e){throw assertionError("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,o){return!1}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,__EMPTY_NODE)}makePost(e,o){return assert(typeof e=="string","KeyIndex indexValue must always be a string."),new NamedNode(e,__EMPTY_NODE)}toString(){return".key"}}const KEY_INDEX=new KeyIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedMapIterator{constructor(e,o,s,c,u=null){this.isReverse_=c,this.resultGenerator_=u,this.nodeStack_=[];let d=1;for(;!e.isEmpty();)if(e=e,d=o?s(e.key,o):1,c&&(d*=-1),d<0)this.isReverse_?e=e.left:e=e.right;else if(d===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),o;if(this.resultGenerator_?o=this.resultGenerator_(e.key,e.value):o={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return o}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class LLRBNode{constructor(e,o,s,c,u){this.key=e,this.value=o,this.color=s??LLRBNode.RED,this.left=c??SortedMap.EMPTY_NODE,this.right=u??SortedMap.EMPTY_NODE}copy(e,o,s,c,u){return new LLRBNode(e??this.key,o??this.value,s??this.color,c??this.left,u??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,o,s){let c=this;const u=s(e,c.key);return u<0?c=c.copy(null,null,null,c.left.insert(e,o,s),null):u===0?c=c.copy(null,o,null,null,null):c=c.copy(null,null,null,null,c.right.insert(e,o,s)),c.fixUp_()}removeMin_(){if(this.left.isEmpty())return SortedMap.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,o){let s,c;if(s=this,o(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,o),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),o(e,s.key)===0){if(s.right.isEmpty())return SortedMap.EMPTY_NODE;c=s.right.min_(),s=s.copy(c.key,c.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,o))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,o)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}LLRBNode.RED=!0;LLRBNode.BLACK=!1;class LLRBEmptyNode{copy(e,o,s,c,u){return this}insert(e,o,s){return new LLRBNode(e,o,null)}remove(e,o){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class SortedMap{constructor(e,o=SortedMap.EMPTY_NODE){this.comparator_=e,this.root_=o}insert(e,o){return new SortedMap(this.comparator_,this.root_.insert(e,o,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}remove(e){return new SortedMap(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}get(e){let o,s=this.root_;for(;!s.isEmpty();){if(o=this.comparator_(e,s.key),o===0)return s.value;o<0?s=s.left:o>0&&(s=s.right)}return null}getPredecessorKey(e){let o,s=this.root_,c=null;for(;!s.isEmpty();)if(o=this.comparator_(e,s.key),o===0){if(s.left.isEmpty())return c?c.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else o<0?s=s.left:o>0&&(c=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new SortedMapIterator(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,o){return new SortedMapIterator(this.root_,e,this.comparator_,!1,o)}getReverseIteratorFrom(e,o){return new SortedMapIterator(this.root_,e,this.comparator_,!0,o)}getReverseIterator(e){return new SortedMapIterator(this.root_,null,this.comparator_,!0,e)}}SortedMap.EMPTY_NODE=new LLRBEmptyNode;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NAME_ONLY_COMPARATOR(n,e){return nameCompare(n.name,e.name)}function NAME_COMPARATOR(n,e){return nameCompare(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MAX_NODE$2;function setMaxNode$1(n){MAX_NODE$2=n}const priorityHashText=function(n){return typeof n=="number"?"number:"+doubleToIEEE754String(n):"string:"+n},validatePriorityNode=function(n){if(n.isLeafNode()){const e=n.val();assert(typeof e=="string"||typeof e=="number"||typeof e=="object"&&contains(e,".sv"),"Priority must be a string or number.")}else assert(n===MAX_NODE$2||n.isEmpty(),"priority of unexpected type.");assert(n===MAX_NODE$2||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __childrenNodeConstructor;class LeafNode{constructor(e,o=LeafNode.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=o,this.lazyHash_=null,assert(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),validatePriorityNode(this.priorityNode_)}static set __childrenNodeConstructor(e){__childrenNodeConstructor=e}static get __childrenNodeConstructor(){return __childrenNodeConstructor}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new LeafNode(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return pathIsEmpty(e)?this:pathGetFront(e)===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,o){return null}updateImmediateChild(e,o){return e===".priority"?this.updatePriority(o):o.isEmpty()&&e!==".priority"?this:LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,o).updatePriority(this.priorityNode_)}updateChild(e,o){const s=pathGetFront(e);return s===null?o:o.isEmpty()&&s!==".priority"?this:(assert(s!==".priority"||pathGetLength(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(pathPopFront(e),o)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,o){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+priorityHashText(this.priorityNode_.val())+":");const o=typeof this.value_;e+=o+":",o==="number"?e+=doubleToIEEE754String(this.value_):e+=this.value_,this.lazyHash_=sha1(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===LeafNode.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof LeafNode.__childrenNodeConstructor?-1:(assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const o=typeof e.value_,s=typeof this.value_,c=LeafNode.VALUE_TYPE_ORDER.indexOf(o),u=LeafNode.VALUE_TYPE_ORDER.indexOf(s);return assert(c>=0,"Unknown leaf type: "+o),assert(u>=0,"Unknown leaf type: "+s),c===u?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:u-c}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const o=e;return this.value_===o.value_&&this.priorityNode_.equals(o.priorityNode_)}else return!1}}LeafNode.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nodeFromJSON$1,MAX_NODE$1;function setNodeFromJSON(n){nodeFromJSON$1=n}function setMaxNode(n){MAX_NODE$1=n}class PriorityIndex extends Index{compare(e,o){const s=e.node.getPriority(),c=o.node.getPriority(),u=s.compareTo(c);return u===0?nameCompare(e.name,o.name):u}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,o){return!e.getPriority().equals(o.getPriority())}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,new LeafNode("[PRIORITY-POST]",MAX_NODE$1))}makePost(e,o){const s=nodeFromJSON$1(e);return new NamedNode(o,new LeafNode("[PRIORITY-POST]",s))}toString(){return".priority"}}const PRIORITY_INDEX=new PriorityIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LOG_2=Math.log(2);class Base12Num{constructor(e){const o=u=>parseInt(Math.log(u)/LOG_2,10),s=u=>parseInt(Array(u+1).join("1"),2);this.count=o(e+1),this.current_=this.count-1;const c=s(this.count);this.bits_=e+1&c}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const buildChildSet=function(n,e,o,s){n.sort(e);const c=function(_,ue){const gn=ue-_;let nh,ih;if(gn===0)return null;if(gn===1)return nh=n[_],ih=o?o(nh):nh,new LLRBNode(ih,nh.node,LLRBNode.BLACK,null,null);{const rh=parseInt(gn/2,10)+_,oh=c(_,rh),lh=c(rh+1,ue);return nh=n[rh],ih=o?o(nh):nh,new LLRBNode(ih,nh.node,LLRBNode.BLACK,oh,lh)}},u=function(_){let ue=null,gn=null,nh=n.length;const ih=function(oh,lh){const ch=nh-oh,dh=nh;nh-=oh;const _h=c(ch+1,dh),Sh=n[ch],fh=o?o(Sh):Sh;rh(new LLRBNode(fh,Sh.node,lh,null,_h))},rh=function(oh){ue?(ue.left=oh,ue=oh):(gn=oh,ue=oh)};for(let oh=0;oh<_.count;++oh){const lh=_.nextBitIsOne(),ch=Math.pow(2,_.count-(oh+1));lh?ih(ch,LLRBNode.BLACK):(ih(ch,LLRBNode.BLACK),ih(ch,LLRBNode.RED))}return gn},d=new Base12Num(n.length),m=u(d);return new SortedMap(s||e,m)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _defaultIndexMap;const fallbackObject={};class IndexMap{constructor(e,o){this.indexes_=e,this.indexSet_=o}static get Default(){return assert(fallbackObject&&PRIORITY_INDEX,"ChildrenNode.ts has not been loaded"),_defaultIndexMap=_defaultIndexMap||new IndexMap({".priority":fallbackObject},{".priority":PRIORITY_INDEX}),_defaultIndexMap}get(e){const o=safeGet(this.indexes_,e);if(!o)throw new Error("No index defined for "+e);return o instanceof SortedMap?o:null}hasIndex(e){return contains(this.indexSet_,e.toString())}addIndex(e,o){assert(e!==KEY_INDEX,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let c=!1;const u=o.getIterator(NamedNode.Wrap);let d=u.getNext();for(;d;)c=c||e.isDefinedOn(d.node),s.push(d),d=u.getNext();let m;c?m=buildChildSet(s,e.getCompare()):m=fallbackObject;const _=e.toString(),ue=Object.assign({},this.indexSet_);ue[_]=e;const gn=Object.assign({},this.indexes_);return gn[_]=m,new IndexMap(gn,ue)}addToIndexes(e,o){const s=map(this.indexes_,(c,u)=>{const d=safeGet(this.indexSet_,u);if(assert(d,"Missing index implementation for "+u),c===fallbackObject)if(d.isDefinedOn(e.node)){const m=[],_=o.getIterator(NamedNode.Wrap);let ue=_.getNext();for(;ue;)ue.name!==e.name&&m.push(ue),ue=_.getNext();return m.push(e),buildChildSet(m,d.getCompare())}else return fallbackObject;else{const m=o.get(e.name);let _=c;return m&&(_=_.remove(new NamedNode(e.name,m))),_.insert(e,e.node)}});return new IndexMap(s,this.indexSet_)}removeFromIndexes(e,o){const s=map(this.indexes_,c=>{if(c===fallbackObject)return c;{const u=o.get(e.name);return u?c.remove(new NamedNode(e.name,u)):c}});return new IndexMap(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EMPTY_NODE;class ChildrenNode{constructor(e,o,s){this.children_=e,this.priorityNode_=o,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&validatePriorityNode(this.priorityNode_),this.children_.isEmpty()&&assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return EMPTY_NODE||(EMPTY_NODE=new ChildrenNode(new SortedMap(NAME_COMPARATOR),null,IndexMap.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||EMPTY_NODE}updatePriority(e){return this.children_.isEmpty()?this:new ChildrenNode(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const o=this.children_.get(e);return o===null?EMPTY_NODE:o}}getChild(e){const o=pathGetFront(e);return o===null?this:this.getImmediateChild(o).getChild(pathPopFront(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,o){if(assert(o,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(o);{const s=new NamedNode(e,o);let c,u;o.isEmpty()?(c=this.children_.remove(e),u=this.indexMap_.removeFromIndexes(s,this.children_)):(c=this.children_.insert(e,o),u=this.indexMap_.addToIndexes(s,this.children_));const d=c.isEmpty()?EMPTY_NODE:this.priorityNode_;return new ChildrenNode(c,d,u)}}updateChild(e,o){const s=pathGetFront(e);if(s===null)return o;{assert(pathGetFront(e)!==".priority"||pathGetLength(e)===1,".priority must be the last token in a path");const c=this.getImmediateChild(s).updateChild(pathPopFront(e),o);return this.updateImmediateChild(s,c)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const o={};let s=0,c=0,u=!0;if(this.forEachChild(PRIORITY_INDEX,(d,m)=>{o[d]=m.val(e),s++,u&&ChildrenNode.INTEGER_REGEXP_.test(d)?c=Math.max(c,Number(d)):u=!1}),!e&&u&&c<2*s){const d=[];for(const m in o)d[m]=o[m];return d}else return e&&!this.getPriority().isEmpty()&&(o[".priority"]=this.getPriority().val()),o}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+priorityHashText(this.getPriority().val())+":"),this.forEachChild(PRIORITY_INDEX,(o,s)=>{const c=s.hash();c!==""&&(e+=":"+o+":"+c)}),this.lazyHash_=e===""?"":sha1(e)}return this.lazyHash_}getPredecessorChildName(e,o,s){const c=this.resolveIndex_(s);if(c){const u=c.getPredecessorKey(new NamedNode(e,o));return u?u.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const o=this.resolveIndex_(e);if(o){const s=o.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const o=this.getFirstChildName(e);return o?new NamedNode(o,this.children_.get(o)):null}getLastChildName(e){const o=this.resolveIndex_(e);if(o){const s=o.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const o=this.getLastChildName(e);return o?new NamedNode(o,this.children_.get(o)):null}forEachChild(e,o){const s=this.resolveIndex_(e);return s?s.inorderTraversal(c=>o(c.name,c.node)):this.children_.inorderTraversal(o)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,o){const s=this.resolveIndex_(o);if(s)return s.getIteratorFrom(e,c=>c);{const c=this.children_.getIteratorFrom(e.name,NamedNode.Wrap);let u=c.peek();for(;u!=null&&o.compare(u,e)<0;)c.getNext(),u=c.peek();return c}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,o){const s=this.resolveIndex_(o);if(s)return s.getReverseIteratorFrom(e,c=>c);{const c=this.children_.getReverseIteratorFrom(e.name,NamedNode.Wrap);let u=c.peek();for(;u!=null&&o.compare(u,e)>0;)c.getNext(),u=c.peek();return c}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===MAX_NODE?-1:0}withIndex(e){if(e===KEY_INDEX||this.indexMap_.hasIndex(e))return this;{const o=this.indexMap_.addIndex(e,this.children_);return new ChildrenNode(this.children_,this.priorityNode_,o)}}isIndexed(e){return e===KEY_INDEX||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const o=e;if(this.getPriority().equals(o.getPriority()))if(this.children_.count()===o.children_.count()){const s=this.getIterator(PRIORITY_INDEX),c=o.getIterator(PRIORITY_INDEX);let u=s.getNext(),d=c.getNext();for(;u&&d;){if(u.name!==d.name||!u.node.equals(d.node))return!1;u=s.getNext(),d=c.getNext()}return u===null&&d===null}else return!1;else return!1}}resolveIndex_(e){return e===KEY_INDEX?null:this.indexMap_.get(e.toString())}}ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class MaxNode extends ChildrenNode{constructor(){super(new SortedMap(NAME_COMPARATOR),ChildrenNode.EMPTY_NODE,IndexMap.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ChildrenNode.EMPTY_NODE}isEmpty(){return!1}}const MAX_NODE=new MaxNode;Object.defineProperties(NamedNode,{MIN:{value:new NamedNode(MIN_NAME,ChildrenNode.EMPTY_NODE)},MAX:{value:new NamedNode(MAX_NAME,MAX_NODE)}});KeyIndex.__EMPTY_NODE=ChildrenNode.EMPTY_NODE;LeafNode.__childrenNodeConstructor=ChildrenNode;setMaxNode$1(MAX_NODE);setMaxNode(MAX_NODE);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const USE_HINZE=!0;function nodeFromJSON(n,e=null){if(n===null)return ChildrenNode.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),assert(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const o=n;return new LeafNode(o,nodeFromJSON(e))}if(!(n instanceof Array)&&USE_HINZE){const o=[];let s=!1;if(each(n,(d,m)=>{if(d.substring(0,1)!=="."){const _=nodeFromJSON(m);_.isEmpty()||(s=s||!_.getPriority().isEmpty(),o.push(new NamedNode(d,_)))}}),o.length===0)return ChildrenNode.EMPTY_NODE;const u=buildChildSet(o,NAME_ONLY_COMPARATOR,d=>d.name,NAME_COMPARATOR);if(s){const d=buildChildSet(o,PRIORITY_INDEX.getCompare());return new ChildrenNode(u,nodeFromJSON(e),new IndexMap({".priority":d},{".priority":PRIORITY_INDEX}))}else return new ChildrenNode(u,nodeFromJSON(e),IndexMap.Default)}else{let o=ChildrenNode.EMPTY_NODE;return each(n,(s,c)=>{if(contains(n,s)&&s.substring(0,1)!=="."){const u=nodeFromJSON(c);(u.isLeafNode()||!u.isEmpty())&&(o=o.updateImmediateChild(s,u))}}),o.updatePriority(nodeFromJSON(e))}}setNodeFromJSON(nodeFromJSON);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PathIndex extends Index{constructor(e){super(),this.indexPath_=e,assert(!pathIsEmpty(e)&&pathGetFront(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,o){const s=this.extractChild(e.node),c=this.extractChild(o.node),u=s.compareTo(c);return u===0?nameCompare(e.name,o.name):u}makePost(e,o){const s=nodeFromJSON(e),c=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,s);return new NamedNode(o,c)}maxPost(){const e=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,MAX_NODE);return new NamedNode(MAX_NAME,e)}toString(){return pathSlice(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ValueIndex extends Index{compare(e,o){const s=e.node.compareTo(o.node);return s===0?nameCompare(e.name,o.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,o){return!e.equals(o)}minPost(){return NamedNode.MIN}maxPost(){return NamedNode.MAX}makePost(e,o){const s=nodeFromJSON(e);return new NamedNode(o,s)}toString(){return".value"}}const VALUE_INDEX=new ValueIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function changeValue(n){return{type:"value",snapshotNode:n}}function changeChildAdded(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function changeChildRemoved(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function changeChildChanged(n,e,o){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:o}}function changeChildMoved(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IndexedFilter{constructor(e){this.index_=e}updateChild(e,o,s,c,u,d){assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const m=e.getImmediateChild(o);return m.getChild(c).equals(s.getChild(c))&&m.isEmpty()===s.isEmpty()||(d!=null&&(s.isEmpty()?e.hasChild(o)?d.trackChildChange(changeChildRemoved(o,m)):assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):m.isEmpty()?d.trackChildChange(changeChildAdded(o,s)):d.trackChildChange(changeChildChanged(o,s,m))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(o,s).withIndex(this.index_)}updateFullNode(e,o,s){return s!=null&&(e.isLeafNode()||e.forEachChild(PRIORITY_INDEX,(c,u)=>{o.hasChild(c)||s.trackChildChange(changeChildRemoved(c,u))}),o.isLeafNode()||o.forEachChild(PRIORITY_INDEX,(c,u)=>{if(e.hasChild(c)){const d=e.getImmediateChild(c);d.equals(u)||s.trackChildChange(changeChildChanged(c,u,d))}else s.trackChildChange(changeChildAdded(c,u))})),o.withIndex(this.index_)}updatePriority(e,o){return e.isEmpty()?ChildrenNode.EMPTY_NODE:e.updatePriority(o)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RangedFilter{constructor(e){this.indexedFilter_=new IndexedFilter(e.getIndex()),this.index_=e.getIndex(),this.startPost_=RangedFilter.getStartPost_(e),this.endPost_=RangedFilter.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const o=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return o&&s}updateChild(e,o,s,c,u,d){return this.matches(new NamedNode(o,s))||(s=ChildrenNode.EMPTY_NODE),this.indexedFilter_.updateChild(e,o,s,c,u,d)}updateFullNode(e,o,s){o.isLeafNode()&&(o=ChildrenNode.EMPTY_NODE);let c=o.withIndex(this.index_);c=c.updatePriority(ChildrenNode.EMPTY_NODE);const u=this;return o.forEachChild(PRIORITY_INDEX,(d,m)=>{u.matches(new NamedNode(d,m))||(c=c.updateImmediateChild(d,ChildrenNode.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,c,s)}updatePriority(e,o){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const o=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),o)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const o=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),o)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LimitedFilter{constructor(e){this.withinDirectionalStart=o=>this.reverse_?this.withinEndPost(o):this.withinStartPost(o),this.withinDirectionalEnd=o=>this.reverse_?this.withinStartPost(o):this.withinEndPost(o),this.withinStartPost=o=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),o);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=o=>{const s=this.index_.compare(o,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new RangedFilter(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,o,s,c,u,d){return this.rangedFilter_.matches(new NamedNode(o,s))||(s=ChildrenNode.EMPTY_NODE),e.getImmediateChild(o).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,o,s,c,u,d):this.fullLimitUpdateChild_(e,o,s,u,d)}updateFullNode(e,o,s){let c;if(o.isLeafNode()||o.isEmpty())c=ChildrenNode.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<o.numChildren()&&o.isIndexed(this.index_)){c=ChildrenNode.EMPTY_NODE.withIndex(this.index_);let u;this.reverse_?u=o.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):u=o.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let d=0;for(;u.hasNext()&&d<this.limit_;){const m=u.getNext();if(this.withinDirectionalStart(m))if(this.withinDirectionalEnd(m))c=c.updateImmediateChild(m.name,m.node),d++;else break;else continue}}else{c=o.withIndex(this.index_),c=c.updatePriority(ChildrenNode.EMPTY_NODE);let u;this.reverse_?u=c.getReverseIterator(this.index_):u=c.getIterator(this.index_);let d=0;for(;u.hasNext();){const m=u.getNext();d<this.limit_&&this.withinDirectionalStart(m)&&this.withinDirectionalEnd(m)?d++:c=c.updateImmediateChild(m.name,ChildrenNode.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,c,s)}updatePriority(e,o){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,o,s,c,u){let d;if(this.reverse_){const nh=this.index_.getCompare();d=(ih,rh)=>nh(rh,ih)}else d=this.index_.getCompare();const m=e;assert(m.numChildren()===this.limit_,"");const _=new NamedNode(o,s),ue=this.reverse_?m.getFirstChild(this.index_):m.getLastChild(this.index_),gn=this.rangedFilter_.matches(_);if(m.hasChild(o)){const nh=m.getImmediateChild(o);let ih=c.getChildAfterChild(this.index_,ue,this.reverse_);for(;ih!=null&&(ih.name===o||m.hasChild(ih.name));)ih=c.getChildAfterChild(this.index_,ih,this.reverse_);const rh=ih==null?1:d(ih,_);if(gn&&!s.isEmpty()&&rh>=0)return u!=null&&u.trackChildChange(changeChildChanged(o,s,nh)),m.updateImmediateChild(o,s);{u!=null&&u.trackChildChange(changeChildRemoved(o,nh));const lh=m.updateImmediateChild(o,ChildrenNode.EMPTY_NODE);return ih!=null&&this.rangedFilter_.matches(ih)?(u!=null&&u.trackChildChange(changeChildAdded(ih.name,ih.node)),lh.updateImmediateChild(ih.name,ih.node)):lh}}else return s.isEmpty()?e:gn&&d(ue,_)>=0?(u!=null&&(u.trackChildChange(changeChildRemoved(ue.name,ue.node)),u.trackChildChange(changeChildAdded(o,s))),m.updateImmediateChild(o,s).updateImmediateChild(ue.name,ChildrenNode.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryParams{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=PRIORITY_INDEX}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:MIN_NAME}hasEnd(){return this.endSet_}getIndexEndValue(){return assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:MAX_NAME}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return assert(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===PRIORITY_INDEX}copy(){const e=new QueryParams;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function queryParamsGetNodeFilter(n){return n.loadsAllData()?new IndexedFilter(n.getIndex()):n.hasLimit()?new LimitedFilter(n):new RangedFilter(n)}function queryParamsToRestQueryStringParameters(n){const e={};if(n.isDefault())return e;let o;if(n.index_===PRIORITY_INDEX?o="$priority":n.index_===VALUE_INDEX?o="$value":n.index_===KEY_INDEX?o="$key":(assert(n.index_ instanceof PathIndex,"Unrecognized index type!"),o=n.index_.toString()),e.orderBy=stringify(o),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=stringify(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+stringify(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=stringify(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+stringify(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function queryParamsGetQueryObject(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let o=n.viewFrom_;o===""&&(n.isViewFromLeft()?o="l":o="r"),e.vf=o}return n.index_!==PRIORITY_INDEX&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ReadonlyRestClient extends ServerActions{constructor(e,o,s,c){super(),this.repoInfo_=e,this.onDataUpdate_=o,this.authTokenProvider_=s,this.appCheckTokenProvider_=c,this.log_=logWrapper("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,o){return o!==void 0?"tag$"+o:(assert(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,o,s,c){const u=e._path.toString();this.log_("Listen called for "+u+" "+e._queryIdentifier);const d=ReadonlyRestClient.getListenId_(e,s),m={};this.listens_[d]=m;const _=queryParamsToRestQueryStringParameters(e._queryParams);this.restRequest_(u+".json",_,(ue,gn)=>{let nh=gn;if(ue===404&&(nh=null,ue=null),ue===null&&this.onDataUpdate_(u,nh,!1,s),safeGet(this.listens_,d)===m){let ih;ue?ue===401?ih="permission_denied":ih="rest_error:"+ue:ih="ok",c(ih,null)}})}unlisten(e,o){const s=ReadonlyRestClient.getListenId_(e,o);delete this.listens_[s]}get(e){const o=queryParamsToRestQueryStringParameters(e._queryParams),s=e._path.toString(),c=new Deferred;return this.restRequest_(s+".json",o,(u,d)=>{let m=d;u===404&&(m=null,u=null),u===null?(this.onDataUpdate_(s,m,!1,null),c.resolve(m)):c.reject(new Error(m))}),c.promise}refreshAuthToken(e){}restRequest_(e,o={},s){return o.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([c,u])=>{c&&c.accessToken&&(o.auth=c.accessToken),u&&u.token&&(o.ac=u.token);const d=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+querystring(o);this.log_("Sending REST request for "+d);const m=new XMLHttpRequest;m.onreadystatechange=()=>{if(s&&m.readyState===4){this.log_("REST Response for "+d+" received. status:",m.status,"response:",m.responseText);let _=null;if(m.status>=200&&m.status<300){try{_=jsonEval(m.responseText)}catch{warn("Failed to parse JSON response for "+d+": "+m.responseText)}s(null,_)}else m.status!==401&&m.status!==404&&warn("Got unsuccessful REST response for "+d+" Status: "+m.status),s(m.status);s=null}},m.open("GET",d,!0),m.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotHolder{constructor(){this.rootNode_=ChildrenNode.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,o){this.rootNode_=this.rootNode_.updateChild(e,o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newSparseSnapshotTree(){return{value:null,children:new Map}}function sparseSnapshotTreeRemember(n,e,o){if(pathIsEmpty(e))n.value=o,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,o);else{const s=pathGetFront(e);n.children.has(s)||n.children.set(s,newSparseSnapshotTree());const c=n.children.get(s);e=pathPopFront(e),sparseSnapshotTreeRemember(c,e,o)}}function sparseSnapshotTreeForEachTree(n,e,o){n.value!==null?o(e,n.value):sparseSnapshotTreeForEachChild(n,(s,c)=>{const u=new Path(e.toString()+"/"+s);sparseSnapshotTreeForEachTree(c,u,o)})}function sparseSnapshotTreeForEachChild(n,e){n.children.forEach((o,s)=>{e(s,o)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsListener{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),o=Object.assign({},e);return this.last_&&each(this.last_,(s,c)=>{o[s]=o[s]-c}),this.last_=e,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIRST_STATS_MIN_TIME=10*1e3,FIRST_STATS_MAX_TIME=30*1e3,REPORT_STATS_INTERVAL=5*60*1e3;class StatsReporter{constructor(e,o){this.server_=o,this.statsToReport_={},this.statsListener_=new StatsListener(e);const s=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),o={};let s=!1;each(e,(c,u)=>{u>0&&contains(this.statsToReport_,c)&&(o[c]=u,s=!0)}),s&&this.server_.reportStats(o),setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(Math.random()*2*REPORT_STATS_INTERVAL))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var OperationType;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(OperationType||(OperationType={}));function newOperationSourceUser(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function newOperationSourceServer(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function newOperationSourceServerTaggedQuery(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AckUserWrite{constructor(e,o,s){this.path=e,this.affectedTree=o,this.revert=s,this.type=OperationType.ACK_USER_WRITE,this.source=newOperationSourceUser()}operationForChild(e){if(pathIsEmpty(this.path)){if(this.affectedTree.value!=null)return assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const o=this.affectedTree.subtree(new Path(e));return new AckUserWrite(newEmptyPath(),o,this.revert)}}else return assert(pathGetFront(this.path)===e,"operationForChild called for unrelated child."),new AckUserWrite(pathPopFront(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ListenComplete{constructor(e,o){this.source=e,this.path=o,this.type=OperationType.LISTEN_COMPLETE}operationForChild(e){return pathIsEmpty(this.path)?new ListenComplete(this.source,newEmptyPath()):new ListenComplete(this.source,pathPopFront(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Overwrite{constructor(e,o,s){this.source=e,this.path=o,this.snap=s,this.type=OperationType.OVERWRITE}operationForChild(e){return pathIsEmpty(this.path)?new Overwrite(this.source,newEmptyPath(),this.snap.getImmediateChild(e)):new Overwrite(this.source,pathPopFront(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Merge{constructor(e,o,s){this.source=e,this.path=o,this.children=s,this.type=OperationType.MERGE}operationForChild(e){if(pathIsEmpty(this.path)){const o=this.children.subtree(new Path(e));return o.isEmpty()?null:o.value?new Overwrite(this.source,newEmptyPath(),o.value):new Merge(this.source,newEmptyPath(),o)}else return assert(pathGetFront(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Merge(this.source,pathPopFront(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CacheNode{constructor(e,o,s){this.node_=e,this.fullyInitialized_=o,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(pathIsEmpty(e))return this.isFullyInitialized()&&!this.filtered_;const o=pathGetFront(e);return this.isCompleteForChild(o)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventGenerator{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function eventGeneratorGenerateEventsForChanges(n,e,o,s){const c=[],u=[];return e.forEach(d=>{d.type==="child_changed"&&n.index_.indexedValueChanged(d.oldSnap,d.snapshotNode)&&u.push(changeChildMoved(d.childName,d.snapshotNode))}),eventGeneratorGenerateEventsForType(n,c,"child_removed",e,s,o),eventGeneratorGenerateEventsForType(n,c,"child_added",e,s,o),eventGeneratorGenerateEventsForType(n,c,"child_moved",u,s,o),eventGeneratorGenerateEventsForType(n,c,"child_changed",e,s,o),eventGeneratorGenerateEventsForType(n,c,"value",e,s,o),c}function eventGeneratorGenerateEventsForType(n,e,o,s,c,u){const d=s.filter(m=>m.type===o);d.sort((m,_)=>eventGeneratorCompareChanges(n,m,_)),d.forEach(m=>{const _=eventGeneratorMaterializeSingleChange(n,m,u);c.forEach(ue=>{ue.respondsTo(m.type)&&e.push(ue.createEvent(_,n.query_))})})}function eventGeneratorMaterializeSingleChange(n,e,o){return e.type==="value"||e.type==="child_removed"||(e.prevName=o.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function eventGeneratorCompareChanges(n,e,o){if(e.childName==null||o.childName==null)throw assertionError("Should only compare child_ events.");const s=new NamedNode(e.childName,e.snapshotNode),c=new NamedNode(o.childName,o.snapshotNode);return n.index_.compare(s,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewCache(n,e){return{eventCache:n,serverCache:e}}function viewCacheUpdateEventSnap(n,e,o,s){return newViewCache(new CacheNode(e,o,s),n.serverCache)}function viewCacheUpdateServerSnap(n,e,o,s){return newViewCache(n.eventCache,new CacheNode(e,o,s))}function viewCacheGetCompleteEventSnap(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function viewCacheGetCompleteServerSnap(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let emptyChildrenSingleton;const EmptyChildren=()=>(emptyChildrenSingleton||(emptyChildrenSingleton=new SortedMap(stringCompare)),emptyChildrenSingleton);class ImmutableTree{constructor(e,o=EmptyChildren()){this.value=e,this.children=o}static fromObject(e){let o=new ImmutableTree(null);return each(e,(s,c)=>{o=o.set(new Path(s),c)}),o}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,o){if(this.value!=null&&o(this.value))return{path:newEmptyPath(),value:this.value};if(pathIsEmpty(e))return null;{const s=pathGetFront(e),c=this.children.get(s);if(c!==null){const u=c.findRootMostMatchingPathAndValue(pathPopFront(e),o);return u!=null?{path:pathChild(new Path(s),u.path),value:u.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(pathIsEmpty(e))return this;{const o=pathGetFront(e),s=this.children.get(o);return s!==null?s.subtree(pathPopFront(e)):new ImmutableTree(null)}}set(e,o){if(pathIsEmpty(e))return new ImmutableTree(o,this.children);{const s=pathGetFront(e),u=(this.children.get(s)||new ImmutableTree(null)).set(pathPopFront(e),o),d=this.children.insert(s,u);return new ImmutableTree(this.value,d)}}remove(e){if(pathIsEmpty(e))return this.children.isEmpty()?new ImmutableTree(null):new ImmutableTree(null,this.children);{const o=pathGetFront(e),s=this.children.get(o);if(s){const c=s.remove(pathPopFront(e));let u;return c.isEmpty()?u=this.children.remove(o):u=this.children.insert(o,c),this.value===null&&u.isEmpty()?new ImmutableTree(null):new ImmutableTree(this.value,u)}else return this}}get(e){if(pathIsEmpty(e))return this.value;{const o=pathGetFront(e),s=this.children.get(o);return s?s.get(pathPopFront(e)):null}}setTree(e,o){if(pathIsEmpty(e))return o;{const s=pathGetFront(e),u=(this.children.get(s)||new ImmutableTree(null)).setTree(pathPopFront(e),o);let d;return u.isEmpty()?d=this.children.remove(s):d=this.children.insert(s,u),new ImmutableTree(this.value,d)}}fold(e){return this.fold_(newEmptyPath(),e)}fold_(e,o){const s={};return this.children.inorderTraversal((c,u)=>{s[c]=u.fold_(pathChild(e,c),o)}),o(e,this.value,s)}findOnPath(e,o){return this.findOnPath_(e,newEmptyPath(),o)}findOnPath_(e,o,s){const c=this.value?s(o,this.value):!1;if(c)return c;if(pathIsEmpty(e))return null;{const u=pathGetFront(e),d=this.children.get(u);return d?d.findOnPath_(pathPopFront(e),pathChild(o,u),s):null}}foreachOnPath(e,o){return this.foreachOnPath_(e,newEmptyPath(),o)}foreachOnPath_(e,o,s){if(pathIsEmpty(e))return this;{this.value&&s(o,this.value);const c=pathGetFront(e),u=this.children.get(c);return u?u.foreachOnPath_(pathPopFront(e),pathChild(o,c),s):new ImmutableTree(null)}}foreach(e){this.foreach_(newEmptyPath(),e)}foreach_(e,o){this.children.inorderTraversal((s,c)=>{c.foreach_(pathChild(e,s),o)}),this.value&&o(e,this.value)}foreachChild(e){this.children.inorderTraversal((o,s)=>{s.value&&e(o,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CompoundWrite{constructor(e){this.writeTree_=e}static empty(){return new CompoundWrite(new ImmutableTree(null))}}function compoundWriteAddWrite(n,e,o){if(pathIsEmpty(e))return new CompoundWrite(new ImmutableTree(o));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const c=s.path;let u=s.value;const d=newRelativePath(c,e);return u=u.updateChild(d,o),new CompoundWrite(n.writeTree_.set(c,u))}else{const c=new ImmutableTree(o),u=n.writeTree_.setTree(e,c);return new CompoundWrite(u)}}}function compoundWriteAddWrites(n,e,o){let s=n;return each(o,(c,u)=>{s=compoundWriteAddWrite(s,pathChild(e,c),u)}),s}function compoundWriteRemoveWrite(n,e){if(pathIsEmpty(e))return CompoundWrite.empty();{const o=n.writeTree_.setTree(e,new ImmutableTree(null));return new CompoundWrite(o)}}function compoundWriteHasCompleteWrite(n,e){return compoundWriteGetCompleteNode(n,e)!=null}function compoundWriteGetCompleteNode(n,e){const o=n.writeTree_.findRootMostValueAndPath(e);return o!=null?n.writeTree_.get(o.path).getChild(newRelativePath(o.path,e)):null}function compoundWriteGetCompleteChildren(n){const e=[],o=n.writeTree_.value;return o!=null?o.isLeafNode()||o.forEachChild(PRIORITY_INDEX,(s,c)=>{e.push(new NamedNode(s,c))}):n.writeTree_.children.inorderTraversal((s,c)=>{c.value!=null&&e.push(new NamedNode(s,c.value))}),e}function compoundWriteChildCompoundWrite(n,e){if(pathIsEmpty(e))return n;{const o=compoundWriteGetCompleteNode(n,e);return o!=null?new CompoundWrite(new ImmutableTree(o)):new CompoundWrite(n.writeTree_.subtree(e))}}function compoundWriteIsEmpty(n){return n.writeTree_.isEmpty()}function compoundWriteApply(n,e){return applySubtreeWrite(newEmptyPath(),n.writeTree_,e)}function applySubtreeWrite(n,e,o){if(e.value!=null)return o.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((c,u)=>{c===".priority"?(assert(u.value!==null,"Priority writes must always be leaf nodes"),s=u.value):o=applySubtreeWrite(pathChild(n,c),u,o)}),!o.getChild(n).isEmpty()&&s!==null&&(o=o.updateChild(pathChild(n,".priority"),s)),o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function writeTreeChildWrites(n,e){return newWriteTreeRef(e,n)}function writeTreeAddOverwrite(n,e,o,s,c){assert(s>n.lastWriteId,"Stacking an older write on top of newer ones"),c===void 0&&(c=!0),n.allWrites.push({path:e,snap:o,writeId:s,visible:c}),c&&(n.visibleWrites=compoundWriteAddWrite(n.visibleWrites,e,o)),n.lastWriteId=s}function writeTreeAddMerge(n,e,o,s){assert(s>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:o,writeId:s,visible:!0}),n.visibleWrites=compoundWriteAddWrites(n.visibleWrites,e,o),n.lastWriteId=s}function writeTreeGetWrite(n,e){for(let o=0;o<n.allWrites.length;o++){const s=n.allWrites[o];if(s.writeId===e)return s}return null}function writeTreeRemoveWrite(n,e){const o=n.allWrites.findIndex(m=>m.writeId===e);assert(o>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[o];n.allWrites.splice(o,1);let c=s.visible,u=!1,d=n.allWrites.length-1;for(;c&&d>=0;){const m=n.allWrites[d];m.visible&&(d>=o&&writeTreeRecordContainsPath_(m,s.path)?c=!1:pathContains(s.path,m.path)&&(u=!0)),d--}if(c){if(u)return writeTreeResetTree_(n),!0;if(s.snap)n.visibleWrites=compoundWriteRemoveWrite(n.visibleWrites,s.path);else{const m=s.children;each(m,_=>{n.visibleWrites=compoundWriteRemoveWrite(n.visibleWrites,pathChild(s.path,_))})}return!0}else return!1}function writeTreeRecordContainsPath_(n,e){if(n.snap)return pathContains(n.path,e);for(const o in n.children)if(n.children.hasOwnProperty(o)&&pathContains(pathChild(n.path,o),e))return!0;return!1}function writeTreeResetTree_(n){n.visibleWrites=writeTreeLayerTree_(n.allWrites,writeTreeDefaultFilter_,newEmptyPath()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function writeTreeDefaultFilter_(n){return n.visible}function writeTreeLayerTree_(n,e,o){let s=CompoundWrite.empty();for(let c=0;c<n.length;++c){const u=n[c];if(e(u)){const d=u.path;let m;if(u.snap)pathContains(o,d)?(m=newRelativePath(o,d),s=compoundWriteAddWrite(s,m,u.snap)):pathContains(d,o)&&(m=newRelativePath(d,o),s=compoundWriteAddWrite(s,newEmptyPath(),u.snap.getChild(m)));else if(u.children){if(pathContains(o,d))m=newRelativePath(o,d),s=compoundWriteAddWrites(s,m,u.children);else if(pathContains(d,o))if(m=newRelativePath(d,o),pathIsEmpty(m))s=compoundWriteAddWrites(s,newEmptyPath(),u.children);else{const _=safeGet(u.children,pathGetFront(m));if(_){const ue=_.getChild(pathPopFront(m));s=compoundWriteAddWrite(s,newEmptyPath(),ue)}}}else throw assertionError("WriteRecord should have .snap or .children")}}return s}function writeTreeCalcCompleteEventCache(n,e,o,s,c){if(!s&&!c){const u=compoundWriteGetCompleteNode(n.visibleWrites,e);if(u!=null)return u;{const d=compoundWriteChildCompoundWrite(n.visibleWrites,e);if(compoundWriteIsEmpty(d))return o;if(o==null&&!compoundWriteHasCompleteWrite(d,newEmptyPath()))return null;{const m=o||ChildrenNode.EMPTY_NODE;return compoundWriteApply(d,m)}}}else{const u=compoundWriteChildCompoundWrite(n.visibleWrites,e);if(!c&&compoundWriteIsEmpty(u))return o;if(!c&&o==null&&!compoundWriteHasCompleteWrite(u,newEmptyPath()))return null;{const d=function(ue){return(ue.visible||c)&&(!s||!~s.indexOf(ue.writeId))&&(pathContains(ue.path,e)||pathContains(e,ue.path))},m=writeTreeLayerTree_(n.allWrites,d,e),_=o||ChildrenNode.EMPTY_NODE;return compoundWriteApply(m,_)}}}function writeTreeCalcCompleteEventChildren(n,e,o){let s=ChildrenNode.EMPTY_NODE;const c=compoundWriteGetCompleteNode(n.visibleWrites,e);if(c)return c.isLeafNode()||c.forEachChild(PRIORITY_INDEX,(u,d)=>{s=s.updateImmediateChild(u,d)}),s;if(o){const u=compoundWriteChildCompoundWrite(n.visibleWrites,e);return o.forEachChild(PRIORITY_INDEX,(d,m)=>{const _=compoundWriteApply(compoundWriteChildCompoundWrite(u,new Path(d)),m);s=s.updateImmediateChild(d,_)}),compoundWriteGetCompleteChildren(u).forEach(d=>{s=s.updateImmediateChild(d.name,d.node)}),s}else{const u=compoundWriteChildCompoundWrite(n.visibleWrites,e);return compoundWriteGetCompleteChildren(u).forEach(d=>{s=s.updateImmediateChild(d.name,d.node)}),s}}function writeTreeCalcEventCacheAfterServerOverwrite(n,e,o,s,c){assert(s||c,"Either existingEventSnap or existingServerSnap must exist");const u=pathChild(e,o);if(compoundWriteHasCompleteWrite(n.visibleWrites,u))return null;{const d=compoundWriteChildCompoundWrite(n.visibleWrites,u);return compoundWriteIsEmpty(d)?c.getChild(o):compoundWriteApply(d,c.getChild(o))}}function writeTreeCalcCompleteChild(n,e,o,s){const c=pathChild(e,o),u=compoundWriteGetCompleteNode(n.visibleWrites,c);if(u!=null)return u;if(s.isCompleteForChild(o)){const d=compoundWriteChildCompoundWrite(n.visibleWrites,c);return compoundWriteApply(d,s.getNode().getImmediateChild(o))}else return null}function writeTreeShadowingWrite(n,e){return compoundWriteGetCompleteNode(n.visibleWrites,e)}function writeTreeCalcIndexedSlice(n,e,o,s,c,u,d){let m;const _=compoundWriteChildCompoundWrite(n.visibleWrites,e),ue=compoundWriteGetCompleteNode(_,newEmptyPath());if(ue!=null)m=ue;else if(o!=null)m=compoundWriteApply(_,o);else return[];if(m=m.withIndex(d),!m.isEmpty()&&!m.isLeafNode()){const gn=[],nh=d.getCompare(),ih=u?m.getReverseIteratorFrom(s,d):m.getIteratorFrom(s,d);let rh=ih.getNext();for(;rh&&gn.length<c;)nh(rh,s)!==0&&gn.push(rh),rh=ih.getNext();return gn}else return[]}function newWriteTree(){return{visibleWrites:CompoundWrite.empty(),allWrites:[],lastWriteId:-1}}function writeTreeRefCalcCompleteEventCache(n,e,o,s){return writeTreeCalcCompleteEventCache(n.writeTree,n.treePath,e,o,s)}function writeTreeRefCalcCompleteEventChildren(n,e){return writeTreeCalcCompleteEventChildren(n.writeTree,n.treePath,e)}function writeTreeRefCalcEventCacheAfterServerOverwrite(n,e,o,s){return writeTreeCalcEventCacheAfterServerOverwrite(n.writeTree,n.treePath,e,o,s)}function writeTreeRefShadowingWrite(n,e){return writeTreeShadowingWrite(n.writeTree,pathChild(n.treePath,e))}function writeTreeRefCalcIndexedSlice(n,e,o,s,c,u){return writeTreeCalcIndexedSlice(n.writeTree,n.treePath,e,o,s,c,u)}function writeTreeRefCalcCompleteChild(n,e,o){return writeTreeCalcCompleteChild(n.writeTree,n.treePath,e,o)}function writeTreeRefChild(n,e){return newWriteTreeRef(pathChild(n.treePath,e),n.writeTree)}function newWriteTreeRef(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ChildChangeAccumulator{constructor(){this.changeMap=new Map}trackChildChange(e){const o=e.type,s=e.childName;assert(o==="child_added"||o==="child_changed"||o==="child_removed","Only child changes supported for tracking"),assert(s!==".priority","Only non-priority child changes can be tracked.");const c=this.changeMap.get(s);if(c){const u=c.type;if(o==="child_added"&&u==="child_removed")this.changeMap.set(s,changeChildChanged(s,e.snapshotNode,c.snapshotNode));else if(o==="child_removed"&&u==="child_added")this.changeMap.delete(s);else if(o==="child_removed"&&u==="child_changed")this.changeMap.set(s,changeChildRemoved(s,c.oldSnap));else if(o==="child_changed"&&u==="child_added")this.changeMap.set(s,changeChildAdded(s,e.snapshotNode));else if(o==="child_changed"&&u==="child_changed")this.changeMap.set(s,changeChildChanged(s,e.snapshotNode,c.oldSnap));else throw assertionError("Illegal combination of changes: "+e+" occurred after "+c)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NoCompleteChildSource_{getCompleteChild(e){return null}getChildAfterChild(e,o,s){return null}}const NO_COMPLETE_CHILD_SOURCE=new NoCompleteChildSource_;class WriteTreeCompleteChildSource{constructor(e,o,s=null){this.writes_=e,this.viewCache_=o,this.optCompleteServerCache_=s}getCompleteChild(e){const o=this.viewCache_.eventCache;if(o.isCompleteForChild(e))return o.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return writeTreeRefCalcCompleteChild(this.writes_,e,s)}}getChildAfterChild(e,o,s){const c=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:viewCacheGetCompleteServerSnap(this.viewCache_),u=writeTreeRefCalcIndexedSlice(this.writes_,c,o,1,s,e);return u.length===0?null:u[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewProcessor(n){return{filter:n}}function viewProcessorAssertIndexed(n,e){assert(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),assert(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function viewProcessorApplyOperation(n,e,o,s,c){const u=new ChildChangeAccumulator;let d,m;if(o.type===OperationType.OVERWRITE){const ue=o;ue.source.fromUser?d=viewProcessorApplyUserOverwrite(n,e,ue.path,ue.snap,s,c,u):(assert(ue.source.fromServer,"Unknown source."),m=ue.source.tagged||e.serverCache.isFiltered()&&!pathIsEmpty(ue.path),d=viewProcessorApplyServerOverwrite(n,e,ue.path,ue.snap,s,c,m,u))}else if(o.type===OperationType.MERGE){const ue=o;ue.source.fromUser?d=viewProcessorApplyUserMerge(n,e,ue.path,ue.children,s,c,u):(assert(ue.source.fromServer,"Unknown source."),m=ue.source.tagged||e.serverCache.isFiltered(),d=viewProcessorApplyServerMerge(n,e,ue.path,ue.children,s,c,m,u))}else if(o.type===OperationType.ACK_USER_WRITE){const ue=o;ue.revert?d=viewProcessorRevertUserWrite(n,e,ue.path,s,c,u):d=viewProcessorAckUserWrite(n,e,ue.path,ue.affectedTree,s,c,u)}else if(o.type===OperationType.LISTEN_COMPLETE)d=viewProcessorListenComplete(n,e,o.path,s,u);else throw assertionError("Unknown operation type: "+o.type);const _=u.getChanges();return viewProcessorMaybeAddValueEvent(e,d,_),{viewCache:d,changes:_}}function viewProcessorMaybeAddValueEvent(n,e,o){const s=e.eventCache;if(s.isFullyInitialized()){const c=s.getNode().isLeafNode()||s.getNode().isEmpty(),u=viewCacheGetCompleteEventSnap(n);(o.length>0||!n.eventCache.isFullyInitialized()||c&&!s.getNode().equals(u)||!s.getNode().getPriority().equals(u.getPriority()))&&o.push(changeValue(viewCacheGetCompleteEventSnap(e)))}}function viewProcessorGenerateEventCacheAfterServerEvent(n,e,o,s,c,u){const d=e.eventCache;if(writeTreeRefShadowingWrite(s,o)!=null)return e;{let m,_;if(pathIsEmpty(o))if(assert(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const ue=viewCacheGetCompleteServerSnap(e),gn=ue instanceof ChildrenNode?ue:ChildrenNode.EMPTY_NODE,nh=writeTreeRefCalcCompleteEventChildren(s,gn);m=n.filter.updateFullNode(e.eventCache.getNode(),nh,u)}else{const ue=writeTreeRefCalcCompleteEventCache(s,viewCacheGetCompleteServerSnap(e));m=n.filter.updateFullNode(e.eventCache.getNode(),ue,u)}else{const ue=pathGetFront(o);if(ue===".priority"){assert(pathGetLength(o)===1,"Can't have a priority with additional path components");const gn=d.getNode();_=e.serverCache.getNode();const nh=writeTreeRefCalcEventCacheAfterServerOverwrite(s,o,gn,_);nh!=null?m=n.filter.updatePriority(gn,nh):m=d.getNode()}else{const gn=pathPopFront(o);let nh;if(d.isCompleteForChild(ue)){_=e.serverCache.getNode();const ih=writeTreeRefCalcEventCacheAfterServerOverwrite(s,o,d.getNode(),_);ih!=null?nh=d.getNode().getImmediateChild(ue).updateChild(gn,ih):nh=d.getNode().getImmediateChild(ue)}else nh=writeTreeRefCalcCompleteChild(s,ue,e.serverCache);nh!=null?m=n.filter.updateChild(d.getNode(),ue,nh,gn,c,u):m=d.getNode()}}return viewCacheUpdateEventSnap(e,m,d.isFullyInitialized()||pathIsEmpty(o),n.filter.filtersNodes())}}function viewProcessorApplyServerOverwrite(n,e,o,s,c,u,d,m){const _=e.serverCache;let ue;const gn=d?n.filter:n.filter.getIndexedFilter();if(pathIsEmpty(o))ue=gn.updateFullNode(_.getNode(),s,null);else if(gn.filtersNodes()&&!_.isFiltered()){const rh=_.getNode().updateChild(o,s);ue=gn.updateFullNode(_.getNode(),rh,null)}else{const rh=pathGetFront(o);if(!_.isCompleteForPath(o)&&pathGetLength(o)>1)return e;const oh=pathPopFront(o),ch=_.getNode().getImmediateChild(rh).updateChild(oh,s);rh===".priority"?ue=gn.updatePriority(_.getNode(),ch):ue=gn.updateChild(_.getNode(),rh,ch,oh,NO_COMPLETE_CHILD_SOURCE,null)}const nh=viewCacheUpdateServerSnap(e,ue,_.isFullyInitialized()||pathIsEmpty(o),gn.filtersNodes()),ih=new WriteTreeCompleteChildSource(c,nh,u);return viewProcessorGenerateEventCacheAfterServerEvent(n,nh,o,c,ih,m)}function viewProcessorApplyUserOverwrite(n,e,o,s,c,u,d){const m=e.eventCache;let _,ue;const gn=new WriteTreeCompleteChildSource(c,e,u);if(pathIsEmpty(o))ue=n.filter.updateFullNode(e.eventCache.getNode(),s,d),_=viewCacheUpdateEventSnap(e,ue,!0,n.filter.filtersNodes());else{const nh=pathGetFront(o);if(nh===".priority")ue=n.filter.updatePriority(e.eventCache.getNode(),s),_=viewCacheUpdateEventSnap(e,ue,m.isFullyInitialized(),m.isFiltered());else{const ih=pathPopFront(o),rh=m.getNode().getImmediateChild(nh);let oh;if(pathIsEmpty(ih))oh=s;else{const lh=gn.getCompleteChild(nh);lh!=null?pathGetBack(ih)===".priority"&&lh.getChild(pathParent(ih)).isEmpty()?oh=lh:oh=lh.updateChild(ih,s):oh=ChildrenNode.EMPTY_NODE}if(rh.equals(oh))_=e;else{const lh=n.filter.updateChild(m.getNode(),nh,oh,ih,gn,d);_=viewCacheUpdateEventSnap(e,lh,m.isFullyInitialized(),n.filter.filtersNodes())}}}return _}function viewProcessorCacheHasChild(n,e){return n.eventCache.isCompleteForChild(e)}function viewProcessorApplyUserMerge(n,e,o,s,c,u,d){let m=e;return s.foreach((_,ue)=>{const gn=pathChild(o,_);viewProcessorCacheHasChild(e,pathGetFront(gn))&&(m=viewProcessorApplyUserOverwrite(n,m,gn,ue,c,u,d))}),s.foreach((_,ue)=>{const gn=pathChild(o,_);viewProcessorCacheHasChild(e,pathGetFront(gn))||(m=viewProcessorApplyUserOverwrite(n,m,gn,ue,c,u,d))}),m}function viewProcessorApplyMerge(n,e,o){return o.foreach((s,c)=>{e=e.updateChild(s,c)}),e}function viewProcessorApplyServerMerge(n,e,o,s,c,u,d,m){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let _=e,ue;pathIsEmpty(o)?ue=s:ue=new ImmutableTree(null).setTree(o,s);const gn=e.serverCache.getNode();return ue.children.inorderTraversal((nh,ih)=>{if(gn.hasChild(nh)){const rh=e.serverCache.getNode().getImmediateChild(nh),oh=viewProcessorApplyMerge(n,rh,ih);_=viewProcessorApplyServerOverwrite(n,_,new Path(nh),oh,c,u,d,m)}}),ue.children.inorderTraversal((nh,ih)=>{const rh=!e.serverCache.isCompleteForChild(nh)&&ih.value===null;if(!gn.hasChild(nh)&&!rh){const oh=e.serverCache.getNode().getImmediateChild(nh),lh=viewProcessorApplyMerge(n,oh,ih);_=viewProcessorApplyServerOverwrite(n,_,new Path(nh),lh,c,u,d,m)}}),_}function viewProcessorAckUserWrite(n,e,o,s,c,u,d){if(writeTreeRefShadowingWrite(c,o)!=null)return e;const m=e.serverCache.isFiltered(),_=e.serverCache;if(s.value!=null){if(pathIsEmpty(o)&&_.isFullyInitialized()||_.isCompleteForPath(o))return viewProcessorApplyServerOverwrite(n,e,o,_.getNode().getChild(o),c,u,m,d);if(pathIsEmpty(o)){let ue=new ImmutableTree(null);return _.getNode().forEachChild(KEY_INDEX,(gn,nh)=>{ue=ue.set(new Path(gn),nh)}),viewProcessorApplyServerMerge(n,e,o,ue,c,u,m,d)}else return e}else{let ue=new ImmutableTree(null);return s.foreach((gn,nh)=>{const ih=pathChild(o,gn);_.isCompleteForPath(ih)&&(ue=ue.set(gn,_.getNode().getChild(ih)))}),viewProcessorApplyServerMerge(n,e,o,ue,c,u,m,d)}}function viewProcessorListenComplete(n,e,o,s,c){const u=e.serverCache,d=viewCacheUpdateServerSnap(e,u.getNode(),u.isFullyInitialized()||pathIsEmpty(o),u.isFiltered());return viewProcessorGenerateEventCacheAfterServerEvent(n,d,o,s,NO_COMPLETE_CHILD_SOURCE,c)}function viewProcessorRevertUserWrite(n,e,o,s,c,u){let d;if(writeTreeRefShadowingWrite(s,o)!=null)return e;{const m=new WriteTreeCompleteChildSource(s,e,c),_=e.eventCache.getNode();let ue;if(pathIsEmpty(o)||pathGetFront(o)===".priority"){let gn;if(e.serverCache.isFullyInitialized())gn=writeTreeRefCalcCompleteEventCache(s,viewCacheGetCompleteServerSnap(e));else{const nh=e.serverCache.getNode();assert(nh instanceof ChildrenNode,"serverChildren would be complete if leaf node"),gn=writeTreeRefCalcCompleteEventChildren(s,nh)}gn=gn,ue=n.filter.updateFullNode(_,gn,u)}else{const gn=pathGetFront(o);let nh=writeTreeRefCalcCompleteChild(s,gn,e.serverCache);nh==null&&e.serverCache.isCompleteForChild(gn)&&(nh=_.getImmediateChild(gn)),nh!=null?ue=n.filter.updateChild(_,gn,nh,pathPopFront(o),m,u):e.eventCache.getNode().hasChild(gn)?ue=n.filter.updateChild(_,gn,ChildrenNode.EMPTY_NODE,pathPopFront(o),m,u):ue=_,ue.isEmpty()&&e.serverCache.isFullyInitialized()&&(d=writeTreeRefCalcCompleteEventCache(s,viewCacheGetCompleteServerSnap(e)),d.isLeafNode()&&(ue=n.filter.updateFullNode(ue,d,u)))}return d=e.serverCache.isFullyInitialized()||writeTreeRefShadowingWrite(s,newEmptyPath())!=null,viewCacheUpdateEventSnap(e,ue,d,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class View{constructor(e,o){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,c=new IndexedFilter(s.getIndex()),u=queryParamsGetNodeFilter(s);this.processor_=newViewProcessor(u);const d=o.serverCache,m=o.eventCache,_=c.updateFullNode(ChildrenNode.EMPTY_NODE,d.getNode(),null),ue=u.updateFullNode(ChildrenNode.EMPTY_NODE,m.getNode(),null),gn=new CacheNode(_,d.isFullyInitialized(),c.filtersNodes()),nh=new CacheNode(ue,m.isFullyInitialized(),u.filtersNodes());this.viewCache_=newViewCache(nh,gn),this.eventGenerator_=new EventGenerator(this.query_)}get query(){return this.query_}}function viewGetServerCache(n){return n.viewCache_.serverCache.getNode()}function viewGetCompleteNode(n){return viewCacheGetCompleteEventSnap(n.viewCache_)}function viewGetCompleteServerCache(n,e){const o=viewCacheGetCompleteServerSnap(n.viewCache_);return o&&(n.query._queryParams.loadsAllData()||!pathIsEmpty(e)&&!o.getImmediateChild(pathGetFront(e)).isEmpty())?o.getChild(e):null}function viewIsEmpty(n){return n.eventRegistrations_.length===0}function viewAddEventRegistration(n,e){n.eventRegistrations_.push(e)}function viewRemoveEventRegistration(n,e,o){const s=[];if(o){assert(e==null,"A cancel should cancel all event registrations.");const c=n.query._path;n.eventRegistrations_.forEach(u=>{const d=u.createCancelEvent(o,c);d&&s.push(d)})}if(e){let c=[];for(let u=0;u<n.eventRegistrations_.length;++u){const d=n.eventRegistrations_[u];if(!d.matches(e))c.push(d);else if(e.hasAnyCallback()){c=c.concat(n.eventRegistrations_.slice(u+1));break}}n.eventRegistrations_=c}else n.eventRegistrations_=[];return s}function viewApplyOperation(n,e,o,s){e.type===OperationType.MERGE&&e.source.queryId!==null&&(assert(viewCacheGetCompleteServerSnap(n.viewCache_),"We should always have a full cache before handling merges"),assert(viewCacheGetCompleteEventSnap(n.viewCache_),"Missing event cache, even though we have a server cache"));const c=n.viewCache_,u=viewProcessorApplyOperation(n.processor_,c,e,o,s);return viewProcessorAssertIndexed(n.processor_,u.viewCache),assert(u.viewCache.serverCache.isFullyInitialized()||!c.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=u.viewCache,viewGenerateEventsForChanges_(n,u.changes,u.viewCache.eventCache.getNode(),null)}function viewGetInitialEvents(n,e){const o=n.viewCache_.eventCache,s=[];return o.getNode().isLeafNode()||o.getNode().forEachChild(PRIORITY_INDEX,(u,d)=>{s.push(changeChildAdded(u,d))}),o.isFullyInitialized()&&s.push(changeValue(o.getNode())),viewGenerateEventsForChanges_(n,s,o.getNode(),e)}function viewGenerateEventsForChanges_(n,e,o,s){const c=s?[s]:n.eventRegistrations_;return eventGeneratorGenerateEventsForChanges(n.eventGenerator_,e,o,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor$1;class SyncPoint{constructor(){this.views=new Map}}function syncPointSetReferenceConstructor(n){assert(!referenceConstructor$1,"__referenceConstructor has already been defined"),referenceConstructor$1=n}function syncPointGetReferenceConstructor(){return assert(referenceConstructor$1,"Reference.ts has not been loaded"),referenceConstructor$1}function syncPointIsEmpty(n){return n.views.size===0}function syncPointApplyOperation(n,e,o,s){const c=e.source.queryId;if(c!==null){const u=n.views.get(c);return assert(u!=null,"SyncTree gave us an op for an invalid query."),viewApplyOperation(u,e,o,s)}else{let u=[];for(const d of n.views.values())u=u.concat(viewApplyOperation(d,e,o,s));return u}}function syncPointGetView(n,e,o,s,c){const u=e._queryIdentifier,d=n.views.get(u);if(!d){let m=writeTreeRefCalcCompleteEventCache(o,c?s:null),_=!1;m?_=!0:s instanceof ChildrenNode?(m=writeTreeRefCalcCompleteEventChildren(o,s),_=!1):(m=ChildrenNode.EMPTY_NODE,_=!1);const ue=newViewCache(new CacheNode(m,_,!1),new CacheNode(s,c,!1));return new View(e,ue)}return d}function syncPointAddEventRegistration(n,e,o,s,c,u){const d=syncPointGetView(n,e,s,c,u);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,d),viewAddEventRegistration(d,o),viewGetInitialEvents(d,o)}function syncPointRemoveEventRegistration(n,e,o,s){const c=e._queryIdentifier,u=[];let d=[];const m=syncPointHasCompleteView(n);if(c==="default")for(const[_,ue]of n.views.entries())d=d.concat(viewRemoveEventRegistration(ue,o,s)),viewIsEmpty(ue)&&(n.views.delete(_),ue.query._queryParams.loadsAllData()||u.push(ue.query));else{const _=n.views.get(c);_&&(d=d.concat(viewRemoveEventRegistration(_,o,s)),viewIsEmpty(_)&&(n.views.delete(c),_.query._queryParams.loadsAllData()||u.push(_.query)))}return m&&!syncPointHasCompleteView(n)&&u.push(new(syncPointGetReferenceConstructor())(e._repo,e._path)),{removed:u,events:d}}function syncPointGetQueryViews(n){const e=[];for(const o of n.views.values())o.query._queryParams.loadsAllData()||e.push(o);return e}function syncPointGetCompleteServerCache(n,e){let o=null;for(const s of n.views.values())o=o||viewGetCompleteServerCache(s,e);return o}function syncPointViewForQuery(n,e){if(e._queryParams.loadsAllData())return syncPointGetCompleteView(n);{const s=e._queryIdentifier;return n.views.get(s)}}function syncPointViewExistsForQuery(n,e){return syncPointViewForQuery(n,e)!=null}function syncPointHasCompleteView(n){return syncPointGetCompleteView(n)!=null}function syncPointGetCompleteView(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor;function syncTreeSetReferenceConstructor(n){assert(!referenceConstructor,"__referenceConstructor has already been defined"),referenceConstructor=n}function syncTreeGetReferenceConstructor(){return assert(referenceConstructor,"Reference.ts has not been loaded"),referenceConstructor}let syncTreeNextQueryTag_=1;class SyncTree{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ImmutableTree(null),this.pendingWriteTree_=newWriteTree(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function syncTreeApplyUserOverwrite(n,e,o,s,c){return writeTreeAddOverwrite(n.pendingWriteTree_,e,o,s,c),c?syncTreeApplyOperationToSyncPoints_(n,new Overwrite(newOperationSourceUser(),e,o)):[]}function syncTreeApplyUserMerge(n,e,o,s){writeTreeAddMerge(n.pendingWriteTree_,e,o,s);const c=ImmutableTree.fromObject(o);return syncTreeApplyOperationToSyncPoints_(n,new Merge(newOperationSourceUser(),e,c))}function syncTreeAckUserWrite(n,e,o=!1){const s=writeTreeGetWrite(n.pendingWriteTree_,e);if(writeTreeRemoveWrite(n.pendingWriteTree_,e)){let u=new ImmutableTree(null);return s.snap!=null?u=u.set(newEmptyPath(),!0):each(s.children,d=>{u=u.set(new Path(d),!0)}),syncTreeApplyOperationToSyncPoints_(n,new AckUserWrite(s.path,u,o))}else return[]}function syncTreeApplyServerOverwrite(n,e,o){return syncTreeApplyOperationToSyncPoints_(n,new Overwrite(newOperationSourceServer(),e,o))}function syncTreeApplyServerMerge(n,e,o){const s=ImmutableTree.fromObject(o);return syncTreeApplyOperationToSyncPoints_(n,new Merge(newOperationSourceServer(),e,s))}function syncTreeApplyListenComplete(n,e){return syncTreeApplyOperationToSyncPoints_(n,new ListenComplete(newOperationSourceServer(),e))}function syncTreeApplyTaggedListenComplete(n,e,o){const s=syncTreeQueryKeyForTag_(n,o);if(s){const c=syncTreeParseQueryKey_(s),u=c.path,d=c.queryId,m=newRelativePath(u,e),_=new ListenComplete(newOperationSourceServerTaggedQuery(d),m);return syncTreeApplyTaggedOperation_(n,u,_)}else return[]}function syncTreeRemoveEventRegistration(n,e,o,s,c=!1){const u=e._path,d=n.syncPointTree_.get(u);let m=[];if(d&&(e._queryIdentifier==="default"||syncPointViewExistsForQuery(d,e))){const _=syncPointRemoveEventRegistration(d,e,o,s);syncPointIsEmpty(d)&&(n.syncPointTree_=n.syncPointTree_.remove(u));const ue=_.removed;if(m=_.events,!c){const gn=ue.findIndex(ih=>ih._queryParams.loadsAllData())!==-1,nh=n.syncPointTree_.findOnPath(u,(ih,rh)=>syncPointHasCompleteView(rh));if(gn&&!nh){const ih=n.syncPointTree_.subtree(u);if(!ih.isEmpty()){const rh=syncTreeCollectDistinctViewsForSubTree_(ih);for(let oh=0;oh<rh.length;++oh){const lh=rh[oh],ch=lh.query,dh=syncTreeCreateListenerForView_(n,lh);n.listenProvider_.startListening(syncTreeQueryForListening_(ch),syncTreeTagForQuery(n,ch),dh.hashFn,dh.onComplete)}}}!nh&&ue.length>0&&!s&&(gn?n.listenProvider_.stopListening(syncTreeQueryForListening_(e),null):ue.forEach(ih=>{const rh=n.queryToTagMap.get(syncTreeMakeQueryKey_(ih));n.listenProvider_.stopListening(syncTreeQueryForListening_(ih),rh)}))}syncTreeRemoveTags_(n,ue)}return m}function syncTreeApplyTaggedQueryOverwrite(n,e,o,s){const c=syncTreeQueryKeyForTag_(n,s);if(c!=null){const u=syncTreeParseQueryKey_(c),d=u.path,m=u.queryId,_=newRelativePath(d,e),ue=new Overwrite(newOperationSourceServerTaggedQuery(m),_,o);return syncTreeApplyTaggedOperation_(n,d,ue)}else return[]}function syncTreeApplyTaggedQueryMerge(n,e,o,s){const c=syncTreeQueryKeyForTag_(n,s);if(c){const u=syncTreeParseQueryKey_(c),d=u.path,m=u.queryId,_=newRelativePath(d,e),ue=ImmutableTree.fromObject(o),gn=new Merge(newOperationSourceServerTaggedQuery(m),_,ue);return syncTreeApplyTaggedOperation_(n,d,gn)}else return[]}function syncTreeAddEventRegistration(n,e,o,s=!1){const c=e._path;let u=null,d=!1;n.syncPointTree_.foreachOnPath(c,(ih,rh)=>{const oh=newRelativePath(ih,c);u=u||syncPointGetCompleteServerCache(rh,oh),d=d||syncPointHasCompleteView(rh)});let m=n.syncPointTree_.get(c);m?(d=d||syncPointHasCompleteView(m),u=u||syncPointGetCompleteServerCache(m,newEmptyPath())):(m=new SyncPoint,n.syncPointTree_=n.syncPointTree_.set(c,m));let _;u!=null?_=!0:(_=!1,u=ChildrenNode.EMPTY_NODE,n.syncPointTree_.subtree(c).foreachChild((rh,oh)=>{const lh=syncPointGetCompleteServerCache(oh,newEmptyPath());lh&&(u=u.updateImmediateChild(rh,lh))}));const ue=syncPointViewExistsForQuery(m,e);if(!ue&&!e._queryParams.loadsAllData()){const ih=syncTreeMakeQueryKey_(e);assert(!n.queryToTagMap.has(ih),"View does not exist, but we have a tag");const rh=syncTreeGetNextQueryTag_();n.queryToTagMap.set(ih,rh),n.tagToQueryMap.set(rh,ih)}const gn=writeTreeChildWrites(n.pendingWriteTree_,c);let nh=syncPointAddEventRegistration(m,e,o,gn,u,_);if(!ue&&!d&&!s){const ih=syncPointViewForQuery(m,e);nh=nh.concat(syncTreeSetupListener_(n,e,ih))}return nh}function syncTreeCalcCompleteEventCache(n,e,o){const c=n.pendingWriteTree_,u=n.syncPointTree_.findOnPath(e,(d,m)=>{const _=newRelativePath(d,e),ue=syncPointGetCompleteServerCache(m,_);if(ue)return ue});return writeTreeCalcCompleteEventCache(c,e,u,o,!0)}function syncTreeGetServerValue(n,e){const o=e._path;let s=null;n.syncPointTree_.foreachOnPath(o,(ue,gn)=>{const nh=newRelativePath(ue,o);s=s||syncPointGetCompleteServerCache(gn,nh)});let c=n.syncPointTree_.get(o);c?s=s||syncPointGetCompleteServerCache(c,newEmptyPath()):(c=new SyncPoint,n.syncPointTree_=n.syncPointTree_.set(o,c));const u=s!=null,d=u?new CacheNode(s,!0,!1):null,m=writeTreeChildWrites(n.pendingWriteTree_,e._path),_=syncPointGetView(c,e,m,u?d.getNode():ChildrenNode.EMPTY_NODE,u);return viewGetCompleteNode(_)}function syncTreeApplyOperationToSyncPoints_(n,e){return syncTreeApplyOperationHelper_(e,n.syncPointTree_,null,writeTreeChildWrites(n.pendingWriteTree_,newEmptyPath()))}function syncTreeApplyOperationHelper_(n,e,o,s){if(pathIsEmpty(n.path))return syncTreeApplyOperationDescendantsHelper_(n,e,o,s);{const c=e.get(newEmptyPath());o==null&&c!=null&&(o=syncPointGetCompleteServerCache(c,newEmptyPath()));let u=[];const d=pathGetFront(n.path),m=n.operationForChild(d),_=e.children.get(d);if(_&&m){const ue=o?o.getImmediateChild(d):null,gn=writeTreeRefChild(s,d);u=u.concat(syncTreeApplyOperationHelper_(m,_,ue,gn))}return c&&(u=u.concat(syncPointApplyOperation(c,n,s,o))),u}}function syncTreeApplyOperationDescendantsHelper_(n,e,o,s){const c=e.get(newEmptyPath());o==null&&c!=null&&(o=syncPointGetCompleteServerCache(c,newEmptyPath()));let u=[];return e.children.inorderTraversal((d,m)=>{const _=o?o.getImmediateChild(d):null,ue=writeTreeRefChild(s,d),gn=n.operationForChild(d);gn&&(u=u.concat(syncTreeApplyOperationDescendantsHelper_(gn,m,_,ue)))}),c&&(u=u.concat(syncPointApplyOperation(c,n,s,o))),u}function syncTreeCreateListenerForView_(n,e){const o=e.query,s=syncTreeTagForQuery(n,o);return{hashFn:()=>(viewGetServerCache(e)||ChildrenNode.EMPTY_NODE).hash(),onComplete:c=>{if(c==="ok")return s?syncTreeApplyTaggedListenComplete(n,o._path,s):syncTreeApplyListenComplete(n,o._path);{const u=errorForServerCode(c,o);return syncTreeRemoveEventRegistration(n,o,null,u)}}}}function syncTreeTagForQuery(n,e){const o=syncTreeMakeQueryKey_(e);return n.queryToTagMap.get(o)}function syncTreeMakeQueryKey_(n){return n._path.toString()+"$"+n._queryIdentifier}function syncTreeQueryKeyForTag_(n,e){return n.tagToQueryMap.get(e)}function syncTreeParseQueryKey_(n){const e=n.indexOf("$");return assert(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Path(n.substr(0,e))}}function syncTreeApplyTaggedOperation_(n,e,o){const s=n.syncPointTree_.get(e);assert(s,"Missing sync point for query tag that we're tracking");const c=writeTreeChildWrites(n.pendingWriteTree_,e);return syncPointApplyOperation(s,o,c,null)}function syncTreeCollectDistinctViewsForSubTree_(n){return n.fold((e,o,s)=>{if(o&&syncPointHasCompleteView(o))return[syncPointGetCompleteView(o)];{let c=[];return o&&(c=syncPointGetQueryViews(o)),each(s,(u,d)=>{c=c.concat(d)}),c}})}function syncTreeQueryForListening_(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(syncTreeGetReferenceConstructor())(n._repo,n._path):n}function syncTreeRemoveTags_(n,e){for(let o=0;o<e.length;++o){const s=e[o];if(!s._queryParams.loadsAllData()){const c=syncTreeMakeQueryKey_(s),u=n.queryToTagMap.get(c);n.queryToTagMap.delete(c),n.tagToQueryMap.delete(u)}}}function syncTreeGetNextQueryTag_(){return syncTreeNextQueryTag_++}function syncTreeSetupListener_(n,e,o){const s=e._path,c=syncTreeTagForQuery(n,e),u=syncTreeCreateListenerForView_(n,o),d=n.listenProvider_.startListening(syncTreeQueryForListening_(e),c,u.hashFn,u.onComplete),m=n.syncPointTree_.subtree(s);if(c)assert(!syncPointHasCompleteView(m.value),"If we're adding a query, it shouldn't be shadowed");else{const _=m.fold((ue,gn,nh)=>{if(!pathIsEmpty(ue)&&gn&&syncPointHasCompleteView(gn))return[syncPointGetCompleteView(gn).query];{let ih=[];return gn&&(ih=ih.concat(syncPointGetQueryViews(gn).map(rh=>rh.query))),each(nh,(rh,oh)=>{ih=ih.concat(oh)}),ih}});for(let ue=0;ue<_.length;++ue){const gn=_[ue];n.listenProvider_.stopListening(syncTreeQueryForListening_(gn),syncTreeTagForQuery(n,gn))}}return d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ExistingValueProvider{constructor(e){this.node_=e}getImmediateChild(e){const o=this.node_.getImmediateChild(e);return new ExistingValueProvider(o)}node(){return this.node_}}class DeferredValueProvider{constructor(e,o){this.syncTree_=e,this.path_=o}getImmediateChild(e){const o=pathChild(this.path_,e);return new DeferredValueProvider(this.syncTree_,o)}node(){return syncTreeCalcCompleteEventCache(this.syncTree_,this.path_)}}const generateWithValues=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},resolveDeferredLeafValue=function(n,e,o){if(!n||typeof n!="object")return n;if(assert(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return resolveScalarDeferredValue(n[".sv"],e,o);if(typeof n[".sv"]=="object")return resolveComplexDeferredValue(n[".sv"],e);assert(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},resolveScalarDeferredValue=function(n,e,o){switch(n){case"timestamp":return o.timestamp;default:assert(!1,"Unexpected server value: "+n)}},resolveComplexDeferredValue=function(n,e,o){n.hasOwnProperty("increment")||assert(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&assert(!1,"Unexpected increment value: "+s);const c=e.node();if(assert(c!==null&&typeof c<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!c.isLeafNode())return s;const d=c.getValue();return typeof d!="number"?s:d+s},resolveDeferredValueTree=function(n,e,o,s){return resolveDeferredValue(e,new DeferredValueProvider(o,n),s)},resolveDeferredValueSnapshot=function(n,e,o){return resolveDeferredValue(n,new ExistingValueProvider(e),o)};function resolveDeferredValue(n,e,o){const s=n.getPriority().val(),c=resolveDeferredLeafValue(s,e.getImmediateChild(".priority"),o);let u;if(n.isLeafNode()){const d=n,m=resolveDeferredLeafValue(d.getValue(),e,o);return m!==d.getValue()||c!==d.getPriority().val()?new LeafNode(m,nodeFromJSON(c)):n}else{const d=n;return u=d,c!==d.getPriority().val()&&(u=u.updatePriority(new LeafNode(c))),d.forEachChild(PRIORITY_INDEX,(m,_)=>{const ue=resolveDeferredValue(_,e.getImmediateChild(m),o);ue!==_&&(u=u.updateImmediateChild(m,ue))}),u}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tree{constructor(e="",o=null,s={children:{},childCount:0}){this.name=e,this.parent=o,this.node=s}}function treeSubTree(n,e){let o=e instanceof Path?e:new Path(e),s=n,c=pathGetFront(o);for(;c!==null;){const u=safeGet(s.node.children,c)||{children:{},childCount:0};s=new Tree(c,s,u),o=pathPopFront(o),c=pathGetFront(o)}return s}function treeGetValue(n){return n.node.value}function treeSetValue(n,e){n.node.value=e,treeUpdateParents(n)}function treeHasChildren(n){return n.node.childCount>0}function treeIsEmpty(n){return treeGetValue(n)===void 0&&!treeHasChildren(n)}function treeForEachChild(n,e){each(n.node.children,(o,s)=>{e(new Tree(o,n,s))})}function treeForEachDescendant(n,e,o,s){o&&!s&&e(n),treeForEachChild(n,c=>{treeForEachDescendant(c,e,!0,s)}),o&&s&&e(n)}function treeForEachAncestor(n,e,o){let s=o?n:n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function treeGetPath(n){return new Path(n.parent===null?n.name:treeGetPath(n.parent)+"/"+n.name)}function treeUpdateParents(n){n.parent!==null&&treeUpdateChild(n.parent,n.name,n)}function treeUpdateChild(n,e,o){const s=treeIsEmpty(o),c=contains(n.node.children,e);s&&c?(delete n.node.children[e],n.node.childCount--,treeUpdateParents(n)):!s&&!c&&(n.node.children[e]=o.node,n.node.childCount++,treeUpdateParents(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INVALID_KEY_REGEX_=/[\[\].#$\/\u0000-\u001F\u007F]/,INVALID_PATH_REGEX_=/[\[\].#$\u0000-\u001F\u007F]/,MAX_LEAF_SIZE_=10*1024*1024,isValidKey=function(n){return typeof n=="string"&&n.length!==0&&!INVALID_KEY_REGEX_.test(n)},isValidPathString=function(n){return typeof n=="string"&&n.length!==0&&!INVALID_PATH_REGEX_.test(n)},isValidRootPathString=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),isValidPathString(n)},isValidPriority=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!isInvalidJSONNumber(n)||n&&typeof n=="object"&&contains(n,".sv")},validateFirebaseDataArg=function(n,e,o,s){s&&e===void 0||validateFirebaseData(errorPrefix(n,"value"),e,o)},validateFirebaseData=function(n,e,o){const s=o instanceof Path?new ValidationPath(o,n):o;if(e===void 0)throw new Error(n+"contains undefined "+validationPathToErrorString(s));if(typeof e=="function")throw new Error(n+"contains a function "+validationPathToErrorString(s)+" with contents = "+e.toString());if(isInvalidJSONNumber(e))throw new Error(n+"contains "+e.toString()+" "+validationPathToErrorString(s));if(typeof e=="string"&&e.length>MAX_LEAF_SIZE_/3&&stringLength(e)>MAX_LEAF_SIZE_)throw new Error(n+"contains a string greater than "+MAX_LEAF_SIZE_+" utf8 bytes "+validationPathToErrorString(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let c=!1,u=!1;if(each(e,(d,m)=>{if(d===".value")c=!0;else if(d!==".priority"&&d!==".sv"&&(u=!0,!isValidKey(d)))throw new Error(n+" contains an invalid key ("+d+") "+validationPathToErrorString(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);validationPathPush(s,d),validateFirebaseData(n,m,s),validationPathPop(s)}),c&&u)throw new Error(n+' contains ".value" child '+validationPathToErrorString(s)+" in addition to actual children.")}},validateFirebaseMergePaths=function(n,e){let o,s;for(o=0;o<e.length;o++){s=e[o];const u=pathSlice(s);for(let d=0;d<u.length;d++)if(!(u[d]===".priority"&&d===u.length-1)){if(!isValidKey(u[d]))throw new Error(n+"contains an invalid key ("+u[d]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(pathCompare);let c=null;for(o=0;o<e.length;o++){if(s=e[o],c!==null&&pathContains(c,s))throw new Error(n+"contains a path "+c.toString()+" that is ancestor of another path "+s.toString());c=s}},validateFirebaseMergeDataArg=function(n,e,o,s){if(s&&e===void 0)return;const c=errorPrefix(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(c+" must be an object containing the children to replace.");const u=[];each(e,(d,m)=>{const _=new Path(d);if(validateFirebaseData(c,m,pathChild(o,_)),pathGetBack(_)===".priority"&&!isValidPriority(m))throw new Error(c+"contains an invalid value for '"+_.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");u.push(_)}),validateFirebaseMergePaths(c,u)},validatePathString=function(n,e,o,s){if(!(s&&o===void 0)&&!isValidPathString(o))throw new Error(errorPrefix(n,e)+'was an invalid path = "'+o+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},validateRootPathString=function(n,e,o,s){o&&(o=o.replace(/^\/*\.info(\/|$)/,"/")),validatePathString(n,e,o,s)},validateWritablePath=function(n,e){if(pathGetFront(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},validateUrl=function(n,e){const o=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!isValidKey(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||o.length!==0&&!isValidRootPathString(o))throw new Error(errorPrefix(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventQueue{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function eventQueueQueueEvents(n,e){let o=null;for(let s=0;s<e.length;s++){const c=e[s],u=c.getPath();o!==null&&!pathEquals(u,o.path)&&(n.eventLists_.push(o),o=null),o===null&&(o={events:[],path:u}),o.events.push(c)}o&&n.eventLists_.push(o)}function eventQueueRaiseEventsAtPath(n,e,o){eventQueueQueueEvents(n,o),eventQueueRaiseQueuedEventsMatchingPredicate(n,s=>pathEquals(s,e))}function eventQueueRaiseEventsForChangedPath(n,e,o){eventQueueQueueEvents(n,o),eventQueueRaiseQueuedEventsMatchingPredicate(n,s=>pathContains(s,e)||pathContains(e,s))}function eventQueueRaiseQueuedEventsMatchingPredicate(n,e){n.recursionDepth_++;let o=!0;for(let s=0;s<n.eventLists_.length;s++){const c=n.eventLists_[s];if(c){const u=c.path;e(u)?(eventListRaise(n.eventLists_[s]),n.eventLists_[s]=null):o=!1}}o&&(n.eventLists_=[]),n.recursionDepth_--}function eventListRaise(n){for(let e=0;e<n.events.length;e++){const o=n.events[e];if(o!==null){n.events[e]=null;const s=o.getEventRunner();logger$1&&log("event: "+o.toString()),exceptionGuard(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INTERRUPT_REASON="repo_interrupt",MAX_TRANSACTION_RETRIES=25;class Repo{constructor(e,o,s,c){this.repoInfo_=e,this.forceRestClient_=o,this.authTokenProvider_=s,this.appCheckProvider_=c,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new EventQueue,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=newSparseSnapshotTree(),this.transactionQueueTree_=new Tree,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function repoStart(n,e,o){if(n.stats_=statsManagerGetCollection(n.repoInfo_),n.forceRestClient_||beingCrawled())n.server_=new ReadonlyRestClient(n.repoInfo_,(s,c,u,d)=>{repoOnDataUpdate(n,s,c,u,d)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>repoOnConnectStatus(n,!0),0);else{if(typeof o<"u"&&o!==null){if(typeof o!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{stringify(o)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new PersistentConnection(n.repoInfo_,e,(s,c,u,d)=>{repoOnDataUpdate(n,s,c,u,d)},s=>{repoOnConnectStatus(n,s)},s=>{repoOnServerInfoUpdate(n,s)},n.authTokenProvider_,n.appCheckProvider_,o),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=statsManagerGetOrCreateReporter(n.repoInfo_,()=>new StatsReporter(n.stats_,n.server_)),n.infoData_=new SnapshotHolder,n.infoSyncTree_=new SyncTree({startListening:(s,c,u,d)=>{let m=[];const _=n.infoData_.getNode(s._path);return _.isEmpty()||(m=syncTreeApplyServerOverwrite(n.infoSyncTree_,s._path,_),setTimeout(()=>{d("ok")},0)),m},stopListening:()=>{}}),repoUpdateInfo(n,"connected",!1),n.serverSyncTree_=new SyncTree({startListening:(s,c,u,d)=>(n.server_.listen(s,u,c,(m,_)=>{const ue=d(m,_);eventQueueRaiseEventsForChangedPath(n.eventQueue_,s._path,ue)}),[]),stopListening:(s,c)=>{n.server_.unlisten(s,c)}})}function repoServerTime(n){const o=n.infoData_.getNode(new Path(".info/serverTimeOffset")).val()||0;return new Date().getTime()+o}function repoGenerateServerValues(n){return generateWithValues({timestamp:repoServerTime(n)})}function repoOnDataUpdate(n,e,o,s,c){n.dataUpdateCount++;const u=new Path(e);o=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,o):o;let d=[];if(c)if(s){const _=map(o,ue=>nodeFromJSON(ue));d=syncTreeApplyTaggedQueryMerge(n.serverSyncTree_,u,_,c)}else{const _=nodeFromJSON(o);d=syncTreeApplyTaggedQueryOverwrite(n.serverSyncTree_,u,_,c)}else if(s){const _=map(o,ue=>nodeFromJSON(ue));d=syncTreeApplyServerMerge(n.serverSyncTree_,u,_)}else{const _=nodeFromJSON(o);d=syncTreeApplyServerOverwrite(n.serverSyncTree_,u,_)}let m=u;d.length>0&&(m=repoRerunTransactions(n,u)),eventQueueRaiseEventsForChangedPath(n.eventQueue_,m,d)}function repoOnConnectStatus(n,e){repoUpdateInfo(n,"connected",e),e===!1&&repoRunOnDisconnectEvents(n)}function repoOnServerInfoUpdate(n,e){each(e,(o,s)=>{repoUpdateInfo(n,o,s)})}function repoUpdateInfo(n,e,o){const s=new Path("/.info/"+e),c=nodeFromJSON(o);n.infoData_.updateSnapshot(s,c);const u=syncTreeApplyServerOverwrite(n.infoSyncTree_,s,c);eventQueueRaiseEventsForChangedPath(n.eventQueue_,s,u)}function repoGetNextWriteId(n){return n.nextWriteId_++}function repoGetValue(n,e,o){const s=syncTreeGetServerValue(n.serverSyncTree_,e);return s!=null?Promise.resolve(s):n.server_.get(e).then(c=>{const u=nodeFromJSON(c).withIndex(e._queryParams.getIndex());syncTreeAddEventRegistration(n.serverSyncTree_,e,o,!0);let d;if(e._queryParams.loadsAllData())d=syncTreeApplyServerOverwrite(n.serverSyncTree_,e._path,u);else{const m=syncTreeTagForQuery(n.serverSyncTree_,e);d=syncTreeApplyTaggedQueryOverwrite(n.serverSyncTree_,e._path,u,m)}return eventQueueRaiseEventsForChangedPath(n.eventQueue_,e._path,d),syncTreeRemoveEventRegistration(n.serverSyncTree_,e,o,null,!0),u},c=>(repoLog(n,"get for query "+stringify(e)+" failed: "+c),Promise.reject(new Error(c))))}function repoSetWithPriority(n,e,o,s,c){repoLog(n,"set",{path:e.toString(),value:o,priority:s});const u=repoGenerateServerValues(n),d=nodeFromJSON(o,s),m=syncTreeCalcCompleteEventCache(n.serverSyncTree_,e),_=resolveDeferredValueSnapshot(d,m,u),ue=repoGetNextWriteId(n),gn=syncTreeApplyUserOverwrite(n.serverSyncTree_,e,_,ue,!0);eventQueueQueueEvents(n.eventQueue_,gn),n.server_.put(e.toString(),d.val(!0),(ih,rh)=>{const oh=ih==="ok";oh||warn("set at "+e+" failed: "+ih);const lh=syncTreeAckUserWrite(n.serverSyncTree_,ue,!oh);eventQueueRaiseEventsForChangedPath(n.eventQueue_,e,lh),repoCallOnCompleteCallback(n,c,ih,rh)});const nh=repoAbortTransactions(n,e);repoRerunTransactions(n,nh),eventQueueRaiseEventsForChangedPath(n.eventQueue_,nh,[])}function repoUpdate(n,e,o,s){repoLog(n,"update",{path:e.toString(),value:o});let c=!0;const u=repoGenerateServerValues(n),d={};if(each(o,(m,_)=>{c=!1,d[m]=resolveDeferredValueTree(pathChild(e,m),nodeFromJSON(_),n.serverSyncTree_,u)}),c)log("update() called with empty data.  Don't do anything."),repoCallOnCompleteCallback(n,s,"ok",void 0);else{const m=repoGetNextWriteId(n),_=syncTreeApplyUserMerge(n.serverSyncTree_,e,d,m);eventQueueQueueEvents(n.eventQueue_,_),n.server_.merge(e.toString(),o,(ue,gn)=>{const nh=ue==="ok";nh||warn("update at "+e+" failed: "+ue);const ih=syncTreeAckUserWrite(n.serverSyncTree_,m,!nh),rh=ih.length>0?repoRerunTransactions(n,e):e;eventQueueRaiseEventsForChangedPath(n.eventQueue_,rh,ih),repoCallOnCompleteCallback(n,s,ue,gn)}),each(o,ue=>{const gn=repoAbortTransactions(n,pathChild(e,ue));repoRerunTransactions(n,gn)}),eventQueueRaiseEventsForChangedPath(n.eventQueue_,e,[])}}function repoRunOnDisconnectEvents(n){repoLog(n,"onDisconnectEvents");const e=repoGenerateServerValues(n),o=newSparseSnapshotTree();sparseSnapshotTreeForEachTree(n.onDisconnect_,newEmptyPath(),(c,u)=>{const d=resolveDeferredValueTree(c,u,n.serverSyncTree_,e);sparseSnapshotTreeRemember(o,c,d)});let s=[];sparseSnapshotTreeForEachTree(o,newEmptyPath(),(c,u)=>{s=s.concat(syncTreeApplyServerOverwrite(n.serverSyncTree_,c,u));const d=repoAbortTransactions(n,c);repoRerunTransactions(n,d)}),n.onDisconnect_=newSparseSnapshotTree(),eventQueueRaiseEventsForChangedPath(n.eventQueue_,newEmptyPath(),s)}function repoAddEventCallbackForQuery(n,e,o){let s;pathGetFront(e._path)===".info"?s=syncTreeAddEventRegistration(n.infoSyncTree_,e,o):s=syncTreeAddEventRegistration(n.serverSyncTree_,e,o),eventQueueRaiseEventsAtPath(n.eventQueue_,e._path,s)}function repoRemoveEventCallbackForQuery(n,e,o){let s;pathGetFront(e._path)===".info"?s=syncTreeRemoveEventRegistration(n.infoSyncTree_,e,o):s=syncTreeRemoveEventRegistration(n.serverSyncTree_,e,o),eventQueueRaiseEventsAtPath(n.eventQueue_,e._path,s)}function repoInterrupt(n){n.persistentConnection_&&n.persistentConnection_.interrupt(INTERRUPT_REASON)}function repoLog(n,...e){let o="";n.persistentConnection_&&(o=n.persistentConnection_.id+":"),log(o,...e)}function repoCallOnCompleteCallback(n,e,o,s){e&&exceptionGuard(()=>{if(o==="ok")e(null);else{const c=(o||"error").toUpperCase();let u=c;s&&(u+=": "+s);const d=new Error(u);d.code=c,e(d)}})}function repoGetLatestState(n,e,o){return syncTreeCalcCompleteEventCache(n.serverSyncTree_,e,o)||ChildrenNode.EMPTY_NODE}function repoSendReadyTransactions(n,e=n.transactionQueueTree_){if(e||repoPruneCompletedTransactionsBelowNode(n,e),treeGetValue(e)){const o=repoBuildTransactionQueue(n,e);assert(o.length>0,"Sending zero length transaction queue"),o.every(c=>c.status===0)&&repoSendTransactionQueue(n,treeGetPath(e),o)}else treeHasChildren(e)&&treeForEachChild(e,o=>{repoSendReadyTransactions(n,o)})}function repoSendTransactionQueue(n,e,o){const s=o.map(ue=>ue.currentWriteId),c=repoGetLatestState(n,e,s);let u=c;const d=c.hash();for(let ue=0;ue<o.length;ue++){const gn=o[ue];assert(gn.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),gn.status=1,gn.retryCount++;const nh=newRelativePath(e,gn.path);u=u.updateChild(nh,gn.currentOutputSnapshotRaw)}const m=u.val(!0),_=e;n.server_.put(_.toString(),m,ue=>{repoLog(n,"transaction put response",{path:_.toString(),status:ue});let gn=[];if(ue==="ok"){const nh=[];for(let ih=0;ih<o.length;ih++)o[ih].status=2,gn=gn.concat(syncTreeAckUserWrite(n.serverSyncTree_,o[ih].currentWriteId)),o[ih].onComplete&&nh.push(()=>o[ih].onComplete(null,!0,o[ih].currentOutputSnapshotResolved)),o[ih].unwatcher();repoPruneCompletedTransactionsBelowNode(n,treeSubTree(n.transactionQueueTree_,e)),repoSendReadyTransactions(n,n.transactionQueueTree_),eventQueueRaiseEventsForChangedPath(n.eventQueue_,e,gn);for(let ih=0;ih<nh.length;ih++)exceptionGuard(nh[ih])}else{if(ue==="datastale")for(let nh=0;nh<o.length;nh++)o[nh].status===3?o[nh].status=4:o[nh].status=0;else{warn("transaction at "+_.toString()+" failed: "+ue);for(let nh=0;nh<o.length;nh++)o[nh].status=4,o[nh].abortReason=ue}repoRerunTransactions(n,e)}},d)}function repoRerunTransactions(n,e){const o=repoGetAncestorTransactionNode(n,e),s=treeGetPath(o),c=repoBuildTransactionQueue(n,o);return repoRerunTransactionQueue(n,c,s),s}function repoRerunTransactionQueue(n,e,o){if(e.length===0)return;const s=[];let c=[];const d=e.filter(m=>m.status===0).map(m=>m.currentWriteId);for(let m=0;m<e.length;m++){const _=e[m],ue=newRelativePath(o,_.path);let gn=!1,nh;if(assert(ue!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),_.status===4)gn=!0,nh=_.abortReason,c=c.concat(syncTreeAckUserWrite(n.serverSyncTree_,_.currentWriteId,!0));else if(_.status===0)if(_.retryCount>=MAX_TRANSACTION_RETRIES)gn=!0,nh="maxretry",c=c.concat(syncTreeAckUserWrite(n.serverSyncTree_,_.currentWriteId,!0));else{const ih=repoGetLatestState(n,_.path,d);_.currentInputSnapshot=ih;const rh=e[m].update(ih.val());if(rh!==void 0){validateFirebaseData("transaction failed: Data returned ",rh,_.path);let oh=nodeFromJSON(rh);typeof rh=="object"&&rh!=null&&contains(rh,".priority")||(oh=oh.updatePriority(ih.getPriority()));const ch=_.currentWriteId,dh=repoGenerateServerValues(n),_h=resolveDeferredValueSnapshot(oh,ih,dh);_.currentOutputSnapshotRaw=oh,_.currentOutputSnapshotResolved=_h,_.currentWriteId=repoGetNextWriteId(n),d.splice(d.indexOf(ch),1),c=c.concat(syncTreeApplyUserOverwrite(n.serverSyncTree_,_.path,_h,_.currentWriteId,_.applyLocally)),c=c.concat(syncTreeAckUserWrite(n.serverSyncTree_,ch,!0))}else gn=!0,nh="nodata",c=c.concat(syncTreeAckUserWrite(n.serverSyncTree_,_.currentWriteId,!0))}eventQueueRaiseEventsForChangedPath(n.eventQueue_,o,c),c=[],gn&&(e[m].status=2,function(ih){setTimeout(ih,Math.floor(0))}(e[m].unwatcher),e[m].onComplete&&(nh==="nodata"?s.push(()=>e[m].onComplete(null,!1,e[m].currentInputSnapshot)):s.push(()=>e[m].onComplete(new Error(nh),!1,null))))}repoPruneCompletedTransactionsBelowNode(n,n.transactionQueueTree_);for(let m=0;m<s.length;m++)exceptionGuard(s[m]);repoSendReadyTransactions(n,n.transactionQueueTree_)}function repoGetAncestorTransactionNode(n,e){let o,s=n.transactionQueueTree_;for(o=pathGetFront(e);o!==null&&treeGetValue(s)===void 0;)s=treeSubTree(s,o),e=pathPopFront(e),o=pathGetFront(e);return s}function repoBuildTransactionQueue(n,e){const o=[];return repoAggregateTransactionQueuesForNode(n,e,o),o.sort((s,c)=>s.order-c.order),o}function repoAggregateTransactionQueuesForNode(n,e,o){const s=treeGetValue(e);if(s)for(let c=0;c<s.length;c++)o.push(s[c]);treeForEachChild(e,c=>{repoAggregateTransactionQueuesForNode(n,c,o)})}function repoPruneCompletedTransactionsBelowNode(n,e){const o=treeGetValue(e);if(o){let s=0;for(let c=0;c<o.length;c++)o[c].status!==2&&(o[s]=o[c],s++);o.length=s,treeSetValue(e,o.length>0?o:void 0)}treeForEachChild(e,s=>{repoPruneCompletedTransactionsBelowNode(n,s)})}function repoAbortTransactions(n,e){const o=treeGetPath(repoGetAncestorTransactionNode(n,e)),s=treeSubTree(n.transactionQueueTree_,e);return treeForEachAncestor(s,c=>{repoAbortTransactionsOnNode(n,c)}),repoAbortTransactionsOnNode(n,s),treeForEachDescendant(s,c=>{repoAbortTransactionsOnNode(n,c)}),o}function repoAbortTransactionsOnNode(n,e){const o=treeGetValue(e);if(o){const s=[];let c=[],u=-1;for(let d=0;d<o.length;d++)o[d].status===3||(o[d].status===1?(assert(u===d-1,"All SENT items should be at beginning of queue."),u=d,o[d].status=3,o[d].abortReason="set"):(assert(o[d].status===0,"Unexpected transaction status in abort"),o[d].unwatcher(),c=c.concat(syncTreeAckUserWrite(n.serverSyncTree_,o[d].currentWriteId,!0)),o[d].onComplete&&s.push(o[d].onComplete.bind(null,new Error("set"),!1,null))));u===-1?treeSetValue(e,void 0):o.length=u+1,eventQueueRaiseEventsForChangedPath(n.eventQueue_,treeGetPath(e),c);for(let d=0;d<s.length;d++)exceptionGuard(s[d])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function decodePath(n){let e="";const o=n.split("/");for(let s=0;s<o.length;s++)if(o[s].length>0){let c=o[s];try{c=decodeURIComponent(c.replace(/\+/g," "))}catch{}e+="/"+c}return e}function decodeQuery(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const o of n.split("&")){if(o.length===0)continue;const s=o.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):warn(`Invalid query segment '${o}' in query '${n}'`)}return e}const parseRepoInfo=function(n,e){const o=parseDatabaseURL(n),s=o.namespace;o.domain==="firebase.com"&&fatal(o.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&o.domain!=="localhost"&&fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),o.secure||warnIfPageIsSecure();const c=o.scheme==="ws"||o.scheme==="wss";return{repoInfo:new RepoInfo(o.host,o.secure,s,c,e,"",s!==o.subdomain),path:new Path(o.pathString)}},parseDatabaseURL=function(n){let e="",o="",s="",c="",u="",d=!0,m="https",_=443;if(typeof n=="string"){let ue=n.indexOf("//");ue>=0&&(m=n.substring(0,ue-1),n=n.substring(ue+2));let gn=n.indexOf("/");gn===-1&&(gn=n.length);let nh=n.indexOf("?");nh===-1&&(nh=n.length),e=n.substring(0,Math.min(gn,nh)),gn<nh&&(c=decodePath(n.substring(gn,nh)));const ih=decodeQuery(n.substring(Math.min(n.length,nh)));ue=e.indexOf(":"),ue>=0?(d=m==="https"||m==="wss",_=parseInt(e.substring(ue+1),10)):ue=e.length;const rh=e.slice(0,ue);if(rh.toLowerCase()==="localhost")o="localhost";else if(rh.split(".").length<=2)o=rh;else{const oh=e.indexOf(".");s=e.substring(0,oh).toLowerCase(),o=e.substring(oh+1),u=s}"ns"in ih&&(u=ih.ns)}return{host:e,port:_,domain:o,subdomain:s,secure:d,scheme:m,pathString:c,namespace:u}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DataEvent{constructor(e,o,s,c){this.eventType=e,this.eventRegistration=o,this.snapshot=s,this.prevName=c}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+stringify(this.snapshot.exportVal())}}class CancelEvent{constructor(e,o,s){this.eventRegistration=e,this.error=o,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CallbackContext{constructor(e,o){this.snapshotCallback=e,this.cancelCallback=o}onValue(e,o){this.snapshotCallback.call(null,e,o)}onCancel(e){return assert(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryImpl{constructor(e,o,s,c){this._repo=e,this._path=o,this._queryParams=s,this._orderByCalled=c}get key(){return pathIsEmpty(this._path)?null:pathGetBack(this._path)}get ref(){return new ReferenceImpl(this._repo,this._path)}get _queryIdentifier(){const e=queryParamsGetQueryObject(this._queryParams),o=ObjectToUniqueKey(e);return o==="{}"?"default":o}get _queryObject(){return queryParamsGetQueryObject(this._queryParams)}isEqual(e){if(e=getModularInstance(e),!(e instanceof QueryImpl))return!1;const o=this._repo===e._repo,s=pathEquals(this._path,e._path),c=this._queryIdentifier===e._queryIdentifier;return o&&s&&c}toJSON(){return this.toString()}toString(){return this._repo.toString()+pathToUrlEncodedString(this._path)}}class ReferenceImpl extends QueryImpl{constructor(e,o){super(e,o,new QueryParams,!1)}get parent(){const e=pathParent(this._path);return e===null?null:new ReferenceImpl(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class DataSnapshot{constructor(e,o,s){this._node=e,this.ref=o,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const o=new Path(e),s=child(this.ref,e);return new DataSnapshot(this._node.getChild(o),s,PRIORITY_INDEX)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,c)=>e(new DataSnapshot(c,child(this.ref,s),PRIORITY_INDEX)))}hasChild(e){const o=new Path(e);return!this._node.getChild(o).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ref(n,e){return n=getModularInstance(n),n._checkNotDeleted("ref"),e!==void 0?child(n._root,e):n._root}function child(n,e){return n=getModularInstance(n),pathGetFront(n._path)===null?validateRootPathString("child","path",e,!1):validatePathString("child","path",e,!1),new ReferenceImpl(n._repo,pathChild(n._path,e))}function remove(n){return validateWritablePath("remove",n._path),set(n,null)}function set(n,e){n=getModularInstance(n),validateWritablePath("set",n._path),validateFirebaseDataArg("set",e,n._path,!1);const o=new Deferred;return repoSetWithPriority(n._repo,n._path,e,null,o.wrapCallback(()=>{})),o.promise}function update(n,e){validateFirebaseMergeDataArg("update",e,n._path,!1);const o=new Deferred;return repoUpdate(n._repo,n._path,e,o.wrapCallback(()=>{})),o.promise}function get(n){n=getModularInstance(n);const e=new CallbackContext(()=>{}),o=new ValueEventRegistration(e);return repoGetValue(n._repo,n,o).then(s=>new DataSnapshot(s,new ReferenceImpl(n._repo,n._path),n._queryParams.getIndex()))}class ValueEventRegistration{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,o){const s=o._queryParams.getIndex();return new DataEvent("value",this,new DataSnapshot(e.snapshotNode,new ReferenceImpl(o._repo,o._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,o){return this.callbackContext.hasCancelCallback?new CancelEvent(this,e,o):null}matches(e){return e instanceof ValueEventRegistration?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class ChildEventRegistration{constructor(e,o){this.eventType=e,this.callbackContext=o}respondsTo(e){let o=e==="children_added"?"child_added":e;return o=o==="children_removed"?"child_removed":o,this.eventType===o}createCancelEvent(e,o){return this.callbackContext.hasCancelCallback?new CancelEvent(this,e,o):null}createEvent(e,o){assert(e.childName!=null,"Child events should have a childName.");const s=child(new ReferenceImpl(o._repo,o._path),e.childName),c=o._queryParams.getIndex();return new DataEvent(e.type,this,new DataSnapshot(e.snapshotNode,s,c),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ChildEventRegistration?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function addEventListener(n,e,o,s,c){let u;if(typeof s=="object"&&(u=void 0,c=s),typeof s=="function"&&(u=s),c&&c.onlyOnce){const _=o,ue=(gn,nh)=>{repoRemoveEventCallbackForQuery(n._repo,n,m),_(gn,nh)};ue.userCallback=o.userCallback,ue.context=o.context,o=ue}const d=new CallbackContext(o,u||void 0),m=e==="value"?new ValueEventRegistration(d):new ChildEventRegistration(e,d);return repoAddEventCallbackForQuery(n._repo,n,m),()=>repoRemoveEventCallbackForQuery(n._repo,n,m)}function onValue(n,e,o,s){return addEventListener(n,"value",e,o,s)}function onChildAdded(n,e,o,s){return addEventListener(n,"child_added",e,o,s)}function onChildChanged(n,e,o,s){return addEventListener(n,"child_changed",e,o,s)}function onChildMoved(n,e,o,s){return addEventListener(n,"child_moved",e,o,s)}function onChildRemoved(n,e,o,s){return addEventListener(n,"child_removed",e,o,s)}syncPointSetReferenceConstructor(ReferenceImpl);syncTreeSetReferenceConstructor(ReferenceImpl);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_DATABASE_EMULATOR_HOST_VAR="FIREBASE_DATABASE_EMULATOR_HOST",repos={};let useRestClient=!1;function repoManagerApplyEmulatorSettings(n,e,o,s){n.repoInfo_=new RepoInfo(`${e}:${o}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),s&&(n.authTokenProvider_=s)}function repoManagerDatabaseFromApp(n,e,o,s,c){let u=s||n.options.databaseURL;u===void 0&&(n.options.projectId||fatal("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),log("Using default host for project ",n.options.projectId),u=`${n.options.projectId}-default-rtdb.firebaseio.com`);let d=parseRepoInfo(u,c),m=d.repoInfo,_,ue;typeof process<"u"&&process.env&&(ue=process.env[FIREBASE_DATABASE_EMULATOR_HOST_VAR]),ue?(_=!0,u=`http://${ue}?ns=${m.namespace}`,d=parseRepoInfo(u,c),m=d.repoInfo):_=!d.repoInfo.secure;const gn=c&&_?new EmulatorTokenProvider(EmulatorTokenProvider.OWNER):new FirebaseAuthTokenProvider(n.name,n.options,e);validateUrl("Invalid Firebase Database URL",d),pathIsEmpty(d.path)||fatal("Database URL must point to the root of a Firebase Database (not including a child path).");const nh=repoManagerCreateRepo(m,n,gn,new AppCheckTokenProvider(n.name,o));return new Database(nh,n)}function repoManagerDeleteRepo(n,e){const o=repos[e];(!o||o[n.key]!==n)&&fatal(`Database ${e}(${n.repoInfo_}) has already been deleted.`),repoInterrupt(n),delete o[n.key]}function repoManagerCreateRepo(n,e,o,s){let c=repos[e.name];c||(c={},repos[e.name]=c);let u=c[n.toURLString()];return u&&fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new Repo(n,useRestClient,o,s),c[n.toURLString()]=u,u}class Database{constructor(e,o){this._repoInternal=e,this.app=o,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(repoStart(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ReferenceImpl(this._repo,newEmptyPath())),this._rootInternal}_delete(){return this._rootInternal!==null&&(repoManagerDeleteRepo(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&fatal("Cannot call "+e+" on a deleted database.")}}function getDatabase(n=getApp(),e){const o=_getProvider(n,"database").getImmediate({identifier:e});if(!o._instanceStarted){const s=getDefaultEmulatorHostnameAndPort("database");s&&connectDatabaseEmulator(o,...s)}return o}function connectDatabaseEmulator(n,e,o,s={}){n=getModularInstance(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&fatal("Cannot call useEmulator() after instance has already been initialized.");const c=n._repoInternal;let u;if(c.repoInfo_.nodeAdmin)s.mockUserToken&&fatal('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),u=new EmulatorTokenProvider(EmulatorTokenProvider.OWNER);else if(s.mockUserToken){const d=typeof s.mockUserToken=="string"?s.mockUserToken:createMockUserToken(s.mockUserToken,n.app.options.projectId);u=new EmulatorTokenProvider(d)}repoManagerApplyEmulatorSettings(c,e,o,u)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerDatabase(n){setSDKVersion(SDK_VERSION$1),_registerComponent(new Component("database",(e,{instanceIdentifier:o})=>{const s=e.getProvider("app").getImmediate(),c=e.getProvider("auth-internal"),u=e.getProvider("app-check-internal");return repoManagerDatabaseFromApp(s,c,u,o)},"PUBLIC").setMultipleInstances(!0)),registerVersion(name$3,version$3,n),registerVersion(name$3,version$3,"esm2017")}PersistentConnection.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};PersistentConnection.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};registerDatabase();function __rest(n,e){var o={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(o[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(n);c<s.length;c++)e.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(n,s[c])&&(o[s[c]]=n[s[c]]);return o}function _prodErrorMap(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const prodErrorMap=_prodErrorMap,_DEFAULT_AUTH_ERROR_FACTORY=new ErrorFactory("auth","Firebase",_prodErrorMap());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient=new Logger("@firebase/auth");function _logWarn(n,...e){logClient.logLevel<=LogLevel.WARN&&logClient.warn(`Auth (${SDK_VERSION$1}): ${n}`,...e)}function _logError(n,...e){logClient.logLevel<=LogLevel.ERROR&&logClient.error(`Auth (${SDK_VERSION$1}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _fail(n,...e){throw createErrorInternal(n,...e)}function _createError(n,...e){return createErrorInternal(n,...e)}function _errorWithCustomMessage(n,e,o){const s=Object.assign(Object.assign({},prodErrorMap()),{[e]:o});return new ErrorFactory("auth","Firebase",s).create(e,{appName:n.name})}function _assertInstanceOf(n,e,o){const s=o;if(!(e instanceof s))throw s.name!==e.constructor.name&&_fail(n,"argument-error"),_errorWithCustomMessage(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function createErrorInternal(n,...e){if(typeof n!="string"){const o=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(o,...s)}return _DEFAULT_AUTH_ERROR_FACTORY.create(n,...e)}function _assert(n,e,...o){if(!n)throw createErrorInternal(e,...o)}function debugFail(n){const e="INTERNAL ASSERTION FAILED: "+n;throw _logError(e),new Error(e)}function debugAssert(n,e){n||debugFail(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getCurrentUrl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function _isHttpOrHttps(){return _getCurrentScheme()==="http:"||_getCurrentScheme()==="https:"}function _getCurrentScheme(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isOnline(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_isHttpOrHttps()||isBrowserExtension()||"connection"in navigator)?navigator.onLine:!0}function _getUserLanguage(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Delay{constructor(e,o){this.shortDelay=e,this.longDelay=o,debugAssert(o>e,"Short delay should be less than long delay!"),this.isMobile=isMobileCordova()||isReactNative()}get(){return _isOnline()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _emulatorUrl(n,e){debugAssert(n.emulator,"Emulator should always be set here");const{url:o}=n.emulator;return e?`${o}${e.startsWith("/")?e.slice(1):e}`:o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FetchProvider{static initialize(e,o,s){this.fetchImpl=e,o&&(this.headersImpl=o),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SERVER_ERROR_MAP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_API_TIMEOUT_MS=new Delay(3e4,6e4);function _addTidIfNecessary(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function _performApiRequest(n,e,o,s,c={}){return _performFetchWithErrorHandling(n,c,async()=>{let u={},d={};s&&(e==="GET"?d=s:u={body:JSON.stringify(s)});const m=querystring(Object.assign({key:n.config.apiKey},d)).slice(1),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/json",n.languageCode&&(_["X-Firebase-Locale"]=n.languageCode),FetchProvider.fetch()(_getFinalTarget(n,n.config.apiHost,o,m),Object.assign({method:e,headers:_,referrerPolicy:"no-referrer"},u))})}async function _performFetchWithErrorHandling(n,e,o){n._canInitEmulator=!1;const s=Object.assign(Object.assign({},SERVER_ERROR_MAP),e);try{const c=new NetworkTimeout(n),u=await Promise.race([o(),c.promise]);c.clearNetworkTimeout();const d=await u.json();if("needConfirmation"in d)throw _makeTaggedError(n,"account-exists-with-different-credential",d);if(u.ok&&!("errorMessage"in d))return d;{const m=u.ok?d.errorMessage:d.error.message,[_,ue]=m.split(" : ");if(_==="FEDERATED_USER_ID_ALREADY_LINKED")throw _makeTaggedError(n,"credential-already-in-use",d);if(_==="EMAIL_EXISTS")throw _makeTaggedError(n,"email-already-in-use",d);if(_==="USER_DISABLED")throw _makeTaggedError(n,"user-disabled",d);const gn=s[_]||_.toLowerCase().replace(/[_\s]+/g,"-");if(ue)throw _errorWithCustomMessage(n,gn,ue);_fail(n,gn)}}catch(c){if(c instanceof FirebaseError)throw c;_fail(n,"network-request-failed",{message:String(c)})}}async function _performSignInRequest(n,e,o,s,c={}){const u=await _performApiRequest(n,e,o,s,c);return"mfaPendingCredential"in u&&_fail(n,"multi-factor-auth-required",{_serverResponse:u}),u}function _getFinalTarget(n,e,o,s){const c=`${e}${o}?${s}`;return n.config.emulator?_emulatorUrl(n.config,c):`${n.config.apiScheme}://${c}`}class NetworkTimeout{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((o,s)=>{this.timer=setTimeout(()=>s(_createError(this.auth,"network-request-failed")),DEFAULT_API_TIMEOUT_MS.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function _makeTaggedError(n,e,o){const s={appName:n.name};o.email&&(s.email=o.email),o.phoneNumber&&(s.phoneNumber=o.phoneNumber);const c=_createError(n,e,s);return c.customData._tokenResponse=o,c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function deleteAccount(n,e){return _performApiRequest(n,"POST","/v1/accounts:delete",e)}async function getAccountInfo(n,e){return _performApiRequest(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function utcTimestampToDateString(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function getIdTokenResult(n,e=!1){const o=getModularInstance(n),s=await o.getIdToken(e),c=_parseToken(s);_assert(c&&c.exp&&c.auth_time&&c.iat,o.auth,"internal-error");const u=typeof c.firebase=="object"?c.firebase:void 0,d=u==null?void 0:u.sign_in_provider;return{claims:c,token:s,authTime:utcTimestampToDateString(secondsStringToMilliseconds(c.auth_time)),issuedAtTime:utcTimestampToDateString(secondsStringToMilliseconds(c.iat)),expirationTime:utcTimestampToDateString(secondsStringToMilliseconds(c.exp)),signInProvider:d||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function secondsStringToMilliseconds(n){return Number(n)*1e3}function _parseToken(n){const[e,o,s]=n.split(".");if(e===void 0||o===void 0||s===void 0)return _logError("JWT malformed, contained fewer than 3 sections"),null;try{const c=base64Decode(o);return c?JSON.parse(c):(_logError("Failed to decode base64 JWT payload"),null)}catch(c){return _logError("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function _tokenExpiresIn(n){const e=_parseToken(n);return _assert(e,"internal-error"),_assert(typeof e.exp<"u","internal-error"),_assert(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _logoutIfInvalidated(n,e,o=!1){if(o)return e;try{return await e}catch(s){throw s instanceof FirebaseError&&isUserInvalidated(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function isUserInvalidated({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ProactiveRefresh{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var o;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const c=((o=this.user.stsTokenManager.expirationTime)!==null&&o!==void 0?o:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const o=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},o)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserMetadata{constructor(e,o){this.createdAt=e,this.lastLoginAt=o,this._initializeTime()}_initializeTime(){this.lastSignInTime=utcTimestampToDateString(this.lastLoginAt),this.creationTime=utcTimestampToDateString(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reloadWithoutSaving(n){var e;const o=n.auth,s=await n.getIdToken(),c=await _logoutIfInvalidated(n,getAccountInfo(o,{idToken:s}));_assert(c==null?void 0:c.users.length,o,"internal-error");const u=c.users[0];n._notifyReloadListener(u);const d=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?extractProviderData(u.providerUserInfo):[],m=mergeProviderData(n.providerData,d),_=n.isAnonymous,ue=!(n.email&&u.passwordHash)&&!(m!=null&&m.length),gn=_?ue:!1,nh={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:m,metadata:new UserMetadata(u.createdAt,u.lastLoginAt),isAnonymous:gn};Object.assign(n,nh)}async function reload(n){const e=getModularInstance(n);await _reloadWithoutSaving(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function mergeProviderData(n,e){return[...n.filter(s=>!e.some(c=>c.providerId===s.providerId)),...e]}function extractProviderData(n){return n.map(e=>{var{providerId:o}=e,s=__rest(e,["providerId"]);return{providerId:o,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function requestStsToken(n,e){const o=await _performFetchWithErrorHandling(n,{},async()=>{const s=querystring({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:u}=n.config,d=_getFinalTarget(n,c,"/v1/token",`key=${u}`),m=await n._getAdditionalHeaders();return m["Content-Type"]="application/x-www-form-urlencoded",FetchProvider.fetch()(d,{method:"POST",headers:m,body:s})});return{accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StsTokenManager{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_assert(e.idToken,"internal-error"),_assert(typeof e.idToken<"u","internal-error"),_assert(typeof e.refreshToken<"u","internal-error");const o="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):_tokenExpiresIn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,o)}async getToken(e,o=!1){return _assert(!this.accessToken||this.refreshToken,e,"user-token-expired"),!o&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,o){const{accessToken:s,refreshToken:c,expiresIn:u}=await requestStsToken(e,o);this.updateTokensAndExpiration(s,c,Number(u))}updateTokensAndExpiration(e,o,s){this.refreshToken=o||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,o){const{refreshToken:s,accessToken:c,expirationTime:u}=o,d=new StsTokenManager;return s&&(_assert(typeof s=="string","internal-error",{appName:e}),d.refreshToken=s),c&&(_assert(typeof c=="string","internal-error",{appName:e}),d.accessToken=c),u&&(_assert(typeof u=="number","internal-error",{appName:e}),d.expirationTime=u),d}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new StsTokenManager,this.toJSON())}_performRefresh(){return debugFail("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function assertStringOrUndefined(n,e){_assert(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class UserImpl{constructor(e){var{uid:o,auth:s,stsTokenManager:c}=e,u=__rest(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ProactiveRefresh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=o,this.auth=s,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new UserMetadata(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const o=await _logoutIfInvalidated(this,this.stsTokenManager.getToken(this.auth,e));return _assert(o,this.auth,"internal-error"),this.accessToken!==o&&(this.accessToken=o,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),o}getIdTokenResult(e){return getIdTokenResult(this,e)}reload(){return reload(this)}_assign(e){this!==e&&(_assert(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(o=>Object.assign({},o)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const o=new UserImpl(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return o.metadata._copy(this.metadata),o}_onReload(e){_assert(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,o=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),o&&await _reloadWithoutSaving(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await _logoutIfInvalidated(this,deleteAccount(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,o){var s,c,u,d,m,_,ue,gn;const nh=(s=o.displayName)!==null&&s!==void 0?s:void 0,ih=(c=o.email)!==null&&c!==void 0?c:void 0,rh=(u=o.phoneNumber)!==null&&u!==void 0?u:void 0,oh=(d=o.photoURL)!==null&&d!==void 0?d:void 0,lh=(m=o.tenantId)!==null&&m!==void 0?m:void 0,ch=(_=o._redirectEventId)!==null&&_!==void 0?_:void 0,dh=(ue=o.createdAt)!==null&&ue!==void 0?ue:void 0,_h=(gn=o.lastLoginAt)!==null&&gn!==void 0?gn:void 0,{uid:Sh,emailVerified:fh,isAnonymous:yh,providerData:mh,stsTokenManager:Ch}=o;_assert(Sh&&Ch,e,"internal-error");const Mh=StsTokenManager.fromJSON(this.name,Ch);_assert(typeof Sh=="string",e,"internal-error"),assertStringOrUndefined(nh,e.name),assertStringOrUndefined(ih,e.name),_assert(typeof fh=="boolean",e,"internal-error"),_assert(typeof yh=="boolean",e,"internal-error"),assertStringOrUndefined(rh,e.name),assertStringOrUndefined(oh,e.name),assertStringOrUndefined(lh,e.name),assertStringOrUndefined(ch,e.name),assertStringOrUndefined(dh,e.name),assertStringOrUndefined(_h,e.name);const Ph=new UserImpl({uid:Sh,auth:e,email:ih,emailVerified:fh,displayName:nh,isAnonymous:yh,photoURL:oh,phoneNumber:rh,tenantId:lh,stsTokenManager:Mh,createdAt:dh,lastLoginAt:_h});return mh&&Array.isArray(mh)&&(Ph.providerData=mh.map(Eh=>Object.assign({},Eh))),ch&&(Ph._redirectEventId=ch),Ph}static async _fromIdTokenResponse(e,o,s=!1){const c=new StsTokenManager;c.updateFromServerResponse(o);const u=new UserImpl({uid:o.localId,auth:e,stsTokenManager:c,isAnonymous:s});return await _reloadWithoutSaving(u),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const instanceCache=new Map;function _getInstance(n){debugAssert(n instanceof Function,"Expected a class definition");let e=instanceCache.get(n);return e?(debugAssert(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,instanceCache.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class InMemoryPersistence{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,o){this.storage[e]=o}async _get(e){const o=this.storage[e];return o===void 0?null:o}async _remove(e){delete this.storage[e]}_addListener(e,o){}_removeListener(e,o){}}InMemoryPersistence.type="NONE";const inMemoryPersistence=InMemoryPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _persistenceKeyName(n,e,o){return`firebase:${n}:${e}:${o}`}class PersistenceUserManager{constructor(e,o,s){this.persistence=e,this.auth=o,this.userKey=s;const{config:c,name:u}=this.auth;this.fullUserKey=_persistenceKeyName(this.userKey,c.apiKey,u),this.fullPersistenceKey=_persistenceKeyName("persistence",c.apiKey,u),this.boundEventHandler=o._onStorageEvent.bind(o),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?UserImpl._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const o=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,o)return this.setCurrentUser(o)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,o,s="authUser"){if(!o.length)return new PersistenceUserManager(_getInstance(inMemoryPersistence),e,s);const c=(await Promise.all(o.map(async ue=>{if(await ue._isAvailable())return ue}))).filter(ue=>ue);let u=c[0]||_getInstance(inMemoryPersistence);const d=_persistenceKeyName(s,e.config.apiKey,e.name);let m=null;for(const ue of o)try{const gn=await ue._get(d);if(gn){const nh=UserImpl._fromJSON(e,gn);ue!==u&&(m=nh),u=ue;break}}catch{}const _=c.filter(ue=>ue._shouldAllowMigration);return!u._shouldAllowMigration||!_.length?new PersistenceUserManager(u,e,s):(u=_[0],m&&await u._set(d,m.toJSON()),await Promise.all(o.map(async ue=>{if(ue!==u)try{await ue._remove(d)}catch{}})),new PersistenceUserManager(u,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getBrowserName(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(_isIEMobile(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(_isFirefox(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_isBlackBerry(e))return"Blackberry";if(_isWebOS(e))return"Webos";if(_isSafari(e))return"Safari";if((e.includes("chrome/")||_isChromeIOS(e))&&!e.includes("edge/"))return"Chrome";if(_isAndroid(e))return"Android";{const o=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(o);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function _isFirefox(n=getUA()){return/firefox\//i.test(n)}function _isSafari(n=getUA()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _isChromeIOS(n=getUA()){return/crios\//i.test(n)}function _isIEMobile(n=getUA()){return/iemobile/i.test(n)}function _isAndroid(n=getUA()){return/android/i.test(n)}function _isBlackBerry(n=getUA()){return/blackberry/i.test(n)}function _isWebOS(n=getUA()){return/webos/i.test(n)}function _isIOS(n=getUA()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function _isIOSStandalone(n=getUA()){var e;return _isIOS(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function _isIE10(){return isIE()&&document.documentMode===10}function _isMobileBrowser(n=getUA()){return _isIOS(n)||_isAndroid(n)||_isWebOS(n)||_isBlackBerry(n)||/windows phone/i.test(n)||_isIEMobile(n)}function _isIframe(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getClientVersion(n,e=[]){let o;switch(n){case"Browser":o=_getBrowserName(getUA());break;case"Worker":o=`${_getBrowserName(getUA())}-${n}`;break;default:o=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${o}/JsCore/${SDK_VERSION$1}/${s}`}async function getRecaptchaConfig(n,e){return _performApiRequest(n,"GET","/v2/recaptchaConfig",_addTidIfNecessary(n,e))}function isEnterprise(n){return n!==void 0&&n.enterprise!==void 0}class RecaptchaConfig{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(o=>o.provider==="EMAIL_PASSWORD_PROVIDER"&&o.enforcementState!=="OFF")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getScriptParentElement(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function _loadJS(n){return new Promise((e,o)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=c=>{const u=_createError("internal-error");u.customData=c,o(u)},s.type="text/javascript",s.charset="UTF-8",getScriptParentElement().appendChild(s)})}function _generateCallbackName(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const RECAPTCHA_ENTERPRISE_URL="https://www.google.com/recaptcha/enterprise.js?render=",RECAPTCHA_ENTERPRISE_VERIFIER_TYPE="recaptcha-enterprise",FAKE_TOKEN="NO_RECAPTCHA";class RecaptchaEnterpriseVerifier{constructor(e){this.type=RECAPTCHA_ENTERPRISE_VERIFIER_TYPE,this.auth=_castAuth(e)}async verify(e="verify",o=!1){async function s(u){if(!o){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(d,m)=>{getRecaptchaConfig(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(_=>{if(_.recaptchaKey===void 0)m(new Error("recaptcha Enterprise site key undefined"));else{const ue=new RecaptchaConfig(_);return u.tenantId==null?u._agentRecaptchaConfig=ue:u._tenantRecaptchaConfigs[u.tenantId]=ue,d(ue.siteKey)}}).catch(_=>{m(_)})})}function c(u,d,m){const _=window.grecaptcha;isEnterprise(_)?_.enterprise.ready(()=>{_.enterprise.execute(u,{action:e}).then(ue=>{d(ue)}).catch(()=>{d(FAKE_TOKEN)})}):m(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((u,d)=>{s(this.auth).then(m=>{if(!o&&isEnterprise(window.grecaptcha))c(m,u,d);else{if(typeof window>"u"){d(new Error("RecaptchaVerifier is only supported in browser"));return}_loadJS(RECAPTCHA_ENTERPRISE_URL+m).then(()=>{c(m,u,d)}).catch(_=>{d(_)})}}).catch(m=>{d(m)})})}}async function injectRecaptchaFields(n,e,o,s=!1){const c=new RecaptchaEnterpriseVerifier(n);let u;try{u=await c.verify(o)}catch{u=await c.verify(o,!0)}const d=Object.assign({},e);return s?Object.assign(d,{captchaResp:u}):Object.assign(d,{captchaResponse:u}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthMiddlewareQueue{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,o){const s=u=>new Promise((d,m)=>{try{const _=e(u);d(_)}catch(_){m(_)}});s.onAbort=o,this.queue.push(s);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const o=[];try{for(const s of this.queue)await s(e),s.onAbort&&o.push(s.onAbort)}catch(s){o.reverse();for(const c of o)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthImpl{constructor(e,o,s,c){this.app=e,this.heartbeatServiceProvider=o,this.appCheckServiceProvider=s,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Subscription(this),this.idTokenSubscription=new Subscription(this),this.beforeStateQueue=new AuthMiddlewareQueue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_DEFAULT_AUTH_ERROR_FACTORY,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,o){return o&&(this._popupRedirectResolver=_getInstance(o)),this._initializationPromise=this.queue(async()=>{var s,c;if(!this._deleted&&(this.persistenceManager=await PersistenceUserManager.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(o),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var o;const s=await this.assertedPersistence.getCurrentUser();let c=s,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const d=(o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId,m=c==null?void 0:c._redirectEventId,_=await this.tryRedirectSignIn(e);(!d||d===m)&&(_!=null&&_.user)&&(c=_.user,u=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(c)}catch(d){c=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(d))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return _assert(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let o=null;try{o=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return o}async reloadAndSetCurrentUserOrClear(e){try{await _reloadWithoutSaving(e)}catch(o){if((o==null?void 0:o.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=_getUserLanguage()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const o=e?getModularInstance(e):null;return o&&_assert(o.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(o&&o._clone(this))}async _updateCurrentUser(e,o=!1){if(!this._deleted)return e&&_assert(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),o||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(_getInstance(e))})}async initializeRecaptchaConfig(){const e=await getRecaptchaConfig(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),o=new RecaptchaConfig(e);this.tenantId==null?this._agentRecaptchaConfig=o:this._tenantRecaptchaConfigs[this.tenantId]=o,o.emailPasswordEnabled&&new RecaptchaEnterpriseVerifier(this).verify()}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ErrorFactory("auth","Firebase",e())}onAuthStateChanged(e,o,s){return this.registerStateListener(this.authStateSubscription,e,o,s)}beforeAuthStateChanged(e,o){return this.beforeStateQueue.pushCallback(e,o)}onIdTokenChanged(e,o,s){return this.registerStateListener(this.idTokenSubscription,e,o,s)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,o){const s=await this.getOrInitRedirectPersistenceManager(o);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const o=e&&_getInstance(e)||this._popupRedirectResolver;_assert(o,this,"argument-error"),this.redirectPersistenceManager=await PersistenceUserManager.create(this,[_getInstance(o._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var o,s;return this._isInitialized&&await this.queue(async()=>{}),((o=this._currentUser)===null||o===void 0?void 0:o._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,o;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(o=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&o!==void 0?o:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,o,s,c){if(this._deleted)return()=>{};const u=typeof o=="function"?o:o.next.bind(o),d=this._isInitialized?Promise.resolve():this._initializationPromise;return _assert(d,this,"internal-error"),d.then(()=>u(this.currentUser)),typeof o=="function"?e.addObserver(o,s,c):e.addObserver(o)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _assert(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_getClientVersion(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const o={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(o["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(o["X-Firebase-Client"]=s);const c=await this._getAppCheckToken();return c&&(o["X-Firebase-AppCheck"]=c),o}async _getAppCheckToken(){var e;const o=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return o!=null&&o.error&&_logWarn(`Error while retrieving App Check token: ${o.error}`),o==null?void 0:o.token}}function _castAuth(n){return getModularInstance(n)}class Subscription{constructor(e){this.auth=e,this.observer=null,this.addObserver=createSubscribe(o=>this.observer=o)}get next(){return _assert(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function initializeAuth(n,e){const o=_getProvider(n,"auth");if(o.isInitialized()){const c=o.getImmediate(),u=o.getOptions();if(deepEqual(u,e??{}))return c;_fail(c,"already-initialized")}return o.initialize({options:e})}function _initializeAuthInstance(n,e){const o=(e==null?void 0:e.persistence)||[],s=(Array.isArray(o)?o:[o]).map(_getInstance);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function connectAuthEmulator(n,e,o){const s=_castAuth(n);_assert(s._canInitEmulator,s,"emulator-config-failed"),_assert(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const c=!!(o!=null&&o.disableWarnings),u=extractProtocol(e),{host:d,port:m}=extractHostAndPort(e),_=m===null?"":`:${m}`;s.config.emulator={url:`${u}//${d}${_}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:d,port:m,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:c})}),c||emitEmulatorWarning()}function extractProtocol(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function extractHostAndPort(n){const e=extractProtocol(n),o=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!o)return{host:"",port:null};const s=o[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(s);if(c){const u=c[1];return{host:u,port:parsePort(s.substr(u.length+1))}}else{const[u,d]=s.split(":");return{host:u,port:parsePort(d)}}}function parsePort(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function emitEmulatorWarning(){function n(){const e=document.createElement("p"),o=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",o.position="fixed",o.width="100%",o.backgroundColor="#ffffff",o.border=".1em solid #000000",o.color="#b50000",o.bottom="0px",o.left="0px",o.margin="0px",o.zIndex="10000",o.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthCredential{constructor(e,o){this.providerId=e,this.signInMethod=o}toJSON(){return debugFail("not implemented")}_getIdTokenResponse(e){return debugFail("not implemented")}_linkToIdToken(e,o){return debugFail("not implemented")}_getReauthenticationResolver(e){return debugFail("not implemented")}}async function updateEmailPassword(n,e){return _performApiRequest(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithPassword(n,e){return _performSignInRequest(n,"POST","/v1/accounts:signInWithPassword",_addTidIfNecessary(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithEmailLink$1(n,e){return _performSignInRequest(n,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(n,e))}async function signInWithEmailLinkForLinking(n,e){return _performSignInRequest(n,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthCredential extends AuthCredential{constructor(e,o,s,c=null){super("password",s),this._email=e,this._password=o,this._tenantId=c}static _fromEmailAndPassword(e,o){return new EmailAuthCredential(e,o,"password")}static _fromEmailAndCode(e,o,s=null){return new EmailAuthCredential(e,o,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const o=typeof e=="string"?JSON.parse(e):e;if(o!=null&&o.email&&(o!=null&&o.password)){if(o.signInMethod==="password")return this._fromEmailAndPassword(o.email,o.password);if(o.signInMethod==="emailLink")return this._fromEmailAndCode(o.email,o.password,o.tenantId)}return null}async _getIdTokenResponse(e){var o;switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(!((o=e._getRecaptchaConfig())===null||o===void 0)&&o.emailPasswordEnabled){const c=await injectRecaptchaFields(e,s,"signInWithPassword");return signInWithPassword(e,c)}else return signInWithPassword(e,s).catch(async c=>{if(c.code==="auth/missing-recaptcha-token"){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const u=await injectRecaptchaFields(e,s,"signInWithPassword");return signInWithPassword(e,u)}else return Promise.reject(c)});case"emailLink":return signInWithEmailLink$1(e,{email:this._email,oobCode:this._password});default:_fail(e,"internal-error")}}async _linkToIdToken(e,o){switch(this.signInMethod){case"password":return updateEmailPassword(e,{idToken:o,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return signInWithEmailLinkForLinking(e,{idToken:o,email:this._email,oobCode:this._password});default:_fail(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithIdp(n,e){return _performSignInRequest(n,"POST","/v1/accounts:signInWithIdp",_addTidIfNecessary(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IDP_REQUEST_URI$1="http://localhost";class OAuthCredential extends AuthCredential{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const o=new OAuthCredential(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(o.idToken=e.idToken),e.accessToken&&(o.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(o.nonce=e.nonce),e.pendingToken&&(o.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(o.accessToken=e.oauthToken,o.secret=e.oauthTokenSecret):_fail("argument-error"),o}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const o=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:c}=o,u=__rest(o,["providerId","signInMethod"]);if(!s||!c)return null;const d=new OAuthCredential(s,c);return d.idToken=u.idToken||void 0,d.accessToken=u.accessToken||void 0,d.secret=u.secret,d.nonce=u.nonce,d.pendingToken=u.pendingToken||null,d}_getIdTokenResponse(e){const o=this.buildRequest();return signInWithIdp(e,o)}_linkToIdToken(e,o){const s=this.buildRequest();return s.idToken=o,signInWithIdp(e,s)}_getReauthenticationResolver(e){const o=this.buildRequest();return o.autoCreate=!1,signInWithIdp(e,o)}buildRequest(){const e={requestUri:IDP_REQUEST_URI$1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const o={};this.idToken&&(o.id_token=this.idToken),this.accessToken&&(o.access_token=this.accessToken),this.secret&&(o.oauth_token_secret=this.secret),o.providerId=this.providerId,this.nonce&&!this.pendingToken&&(o.nonce=this.nonce),e.postBody=querystring(o)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parseMode(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function parseDeepLink(n){const e=querystringDecode(extractQuerystring(n)).link,o=e?querystringDecode(extractQuerystring(e)).deep_link_id:null,s=querystringDecode(extractQuerystring(n)).deep_link_id;return(s?querystringDecode(extractQuerystring(s)).link:null)||s||o||e||n}class ActionCodeURL{constructor(e){var o,s,c,u,d,m;const _=querystringDecode(extractQuerystring(e)),ue=(o=_.apiKey)!==null&&o!==void 0?o:null,gn=(s=_.oobCode)!==null&&s!==void 0?s:null,nh=parseMode((c=_.mode)!==null&&c!==void 0?c:null);_assert(ue&&gn&&nh,"argument-error"),this.apiKey=ue,this.operation=nh,this.code=gn,this.continueUrl=(u=_.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(d=_.languageCode)!==null&&d!==void 0?d:null,this.tenantId=(m=_.tenantId)!==null&&m!==void 0?m:null}static parseLink(e){const o=parseDeepLink(e);try{return new ActionCodeURL(o)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthProvider{constructor(){this.providerId=EmailAuthProvider.PROVIDER_ID}static credential(e,o){return EmailAuthCredential._fromEmailAndPassword(e,o)}static credentialWithLink(e,o){const s=ActionCodeURL.parseLink(o);return _assert(s,"argument-error"),EmailAuthCredential._fromEmailAndCode(e,s.code,s.tenantId)}}EmailAuthProvider.PROVIDER_ID="password";EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD="password";EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FederatedAuthProvider{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BaseOAuthProvider extends FederatedAuthProvider{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FacebookAuthProvider extends BaseOAuthProvider{constructor(){super("facebook.com")}static credential(e){return OAuthCredential._fromParams({providerId:FacebookAuthProvider.PROVIDER_ID,signInMethod:FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return FacebookAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return FacebookAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return FacebookAuthProvider.credential(e.oauthAccessToken)}catch{return null}}}FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD="facebook.com";FacebookAuthProvider.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GoogleAuthProvider extends BaseOAuthProvider{constructor(){super("google.com"),this.addScope("profile")}static credential(e,o){return OAuthCredential._fromParams({providerId:GoogleAuthProvider.PROVIDER_ID,signInMethod:GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:o})}static credentialFromResult(e){return GoogleAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return GoogleAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:o,oauthAccessToken:s}=e;if(!o&&!s)return null;try{return GoogleAuthProvider.credential(o,s)}catch{return null}}}GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD="google.com";GoogleAuthProvider.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GithubAuthProvider extends BaseOAuthProvider{constructor(){super("github.com")}static credential(e){return OAuthCredential._fromParams({providerId:GithubAuthProvider.PROVIDER_ID,signInMethod:GithubAuthProvider.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return GithubAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return GithubAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return GithubAuthProvider.credential(e.oauthAccessToken)}catch{return null}}}GithubAuthProvider.GITHUB_SIGN_IN_METHOD="github.com";GithubAuthProvider.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TwitterAuthProvider extends BaseOAuthProvider{constructor(){super("twitter.com")}static credential(e,o){return OAuthCredential._fromParams({providerId:TwitterAuthProvider.PROVIDER_ID,signInMethod:TwitterAuthProvider.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:o})}static credentialFromResult(e){return TwitterAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return TwitterAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:o,oauthTokenSecret:s}=e;if(!o||!s)return null;try{return TwitterAuthProvider.credential(o,s)}catch{return null}}}TwitterAuthProvider.TWITTER_SIGN_IN_METHOD="twitter.com";TwitterAuthProvider.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signUp(n,e){return _performSignInRequest(n,"POST","/v1/accounts:signUp",_addTidIfNecessary(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserCredentialImpl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,o,s,c=!1){const u=await UserImpl._fromIdTokenResponse(e,s,c),d=providerIdForResponse(s);return new UserCredentialImpl({user:u,providerId:d,_tokenResponse:s,operationType:o})}static async _forOperation(e,o,s){await e._updateTokensIfNecessary(s,!0);const c=providerIdForResponse(s);return new UserCredentialImpl({user:e,providerId:c,_tokenResponse:s,operationType:o})}}function providerIdForResponse(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MultiFactorError extends FirebaseError{constructor(e,o,s,c){var u;super(o.code,o.message),this.operationType=s,this.user=c,Object.setPrototypeOf(this,MultiFactorError.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:o.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,o,s,c){return new MultiFactorError(e,o,s,c)}}function _processCredentialSavingMfaContextIfNecessary(n,e,o,s){return(e==="reauthenticate"?o._getReauthenticationResolver(n):o._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?MultiFactorError._fromErrorAndOperation(n,u,e,s):u})}async function _link$1(n,e,o=!1){const s=await _logoutIfInvalidated(n,e._linkToIdToken(n.auth,await n.getIdToken()),o);return UserCredentialImpl._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reauthenticate(n,e,o=!1){const{auth:s}=n,c="reauthenticate";try{const u=await _logoutIfInvalidated(n,_processCredentialSavingMfaContextIfNecessary(s,c,e,n),o);_assert(u.idToken,s,"internal-error");const d=_parseToken(u.idToken);_assert(d,s,"internal-error");const{sub:m}=d;return _assert(n.uid===m,s,"user-mismatch"),UserCredentialImpl._forOperation(n,c,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&_fail(s,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _signInWithCredential(n,e,o=!1){const s="signIn",c=await _processCredentialSavingMfaContextIfNecessary(n,s,e),u=await UserCredentialImpl._fromIdTokenResponse(n,s,c);return o||await n._updateCurrentUser(u.user),u}async function signInWithCredential(n,e){return _signInWithCredential(_castAuth(n),e)}async function createUserWithEmailAndPassword(n,e,o){var s;const c=_castAuth(n),u={returnSecureToken:!0,email:e,password:o,clientType:"CLIENT_TYPE_WEB"};let d;if(!((s=c._getRecaptchaConfig())===null||s===void 0)&&s.emailPasswordEnabled){const ue=await injectRecaptchaFields(c,u,"signUpPassword");d=signUp(c,ue)}else d=signUp(c,u).catch(async ue=>{if(ue.code==="auth/missing-recaptcha-token"){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const gn=await injectRecaptchaFields(c,u,"signUpPassword");return signUp(c,gn)}else return Promise.reject(ue)});const m=await d.catch(ue=>Promise.reject(ue)),_=await UserCredentialImpl._fromIdTokenResponse(c,"signIn",m);return await c._updateCurrentUser(_.user),_}function signInWithEmailAndPassword(n,e,o){return signInWithCredential(getModularInstance(n),EmailAuthProvider.credential(e,o))}function onIdTokenChanged(n,e,o,s){return getModularInstance(n).onIdTokenChanged(e,o,s)}function beforeAuthStateChanged(n,e,o){return getModularInstance(n).beforeAuthStateChanged(e,o)}function onAuthStateChanged(n,e,o,s){return getModularInstance(n).onAuthStateChanged(e,o,s)}function signOut(n){return getModularInstance(n).signOut()}const STORAGE_AVAILABLE_KEY="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserPersistenceClass{constructor(e,o){this.storageRetriever=e,this.type=o}_isAvailable(){try{return this.storage?(this.storage.setItem(STORAGE_AVAILABLE_KEY,"1"),this.storage.removeItem(STORAGE_AVAILABLE_KEY),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,o){return this.storage.setItem(e,JSON.stringify(o)),Promise.resolve()}_get(e){const o=this.storage.getItem(e);return Promise.resolve(o?JSON.parse(o):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _iframeCannotSyncWebStorage(){const n=getUA();return _isSafari(n)||_isIOS(n)}const _POLLING_INTERVAL_MS$1=1e3,IE10_LOCAL_STORAGE_SYNC_DELAY=10;class BrowserLocalPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,o)=>this.onStorageEvent(e,o),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=_iframeCannotSyncWebStorage()&&_isIframe(),this.fallbackToPolling=_isMobileBrowser(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const o of Object.keys(this.listeners)){const s=this.storage.getItem(o),c=this.localCache[o];s!==c&&e(o,c,s)}}onStorageEvent(e,o=!1){if(!e.key){this.forAllChangedKeys((d,m,_)=>{this.notifyListeners(d,_)});return}const s=e.key;if(o?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const d=this.storage.getItem(s);if(e.newValue!==d)e.newValue!==null?this.storage.setItem(s,e.newValue):this.storage.removeItem(s);else if(this.localCache[s]===e.newValue&&!o)return}const c=()=>{const d=this.storage.getItem(s);!o&&this.localCache[s]===d||this.notifyListeners(s,d)},u=this.storage.getItem(s);_isIE10()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,IE10_LOCAL_STORAGE_SYNC_DELAY):c()}notifyListeners(e,o){this.localCache[e]=o;const s=this.listeners[e];if(s)for(const c of Array.from(s))c(o&&JSON.parse(o))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,o,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:o,newValue:s}),!0)})},_POLLING_INTERVAL_MS$1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,o){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(o)}_removeListener(e,o){this.listeners[e]&&(this.listeners[e].delete(o),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,o){await super._set(e,o),this.localCache[e]=JSON.stringify(o)}async _get(e){const o=await super._get(e);return this.localCache[e]=JSON.stringify(o),o}async _remove(e){await super._remove(e),delete this.localCache[e]}}BrowserLocalPersistence.type="LOCAL";const browserLocalPersistence=BrowserLocalPersistence;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserSessionPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,o){}_removeListener(e,o){}}BrowserSessionPersistence.type="SESSION";const browserSessionPersistence=BrowserSessionPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _allSettled(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(o){return{fulfilled:!1,reason:o}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Receiver{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const o=this.receivers.find(c=>c.isListeningto(e));if(o)return o;const s=new Receiver(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const o=e,{eventId:s,eventType:c,data:u}=o.data,d=this.handlersMap[c];if(!(d!=null&&d.size))return;o.ports[0].postMessage({status:"ack",eventId:s,eventType:c});const m=Array.from(d).map(async ue=>ue(o.origin,u)),_=await _allSettled(m);o.ports[0].postMessage({status:"done",eventId:s,eventType:c,response:_})}_subscribe(e,o){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(o)}_unsubscribe(e,o){this.handlersMap[e]&&o&&this.handlersMap[e].delete(o),(!o||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Receiver.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _generateEventId(n="",e=10){let o="";for(let s=0;s<e;s++)o+=Math.floor(Math.random()*10);return n+o}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sender{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,o,s=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let u,d;return new Promise((m,_)=>{const ue=_generateEventId("",20);c.port1.start();const gn=setTimeout(()=>{_(new Error("unsupported_event"))},s);d={messageChannel:c,onMessage(nh){const ih=nh;if(ih.data.eventId===ue)switch(ih.data.status){case"ack":clearTimeout(gn),u=setTimeout(()=>{_(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),m(ih.data.response);break;default:clearTimeout(gn),clearTimeout(u),_(new Error("invalid_response"));break}}},this.handlers.add(d),c.port1.addEventListener("message",d.onMessage),this.target.postMessage({eventType:e,eventId:ue,data:o},[c.port2])}).finally(()=>{d&&this.removeMessageHandler(d)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _window(){return window}function _setWindowLocation(n){_window().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isWorker(){return typeof _window().WorkerGlobalScope<"u"&&typeof _window().importScripts=="function"}async function _getActiveServiceWorker(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _getServiceWorkerController(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function _getWorkerGlobalScope(){return _isWorker()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME$1="firebaseLocalStorageDb",DB_VERSION$1=1,DB_OBJECTSTORE_NAME="firebaseLocalStorage",DB_DATA_KEYPATH="fbase_key";class DBPromise{constructor(e){this.request=e}toPromise(){return new Promise((e,o)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{o(this.request.error)})})}}function getObjectStore(n,e){return n.transaction([DB_OBJECTSTORE_NAME],e?"readwrite":"readonly").objectStore(DB_OBJECTSTORE_NAME)}function _deleteDatabase(){const n=indexedDB.deleteDatabase(DB_NAME$1);return new DBPromise(n).toPromise()}function _openDatabase(){const n=indexedDB.open(DB_NAME$1,DB_VERSION$1);return new Promise((e,o)=>{n.addEventListener("error",()=>{o(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(DB_OBJECTSTORE_NAME,{keyPath:DB_DATA_KEYPATH})}catch(c){o(c)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(DB_OBJECTSTORE_NAME)?e(s):(s.close(),await _deleteDatabase(),e(await _openDatabase()))})})}async function _putObject(n,e,o){const s=getObjectStore(n,!0).put({[DB_DATA_KEYPATH]:e,value:o});return new DBPromise(s).toPromise()}async function getObject(n,e){const o=getObjectStore(n,!1).get(e),s=await new DBPromise(o).toPromise();return s===void 0?null:s.value}function _deleteObject(n,e){const o=getObjectStore(n,!0).delete(e);return new DBPromise(o).toPromise()}const _POLLING_INTERVAL_MS=800,_TRANSACTION_RETRY_COUNT=3;class IndexedDBLocalPersistence{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _openDatabase(),this.db)}async _withRetries(e){let o=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(o++>_TRANSACTION_RETRY_COUNT)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _isWorker()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Receiver._getInstance(_getWorkerGlobalScope()),this.receiver._subscribe("keyChanged",async(e,o)=>({keyProcessed:(await this._poll()).includes(o.key)})),this.receiver._subscribe("ping",async(e,o)=>["keyChanged"])}async initializeSender(){var e,o;if(this.activeServiceWorker=await _getActiveServiceWorker(),!this.activeServiceWorker)return;this.sender=new Sender(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((o=s[0])===null||o===void 0)&&o.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||_getServiceWorkerController()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _openDatabase();return await _putObject(e,STORAGE_AVAILABLE_KEY,"1"),await _deleteObject(e,STORAGE_AVAILABLE_KEY),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,o){return this._withPendingWrite(async()=>(await this._withRetries(s=>_putObject(s,e,o)),this.localCache[e]=o,this.notifyServiceWorker(e)))}async _get(e){const o=await this._withRetries(s=>getObject(s,e));return this.localCache[e]=o,o}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(o=>_deleteObject(o,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const u=getObjectStore(c,!1).getAll();return new DBPromise(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const o=[],s=new Set;for(const{fbase_key:c,value:u}of e)s.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(u)&&(this.notifyListeners(c,u),o.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!s.has(c)&&(this.notifyListeners(c,null),o.push(c));return o}notifyListeners(e,o){this.localCache[e]=o;const s=this.listeners[e];if(s)for(const c of Array.from(s))c(o)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_POLLING_INTERVAL_MS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,o){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(o)}_removeListener(e,o){this.listeners[e]&&(this.listeners[e].delete(o),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}IndexedDBLocalPersistence.type="LOCAL";const indexedDBLocalPersistence=IndexedDBLocalPersistence;new Delay(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _withDefaultResolver(n,e){return e?_getInstance(e):(_assert(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IdpCredential extends AuthCredential{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return signInWithIdp(e,this._buildIdpRequest())}_linkToIdToken(e,o){return signInWithIdp(e,this._buildIdpRequest(o))}_getReauthenticationResolver(e){return signInWithIdp(e,this._buildIdpRequest())}_buildIdpRequest(e){const o={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(o.idToken=e),o}}function _signIn(n){return _signInWithCredential(n.auth,new IdpCredential(n),n.bypassAuthState)}function _reauth(n){const{auth:e,user:o}=n;return _assert(o,e,"internal-error"),_reauthenticate(o,new IdpCredential(n),n.bypassAuthState)}async function _link(n){const{auth:e,user:o}=n;return _assert(o,e,"internal-error"),_link$1(o,new IdpCredential(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AbstractPopupRedirectOperation{constructor(e,o,s,c,u=!1){this.auth=e,this.resolver=s,this.user=c,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(o)?o:[o]}execute(){return new Promise(async(e,o)=>{this.pendingPromise={resolve:e,reject:o};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:o,sessionId:s,postBody:c,tenantId:u,error:d,type:m}=e;if(d){this.reject(d);return}const _={auth:this.auth,requestUri:o,sessionId:s,tenantId:u||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(m)(_))}catch(ue){this.reject(ue)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return _signIn;case"linkViaPopup":case"linkViaRedirect":return _link;case"reauthViaPopup":case"reauthViaRedirect":return _reauth;default:_fail(this.auth,"internal-error")}}resolve(e){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _POLL_WINDOW_CLOSE_TIMEOUT=new Delay(2e3,1e4);async function signInWithPopup(n,e,o){const s=_castAuth(n);_assertInstanceOf(n,e,FederatedAuthProvider);const c=_withDefaultResolver(s,o);return new PopupOperation(s,"signInViaPopup",e,c).executeNotNull()}class PopupOperation extends AbstractPopupRedirectOperation{constructor(e,o,s,c,u){super(e,o,c,u),this.provider=s,this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction&&PopupOperation.currentPopupAction.cancel(),PopupOperation.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _assert(e,this.auth,"internal-error"),e}async onExecution(){debugAssert(this.filter.length===1,"Popup operations only handle one event");const e=_generateEventId();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(o=>{this.reject(o)}),this.resolver._isIframeWebStorageSupported(this.auth,o=>{o||this.reject(_createError(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(_createError(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction=null}pollUserCancellation(){const e=()=>{var o,s;if(!((s=(o=this.authWindow)===null||o===void 0?void 0:o.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_createError(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_POLL_WINDOW_CLOSE_TIMEOUT.get())};e()}}PopupOperation.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PENDING_REDIRECT_KEY="pendingRedirect",redirectOutcomeMap=new Map;class RedirectAction extends AbstractPopupRedirectOperation{constructor(e,o,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],o,void 0,s),this.eventId=null}async execute(){let e=redirectOutcomeMap.get(this.auth._key());if(!e){try{const s=await _getAndClearPendingRedirectStatus(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(o){e=()=>Promise.reject(o)}redirectOutcomeMap.set(this.auth._key(),e)}return this.bypassAuthState||redirectOutcomeMap.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const o=await this.auth._redirectUserForId(e.eventId);if(o)return this.user=o,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _getAndClearPendingRedirectStatus(n,e){const o=pendingRedirectKey(e),s=resolverPersistence(n);if(!await s._isAvailable())return!1;const c=await s._get(o)==="true";return await s._remove(o),c}function _overrideRedirectResult(n,e){redirectOutcomeMap.set(n._key(),e)}function resolverPersistence(n){return _getInstance(n._redirectPersistence)}function pendingRedirectKey(n){return _persistenceKeyName(PENDING_REDIRECT_KEY,n.config.apiKey,n.name)}async function _getRedirectResult(n,e,o=!1){const s=_castAuth(n),c=_withDefaultResolver(s,e),d=await new RedirectAction(s,c,o).execute();return d&&!o&&(delete d.user._redirectEventId,await s._persistUserIfCurrent(d.user),await s._setRedirectUser(null,e)),d}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EVENT_DUPLICATION_CACHE_DURATION_MS=10*60*1e3;class AuthEventManager{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let o=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(o=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!isRedirectEvent(e)||(this.hasHandledPotentialRedirect=!0,o||(this.queuedRedirectEvent=e,o=!0)),o}sendToConsumer(e,o){var s;if(e.error&&!isNullRedirectEvent(e)){const c=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";o.onError(_createError(this.auth,c))}else o.onAuthEvent(e)}isEventForConsumer(e,o){const s=o.eventId===null||!!e.eventId&&e.eventId===o.eventId;return o.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=EVENT_DUPLICATION_CACHE_DURATION_MS&&this.cachedEventUids.clear(),this.cachedEventUids.has(eventUid(e))}saveEventToCache(e){this.cachedEventUids.add(eventUid(e)),this.lastProcessedEventTime=Date.now()}}function eventUid(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function isNullRedirectEvent({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function isRedirectEvent(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return isNullRedirectEvent(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _getProjectConfig(n,e={}){return _performApiRequest(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP_ADDRESS_REGEX=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HTTP_REGEX=/^https?/;async function _validateOrigin(n){if(n.config.emulator)return;const{authorizedDomains:e}=await _getProjectConfig(n);for(const o of e)try{if(matchDomain(o))return}catch{}_fail(n,"unauthorized-domain")}function matchDomain(n){const e=_getCurrentUrl(),{protocol:o,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const d=new URL(n);return d.hostname===""&&s===""?o==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):o==="chrome-extension:"&&d.hostname===s}if(!HTTP_REGEX.test(o))return!1;if(IP_ADDRESS_REGEX.test(n))return s===n;const c=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NETWORK_TIMEOUT=new Delay(3e4,6e4);function resetUnloadedGapiModules(){const n=_window().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let o=0;o<n.CP.length;o++)n.CP[o]=null}}function loadGapi(n){return new Promise((e,o)=>{var s,c,u;function d(){resetUnloadedGapiModules(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{resetUnloadedGapiModules(),o(_createError(n,"network-request-failed"))},timeout:NETWORK_TIMEOUT.get()})}if(!((c=(s=_window().gapi)===null||s===void 0?void 0:s.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((u=_window().gapi)===null||u===void 0)&&u.load)d();else{const m=_generateCallbackName("iframefcb");return _window()[m]=()=>{gapi.load?d():o(_createError(n,"network-request-failed"))},_loadJS(`https://apis.google.com/js/api.js?onload=${m}`).catch(_=>o(_))}}).catch(e=>{throw cachedGApiLoader=null,e})}let cachedGApiLoader=null;function _loadGapi(n){return cachedGApiLoader=cachedGApiLoader||loadGapi(n),cachedGApiLoader}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PING_TIMEOUT=new Delay(5e3,15e3),IFRAME_PATH="__/auth/iframe",EMULATED_IFRAME_PATH="emulator/auth/iframe",IFRAME_ATTRIBUTES={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EID_FROM_APIHOST=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function getIframeUrl(n){const e=n.config;_assert(e.authDomain,n,"auth-domain-config-required");const o=e.emulator?_emulatorUrl(e,EMULATED_IFRAME_PATH):`https://${n.config.authDomain}/${IFRAME_PATH}`,s={apiKey:e.apiKey,appName:n.name,v:SDK_VERSION$1},c=EID_FROM_APIHOST.get(n.config.apiHost);c&&(s.eid=c);const u=n._getFrameworks();return u.length&&(s.fw=u.join(",")),`${o}?${querystring(s).slice(1)}`}async function _openIframe(n){const e=await _loadGapi(n),o=_window().gapi;return _assert(o,n,"internal-error"),e.open({where:document.body,url:getIframeUrl(n),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IFRAME_ATTRIBUTES,dontclear:!0},s=>new Promise(async(c,u)=>{await s.restyle({setHideOnLeave:!1});const d=_createError(n,"network-request-failed"),m=_window().setTimeout(()=>{u(d)},PING_TIMEOUT.get());function _(){_window().clearTimeout(m),c(s)}s.ping(_).then(_,()=>{u(d)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BASE_POPUP_OPTIONS={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DEFAULT_WIDTH=500,DEFAULT_HEIGHT=600,TARGET_BLANK="_blank",FIREFOX_EMPTY_URL="http://localhost";class AuthPopup{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _open(n,e,o,s=DEFAULT_WIDTH,c=DEFAULT_HEIGHT){const u=Math.max((window.screen.availHeight-c)/2,0).toString(),d=Math.max((window.screen.availWidth-s)/2,0).toString();let m="";const _=Object.assign(Object.assign({},BASE_POPUP_OPTIONS),{width:s.toString(),height:c.toString(),top:u,left:d}),ue=getUA().toLowerCase();o&&(m=_isChromeIOS(ue)?TARGET_BLANK:o),_isFirefox(ue)&&(e=e||FIREFOX_EMPTY_URL,_.scrollbars="yes");const gn=Object.entries(_).reduce((ih,[rh,oh])=>`${ih}${rh}=${oh},`,"");if(_isIOSStandalone(ue)&&m!=="_self")return openAsNewWindowIOS(e||"",m),new AuthPopup(null);const nh=window.open(e||"",m,gn);_assert(nh,n,"popup-blocked");try{nh.focus()}catch{}return new AuthPopup(nh)}function openAsNewWindowIOS(n,e){const o=document.createElement("a");o.href=n,o.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),o.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WIDGET_PATH="__/auth/handler",EMULATOR_WIDGET_PATH="emulator/auth/handler",FIREBASE_APP_CHECK_FRAGMENT_ID=encodeURIComponent("fac");async function _getRedirectUrl(n,e,o,s,c,u){_assert(n.config.authDomain,n,"auth-domain-config-required"),_assert(n.config.apiKey,n,"invalid-api-key");const d={apiKey:n.config.apiKey,appName:n.name,authType:o,redirectUrl:s,v:SDK_VERSION$1,eventId:c};if(e instanceof FederatedAuthProvider){e.setDefaultLanguage(n.languageCode),d.providerId=e.providerId||"",isEmpty(e.getCustomParameters())||(d.customParameters=JSON.stringify(e.getCustomParameters()));for(const[gn,nh]of Object.entries(u||{}))d[gn]=nh}if(e instanceof BaseOAuthProvider){const gn=e.getScopes().filter(nh=>nh!=="");gn.length>0&&(d.scopes=gn.join(","))}n.tenantId&&(d.tid=n.tenantId);const m=d;for(const gn of Object.keys(m))m[gn]===void 0&&delete m[gn];const _=await n._getAppCheckToken(),ue=_?`#${FIREBASE_APP_CHECK_FRAGMENT_ID}=${encodeURIComponent(_)}`:"";return`${getHandlerBase(n)}?${querystring(m).slice(1)}${ue}`}function getHandlerBase({config:n}){return n.emulator?_emulatorUrl(n,EMULATOR_WIDGET_PATH):`https://${n.authDomain}/${WIDGET_PATH}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEB_STORAGE_SUPPORT_KEY="webStorageSupport";class BrowserPopupRedirectResolver{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=browserSessionPersistence,this._completeRedirectFn=_getRedirectResult,this._overrideRedirectResult=_overrideRedirectResult}async _openPopup(e,o,s,c){var u;debugAssert((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const d=await _getRedirectUrl(e,o,s,_getCurrentUrl(),c);return _open(e,d,_generateEventId())}async _openRedirect(e,o,s,c){await this._originValidation(e);const u=await _getRedirectUrl(e,o,s,_getCurrentUrl(),c);return _setWindowLocation(u),new Promise(()=>{})}_initialize(e){const o=e._key();if(this.eventManagers[o]){const{manager:c,promise:u}=this.eventManagers[o];return c?Promise.resolve(c):(debugAssert(u,"If manager is not set, promise should be"),u)}const s=this.initAndGetManager(e);return this.eventManagers[o]={promise:s},s.catch(()=>{delete this.eventManagers[o]}),s}async initAndGetManager(e){const o=await _openIframe(e),s=new AuthEventManager(e);return o.register("authEvent",c=>(_assert(c==null?void 0:c.authEvent,e,"invalid-auth-event"),{status:s.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=o,s}_isIframeWebStorageSupported(e,o){this.iframes[e._key()].send(WEB_STORAGE_SUPPORT_KEY,{type:WEB_STORAGE_SUPPORT_KEY},c=>{var u;const d=(u=c==null?void 0:c[0])===null||u===void 0?void 0:u[WEB_STORAGE_SUPPORT_KEY];d!==void 0&&o(!!d),_fail(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const o=e._key();return this.originValidationPromises[o]||(this.originValidationPromises[o]=_validateOrigin(e)),this.originValidationPromises[o]}get _shouldInitProactively(){return _isMobileBrowser()||_isSafari()||_isIOS()}}const browserPopupRedirectResolver=BrowserPopupRedirectResolver;var name$2="@firebase/auth",version$2="0.23.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthInterop{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const o=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,o),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const o=this.internalListeners.get(e);o&&(this.internalListeners.delete(e),o(),this.updateProactiveRefresh())}assertAuthConfigured(){_assert(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getVersionForPlatform(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function registerAuth(n){_registerComponent(new Component("auth",(e,{options:o})=>{const s=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:d,authDomain:m}=s.options;_assert(d&&!d.includes(":"),"invalid-api-key",{appName:s.name});const _={apiKey:d,authDomain:m,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_getClientVersion(n)},ue=new AuthImpl(s,c,u,_);return _initializeAuthInstance(ue,o),ue},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,o,s)=>{e.getProvider("auth-internal").initialize()})),_registerComponent(new Component("auth-internal",e=>{const o=_castAuth(e.getProvider("auth").getImmediate());return(s=>new AuthInterop(s))(o)},"PRIVATE").setInstantiationMode("EXPLICIT")),registerVersion(name$2,version$2,getVersionForPlatform(n)),registerVersion(name$2,version$2,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ID_TOKEN_MAX_AGE=5*60,authIdTokenMaxAge=getExperimentalSetting("authIdTokenMaxAge")||DEFAULT_ID_TOKEN_MAX_AGE;let lastPostedIdToken=null;const mintCookieFactory=n=>async e=>{const o=e&&await e.getIdTokenResult(),s=o&&(new Date().getTime()-Date.parse(o.issuedAtTime))/1e3;if(s&&s>authIdTokenMaxAge)return;const c=o==null?void 0:o.token;lastPostedIdToken!==c&&(lastPostedIdToken=c,await fetch(n,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function getAuth(n=getApp()){const e=_getProvider(n,"auth");if(e.isInitialized())return e.getImmediate();const o=initializeAuth(n,{popupRedirectResolver:browserPopupRedirectResolver,persistence:[indexedDBLocalPersistence,browserLocalPersistence,browserSessionPersistence]}),s=getExperimentalSetting("authTokenSyncURL");if(s){const u=mintCookieFactory(s);beforeAuthStateChanged(o,u,()=>u(o.currentUser)),onIdTokenChanged(o,d=>u(d))}const c=getDefaultEmulatorHost("auth");return c&&connectAuthEmulator(o,`http://${c}`),o}registerAuth("Browser");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const APP_CHECK_STATES=new Map,DEFAULT_STATE={activated:!1,tokenObservers:[]};function getStateReference(n){return APP_CHECK_STATES.get(n)||Object.assign({},DEFAULT_STATE)}const TOKEN_REFRESH_TIME={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Refresher{constructor(e,o,s,c,u){if(this.operation=e,this.retryPolicy=o,this.getWaitDuration=s,this.lowerBound=c,this.upperBound=u,this.pending=null,this.nextErrorWaitInterval=c,c>u)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Deferred,await sleep(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new Deferred,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(o){this.retryPolicy(o)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const o=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),o}}}function sleep(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={["already-initialized"]:"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.",["use-before-activation"]:"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.",["fetch-network-error"]:"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-parse-error"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status-error"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["recaptcha-error"]:"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},ERROR_FACTORY=new ErrorFactory("appCheck","AppCheck",ERRORS);function ensureActivated(n){if(!getStateReference(n).activated)throw ERROR_FACTORY.create("use-before-activation",{appName:n.name})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebase-app-check-database",DB_VERSION=1,STORE_NAME="firebase-app-check-store";let dbPromise=null;function getDBPromise(){return dbPromise||(dbPromise=new Promise((n,e)=>{try{const o=indexedDB.open(DB_NAME,DB_VERSION);o.onsuccess=s=>{n(s.target.result)},o.onerror=s=>{var c;e(ERROR_FACTORY.create("storage-open",{originalErrorMessage:(c=s.target.error)===null||c===void 0?void 0:c.message}))},o.onupgradeneeded=s=>{const c=s.target.result;switch(s.oldVersion){case 0:c.createObjectStore(STORE_NAME,{keyPath:"compositeKey"})}}}catch(o){e(ERROR_FACTORY.create("storage-open",{originalErrorMessage:o==null?void 0:o.message}))}}),dbPromise)}function writeTokenToIndexedDB(n,e){return write(computeKey(n),e)}async function write(n,e){const s=(await getDBPromise()).transaction(STORE_NAME,"readwrite"),u=s.objectStore(STORE_NAME).put({compositeKey:n,value:e});return new Promise((d,m)=>{u.onsuccess=_=>{d()},s.onerror=_=>{var ue;m(ERROR_FACTORY.create("storage-set",{originalErrorMessage:(ue=_.target.error)===null||ue===void 0?void 0:ue.message}))}})}function computeKey(n){return`${n.options.appId}-${n.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger=new Logger("@firebase/app-check");function writeTokenToStorage(n,e){return isIndexedDBAvailable()?writeTokenToIndexedDB(n,e).catch(o=>{logger.warn(`Failed to write token to IndexedDB. Error: ${o}`)}):Promise.resolve()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const defaultTokenErrorData={error:"UNKNOWN_ERROR"};function formatDummyToken(n){return base64.encodeString(JSON.stringify(n),!1)}async function getToken$2(n,e=!1){const o=n.app;ensureActivated(o);const s=getStateReference(o);let c=s.token,u;if(c&&!isValid(c)&&(s.token=void 0,c=void 0),!c){const _=await s.cachedTokenPromise;_&&(isValid(_)?c=_:await writeTokenToStorage(o,void 0))}if(!e&&c&&isValid(c))return{token:c.token};let d=!1;try{s.exchangeTokenPromise||(s.exchangeTokenPromise=s.provider.getToken().finally(()=>{s.exchangeTokenPromise=void 0}),d=!0),c=await getStateReference(o).exchangeTokenPromise}catch(_){_.code==="appCheck/throttled"?logger.warn(_.message):logger.error(_),u=_}let m;return c?u?isValid(c)?m={token:c.token,internalError:u}:m=makeDummyTokenResult(u):(m={token:c.token},s.token=c,await writeTokenToStorage(o,c)):m=makeDummyTokenResult(u),d&&notifyTokenListeners(o,m),m}async function getLimitedUseToken$1(n){const e=n.app;ensureActivated(e);const{provider:o}=getStateReference(e);{const{token:s}=await o.getToken();return{token:s}}}function addTokenListener(n,e,o,s){const{app:c}=n,u=getStateReference(c),d={next:o,error:s,type:e};if(u.tokenObservers=[...u.tokenObservers,d],u.token&&isValid(u.token)){const m=u.token;Promise.resolve().then(()=>{o({token:m.token}),initTokenRefresher(n)}).catch(()=>{})}u.cachedTokenPromise.then(()=>initTokenRefresher(n))}function removeTokenListener(n,e){const o=getStateReference(n),s=o.tokenObservers.filter(c=>c.next!==e);s.length===0&&o.tokenRefresher&&o.tokenRefresher.isRunning()&&o.tokenRefresher.stop(),o.tokenObservers=s}function initTokenRefresher(n){const{app:e}=n,o=getStateReference(e);let s=o.tokenRefresher;s||(s=createTokenRefresher(n),o.tokenRefresher=s),!s.isRunning()&&o.isTokenAutoRefreshEnabled&&s.start()}function createTokenRefresher(n){const{app:e}=n;return new Refresher(async()=>{const o=getStateReference(e);let s;if(o.token?s=await getToken$2(n,!0):s=await getToken$2(n),s.error)throw s.error;if(s.internalError)throw s.internalError},()=>!0,()=>{const o=getStateReference(e);if(o.token){let s=o.token.issuedAtTimeMillis+(o.token.expireTimeMillis-o.token.issuedAtTimeMillis)*.5+3e5;const c=o.token.expireTimeMillis-5*60*1e3;return s=Math.min(s,c),Math.max(0,s-Date.now())}else return 0},TOKEN_REFRESH_TIME.RETRIAL_MIN_WAIT,TOKEN_REFRESH_TIME.RETRIAL_MAX_WAIT)}function notifyTokenListeners(n,e){const o=getStateReference(n).tokenObservers;for(const s of o)try{s.type==="EXTERNAL"&&e.error!=null?s.error(e.error):s.next(e)}catch{}}function isValid(n){return n.expireTimeMillis-Date.now()>0}function makeDummyTokenResult(n){return{token:formatDummyToken(defaultTokenErrorData),error:n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AppCheckService{constructor(e,o){this.app=e,this.heartbeatServiceProvider=o}_delete(){const{tokenObservers:e}=getStateReference(this.app);for(const o of e)removeTokenListener(this.app,o.next);return Promise.resolve()}}function factory$1(n,e){return new AppCheckService(n,e)}function internalFactory(n){return{getToken:e=>getToken$2(n,e),getLimitedUseToken:()=>getLimitedUseToken$1(n),addTokenListener:e=>addTokenListener(n,"INTERNAL",e),removeTokenListener:e=>removeTokenListener(n.app,e)}}const name$1="@firebase/app-check",version$1="0.8.0",APP_CHECK_NAME="app-check",APP_CHECK_NAME_INTERNAL="app-check-internal";function registerAppCheck(){_registerComponent(new Component(APP_CHECK_NAME,n=>{const e=n.getProvider("app").getImmediate(),o=n.getProvider("heartbeat");return factory$1(e,o)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,o)=>{n.getProvider(APP_CHECK_NAME_INTERNAL).initialize()})),_registerComponent(new Component(APP_CHECK_NAME_INTERNAL,n=>{const e=n.getProvider("app-check").getImmediate();return internalFactory(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),registerVersion(name$1,version$1)}registerAppCheck();const _FirebaseAppInjectionKey=Symbol("firebaseApp");function useFirebaseApp(n){return getCurrentInstance()&&inject(_FirebaseAppInjectionKey,null)||getApp(n)}const noop$1=()=>{};function isObject(n){return!!n&&typeof n=="object"}function isDocumentRef(n){return isObject(n)&&n.type==="document"}function isCollectionRef(n){return isObject(n)&&n.type==="collection"}function isFirestoreDataReference(n){return isDocumentRef(n)||isCollectionRef(n)}function isFirestoreQuery(n){return isObject(n)&&n.type==="query"}function isDatabaseReference(n){return isObject(n)&&"ref"in n}function isStorageReference(n){return isObject(n)&&typeof n.bucket=="string"}function isSSR(){return!!(getCurrentInstance()&&inject(ssrContextKey,null))}const scopeMap=new WeakMap;function getGlobalScope(n,e){if(!scopeMap.has(n)){const o=effectScope(!0);scopeMap.set(n,o);const{unmount:s}=e;e.unmount=()=>{s.call(e),o.stop(),scopeMap.delete(n)}}return scopeMap.get(n)}const authUserMap=new WeakMap;function useCurrentUser(n){return authUserMap.get(useFirebaseApp(n))}const initialUserMap=new WeakMap;function _getCurrentUserState(n){const e=useFirebaseApp(n);if(!initialUserMap.has(e)){let o;const c=[new Promise(u=>{o=u}),u=>{initialUserMap.set(e,u),o(u.value)}];initialUserMap.set(e,c)}return initialUserMap.get(e)}function getCurrentUser(n){const e=_getCurrentUserState(n);return Array.isArray(e)?e[0]:Promise.resolve(e.value)}function setupOnAuthStateChanged(n,e){const o=getAuth(e);onIdTokenChanged(o,s=>{const c=_getCurrentUserState();n.value=s,Array.isArray(c)&&c[1](n)})}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},k$1,goog=goog||{},l=commonjsGlobal||self;function aa$1(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function p(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function ba$1(n){return Object.prototype.hasOwnProperty.call(n,ca$1)&&n[ca$1]||(n[ca$1]=++da$1)}var ca$1="closure_uid_"+(1e9*Math.random()>>>0),da$1=0;function ea$1(n,e,o){return n.call.apply(n.bind,arguments)}function fa$1(n,e,o){if(!n)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,s),n.apply(e,c)}}return function(){return n.apply(e,arguments)}}function q$2(n,e,o){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?q$2=ea$1:q$2=fa$1,q$2.apply(null,arguments)}function ha$1(n,e){var o=Array.prototype.slice.call(arguments,1);return function(){var s=o.slice();return s.push.apply(s,arguments),n.apply(this,s)}}function r(n,e){function o(){}o.prototype=e.prototype,n.$=e.prototype,n.prototype=new o,n.prototype.constructor=n,n.ac=function(s,c,u){for(var d=Array(arguments.length-2),m=2;m<arguments.length;m++)d[m-2]=arguments[m];return e.prototype[c].apply(s,d)}}function v(){this.s=this.s,this.o=this.o}var ia$1=0;v.prototype.s=!1;v.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),ia$1!=0)&&ba$1(this)};v.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ka$1=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let o=0;o<n.length;o++)if(o in n&&n[o]===e)return o;return-1};function ma$1(n){const e=n.length;if(0<e){const o=Array(e);for(let s=0;s<e;s++)o[s]=n[s];return o}return[]}function na$1(n,e){for(let o=1;o<arguments.length;o++){const s=arguments[o];if(aa$1(s)){const c=n.length||0,u=s.length||0;n.length=c+u;for(let d=0;d<u;d++)n[c+d]=s[d]}else n.push(s)}}function w$1(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}w$1.prototype.h=function(){this.defaultPrevented=!0};var oa$1=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{l.addEventListener("test",()=>{},e),l.removeEventListener("test",()=>{},e)}catch{}return n}();function x(n){return/^[\s\xa0]*$/.test(n)}function pa$1(){var n=l.navigator;return n&&(n=n.userAgent)?n:""}function y(n){return pa$1().indexOf(n)!=-1}function qa$1(n){return qa$1[" "](n),n}qa$1[" "]=function(){};function ra$1(n,e){var o=sa$1;return Object.prototype.hasOwnProperty.call(o,n)?o[n]:o[n]=e(n)}var ta$1=y("Opera"),z$2=y("Trident")||y("MSIE"),ua$1=y("Edge"),va$1=ua$1||z$2,wa$1=y("Gecko")&&!(pa$1().toLowerCase().indexOf("webkit")!=-1&&!y("Edge"))&&!(y("Trident")||y("MSIE"))&&!y("Edge"),xa$2=pa$1().toLowerCase().indexOf("webkit")!=-1&&!y("Edge");function ya$1(){var n=l.document;return n?n.documentMode:void 0}e:{var Aa$1="",Ba$1=function(){var n=pa$1();if(wa$1)return/rv:([^\);]+)(\)|;)/.exec(n);if(ua$1)return/Edge\/([\d\.]+)/.exec(n);if(z$2)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(xa$2)return/WebKit\/(\S+)/.exec(n);if(ta$1)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(Ba$1&&(Aa$1=Ba$1?Ba$1[1]:""),z$2){var Ca$1=ya$1();if(Ca$1!=null&&Ca$1>parseFloat(Aa$1))break e}}l.document&&z$2&&ya$1();function A$1(n,e){if(w$1.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var o=this.type=n.type,s=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(wa$1){e:{try{qa$1(e.nodeName);var c=!0;break e}catch{}c=!1}c||(e=null)}}else o=="mouseover"?e=n.fromElement:o=="mouseout"&&(e=n.toElement);this.relatedTarget=e,s?(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:Ga$1[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&A$1.$.h.call(this)}}r(A$1,w$1);var Ga$1={2:"touch",3:"pen",4:"mouse"};A$1.prototype.h=function(){A$1.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Ha$1="closure_listenable_"+(1e6*Math.random()|0),Ia$1=0;function Ja$1(n,e,o,s,c){this.listener=n,this.proxy=null,this.src=e,this.type=o,this.capture=!!s,this.la=c,this.key=++Ia$1,this.fa=this.ia=!1}function Ka$1(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Na$1(n,e,o){for(const s in n)e.call(o,n[s],s,n)}function Oa$1(n,e){for(const o in n)e.call(void 0,n[o],o,n)}function Pa$1(n){const e={};for(const o in n)e[o]=n[o];return e}const Qa$1="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ra$1(n,e){let o,s;for(let c=1;c<arguments.length;c++){s=arguments[c];for(o in s)n[o]=s[o];for(let u=0;u<Qa$1.length;u++)o=Qa$1[u],Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])}}function Sa$1(n){this.src=n,this.g={},this.h=0}Sa$1.prototype.add=function(n,e,o,s,c){var u=n.toString();n=this.g[u],n||(n=this.g[u]=[],this.h++);var d=Ta$1(n,e,s,c);return-1<d?(e=n[d],o||(e.ia=!1)):(e=new Ja$1(e,this.src,u,!!s,c),e.ia=o,n.push(e)),e};function Ua$1(n,e){var o=e.type;if(o in n.g){var s=n.g[o],c=ka$1(s,e),u;(u=0<=c)&&Array.prototype.splice.call(s,c,1),u&&(Ka$1(e),n.g[o].length==0&&(delete n.g[o],n.h--))}}function Ta$1(n,e,o,s){for(var c=0;c<n.length;++c){var u=n[c];if(!u.fa&&u.listener==e&&u.capture==!!o&&u.la==s)return c}return-1}var Va$1="closure_lm_"+(1e6*Math.random()|0),Wa$1={};function Ya$1(n,e,o,s,c){if(s&&s.once)return Za$1(n,e,o,s,c);if(Array.isArray(e)){for(var u=0;u<e.length;u++)Ya$1(n,e[u],o,s,c);return null}return o=$a$1(o),n&&n[Ha$1]?n.O(e,o,p(s)?!!s.capture:!!s,c):ab(n,e,o,!1,s,c)}function ab(n,e,o,s,c,u){if(!e)throw Error("Invalid event type");var d=p(c)?!!c.capture:!!c,m=bb(n);if(m||(n[Va$1]=m=new Sa$1(n)),o=m.add(e,o,s,d,u),o.proxy)return o;if(s=cb(),o.proxy=s,s.src=n,s.listener=o,n.addEventListener)oa$1||(c=d),c===void 0&&(c=!1),n.addEventListener(e.toString(),s,c);else if(n.attachEvent)n.attachEvent(db(e.toString()),s);else if(n.addListener&&n.removeListener)n.addListener(s);else throw Error("addEventListener and attachEvent are unavailable.");return o}function cb(){function n(o){return e.call(n.src,n.listener,o)}const e=eb;return n}function Za$1(n,e,o,s,c){if(Array.isArray(e)){for(var u=0;u<e.length;u++)Za$1(n,e[u],o,s,c);return null}return o=$a$1(o),n&&n[Ha$1]?n.P(e,o,p(s)?!!s.capture:!!s,c):ab(n,e,o,!0,s,c)}function fb(n,e,o,s,c){if(Array.isArray(e))for(var u=0;u<e.length;u++)fb(n,e[u],o,s,c);else s=p(s)?!!s.capture:!!s,o=$a$1(o),n&&n[Ha$1]?(n=n.i,e=String(e).toString(),e in n.g&&(u=n.g[e],o=Ta$1(u,o,s,c),-1<o&&(Ka$1(u[o]),Array.prototype.splice.call(u,o,1),u.length==0&&(delete n.g[e],n.h--)))):n&&(n=bb(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ta$1(e,o,s,c)),(o=-1<n?e[n]:null)&&gb(o))}function gb(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[Ha$1])Ua$1(e.i,n);else{var o=n.type,s=n.proxy;e.removeEventListener?e.removeEventListener(o,s,n.capture):e.detachEvent?e.detachEvent(db(o),s):e.addListener&&e.removeListener&&e.removeListener(s),(o=bb(e))?(Ua$1(o,n),o.h==0&&(o.src=null,e[Va$1]=null)):Ka$1(n)}}}function db(n){return n in Wa$1?Wa$1[n]:Wa$1[n]="on"+n}function eb(n,e){if(n.fa)n=!0;else{e=new A$1(e,this);var o=n.listener,s=n.la||n.src;n.ia&&gb(n),n=o.call(s,e)}return n}function bb(n){return n=n[Va$1],n instanceof Sa$1?n:null}var hb="__closure_events_fn_"+(1e9*Math.random()>>>0);function $a$1(n){return typeof n=="function"?n:(n[hb]||(n[hb]=function(e){return n.handleEvent(e)}),n[hb])}function B$2(){v.call(this),this.i=new Sa$1(this),this.S=this,this.J=null}r(B$2,v);B$2.prototype[Ha$1]=!0;B$2.prototype.removeEventListener=function(n,e,o,s){fb(this,n,e,o,s)};function C$1(n,e){var o,s=n.J;if(s)for(o=[];s;s=s.J)o.push(s);if(n=n.S,s=e.type||e,typeof e=="string")e=new w$1(e,n);else if(e instanceof w$1)e.target=e.target||n;else{var c=e;e=new w$1(s,n),Ra$1(e,c)}if(c=!0,o)for(var u=o.length-1;0<=u;u--){var d=e.g=o[u];c=ib(d,s,!0,e)&&c}if(d=e.g=n,c=ib(d,s,!0,e)&&c,c=ib(d,s,!1,e)&&c,o)for(u=0;u<o.length;u++)d=e.g=o[u],c=ib(d,s,!1,e)&&c}B$2.prototype.N=function(){if(B$2.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var o=n.g[e],s=0;s<o.length;s++)Ka$1(o[s]);delete n.g[e],n.h--}}this.J=null};B$2.prototype.O=function(n,e,o,s){return this.i.add(String(n),e,!1,o,s)};B$2.prototype.P=function(n,e,o,s){return this.i.add(String(n),e,!0,o,s)};function ib(n,e,o,s){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var c=!0,u=0;u<e.length;++u){var d=e[u];if(d&&!d.fa&&d.capture==o){var m=d.listener,_=d.la||d.src;d.ia&&Ua$1(n.i,d),c=m.call(_,s)!==!1&&c}}return c&&!s.defaultPrevented}var jb=l.JSON.stringify;class kb{constructor(e,o){this.i=e,this.j=o,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function lb(){var n=mb;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class nb{constructor(){this.h=this.g=null}add(e,o){const s=ob.get();s.set(e,o),this.h?this.h.next=s:this.g=s,this.h=s}}var ob=new kb(()=>new pb,n=>n.reset());class pb{constructor(){this.next=this.g=this.h=null}set(e,o){this.h=e,this.g=o,this.next=null}reset(){this.next=this.g=this.h=null}}function qb(n){var e=1;n=n.split(":");const o=[];for(;0<e&&n.length;)o.push(n.shift()),e--;return n.length&&o.push(n.join(":")),o}function rb(n){l.setTimeout(()=>{throw n},0)}let sb,tb=!1,mb=new nb,vb=()=>{const n=l.Promise.resolve(void 0);sb=()=>{n.then(ub)}};var ub=()=>{for(var n;n=lb();){try{n.h.call(n.g)}catch(o){rb(o)}var e=ob;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}tb=!1};function wb(n,e){B$2.call(this),this.h=n||1,this.g=e||l,this.j=q$2(this.qb,this),this.l=Date.now()}r(wb,B$2);k$1=wb.prototype;k$1.ga=!1;k$1.T=null;k$1.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),C$1(this,"tick"),this.ga&&(xb(this),this.start()))}};k$1.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function xb(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}k$1.N=function(){wb.$.N.call(this),xb(this),delete this.g};function yb(n,e,o){if(typeof n=="function")o&&(n=q$2(n,o));else if(n&&typeof n.handleEvent=="function")n=q$2(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:l.setTimeout(n,e||0)}function zb(n){n.g=yb(()=>{n.g=null,n.i&&(n.i=!1,zb(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class Ab extends v{constructor(e,o){super(),this.m=e,this.j=o,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:zb(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Bb(n){v.call(this),this.h=n,this.g={}}r(Bb,v);var Cb=[];function Db(n,e,o,s){Array.isArray(o)||(o&&(Cb[0]=o.toString()),o=Cb);for(var c=0;c<o.length;c++){var u=Ya$1(e,o[c],s||n.handleEvent,!1,n.h||n);if(!u)break;n.g[u.key]=u}}function Fb(n){Na$1(n.g,function(e,o){this.g.hasOwnProperty(o)&&gb(e)},n),n.g={}}Bb.prototype.N=function(){Bb.$.N.call(this),Fb(this)};Bb.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Gb(){this.g=!0}Gb.prototype.Ea=function(){this.g=!1};function Hb(n,e,o,s,c,u){n.info(function(){if(n.g)if(u)for(var d="",m=u.split("&"),_=0;_<m.length;_++){var ue=m[_].split("=");if(1<ue.length){var gn=ue[0];ue=ue[1];var nh=gn.split("_");d=2<=nh.length&&nh[1]=="type"?d+(gn+"="+ue+"&"):d+(gn+"=redacted&")}}else d=null;else d=u;return"XMLHTTP REQ ("+s+") [attempt "+c+"]: "+e+`
`+o+`
`+d})}function Ib(n,e,o,s,c,u,d){n.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+c+"]: "+e+`
`+o+`
`+u+" "+d})}function D$2(n,e,o,s){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+Jb(n,o)+(s?" "+s:"")})}function Kb(n,e){n.info(function(){return"TIMEOUT: "+e})}Gb.prototype.info=function(){};function Jb(n,e){if(!n.g)return e;if(!e)return null;try{var o=JSON.parse(e);if(o){for(n=0;n<o.length;n++)if(Array.isArray(o[n])){var s=o[n];if(!(2>s.length)){var c=s[1];if(Array.isArray(c)&&!(1>c.length)){var u=c[0];if(u!="noop"&&u!="stop"&&u!="close")for(var d=1;d<c.length;d++)c[d]=""}}}}return jb(o)}catch{return e}}var E$2={},Lb=null;function Mb(){return Lb=Lb||new B$2}E$2.Ta="serverreachability";function Nb(n){w$1.call(this,E$2.Ta,n)}r(Nb,w$1);function Ob(n){const e=Mb();C$1(e,new Nb(e))}E$2.STAT_EVENT="statevent";function Pb(n,e){w$1.call(this,E$2.STAT_EVENT,n),this.stat=e}r(Pb,w$1);function F$2(n){const e=Mb();C$1(e,new Pb(e,n))}E$2.Ua="timingevent";function Qb(n,e){w$1.call(this,E$2.Ua,n),this.size=e}r(Qb,w$1);function Rb(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){n()},e)}var Sb={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Tb={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ub(){}Ub.prototype.h=null;function Vb(n){return n.h||(n.h=n.i())}function Wb(){}var Xb={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Yb(){w$1.call(this,"d")}r(Yb,w$1);function Zb(){w$1.call(this,"c")}r(Zb,w$1);var $b;function ac$1(){}r(ac$1,Ub);ac$1.prototype.g=function(){return new XMLHttpRequest};ac$1.prototype.i=function(){return{}};$b=new ac$1;function bc$1(n,e,o,s){this.l=n,this.j=e,this.m=o,this.W=s||1,this.U=new Bb(this),this.P=cc$1,n=va$1?125:void 0,this.V=new wb(n),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new dc$1}function dc$1(){this.i=null,this.g="",this.h=!1}var cc$1=45e3,ec$1={},fc$1={};k$1=bc$1.prototype;k$1.setTimeout=function(n){this.P=n};function gc$1(n,e,o){n.L=1,n.v=hc$1(G$2(e)),n.s=o,n.S=!0,ic$1(n,null)}function ic$1(n,e){n.G=Date.now(),jc$1(n),n.A=G$2(n.v);var o=n.A,s=n.W;Array.isArray(s)||(s=[String(s)]),kc$1(o.i,"t",s),n.C=0,o=n.l.J,n.h=new dc$1,n.g=lc$1(n.l,o?e:null,!n.s),0<n.O&&(n.M=new Ab(q$2(n.Pa,n,n.g),n.O)),Db(n.U,n.g,"readystatechange",n.nb),e=n.I?Pa$1(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),Ob(),Hb(n.j,n.u,n.A,n.m,n.W,n.s)}k$1.nb=function(n){n=n.target;const e=this.M;e&&H$1(n)==3?e.l():this.Pa(n)};k$1.Pa=function(n){try{if(n==this.g)e:{const gn=H$1(this.g);var e=this.g.Ia();const nh=this.g.da();if(!(3>gn)&&(gn!=3||va$1||this.g&&(this.h.h||this.g.ja()||mc$1(this.g)))){this.J||gn!=4||e==7||(e==8||0>=nh?Ob(3):Ob(2)),nc$1(this);var o=this.g.da();this.ca=o;t:if(oc$1(this)){var s=mc$1(this.g);n="";var c=s.length,u=H$1(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){I(this),pc$1(this);var d="";break t}this.h.i=new l.TextDecoder}for(e=0;e<c;e++)this.h.h=!0,n+=this.h.i.decode(s[e],{stream:u&&e==c-1});s.splice(0,c),this.h.g+=n,this.C=0,d=this.h.g}else d=this.g.ja();if(this.i=o==200,Ib(this.j,this.u,this.A,this.m,this.W,gn,o),this.i){if(this.aa&&!this.K){t:{if(this.g){var m,_=this.g;if((m=_.g?_.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(m)){var ue=m;break t}}ue=null}if(o=ue)D$2(this.j,this.m,o,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qc$1(this,o);else{this.i=!1,this.o=3,F$2(12),I(this),pc$1(this);break e}}this.S?(rc$1(this,gn,d),va$1&&this.i&&gn==3&&(Db(this.U,this.V,"tick",this.mb),this.V.start())):(D$2(this.j,this.m,d,null),qc$1(this,d)),gn==4&&I(this),this.i&&!this.J&&(gn==4?sc$1(this.l,this):(this.i=!1,jc$1(this)))}else tc$1(this.g),o==400&&0<d.indexOf("Unknown SID")?(this.o=3,F$2(12)):(this.o=0,F$2(13)),I(this),pc$1(this)}}}catch{}finally{}};function oc$1(n){return n.g?n.u=="GET"&&n.L!=2&&n.l.Ha:!1}function rc$1(n,e,o){let s=!0,c;for(;!n.J&&n.C<o.length;)if(c=uc$1(n,o),c==fc$1){e==4&&(n.o=4,F$2(14),s=!1),D$2(n.j,n.m,null,"[Incomplete Response]");break}else if(c==ec$1){n.o=4,F$2(15),D$2(n.j,n.m,o,"[Invalid Chunk]"),s=!1;break}else D$2(n.j,n.m,c,null),qc$1(n,c);oc$1(n)&&c!=fc$1&&c!=ec$1&&(n.h.g="",n.C=0),e!=4||o.length!=0||n.h.h||(n.o=1,F$2(16),s=!1),n.i=n.i&&s,s?0<o.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+o.length),vc$1(e),e.M=!0,F$2(11))):(D$2(n.j,n.m,o,"[Invalid Chunked Response]"),I(n),pc$1(n))}k$1.mb=function(){if(this.g){var n=H$1(this.g),e=this.g.ja();this.C<e.length&&(nc$1(this),rc$1(this,n,e),this.i&&n!=4&&jc$1(this))}};function uc$1(n,e){var o=n.C,s=e.indexOf(`
`,o);return s==-1?fc$1:(o=Number(e.substring(o,s)),isNaN(o)?ec$1:(s+=1,s+o>e.length?fc$1:(e=e.slice(s,s+o),n.C=s+o,e)))}k$1.cancel=function(){this.J=!0,I(this)};function jc$1(n){n.Y=Date.now()+n.P,wc$1(n,n.P)}function wc$1(n,e){if(n.B!=null)throw Error("WatchDog timer not null");n.B=Rb(q$2(n.lb,n),e)}function nc$1(n){n.B&&(l.clearTimeout(n.B),n.B=null)}k$1.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(Kb(this.j,this.A),this.L!=2&&(Ob(),F$2(17)),I(this),this.o=2,pc$1(this)):wc$1(this,this.Y-n)};function pc$1(n){n.l.H==0||n.J||sc$1(n.l,n)}function I(n){nc$1(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,xb(n.V),Fb(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function qc$1(n,e){try{var o=n.l;if(o.H!=0&&(o.g==n||xc$1(o.i,n))){if(!n.K&&xc$1(o.i,n)&&o.H==3){try{var s=o.Ja.g.parse(e)}catch{s=null}if(Array.isArray(s)&&s.length==3){var c=s;if(c[0]==0){e:if(!o.u){if(o.g)if(o.g.G+3e3<n.G)yc$1(o),zc$1(o);else break e;Ac$1(o),F$2(18)}}else o.Fa=c[1],0<o.Fa-o.V&&37500>c[2]&&o.G&&o.A==0&&!o.v&&(o.v=Rb(q$2(o.ib,o),6e3));if(1>=Bc$1(o.i)&&o.oa){try{o.oa()}catch{}o.oa=void 0}}else J$4(o,11)}else if((n.K||o.g==n)&&yc$1(o),!x(e))for(c=o.Ja.g.parse(e),e=0;e<c.length;e++){let ue=c[e];if(o.V=ue[0],ue=ue[1],o.H==2)if(ue[0]=="c"){o.K=ue[1],o.pa=ue[2];const gn=ue[3];gn!=null&&(o.ra=gn,o.l.info("VER="+o.ra));const nh=ue[4];nh!=null&&(o.Ga=nh,o.l.info("SVER="+o.Ga));const ih=ue[5];ih!=null&&typeof ih=="number"&&0<ih&&(s=1.5*ih,o.L=s,o.l.info("backChannelRequestTimeoutMs_="+s)),s=o;const rh=n.g;if(rh){const oh=rh.g?rh.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(oh){var u=s.i;u.g||oh.indexOf("spdy")==-1&&oh.indexOf("quic")==-1&&oh.indexOf("h2")==-1||(u.j=u.l,u.g=new Set,u.h&&(Cc$1(u,u.h),u.h=null))}if(s.F){const lh=rh.g?rh.g.getResponseHeader("X-HTTP-Session-Id"):null;lh&&(s.Da=lh,K$3(s.I,s.F,lh))}}o.H=3,o.h&&o.h.Ba(),o.ca&&(o.S=Date.now()-n.G,o.l.info("Handshake RTT: "+o.S+"ms")),s=o;var d=n;if(s.wa=Dc$1(s,s.J?s.pa:null,s.Y),d.K){Ec$2(s.i,d);var m=d,_=s.L;_&&m.setTimeout(_),m.B&&(nc$1(m),jc$1(m)),s.g=d}else Fc$1(s);0<o.j.length&&Gc$1(o)}else ue[0]!="stop"&&ue[0]!="close"||J$4(o,7);else o.H==3&&(ue[0]=="stop"||ue[0]=="close"?ue[0]=="stop"?J$4(o,7):Hc$1(o):ue[0]!="noop"&&o.h&&o.h.Aa(ue),o.A=0)}}Ob(4)}catch{}}function Ic$1(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(aa$1(n)){for(var e=[],o=n.length,s=0;s<o;s++)e.push(n[s]);return e}e=[],o=0;for(s in n)e[o++]=n[s];return e}function Jc$1(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(aa$1(n)||typeof n=="string"){var e=[];n=n.length;for(var o=0;o<n;o++)e.push(o);return e}e=[],o=0;for(const s in n)e[o++]=s;return e}}}function Kc$1(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(aa$1(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var o=Jc$1(n),s=Ic$1(n),c=s.length,u=0;u<c;u++)e.call(void 0,s[u],o&&o[u],n)}var Lc$1=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Mc$1(n,e){if(n){n=n.split("&");for(var o=0;o<n.length;o++){var s=n[o].indexOf("="),c=null;if(0<=s){var u=n[o].substring(0,s);c=n[o].substring(s+1)}else u=n[o];e(u,c?decodeURIComponent(c.replace(/\+/g," ")):"")}}}function M$1(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof M$1){this.h=n.h,Nc$1(this,n.j),this.s=n.s,this.g=n.g,Oc$1(this,n.m),this.l=n.l;var e=n.i,o=new Pc$1;o.i=e.i,e.g&&(o.g=new Map(e.g),o.h=e.h),Qc$1(this,o),this.o=n.o}else n&&(e=String(n).match(Lc$1))?(this.h=!1,Nc$1(this,e[1]||"",!0),this.s=Rc(e[2]||""),this.g=Rc(e[3]||"",!0),Oc$1(this,e[4]),this.l=Rc(e[5]||"",!0),Qc$1(this,e[6]||"",!0),this.o=Rc(e[7]||"")):(this.h=!1,this.i=new Pc$1(null,this.h))}M$1.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Sc$1(e,Tc$2,!0),":");var o=this.g;return(o||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Sc$1(e,Tc$2,!0),"@"),n.push(encodeURIComponent(String(o)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o=this.m,o!=null&&n.push(":",String(o))),(o=this.l)&&(this.g&&o.charAt(0)!="/"&&n.push("/"),n.push(Sc$1(o,o.charAt(0)=="/"?Uc$1:Vc,!0))),(o=this.i.toString())&&n.push("?",o),(o=this.o)&&n.push("#",Sc$1(o,Wc$1)),n.join("")};function G$2(n){return new M$1(n)}function Nc$1(n,e,o){n.j=o?Rc(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Oc$1(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Qc$1(n,e,o){e instanceof Pc$1?(n.i=e,Xc$1(n.i,n.h)):(o||(e=Sc$1(e,Yc$1)),n.i=new Pc$1(e,n.h))}function K$3(n,e,o){n.i.set(e,o)}function hc$1(n){return K$3(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Rc(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Sc$1(n,e,o){return typeof n=="string"?(n=encodeURI(n).replace(e,Zc$1),o&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Zc$1(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Tc$2=/[#\/\?@]/g,Vc=/[#\?:]/g,Uc$1=/[#\?]/g,Yc$1=/[#\?@]/g,Wc$1=/#/g;function Pc$1(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function N$2(n){n.g||(n.g=new Map,n.h=0,n.i&&Mc$1(n.i,function(e,o){n.add(decodeURIComponent(e.replace(/\+/g," ")),o)}))}k$1=Pc$1.prototype;k$1.add=function(n,e){N$2(this),this.i=null,n=O$2(this,n);var o=this.g.get(n);return o||this.g.set(n,o=[]),o.push(e),this.h+=1,this};function $c$1(n,e){N$2(n),e=O$2(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function ad$1(n,e){return N$2(n),e=O$2(n,e),n.g.has(e)}k$1.forEach=function(n,e){N$2(this),this.g.forEach(function(o,s){o.forEach(function(c){n.call(e,c,s,this)},this)},this)};k$1.ta=function(){N$2(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),o=[];for(let s=0;s<e.length;s++){const c=n[s];for(let u=0;u<c.length;u++)o.push(e[s])}return o};k$1.Z=function(n){N$2(this);let e=[];if(typeof n=="string")ad$1(this,n)&&(e=e.concat(this.g.get(O$2(this,n))));else{n=Array.from(this.g.values());for(let o=0;o<n.length;o++)e=e.concat(n[o])}return e};k$1.set=function(n,e){return N$2(this),this.i=null,n=O$2(this,n),ad$1(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};k$1.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function kc$1(n,e,o){$c$1(n,e),0<o.length&&(n.i=null,n.g.set(O$2(n,e),ma$1(o)),n.h+=o.length)}k$1.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var o=0;o<e.length;o++){var s=e[o];const u=encodeURIComponent(String(s)),d=this.Z(s);for(s=0;s<d.length;s++){var c=u;d[s]!==""&&(c+="="+encodeURIComponent(String(d[s]))),n.push(c)}}return this.i=n.join("&")};function O$2(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Xc$1(n,e){e&&!n.j&&(N$2(n),n.i=null,n.g.forEach(function(o,s){var c=s.toLowerCase();s!=c&&($c$1(this,s),kc$1(this,c,o))},n)),n.j=e}var bd$1=class{constructor(e,o){this.g=e,this.map=o}};function cd$1(n){this.l=n||dd$1,l.PerformanceNavigationTiming?(n=l.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(l.g&&l.g.Ka&&l.g.Ka()&&l.g.Ka().ec),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var dd$1=10;function ed$1(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function Bc$1(n){return n.h?1:n.g?n.g.size:0}function xc$1(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Cc$1(n,e){n.g?n.g.add(e):n.h=e}function Ec$2(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}cd$1.prototype.cancel=function(){if(this.i=fd$1(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function fd$1(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const o of n.g.values())e=e.concat(o.F);return e}return ma$1(n.i)}var gd$1=class{stringify(e){return l.JSON.stringify(e,void 0)}parse(e){return l.JSON.parse(e,void 0)}};function hd$1(){this.g=new gd$1}function id$1(n,e,o){const s=o||"";try{Kc$1(n,function(c,u){let d=c;p(c)&&(d=jb(c)),e.push(s+u+"="+encodeURIComponent(d))})}catch(c){throw e.push(s+"type="+encodeURIComponent("_badmap")),c}}function jd(n,e){const o=new Gb;if(l.Image){const s=new Image;s.onload=ha$1(kd$1,o,s,"TestLoadImage: loaded",!0,e),s.onerror=ha$1(kd$1,o,s,"TestLoadImage: error",!1,e),s.onabort=ha$1(kd$1,o,s,"TestLoadImage: abort",!1,e),s.ontimeout=ha$1(kd$1,o,s,"TestLoadImage: timeout",!1,e),l.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=n}else e(!1)}function kd$1(n,e,o,s,c){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,c(s)}catch{}}function ld$1(n){this.l=n.fc||null,this.j=n.ob||!1}r(ld$1,Ub);ld$1.prototype.g=function(){return new md$1(this.l,this.j)};ld$1.prototype.i=function(n){return function(){return n}}({});function md$1(n,e){B$2.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=nd$1,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}r(md$1,B$2);var nd$1=0;k$1=md$1.prototype;k$1.open=function(n,e){if(this.readyState!=nd$1)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,od$1(this)};k$1.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||l).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};k$1.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,pd$1(this)),this.readyState=nd$1};k$1.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,od$1(this)),this.g&&(this.readyState=3,od$1(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;qd$1(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function qd$1(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}k$1.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?pd$1(this):od$1(this),this.readyState==3&&qd$1(this)}};k$1.Za=function(n){this.g&&(this.response=this.responseText=n,pd$1(this))};k$1.Ya=function(n){this.g&&(this.response=n,pd$1(this))};k$1.ka=function(){this.g&&pd$1(this)};function pd$1(n){n.readyState=4,n.l=null,n.j=null,n.A=null,od$1(n)}k$1.setRequestHeader=function(n,e){this.v.append(n,e)};k$1.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};k$1.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var o=e.next();!o.done;)o=o.value,n.push(o[0]+": "+o[1]),o=e.next();return n.join(`\r
`)};function od$1(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(md$1.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var rd$1=l.JSON.parse;function P(n){B$2.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=sd$1,this.L=this.M=!1}r(P,B$2);var sd$1="",td$1=/^https?$/i,ud$1=["POST","PUT"];k$1=P.prototype;k$1.Oa=function(n){this.M=n};k$1.ha=function(n,e,o,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():$b.g(),this.C=this.u?Vb(this.u):Vb($b),this.g.onreadystatechange=q$2(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(u){vd$1(this,u);return}if(n=o||"",o=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var c in s)o.set(c,s[c]);else if(typeof s.keys=="function"&&typeof s.get=="function")for(const u of s.keys())o.set(u,s.get(u));else throw Error("Unknown input type for opt_headers: "+String(s));s=Array.from(o.keys()).find(u=>u.toLowerCase()=="content-type"),c=l.FormData&&n instanceof l.FormData,!(0<=ka$1(ud$1,e))||s||c||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[u,d]of o)this.g.setRequestHeader(u,d);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{wd$1(this),0<this.B&&((this.L=xd$1(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q$2(this.ua,this)):this.A=yb(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(u){vd$1(this,u)}};function xd$1(n){return z$2&&typeof n.timeout=="number"&&n.ontimeout!==void 0}k$1.ua=function(){typeof goog<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,C$1(this,"timeout"),this.abort(8))};function vd$1(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,yd$1(n),zd$1(n)}function yd$1(n){n.F||(n.F=!0,C$1(n,"complete"),C$1(n,"error"))}k$1.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,C$1(this,"complete"),C$1(this,"abort"),zd$1(this))};k$1.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zd$1(this,!0)),P.$.N.call(this)};k$1.La=function(){this.s||(this.G||this.v||this.l?Ad$1(this):this.kb())};k$1.kb=function(){Ad$1(this)};function Ad$1(n){if(n.h&&typeof goog<"u"&&(!n.C[1]||H$1(n)!=4||n.da()!=2)){if(n.v&&H$1(n)==4)yb(n.La,0,n);else if(C$1(n,"readystatechange"),H$1(n)==4){n.h=!1;try{const d=n.da();e:switch(d){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var o;if(!(o=e)){var s;if(s=d===0){var c=String(n.I).match(Lc$1)[1]||null;!c&&l.self&&l.self.location&&(c=l.self.location.protocol.slice(0,-1)),s=!td$1.test(c?c.toLowerCase():"")}o=s}if(o)C$1(n,"complete"),C$1(n,"success");else{n.m=6;try{var u=2<H$1(n)?n.g.statusText:""}catch{u=""}n.j=u+" ["+n.da()+"]",yd$1(n)}}finally{zd$1(n)}}}}function zd$1(n,e){if(n.g){wd$1(n);const o=n.g,s=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||C$1(n,"ready");try{o.onreadystatechange=s}catch{}}}function wd$1(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(l.clearTimeout(n.A),n.A=null)}k$1.isActive=function(){return!!this.g};function H$1(n){return n.g?n.g.readyState:0}k$1.da=function(){try{return 2<H$1(this)?this.g.status:-1}catch{return-1}};k$1.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};k$1.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),rd$1(e)}};function mc$1(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case sd$1:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function tc$1(n){const e={};n=(n.g&&2<=H$1(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let s=0;s<n.length;s++){if(x(n[s]))continue;var o=qb(n[s]);const c=o[0];if(o=o[1],typeof o!="string")continue;o=o.trim();const u=e[c]||[];e[c]=u,u.push(o)}Oa$1(e,function(s){return s.join(", ")})}k$1.Ia=function(){return this.m};k$1.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Bd$1(n){let e="";return Na$1(n,function(o,s){e+=s,e+=":",e+=o,e+=`\r
`}),e}function Cd$1(n,e,o){e:{for(s in o){var s=!1;break e}s=!0}s||(o=Bd$1(o),typeof n=="string"?o!=null&&encodeURIComponent(String(o)):K$3(n,e,o))}function Dd$1(n,e,o){return o&&o.internalChannelParams&&o.internalChannelParams[n]||e}function Ed$1(n){this.Ga=0,this.j=[],this.l=new Gb,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Dd$1("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Dd$1("baseRetryDelayMs",5e3,n),this.hb=Dd$1("retryDelaySeedMs",1e4,n),this.eb=Dd$1("forwardChannelMaxRetries",2,n),this.xa=Dd$1("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.dc||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new cd$1(n&&n.concurrentRequestLimit),this.Ja=new hd$1,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}k$1=Ed$1.prototype;k$1.ra=8;k$1.H=1;function Hc$1(n){if(Fd(n),n.H==3){var e=n.W++,o=G$2(n.I);if(K$3(o,"SID",n.K),K$3(o,"RID",e),K$3(o,"TYPE","terminate"),Gd$1(n,o),e=new bc$1(n,n.l,e),e.L=2,e.v=hc$1(G$2(o)),o=!1,l.navigator&&l.navigator.sendBeacon)try{o=l.navigator.sendBeacon(e.v.toString(),"")}catch{}!o&&l.Image&&(new Image().src=e.v,o=!0),o||(e.g=lc$1(e.l,null),e.g.ha(e.v)),e.G=Date.now(),jc$1(e)}Hd(n)}function zc$1(n){n.g&&(vc$1(n),n.g.cancel(),n.g=null)}function Fd(n){zc$1(n),n.u&&(l.clearTimeout(n.u),n.u=null),yc$1(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&l.clearTimeout(n.m),n.m=null)}function Gc$1(n){if(!ed$1(n.i)&&!n.m){n.m=!0;var e=n.Na;sb||vb(),tb||(sb(),tb=!0),mb.add(e,n),n.C=0}}function Id$1(n,e){return Bc$1(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Rb(q$2(n.Na,n,e),Jd(n,n.C)),n.C++,!0)}k$1.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const c=new bc$1(this,this.l,n);let u=this.s;if(this.U&&(u?(u=Pa$1(u),Ra$1(u,this.U)):u=this.U),this.o!==null||this.O||(c.I=u,u=null),this.P)e:{for(var e=0,o=0;o<this.j.length;o++){t:{var s=this.j[o];if("__data__"in s.map&&(s=s.map.__data__,typeof s=="string")){s=s.length;break t}s=void 0}if(s===void 0)break;if(e+=s,4096<e){e=o;break e}if(e===4096||o===this.j.length-1){e=o+1;break e}}e=1e3}else e=1e3;e=Kd$1(this,c,e),o=G$2(this.I),K$3(o,"RID",n),K$3(o,"CVER",22),this.F&&K$3(o,"X-HTTP-Session-Id",this.F),Gd$1(this,o),u&&(this.O?e="headers="+encodeURIComponent(String(Bd$1(u)))+"&"+e:this.o&&Cd$1(o,this.o,u)),Cc$1(this.i,c),this.bb&&K$3(o,"TYPE","init"),this.P?(K$3(o,"$req",e),K$3(o,"SID","null"),c.aa=!0,gc$1(c,o,null)):gc$1(c,o,e),this.H=2}}else this.H==3&&(n?Ld(this,n):this.j.length==0||ed$1(this.i)||Ld(this))};function Ld(n,e){var o;e?o=e.m:o=n.W++;const s=G$2(n.I);K$3(s,"SID",n.K),K$3(s,"RID",o),K$3(s,"AID",n.V),Gd$1(n,s),n.o&&n.s&&Cd$1(s,n.o,n.s),o=new bc$1(n,n.l,o,n.C+1),n.o===null&&(o.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Kd$1(n,o,1e3),o.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Cc$1(n.i,o),gc$1(o,s,e)}function Gd$1(n,e){n.na&&Na$1(n.na,function(o,s){K$3(e,s,o)}),n.h&&Kc$1({},function(o,s){K$3(e,s,o)})}function Kd$1(n,e,o){o=Math.min(n.j.length,o);var s=n.h?q$2(n.h.Va,n.h,n):null;e:{var c=n.j;let u=-1;for(;;){const d=["count="+o];u==-1?0<o?(u=c[0].g,d.push("ofs="+u)):u=0:d.push("ofs="+u);let m=!0;for(let _=0;_<o;_++){let ue=c[_].g;const gn=c[_].map;if(ue-=u,0>ue)u=Math.max(0,c[_].g-100),m=!1;else try{id$1(gn,d,"req"+ue+"_")}catch{s&&s(gn)}}if(m){s=d.join("&");break e}}}return n=n.j.splice(0,o),e.F=n,s}function Fc$1(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;sb||vb(),tb||(sb(),tb=!0),mb.add(e,n),n.A=0}}function Ac$1(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Rb(q$2(n.Ma,n),Jd(n,n.A)),n.A++,!0)}k$1.Ma=function(){if(this.u=null,Md$1(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Rb(q$2(this.jb,this),n)}};k$1.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,F$2(10),zc$1(this),Md$1(this))};function vc$1(n){n.B!=null&&(l.clearTimeout(n.B),n.B=null)}function Md$1(n){n.g=new bc$1(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=G$2(n.wa);K$3(e,"RID","rpc"),K$3(e,"SID",n.K),K$3(e,"AID",n.V),K$3(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&K$3(e,"TO",n.qa),K$3(e,"TYPE","xmlhttp"),Gd$1(n,e),n.o&&n.s&&Cd$1(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var o=n.g;n=n.pa,o.L=1,o.v=hc$1(G$2(e)),o.s=null,o.S=!0,ic$1(o,n)}k$1.ib=function(){this.v!=null&&(this.v=null,zc$1(this),Ac$1(this),F$2(19))};function yc$1(n){n.v!=null&&(l.clearTimeout(n.v),n.v=null)}function sc$1(n,e){var o=null;if(n.g==e){yc$1(n),vc$1(n),n.g=null;var s=2}else if(xc$1(n.i,e))o=e.F,Ec$2(n.i,e),s=1;else return;if(n.H!=0){if(e.i)if(s==1){o=e.s?e.s.length:0,e=Date.now()-e.G;var c=n.C;s=Mb(),C$1(s,new Qb(s,o)),Gc$1(n)}else Fc$1(n);else if(c=e.o,c==3||c==0&&0<e.ca||!(s==1&&Id$1(n,e)||s==2&&Ac$1(n)))switch(o&&0<o.length&&(e=n.i,e.i=e.i.concat(o)),c){case 1:J$4(n,5);break;case 4:J$4(n,10);break;case 3:J$4(n,6);break;default:J$4(n,2)}}}function Jd(n,e){let o=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(o*=2),o*e}function J$4(n,e){if(n.l.info("Error code "+e),e==2){var o=null;n.h&&(o=null);var s=q$2(n.pb,n);o||(o=new M$1("//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Nc$1(o,"https"),hc$1(o)),jd(o.toString(),s)}else F$2(2);n.H=0,n.h&&n.h.za(e),Hd(n),Fd(n)}k$1.pb=function(n){n?(this.l.info("Successfully pinged google.com"),F$2(2)):(this.l.info("Failed to ping google.com"),F$2(1))};function Hd(n){if(n.H=0,n.ma=[],n.h){const e=fd$1(n.i);(e.length!=0||n.j.length!=0)&&(na$1(n.ma,e),na$1(n.ma,n.j),n.i.i.length=0,ma$1(n.j),n.j.length=0),n.h.ya()}}function Dc$1(n,e,o){var s=o instanceof M$1?G$2(o):new M$1(o);if(s.g!="")e&&(s.g=e+"."+s.g),Oc$1(s,s.m);else{var c=l.location;s=c.protocol,e=e?e+"."+c.hostname:c.hostname,c=+c.port;var u=new M$1(null);s&&Nc$1(u,s),e&&(u.g=e),c&&Oc$1(u,c),o&&(u.l=o),s=u}return o=n.F,e=n.Da,o&&e&&K$3(s,o,e),K$3(s,"VER",n.ra),Gd$1(n,s),s}function lc$1(n,e,o){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=o&&n.Ha&&!n.va?new P(new ld$1({ob:!0})):new P(n.va),e.Oa(n.J),e}k$1.isActive=function(){return!!this.h&&this.h.isActive(this)};function Nd$1(){}k$1=Nd$1.prototype;k$1.Ba=function(){};k$1.Aa=function(){};k$1.za=function(){};k$1.ya=function(){};k$1.isActive=function(){return!0};k$1.Va=function(){};function Q$3(n,e){B$2.call(this),this.g=new Ed$1(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!x(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!x(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new R$1(this)}r(Q$3,B$2);Q$3.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,o=this.h||void 0;F$2(0),n.Y=e,n.na=o||{},n.G=n.aa,n.I=Dc$1(n,null,n.Y),Gc$1(n)};Q$3.prototype.close=function(){Hc$1(this.g)};Q$3.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var o={};o.__data__=n,n=o}else this.v&&(o={},o.__data__=jb(n),n=o);e.j.push(new bd$1(e.fb++,n)),e.H==3&&Gc$1(e)};Q$3.prototype.N=function(){this.g.h=null,delete this.j,Hc$1(this.g),delete this.g,Q$3.$.N.call(this)};function Pd$1(n){Yb.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const o in e){n=o;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}r(Pd$1,Yb);function Qd(){Zb.call(this),this.status=1}r(Qd,Zb);function R$1(n){this.g=n}r(R$1,Nd$1);R$1.prototype.Ba=function(){C$1(this.g,"a")};R$1.prototype.Aa=function(n){C$1(this.g,new Pd$1(n))};R$1.prototype.za=function(n){C$1(this.g,new Qd)};R$1.prototype.ya=function(){C$1(this.g,"b")};function Rd(){this.blockSize=-1}function S$3(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}r(S$3,Rd);S$3.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Sd$1(n,e,o){o||(o=0);var s=Array(16);if(typeof e=="string")for(var c=0;16>c;++c)s[c]=e.charCodeAt(o++)|e.charCodeAt(o++)<<8|e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<24;else for(c=0;16>c;++c)s[c]=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24;e=n.g[0],o=n.g[1],c=n.g[2];var u=n.g[3],d=e+(u^o&(c^u))+s[0]+3614090360&4294967295;e=o+(d<<7&4294967295|d>>>25),d=u+(c^e&(o^c))+s[1]+3905402710&4294967295,u=e+(d<<12&4294967295|d>>>20),d=c+(o^u&(e^o))+s[2]+606105819&4294967295,c=u+(d<<17&4294967295|d>>>15),d=o+(e^c&(u^e))+s[3]+3250441966&4294967295,o=c+(d<<22&4294967295|d>>>10),d=e+(u^o&(c^u))+s[4]+4118548399&4294967295,e=o+(d<<7&4294967295|d>>>25),d=u+(c^e&(o^c))+s[5]+1200080426&4294967295,u=e+(d<<12&4294967295|d>>>20),d=c+(o^u&(e^o))+s[6]+2821735955&4294967295,c=u+(d<<17&4294967295|d>>>15),d=o+(e^c&(u^e))+s[7]+4249261313&4294967295,o=c+(d<<22&4294967295|d>>>10),d=e+(u^o&(c^u))+s[8]+1770035416&4294967295,e=o+(d<<7&4294967295|d>>>25),d=u+(c^e&(o^c))+s[9]+2336552879&4294967295,u=e+(d<<12&4294967295|d>>>20),d=c+(o^u&(e^o))+s[10]+4294925233&4294967295,c=u+(d<<17&4294967295|d>>>15),d=o+(e^c&(u^e))+s[11]+2304563134&4294967295,o=c+(d<<22&4294967295|d>>>10),d=e+(u^o&(c^u))+s[12]+1804603682&4294967295,e=o+(d<<7&4294967295|d>>>25),d=u+(c^e&(o^c))+s[13]+4254626195&4294967295,u=e+(d<<12&4294967295|d>>>20),d=c+(o^u&(e^o))+s[14]+2792965006&4294967295,c=u+(d<<17&4294967295|d>>>15),d=o+(e^c&(u^e))+s[15]+1236535329&4294967295,o=c+(d<<22&4294967295|d>>>10),d=e+(c^u&(o^c))+s[1]+4129170786&4294967295,e=o+(d<<5&4294967295|d>>>27),d=u+(o^c&(e^o))+s[6]+3225465664&4294967295,u=e+(d<<9&4294967295|d>>>23),d=c+(e^o&(u^e))+s[11]+643717713&4294967295,c=u+(d<<14&4294967295|d>>>18),d=o+(u^e&(c^u))+s[0]+3921069994&4294967295,o=c+(d<<20&4294967295|d>>>12),d=e+(c^u&(o^c))+s[5]+3593408605&4294967295,e=o+(d<<5&4294967295|d>>>27),d=u+(o^c&(e^o))+s[10]+38016083&4294967295,u=e+(d<<9&4294967295|d>>>23),d=c+(e^o&(u^e))+s[15]+3634488961&4294967295,c=u+(d<<14&4294967295|d>>>18),d=o+(u^e&(c^u))+s[4]+3889429448&4294967295,o=c+(d<<20&4294967295|d>>>12),d=e+(c^u&(o^c))+s[9]+568446438&4294967295,e=o+(d<<5&4294967295|d>>>27),d=u+(o^c&(e^o))+s[14]+3275163606&4294967295,u=e+(d<<9&4294967295|d>>>23),d=c+(e^o&(u^e))+s[3]+4107603335&4294967295,c=u+(d<<14&4294967295|d>>>18),d=o+(u^e&(c^u))+s[8]+1163531501&4294967295,o=c+(d<<20&4294967295|d>>>12),d=e+(c^u&(o^c))+s[13]+2850285829&4294967295,e=o+(d<<5&4294967295|d>>>27),d=u+(o^c&(e^o))+s[2]+4243563512&4294967295,u=e+(d<<9&4294967295|d>>>23),d=c+(e^o&(u^e))+s[7]+1735328473&4294967295,c=u+(d<<14&4294967295|d>>>18),d=o+(u^e&(c^u))+s[12]+2368359562&4294967295,o=c+(d<<20&4294967295|d>>>12),d=e+(o^c^u)+s[5]+4294588738&4294967295,e=o+(d<<4&4294967295|d>>>28),d=u+(e^o^c)+s[8]+2272392833&4294967295,u=e+(d<<11&4294967295|d>>>21),d=c+(u^e^o)+s[11]+1839030562&4294967295,c=u+(d<<16&4294967295|d>>>16),d=o+(c^u^e)+s[14]+4259657740&4294967295,o=c+(d<<23&4294967295|d>>>9),d=e+(o^c^u)+s[1]+2763975236&4294967295,e=o+(d<<4&4294967295|d>>>28),d=u+(e^o^c)+s[4]+1272893353&4294967295,u=e+(d<<11&4294967295|d>>>21),d=c+(u^e^o)+s[7]+4139469664&4294967295,c=u+(d<<16&4294967295|d>>>16),d=o+(c^u^e)+s[10]+3200236656&4294967295,o=c+(d<<23&4294967295|d>>>9),d=e+(o^c^u)+s[13]+681279174&4294967295,e=o+(d<<4&4294967295|d>>>28),d=u+(e^o^c)+s[0]+3936430074&4294967295,u=e+(d<<11&4294967295|d>>>21),d=c+(u^e^o)+s[3]+3572445317&4294967295,c=u+(d<<16&4294967295|d>>>16),d=o+(c^u^e)+s[6]+76029189&4294967295,o=c+(d<<23&4294967295|d>>>9),d=e+(o^c^u)+s[9]+3654602809&4294967295,e=o+(d<<4&4294967295|d>>>28),d=u+(e^o^c)+s[12]+3873151461&4294967295,u=e+(d<<11&4294967295|d>>>21),d=c+(u^e^o)+s[15]+530742520&4294967295,c=u+(d<<16&4294967295|d>>>16),d=o+(c^u^e)+s[2]+3299628645&4294967295,o=c+(d<<23&4294967295|d>>>9),d=e+(c^(o|~u))+s[0]+4096336452&4294967295,e=o+(d<<6&4294967295|d>>>26),d=u+(o^(e|~c))+s[7]+1126891415&4294967295,u=e+(d<<10&4294967295|d>>>22),d=c+(e^(u|~o))+s[14]+2878612391&4294967295,c=u+(d<<15&4294967295|d>>>17),d=o+(u^(c|~e))+s[5]+4237533241&4294967295,o=c+(d<<21&4294967295|d>>>11),d=e+(c^(o|~u))+s[12]+1700485571&4294967295,e=o+(d<<6&4294967295|d>>>26),d=u+(o^(e|~c))+s[3]+2399980690&4294967295,u=e+(d<<10&4294967295|d>>>22),d=c+(e^(u|~o))+s[10]+4293915773&4294967295,c=u+(d<<15&4294967295|d>>>17),d=o+(u^(c|~e))+s[1]+2240044497&4294967295,o=c+(d<<21&4294967295|d>>>11),d=e+(c^(o|~u))+s[8]+1873313359&4294967295,e=o+(d<<6&4294967295|d>>>26),d=u+(o^(e|~c))+s[15]+4264355552&4294967295,u=e+(d<<10&4294967295|d>>>22),d=c+(e^(u|~o))+s[6]+2734768916&4294967295,c=u+(d<<15&4294967295|d>>>17),d=o+(u^(c|~e))+s[13]+1309151649&4294967295,o=c+(d<<21&4294967295|d>>>11),d=e+(c^(o|~u))+s[4]+4149444226&4294967295,e=o+(d<<6&4294967295|d>>>26),d=u+(o^(e|~c))+s[11]+3174756917&4294967295,u=e+(d<<10&4294967295|d>>>22),d=c+(e^(u|~o))+s[2]+718787259&4294967295,c=u+(d<<15&4294967295|d>>>17),d=o+(u^(c|~e))+s[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(c+(d<<21&4294967295|d>>>11))&4294967295,n.g[2]=n.g[2]+c&4294967295,n.g[3]=n.g[3]+u&4294967295}S$3.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var o=e-this.blockSize,s=this.m,c=this.h,u=0;u<e;){if(c==0)for(;u<=o;)Sd$1(this,n,u),u+=this.blockSize;if(typeof n=="string"){for(;u<e;)if(s[c++]=n.charCodeAt(u++),c==this.blockSize){Sd$1(this,s),c=0;break}}else for(;u<e;)if(s[c++]=n[u++],c==this.blockSize){Sd$1(this,s),c=0;break}}this.h=c,this.i+=e};S$3.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var o=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=o&255,o/=256;for(this.j(n),n=Array(16),e=o=0;4>e;++e)for(var s=0;32>s;s+=8)n[o++]=this.g[e]>>>s&255;return n};function T$1(n,e){this.h=e;for(var o=[],s=!0,c=n.length-1;0<=c;c--){var u=n[c]|0;s&&u==e||(o[c]=u,s=!1)}this.g=o}var sa$1={};function Td$1(n){return-128<=n&&128>n?ra$1(n,function(e){return new T$1([e|0],0>e?-1:0)}):new T$1([n|0],0>n?-1:0)}function U$2(n){if(isNaN(n)||!isFinite(n))return V$1;if(0>n)return W$3(U$2(-n));for(var e=[],o=1,s=0;n>=o;s++)e[s]=n/o|0,o*=Ud;return new T$1(e,0)}function Vd(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return W$3(Vd(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var o=U$2(Math.pow(e,8)),s=V$1,c=0;c<n.length;c+=8){var u=Math.min(8,n.length-c),d=parseInt(n.substring(c,c+u),e);8>u?(u=U$2(Math.pow(e,u)),s=s.R(u).add(U$2(d))):(s=s.R(o),s=s.add(U$2(d)))}return s}var Ud=4294967296,V$1=Td$1(0),Wd=Td$1(1),Xd=Td$1(16777216);k$1=T$1.prototype;k$1.ea=function(){if(X$1(this))return-W$3(this).ea();for(var n=0,e=1,o=0;o<this.g.length;o++){var s=this.D(o);n+=(0<=s?s:Ud+s)*e,e*=Ud}return n};k$1.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(Y$3(this))return"0";if(X$1(this))return"-"+W$3(this).toString(n);for(var e=U$2(Math.pow(n,6)),o=this,s="";;){var c=Yd(o,e).g;o=Zd(o,c.R(e));var u=((0<o.g.length?o.g[0]:o.h)>>>0).toString(n);if(o=c,Y$3(o))return u+s;for(;6>u.length;)u="0"+u;s=u+s}};k$1.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function Y$3(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function X$1(n){return n.h==-1}k$1.X=function(n){return n=Zd(this,n),X$1(n)?-1:Y$3(n)?0:1};function W$3(n){for(var e=n.g.length,o=[],s=0;s<e;s++)o[s]=~n.g[s];return new T$1(o,~n.h).add(Wd)}k$1.abs=function(){return X$1(this)?W$3(this):this};k$1.add=function(n){for(var e=Math.max(this.g.length,n.g.length),o=[],s=0,c=0;c<=e;c++){var u=s+(this.D(c)&65535)+(n.D(c)&65535),d=(u>>>16)+(this.D(c)>>>16)+(n.D(c)>>>16);s=d>>>16,u&=65535,d&=65535,o[c]=d<<16|u}return new T$1(o,o[o.length-1]&-2147483648?-1:0)};function Zd(n,e){return n.add(W$3(e))}k$1.R=function(n){if(Y$3(this)||Y$3(n))return V$1;if(X$1(this))return X$1(n)?W$3(this).R(W$3(n)):W$3(W$3(this).R(n));if(X$1(n))return W$3(this.R(W$3(n)));if(0>this.X(Xd)&&0>n.X(Xd))return U$2(this.ea()*n.ea());for(var e=this.g.length+n.g.length,o=[],s=0;s<2*e;s++)o[s]=0;for(s=0;s<this.g.length;s++)for(var c=0;c<n.g.length;c++){var u=this.D(s)>>>16,d=this.D(s)&65535,m=n.D(c)>>>16,_=n.D(c)&65535;o[2*s+2*c]+=d*_,$d$1(o,2*s+2*c),o[2*s+2*c+1]+=u*_,$d$1(o,2*s+2*c+1),o[2*s+2*c+1]+=d*m,$d$1(o,2*s+2*c+1),o[2*s+2*c+2]+=u*m,$d$1(o,2*s+2*c+2)}for(s=0;s<e;s++)o[s]=o[2*s+1]<<16|o[2*s];for(s=e;s<2*e;s++)o[s]=0;return new T$1(o,0)};function $d$1(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function ae$1(n,e){this.g=n,this.h=e}function Yd(n,e){if(Y$3(e))throw Error("division by zero");if(Y$3(n))return new ae$1(V$1,V$1);if(X$1(n))return e=Yd(W$3(n),e),new ae$1(W$3(e.g),W$3(e.h));if(X$1(e))return e=Yd(n,W$3(e)),new ae$1(W$3(e.g),e.h);if(30<n.g.length){if(X$1(n)||X$1(e))throw Error("slowDivide_ only works with positive integers.");for(var o=Wd,s=e;0>=s.X(n);)o=be$2(o),s=be$2(s);var c=Z$2(o,1),u=Z$2(s,1);for(s=Z$2(s,2),o=Z$2(o,2);!Y$3(s);){var d=u.add(s);0>=d.X(n)&&(c=c.add(o),u=d),s=Z$2(s,1),o=Z$2(o,1)}return e=Zd(n,c.R(e)),new ae$1(c,e)}for(c=V$1;0<=n.X(e);){for(o=Math.max(1,Math.floor(n.ea()/e.ea())),s=Math.ceil(Math.log(o)/Math.LN2),s=48>=s?1:Math.pow(2,s-48),u=U$2(o),d=u.R(e);X$1(d)||0<d.X(n);)o-=s,u=U$2(o),d=u.R(e);Y$3(u)&&(u=Wd),c=c.add(u),n=Zd(n,d)}return new ae$1(c,n)}k$1.gb=function(n){return Yd(this,n).h};k$1.and=function(n){for(var e=Math.max(this.g.length,n.g.length),o=[],s=0;s<e;s++)o[s]=this.D(s)&n.D(s);return new T$1(o,this.h&n.h)};k$1.or=function(n){for(var e=Math.max(this.g.length,n.g.length),o=[],s=0;s<e;s++)o[s]=this.D(s)|n.D(s);return new T$1(o,this.h|n.h)};k$1.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),o=[],s=0;s<e;s++)o[s]=this.D(s)^n.D(s);return new T$1(o,this.h^n.h)};function be$2(n){for(var e=n.g.length+1,o=[],s=0;s<e;s++)o[s]=n.D(s)<<1|n.D(s-1)>>>31;return new T$1(o,n.h)}function Z$2(n,e){var o=e>>5;e%=32;for(var s=n.g.length-o,c=[],u=0;u<s;u++)c[u]=0<e?n.D(u+o)>>>e|n.D(u+o+1)<<32-e:n.D(u+o);return new T$1(c,n.h)}Q$3.prototype.send=Q$3.prototype.u;Q$3.prototype.open=Q$3.prototype.m;Q$3.prototype.close=Q$3.prototype.close;Sb.NO_ERROR=0;Sb.TIMEOUT=8;Sb.HTTP_ERROR=6;Tb.COMPLETE="complete";Wb.EventType=Xb;Xb.OPEN="a";Xb.CLOSE="b";Xb.ERROR="c";Xb.MESSAGE="d";B$2.prototype.listen=B$2.prototype.O;P.prototype.listenOnce=P.prototype.P;P.prototype.getLastError=P.prototype.Sa;P.prototype.getLastErrorCode=P.prototype.Ia;P.prototype.getStatus=P.prototype.da;P.prototype.getResponseJson=P.prototype.Wa;P.prototype.getResponseText=P.prototype.ja;P.prototype.send=P.prototype.ha;P.prototype.setWithCredentials=P.prototype.Oa;S$3.prototype.digest=S$3.prototype.l;S$3.prototype.reset=S$3.prototype.reset;S$3.prototype.update=S$3.prototype.j;T$1.prototype.add=T$1.prototype.add;T$1.prototype.multiply=T$1.prototype.R;T$1.prototype.modulo=T$1.prototype.gb;T$1.prototype.compare=T$1.prototype.X;T$1.prototype.toNumber=T$1.prototype.ea;T$1.prototype.toString=T$1.prototype.toString;T$1.prototype.getBits=T$1.prototype.D;T$1.fromNumber=U$2;T$1.fromString=Vd;var Integer=T$1;const b="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}V.UNAUTHENTICATED=new V(null),V.GOOGLE_CREDENTIALS=new V("google-credentials-uid"),V.FIRST_PARTY=new V("first-party-uid"),V.MOCK_USER=new V("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S$2="9.22.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D$1=new Logger("@firebase/firestore");function N$1(n,...e){if(D$1.logLevel<=LogLevel.DEBUG){const o=e.map($);D$1.debug(`Firestore (${S$2}): ${n}`,...o)}}function k(n,...e){if(D$1.logLevel<=LogLevel.ERROR){const o=e.map($);D$1.error(`Firestore (${S$2}): ${n}`,...o)}}function $(n){if(typeof n=="string")return n;try{return e=n,JSON.stringify(e)}catch{return n}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O$1(n="Unexpected state"){const e=`FIRESTORE (${S$2}) INTERNAL ASSERTION FAILED: `+n;throw k(e),new Error(e)}function F$1(n,e){n||O$1()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q$1={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};let U$1=class extends FirebaseError{constructor(e,o){super(e,o),this.code=e,this.message=o,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let K$2=class{constructor(){this.promise=new Promise((e,o)=>{this.resolve=e,this.reject=o})}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let G$1=class{constructor(e,o){this.user=o,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Q$2=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,o){e.enqueueRetryable(()=>o(V.UNAUTHENTICATED))}shutdown(){}},z$1=class{constructor(e){this.t=e,this.currentUser=V.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,o){let s=this.i;const c=_=>this.i!==s?(s=this.i,o(_)):Promise.resolve();let u=new K$2;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new K$2,e.enqueueRetryable(()=>c(this.currentUser))};const d=()=>{const _=u;e.enqueueRetryable(async()=>{await _.promise,await c(this.currentUser)})},m=_=>{N$1("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=_,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(_=>m(_)),setTimeout(()=>{if(!this.auth){const _=this.t.getImmediate({optional:!0});_?m(_):(N$1("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new K$2)}},0),d()}getToken(){const e=this.i,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then(s=>this.i!==e?(N$1("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(F$1(typeof s.accessToken=="string"),new G$1(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return F$1(e===null||typeof e=="string"),new V(e)}},W$2=class{constructor(e,o,s){this.h=e,this.l=o,this.m=s,this.type="FirstParty",this.user=V.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}};class H{constructor(e,o,s){this.h=e,this.l=o,this.m=s}getToken(){return Promise.resolve(new W$2(this.h,this.l,this.m))}start(e,o){e.enqueueRetryable(()=>o(V.FIRST_PARTY))}shutdown(){}invalidateToken(){}}let J$3=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Y$2=class{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,o){const s=u=>{u.error!=null&&N$1("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const d=u.token!==this.T;return this.T=u.token,N$1("FirebaseAppCheckTokenProvider",`Received ${d?"new":"existing"} token.`),d?o(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>s(u))};const c=u=>{N$1("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.appCheck.addTokenListener(this.o)};this.I.onInit(u=>c(u)),setTimeout(()=>{if(!this.appCheck){const u=this.I.getImmediate({optional:!0});u?c(u):N$1("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(o=>o?(F$1(typeof o.token=="string"),this.T=o.token,new J$3(o.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z$1(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),o=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(o);else for(let s=0;s<n;s++)o[s]=Math.floor(256*Math.random());return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tt$2=class{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const c=Z$1(40);for(let u=0;u<c.length;++u)s.length<20&&c[u]<o&&(s+=e.charAt(c[u]%e.length))}return s}};function Dt$2(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $e$1=class{constructor(e,o,s,c,u,d,m,_,ue){this.databaseId=e,this.appId=o,this.persistenceKey=s,this.host=c,this.ssl=u,this.forceLongPolling=d,this.autoDetectLongPolling=m,this.longPollingOptions=_,this.useFetchStreams=ue}},Oe$2=class yf{constructor(e,o){this.projectId=e,this.database=o||"(default)"}static empty(){return new yf("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof yf&&e.projectId===this.projectId&&e.database===this.database}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ii$2,ri$2;(ri$2=ii$2||(ii$2={}))[ri$2.OK=0]="OK",ri$2[ri$2.CANCELLED=1]="CANCELLED",ri$2[ri$2.UNKNOWN=2]="UNKNOWN",ri$2[ri$2.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ri$2[ri$2.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ri$2[ri$2.NOT_FOUND=5]="NOT_FOUND",ri$2[ri$2.ALREADY_EXISTS=6]="ALREADY_EXISTS",ri$2[ri$2.PERMISSION_DENIED=7]="PERMISSION_DENIED",ri$2[ri$2.UNAUTHENTICATED=16]="UNAUTHENTICATED",ri$2[ri$2.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ri$2[ri$2.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ri$2[ri$2.ABORTED=10]="ABORTED",ri$2[ri$2.OUT_OF_RANGE=11]="OUT_OF_RANGE",ri$2[ri$2.UNIMPLEMENTED=12]="UNIMPLEMENTED",ri$2[ri$2.INTERNAL=13]="INTERNAL",ri$2[ri$2.UNAVAILABLE=14]="UNAVAILABLE",ri$2[ri$2.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Integer([4294967295,4294967295],0);function Ou$1(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bu$1=class{constructor(e,o,s=1e3,c=1.5,u=6e4){this.ii=e,this.timerId=o,this.Po=s,this.bo=c,this.Vo=u,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const o=Math.floor(this.So+this.ko()),s=Math.max(0,Date.now()-this.Co),c=Math.max(0,o-s);c>0&&N$1("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.So} ms, delay with jitter: ${o} ms, last attempt: ${s} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,c,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){this.Do!==null&&(this.Do.skipDelay(),this.Do=null)}cancel(){this.Do!==null&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tc$1=class bf{constructor(e,o,s,c,u){this.asyncQueue=e,this.timerId=o,this.targetTimeMs=s,this.op=c,this.removalCallback=u,this.deferred=new K$2,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(d=>{})}static createAndSchedule(e,o,s,c,u){const d=Date.now()+s,m=new bf(e,o,d,c,u);return m.start(s),m}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new U$1(q$1.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ec$1(n,e){if(k("AsyncQueue",`${e}: ${n}`),Dt$2(n))return new U$1(q$1.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xa$1=class{constructor(e,o,s,c){this.authCredentials=e,this.appCheckCredentials=o,this.asyncQueue=s,this.databaseInfo=c,this.user=V.UNAUTHENTICATED,this.clientId=tt$2.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,async u=>{N$1("FirestoreClient","Received user=",u.uid),await this.authCredentialListener(u),this.user=u}),this.appCheckCredentials.start(s,u=>(N$1("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new U$1(q$1.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new K$2;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(o){const s=Ec$1(o,"Failed to shutdown persistence");e.reject(s)}}),e.promise}};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function th(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh=new Map;function sh(n,e,o,s){if(e===!0&&s===!0)throw new U$1(q$1.INVALID_ARGUMENT,`${n} and ${o} cannot be used together.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah{constructor(e){var o,s;if(e.host===void 0){if(e.ssl!==void 0)throw new U$1(q$1.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(o=e.ssl)===null||o===void 0||o;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new U$1(q$1.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}sh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=th((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(c){if(c.timeoutSeconds!==void 0){if(isNaN(c.timeoutSeconds))throw new U$1(q$1.INVALID_ARGUMENT,`invalid long polling timeout: ${c.timeoutSeconds} (must not be NaN)`);if(c.timeoutSeconds<5)throw new U$1(q$1.INVALID_ARGUMENT,`invalid long polling timeout: ${c.timeoutSeconds} (minimum allowed value is 5)`);if(c.timeoutSeconds>30)throw new U$1(q$1.INVALID_ARGUMENT,`invalid long polling timeout: ${c.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(o=this.experimentalLongPollingOptions,s=e.experimentalLongPollingOptions,o.timeoutSeconds===s.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var o,s}}class hh{constructor(e,o,s,c){this._authCredentials=e,this._appCheckCredentials=o,this._databaseId=s,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ah({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new U$1(q$1.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new U$1(q$1.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ah(e),e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new Q$2;switch(o.type){case"firstParty":return new H(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new U$1(q$1.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const o=eh.get(e);o&&(N$1("ComponentProvider","Removing Datastore"),eh.delete(e),o.terminate())}(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Bu$1(this,"async_queue_retry"),this.Xc=()=>{const o=Ou$1();o&&N$1("AsyncQueue","Visibility state changed to "+o.visibilityState),this.qo.Mo()};const e=Ou$1();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const o=Ou$1();o&&typeof o.removeEventListener=="function"&&o.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const o=new K$2;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(o.resolve,o.reject),o.promise)).then(()=>o.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}async ea(){if(this.Qc.length!==0){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!Dt$2(e))throw e;N$1("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No(()=>this.ea())}}ta(e){const o=this.Gc.then(()=>(this.Hc=!0,e().catch(s=>{this.Wc=s,this.Hc=!1;const c=function(u){let d=u.message||"";return u.stack&&(d=u.stack.includes(u.message)?u.stack:u.message+`
`+u.stack),d}(s);throw k("INTERNAL UNHANDLED ERROR: ",c),s}).then(s=>(this.Hc=!1,s))));return this.Gc=o,o}enqueueAfterDelay(e,o,s){this.Zc(),this.Yc.indexOf(e)>-1&&(o=0);const c=Tc$1.createAndSchedule(this,e,o,s,u=>this.na(u));return this.zc.push(c),c}Zc(){this.Wc&&O$1()}verifyOperationInProgress(){}async sa(){let e;do e=this.Gc,await e;while(e!==this.Gc)}ia(e){for(const o of this.zc)if(o.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((o,s)=>o.targetTimeMs-s.targetTimeMs);for(const o of this.zc)if(o.skipDelay(),e!=="all"&&o.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const o=this.zc.indexOf(e);this.zc.splice(o,1)}}class vh extends hh{constructor(e,o,s,c){super(e,o,s,c),this.type="firestore",this._queue=new Ih,this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Vh(this),this._firestoreClient.terminate()}}function Vh(n){var e,o,s;const c=n._freezeSettings(),u=function(d,m,_,ue){return new $e$1(d,m,_,ue.host,ue.ssl,ue.experimentalForceLongPolling,ue.experimentalAutoDetectLongPolling,th(ue.experimentalLongPollingOptions),ue.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,c);n._firestoreClient=new xa$1(n._authCredentials,n._appCheckCredentials,n._queue,u),!((o=c.cache)===null||o===void 0)&&o._offlineComponentProvider&&(!((s=c.cache)===null||s===void 0)&&s._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:c.cache.kind,_offline:c.cache._offlineComponentProvider,_online:c.cache._onlineComponentProvider})}(function(n,e=!0){(function(o){S$2=o})(SDK_VERSION$1),_registerComponent(new Component("firestore",(o,{instanceIdentifier:s,options:c})=>{const u=o.getProvider("app").getImmediate(),d=new vh(new z$1(o.getProvider("auth-internal")),new Y$2(o.getProvider("app-check-internal")),function(m,_){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new U$1(q$1.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Oe$2(m.options.projectId,_)}(u,s),u);return c=Object.assign({useFetchStreams:e},c),d._setSettings(c),d},"PUBLIC").setMultipleInstances(!0)),registerVersion(b,"3.12.1",n),registerVersion(b,"3.12.1","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_HOST="firebasestorage.googleapis.com",CONFIG_STORAGE_BUCKET_KEY="storageBucket",DEFAULT_MAX_OPERATION_RETRY_TIME=2*60*1e3,DEFAULT_MAX_UPLOAD_RETRY_TIME=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StorageError extends FirebaseError{constructor(e,o,s=0){super(prependCode(e),`Firebase Storage: ${o} (${prependCode(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return prependCode(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var StorageErrorCode;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(StorageErrorCode||(StorageErrorCode={}));function prependCode(n){return"storage/"+n}function unknown(){const n="An unknown error occurred, please check the error payload for server response.";return new StorageError(StorageErrorCode.UNKNOWN,n)}function retryLimitExceeded(){return new StorageError(StorageErrorCode.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function canceled(){return new StorageError(StorageErrorCode.CANCELED,"User canceled the upload/download.")}function invalidUrl(n){return new StorageError(StorageErrorCode.INVALID_URL,"Invalid URL '"+n+"'.")}function invalidDefaultBucket(n){return new StorageError(StorageErrorCode.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function invalidArgument(n){return new StorageError(StorageErrorCode.INVALID_ARGUMENT,n)}function appDeleted(){return new StorageError(StorageErrorCode.APP_DELETED,"The Firebase app was deleted.")}function invalidRootOperation(n){return new StorageError(StorageErrorCode.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Location{constructor(e,o){this.bucket=e,this.path_=o}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,o){let s;try{s=Location.makeFromUrl(e,o)}catch{return new Location(e,"")}if(s.path==="")return s;throw invalidDefaultBucket(e)}static makeFromUrl(e,o){let s=null;const c="([A-Za-z0-9.\\-_]+)";function u(fh){fh.path.charAt(fh.path.length-1)==="/"&&(fh.path_=fh.path_.slice(0,-1))}const d="(/(.*))?$",m=new RegExp("^gs://"+c+d,"i"),_={bucket:1,path:3};function ue(fh){fh.path_=decodeURIComponent(fh.path)}const gn="v[A-Za-z0-9_]+",nh=o.replace(/[.]/g,"\\."),ih="(/([^?#]*).*)?$",rh=new RegExp(`^https?://${nh}/${gn}/b/${c}/o${ih}`,"i"),oh={bucket:1,path:3},lh=o===DEFAULT_HOST?"(?:storage.googleapis.com|storage.cloud.google.com)":o,ch="([^?#]*)",dh=new RegExp(`^https?://${lh}/${c}/${ch}`,"i"),Sh=[{regex:m,indices:_,postModify:u},{regex:rh,indices:oh,postModify:ue},{regex:dh,indices:{bucket:1,path:2},postModify:ue}];for(let fh=0;fh<Sh.length;fh++){const yh=Sh[fh],mh=yh.regex.exec(e);if(mh){const Ch=mh[yh.indices.bucket];let Mh=mh[yh.indices.path];Mh||(Mh=""),s=new Location(Ch,Mh),yh.postModify(s);break}}if(s==null)throw invalidUrl(e);return s}}class FailRequest{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function start(n,e,o){let s=1,c=null,u=null,d=!1,m=0;function _(){return m===2}let ue=!1;function gn(...ch){ue||(ue=!0,e.apply(null,ch))}function nh(ch){c=setTimeout(()=>{c=null,n(rh,_())},ch)}function ih(){u&&clearTimeout(u)}function rh(ch,...dh){if(ue){ih();return}if(ch){ih(),gn.call(null,ch,...dh);return}if(_()||d){ih(),gn.call(null,ch,...dh);return}s<64&&(s*=2);let Sh;m===1?(m=2,Sh=0):Sh=(s+Math.random())*1e3,nh(Sh)}let oh=!1;function lh(ch){oh||(oh=!0,ih(),!ue&&(c!==null?(ch||(m=2),clearTimeout(c),nh(0)):ch||(m=1)))}return nh(0),u=setTimeout(()=>{d=!0,lh(!0)},o),lh}function stop(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isJustDef(n){return n!==void 0}function validateNumber(n,e,o,s){if(s<e)throw invalidArgument(`Invalid value for '${n}'. Expected ${e} or greater.`);if(s>o)throw invalidArgument(`Invalid value for '${n}'. Expected ${o} or less.`)}function makeQueryString(n){const e=encodeURIComponent;let o="?";for(const s in n)if(n.hasOwnProperty(s)){const c=e(s)+"="+e(n[s]);o=o+c+"&"}return o=o.slice(0,-1),o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ErrorCode;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isRetryStatusCode(n,e){const o=n>=500&&n<600,c=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return o||c||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NetworkRequest{constructor(e,o,s,c,u,d,m,_,ue,gn,nh,ih=!0){this.url_=e,this.method_=o,this.headers_=s,this.body_=c,this.successCodes_=u,this.additionalRetryCodes_=d,this.callback_=m,this.errorCallback_=_,this.timeout_=ue,this.progressCallback_=gn,this.connectionFactory_=nh,this.retry=ih,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((rh,oh)=>{this.resolve_=rh,this.reject_=oh,this.start_()})}start_(){const e=(s,c)=>{if(c){s(!1,new RequestEndStatus(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const d=m=>{const _=m.loaded,ue=m.lengthComputable?m.total:-1;this.progressCallback_!==null&&this.progressCallback_(_,ue)};this.progressCallback_!==null&&u.addUploadProgressListener(d),u.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(d),this.pendingConnection_=null;const m=u.getErrorCode()===ErrorCode.NO_ERROR,_=u.getStatus();if(!m||isRetryStatusCode(_,this.additionalRetryCodes_)&&this.retry){const gn=u.getErrorCode()===ErrorCode.ABORT;s(!1,new RequestEndStatus(!1,null,gn));return}const ue=this.successCodes_.indexOf(_)!==-1;s(!0,new RequestEndStatus(ue,u))})},o=(s,c)=>{const u=this.resolve_,d=this.reject_,m=c.connection;if(c.wasSuccessCode)try{const _=this.callback_(m,m.getResponse());isJustDef(_)?u(_):u()}catch(_){d(_)}else if(m!==null){const _=unknown();_.serverResponse=m.getErrorText(),this.errorCallback_?d(this.errorCallback_(m,_)):d(_)}else if(c.canceled){const _=this.appDelete_?appDeleted():canceled();d(_)}else{const _=retryLimitExceeded();d(_)}};this.canceled_?o(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(e,o,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class RequestEndStatus{constructor(e,o,s){this.wasSuccessCode=e,this.connection=o,this.canceled=!!s}}function addAuthHeader_(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function addVersionHeader_(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function addGmpidHeader_(n,e){e&&(n["X-Firebase-GMPID"]=e)}function addAppCheckHeader_(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function makeRequest(n,e,o,s,c,u,d=!0){const m=makeQueryString(n.urlParams),_=n.url+m,ue=Object.assign({},n.headers);return addGmpidHeader_(ue,e),addAuthHeader_(ue,o),addVersionHeader_(ue,u),addAppCheckHeader_(ue,s),new NetworkRequest(_,n.method,ue,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,c,d)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parent(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function lastComponent(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Reference{constructor(e,o){this._service=e,o instanceof Location?this._location=o:this._location=Location.makeFromUrl(o,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,o){return new Reference(e,o)}get root(){const e=new Location(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lastComponent(this._location.path)}get storage(){return this._service}get parent(){const e=parent(this._location.path);if(e===null)return null;const o=new Location(this._location.bucket,e);return new Reference(this._service,o)}_throwIfRoot(e){if(this._location.path==="")throw invalidRootOperation(e)}}function extractBucket(n,e){const o=e==null?void 0:e[CONFIG_STORAGE_BUCKET_KEY];return o==null?null:Location.makeFromBucketSpec(o,n)}class FirebaseStorageImpl{constructor(e,o,s,c,u){this.app=e,this._authProvider=o,this._appCheckProvider=s,this._url=c,this._firebaseVersion=u,this._bucket=null,this._host=DEFAULT_HOST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DEFAULT_MAX_OPERATION_RETRY_TIME,this._maxUploadRetryTime=DEFAULT_MAX_UPLOAD_RETRY_TIME,this._requests=new Set,c!=null?this._bucket=Location.makeFromBucketSpec(c,this._host):this._bucket=extractBucket(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Location.makeFromBucketSpec(this._url,e):this._bucket=extractBucket(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){validateNumber("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){validateNumber("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const o=await e.getToken();if(o!==null)return o.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Reference(this,e)}_makeRequest(e,o,s,c,u=!0){if(this._deleted)return new FailRequest(appDeleted());{const d=makeRequest(e,this._appId,s,c,o,this._firebaseVersion,u);return this._requests.add(d),d.getPromise().then(()=>this._requests.delete(d),()=>this._requests.delete(d)),d}}async makeRequestWithTokens(e,o){const[s,c]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,o,s,c).getPromise()}}const name="@firebase/storage",version="0.11.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const STORAGE_TYPE="storage";function factory(n,{instanceIdentifier:e}){const o=n.getProvider("app").getImmediate(),s=n.getProvider("auth-internal"),c=n.getProvider("app-check-internal");return new FirebaseStorageImpl(o,s,c,e,SDK_VERSION$1)}function registerStorage(){_registerComponent(new Component(STORAGE_TYPE,factory,"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version,""),registerVersion(name,version,"esm2017")}registerStorage();const _initialStatesMap=new WeakMap;function useSSRInitialState(n,e){return _initialStatesMap.has(e)||_initialStatesMap.set(e,n||{f:{},r:{},s:{},u:{}}),_initialStatesMap.get(e)}function getInitialValue(n,e,o,s){if(!n)return o;const[c,u]=getDataSourceInfo(n);if(!c)return o;const d=useSSRInitialState(void 0,s)[c]||{},m=e||u;return m&&m in d?d[m]:o}function deferInitialValueSetup(n,e,o,s){if(!n)return;const[c,u]=getDataSourceInfo(n);if(!c)return;const d=useSSRInitialState(void 0,s)[c],m=e||u;if(m)return o.then(_=>{d[m]=_}).catch(noop$1),m}function getDataSourceInfo(n){return isFirestoreDataReference(n)||isFirestoreQuery(n)?["f",n.path]:isDatabaseReference(n)?["r",n.toString()]:isStorageReference(n)?["s",n.toString()]:[]}const appPendingPromises=new WeakMap;function addPendingPromise(n,e,o){const s=useFirebaseApp();appPendingPromises.has(s)||appPendingPromises.set(s,new Map);const c=appPendingPromises.get(s),u=deferInitialValueSetup(e,o,n,s);return u&&c.set(u,n),u?()=>c.delete(u):noop$1}function createRecordFromDatabaseSnapshot(n){if(!n.exists())return null;const e=n.val();return isObject(e)?Object.defineProperty(e,"id",{value:n.key}):{$value:e,id:n.key}}function indexForKey(n,e){for(let o=0;o<n.length;o++)if(n[o].id===e)return o;return-1}const DEFAULT_OPTIONS$1={reset:!1,serialize:createRecordFromDatabaseSnapshot,wait:!0};function bindAsObject(n,e,o,s,c){const u=Object.assign({},DEFAULT_OPTIONS$1,c);let d=noop$1;function m(_){const ue=u.serialize(_);n.value=ue,o(ue)}return u.once?get(e).then(m).catch(s):d=onValue(e,m,s),_=>{if(d(),_){const ue=typeof _=="function"?_():null;n.value=ue}}}function bindAsArray(n,e,o,s,c){const u=Object.assign({},DEFAULT_OPTIONS$1,c);let d=u.wait?[]:n;u.wait||(n.value=[]);let m=noop$1,_=noop$1,ue=noop$1,gn=noop$1,nh=noop$1;return u.once?get(e).then(ih=>{const rh=[];ih.forEach(oh=>{rh.push(u.serialize(oh))}),o(n.value=rh)}).catch(s):(m=onChildAdded(e,(ih,rh)=>{const oh=unref(d),lh=rh?indexForKey(oh,rh)+1:0;oh.splice(lh,0,u.serialize(ih))},s),ue=onChildRemoved(e,ih=>{const rh=unref(d);rh.splice(indexForKey(rh,ih.key),1)},s),_=onChildChanged(e,ih=>{const rh=unref(d);rh.splice(indexForKey(rh,ih.key),1,u.serialize(ih))},s),gn=onChildMoved(e,(ih,rh)=>{const oh=unref(d),lh=indexForKey(oh,ih.key),ch=oh.splice(lh,1)[0],dh=rh?indexForKey(oh,rh)+1:0;oh.splice(dh,0,ch)},s),nh=onValue(e,()=>{const ih=unref(d);u.wait&&(n.value=ih,d=n),o(ih),nh()},s)),ih=>{if(nh(),m(),ue(),_(),gn(),ih){const rh=typeof ih=="function"?ih():[];n.value=rh}}}function _useDatabaseRef(n,e={},o=!1){let s=noop$1;const c=Object.assign({},DEFAULT_OPTIONS$1,e),u=unref(n),d=c.target||ref$1();isSSR()&&(c.once=!0);const m=getInitialValue(u,c.ssrKey,d.value,useFirebaseApp());d.value=m;let ue=!(o?(m||[]).length>0:m!==void 0);const gn=ref$1(),nh=ref$1(!1),ih=shallowRef(),rh=getCurrentScope();let oh=noop$1;function lh(){const _h=unref(n),Sh=new Promise((fh,yh)=>{if(s(c.reset),!_h)return s=noop$1,fh(null);nh.value=ue,ue=!0,Array.isArray(d.value)?s=bindAsArray(d,_h,fh,yh,c):s=bindAsObject(d,_h,fh,yh,c)}).catch(fh=>{throw ih.value===Sh&&(gn.value=fh),fh}).finally(()=>{ih.value===Sh&&(nh.value=!1)});ih.value=Sh}let ch=noop$1;isRef(n)&&(ch=watch(n,lh)),lh(),u&&(oh=addPendingPromise(ih.value,u)),rh&&(onScopeDispose(dh),getCurrentInstance()&&onServerPrefetch(()=>ih.value));function dh(_h=c.reset){ch(),oh(),s(_h)}return Object.defineProperties(d,{data:{get:()=>d},error:{get:()=>gn},pending:{get:()=>nh},promise:{get:()=>ih},stop:{get:()=>dh}})}function useDatabaseList(n,e){const o=ref$1([]);return _useDatabaseRef(n,{target:o,...e},!0)}function VueFireAuth(n){return(e,o)=>{const s=getGlobalScope(e,o).run(()=>ref$1(n));authUserMap.set(e,s),setupOnAuthStateChanged(s,e)}}function VueFire(n,{firebaseApp:e,modules:o=[]}){n.provide(_FirebaseAppInjectionKey,e);for(const s of o)n.use(s.bind(null,e))}/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const isBrowser=typeof window<"u";function isESModule(n){return n.__esModule||n[Symbol.toStringTag]==="Module"}const assign=Object.assign;function applyToParams(n,e){const o={};for(const s in e){const c=e[s];o[s]=isArray(c)?c.map(n):n(c)}return o}const noop=()=>{},isArray=Array.isArray,TRAILING_SLASH_RE=/\/$/,removeTrailingSlash=n=>n.replace(TRAILING_SLASH_RE,"");function parseURL(n,e,o="/"){let s,c={},u="",d="";const m=e.indexOf("#");let _=e.indexOf("?");return m<_&&m>=0&&(_=-1),_>-1&&(s=e.slice(0,_),u=e.slice(_+1,m>-1?m:e.length),c=n(u)),m>-1&&(s=s||e.slice(0,m),d=e.slice(m,e.length)),s=resolveRelativePath(s??e,o),{fullPath:s+(u&&"?")+u+d,path:s,query:c,hash:d}}function stringifyURL(n,e){const o=e.query?n(e.query):"";return e.path+(o&&"?")+o+(e.hash||"")}function stripBase(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function isSameRouteLocation(n,e,o){const s=e.matched.length-1,c=o.matched.length-1;return s>-1&&s===c&&isSameRouteRecord(e.matched[s],o.matched[c])&&isSameRouteLocationParams(e.params,o.params)&&n(e.query)===n(o.query)&&e.hash===o.hash}function isSameRouteRecord(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function isSameRouteLocationParams(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const o in n)if(!isSameRouteLocationParamsValue(n[o],e[o]))return!1;return!0}function isSameRouteLocationParamsValue(n,e){return isArray(n)?isEquivalentArray(n,e):isArray(e)?isEquivalentArray(e,n):n===e}function isEquivalentArray(n,e){return isArray(e)?n.length===e.length&&n.every((o,s)=>o===e[s]):n.length===1&&n[0]===e}function resolveRelativePath(n,e){if(n.startsWith("/"))return n;if(!n)return e;const o=e.split("/"),s=n.split("/");let c=o.length-1,u,d;for(u=0;u<s.length;u++)if(d=s[u],d!==".")if(d==="..")c>1&&c--;else break;return o.slice(0,c).join("/")+"/"+s.slice(u-(u===s.length?1:0)).join("/")}var NavigationType;(function(n){n.pop="pop",n.push="push"})(NavigationType||(NavigationType={}));var NavigationDirection;(function(n){n.back="back",n.forward="forward",n.unknown=""})(NavigationDirection||(NavigationDirection={}));function normalizeBase(n){if(!n)if(isBrowser){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),removeTrailingSlash(n)}const BEFORE_HASH_RE=/^[^#]+#/;function createHref(n,e){return n.replace(BEFORE_HASH_RE,"#")+e}function getElementPosition(n,e){const o=document.documentElement.getBoundingClientRect(),s=n.getBoundingClientRect();return{behavior:e.behavior,left:s.left-o.left-(e.left||0),top:s.top-o.top-(e.top||0)}}const computeScrollPosition=()=>({left:window.pageXOffset,top:window.pageYOffset});function scrollToPosition(n){let e;if("el"in n){const o=n.el,s=typeof o=="string"&&o.startsWith("#"),c=typeof o=="string"?s?document.getElementById(o.slice(1)):document.querySelector(o):o;if(!c)return;e=getElementPosition(c,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}function getScrollKey(n,e){return(history.state?history.state.position-e:-1)+n}const scrollPositions=new Map;function saveScrollPosition(n,e){scrollPositions.set(n,e)}function getSavedScrollPosition(n){const e=scrollPositions.get(n);return scrollPositions.delete(n),e}let createBaseLocation=()=>location.protocol+"//"+location.host;function createCurrentLocation(n,e){const{pathname:o,search:s,hash:c}=e,u=n.indexOf("#");if(u>-1){let m=c.includes(n.slice(u))?n.slice(u).length:1,_=c.slice(m);return _[0]!=="/"&&(_="/"+_),stripBase(_,"")}return stripBase(o,n)+s+c}function useHistoryListeners(n,e,o,s){let c=[],u=[],d=null;const m=({state:ih})=>{const rh=createCurrentLocation(n,location),oh=o.value,lh=e.value;let ch=0;if(ih){if(o.value=rh,e.value=ih,d&&d===oh){d=null;return}ch=lh?ih.position-lh.position:0}else s(rh);c.forEach(dh=>{dh(o.value,oh,{delta:ch,type:NavigationType.pop,direction:ch?ch>0?NavigationDirection.forward:NavigationDirection.back:NavigationDirection.unknown})})};function _(){d=o.value}function ue(ih){c.push(ih);const rh=()=>{const oh=c.indexOf(ih);oh>-1&&c.splice(oh,1)};return u.push(rh),rh}function gn(){const{history:ih}=window;ih.state&&ih.replaceState(assign({},ih.state,{scroll:computeScrollPosition()}),"")}function nh(){for(const ih of u)ih();u=[],window.removeEventListener("popstate",m),window.removeEventListener("beforeunload",gn)}return window.addEventListener("popstate",m),window.addEventListener("beforeunload",gn),{pauseListeners:_,listen:ue,destroy:nh}}function buildState(n,e,o,s=!1,c=!1){return{back:n,current:e,forward:o,replaced:s,position:window.history.length,scroll:c?computeScrollPosition():null}}function useHistoryStateNavigation(n){const{history:e,location:o}=window,s={value:createCurrentLocation(n,o)},c={value:e.state};c.value||u(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function u(_,ue,gn){const nh=n.indexOf("#"),ih=nh>-1?(o.host&&document.querySelector("base")?n:n.slice(nh))+_:createBaseLocation()+n+_;try{e[gn?"replaceState":"pushState"](ue,"",ih),c.value=ue}catch(rh){console.error(rh),o[gn?"replace":"assign"](ih)}}function d(_,ue){const gn=assign({},e.state,buildState(c.value.back,_,c.value.forward,!0),ue,{position:c.value.position});u(_,gn,!0),s.value=_}function m(_,ue){const gn=assign({},c.value,e.state,{forward:_,scroll:computeScrollPosition()});u(gn.current,gn,!0);const nh=assign({},buildState(s.value,_,null),{position:gn.position+1},ue);u(_,nh,!1),s.value=_}return{location:s,state:c,push:m,replace:d}}function createWebHistory(n){n=normalizeBase(n);const e=useHistoryStateNavigation(n),o=useHistoryListeners(n,e.state,e.location,e.replace);function s(u,d=!0){d||o.pauseListeners(),history.go(u)}const c=assign({location:"",base:n,go:s,createHref:createHref.bind(null,n)},e,o);return Object.defineProperty(c,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(c,"state",{enumerable:!0,get:()=>e.state.value}),c}function isRouteLocation(n){return typeof n=="string"||n&&typeof n=="object"}function isRouteName(n){return typeof n=="string"||typeof n=="symbol"}const START_LOCATION_NORMALIZED={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},NavigationFailureSymbol=Symbol("");var NavigationFailureType;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(NavigationFailureType||(NavigationFailureType={}));function createRouterError(n,e){return assign(new Error,{type:n,[NavigationFailureSymbol]:!0},e)}function isNavigationFailure(n,e){return n instanceof Error&&NavigationFailureSymbol in n&&(e==null||!!(n.type&e))}const BASE_PARAM_PATTERN="[^/]+?",BASE_PATH_PARSER_OPTIONS={sensitive:!1,strict:!1,start:!0,end:!0},REGEX_CHARS_RE=/[.+*?^${}()[\]/\\]/g;function tokensToParser(n,e){const o=assign({},BASE_PATH_PARSER_OPTIONS,e),s=[];let c=o.start?"^":"";const u=[];for(const ue of n){const gn=ue.length?[]:[90];o.strict&&!ue.length&&(c+="/");for(let nh=0;nh<ue.length;nh++){const ih=ue[nh];let rh=40+(o.sensitive?.25:0);if(ih.type===0)nh||(c+="/"),c+=ih.value.replace(REGEX_CHARS_RE,"\\$&"),rh+=40;else if(ih.type===1){const{value:oh,repeatable:lh,optional:ch,regexp:dh}=ih;u.push({name:oh,repeatable:lh,optional:ch});const _h=dh||BASE_PARAM_PATTERN;if(_h!==BASE_PARAM_PATTERN){rh+=10;try{new RegExp(`(${_h})`)}catch(fh){throw new Error(`Invalid custom RegExp for param "${oh}" (${_h}): `+fh.message)}}let Sh=lh?`((?:${_h})(?:/(?:${_h}))*)`:`(${_h})`;nh||(Sh=ch&&ue.length<2?`(?:/${Sh})`:"/"+Sh),ch&&(Sh+="?"),c+=Sh,rh+=20,ch&&(rh+=-8),lh&&(rh+=-20),_h===".*"&&(rh+=-50)}gn.push(rh)}s.push(gn)}if(o.strict&&o.end){const ue=s.length-1;s[ue][s[ue].length-1]+=.7000000000000001}o.strict||(c+="/?"),o.end?c+="$":o.strict&&(c+="(?:/|$)");const d=new RegExp(c,o.sensitive?"":"i");function m(ue){const gn=ue.match(d),nh={};if(!gn)return null;for(let ih=1;ih<gn.length;ih++){const rh=gn[ih]||"",oh=u[ih-1];nh[oh.name]=rh&&oh.repeatable?rh.split("/"):rh}return nh}function _(ue){let gn="",nh=!1;for(const ih of n){(!nh||!gn.endsWith("/"))&&(gn+="/"),nh=!1;for(const rh of ih)if(rh.type===0)gn+=rh.value;else if(rh.type===1){const{value:oh,repeatable:lh,optional:ch}=rh,dh=oh in ue?ue[oh]:"";if(isArray(dh)&&!lh)throw new Error(`Provided param "${oh}" is an array but it is not repeatable (* or + modifiers)`);const _h=isArray(dh)?dh.join("/"):dh;if(!_h)if(ch)ih.length<2&&(gn.endsWith("/")?gn=gn.slice(0,-1):nh=!0);else throw new Error(`Missing required param "${oh}"`);gn+=_h}}return gn||"/"}return{re:d,score:s,keys:u,parse:m,stringify:_}}function compareScoreArray(n,e){let o=0;for(;o<n.length&&o<e.length;){const s=e[o]-n[o];if(s)return s;o++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function comparePathParserScore(n,e){let o=0;const s=n.score,c=e.score;for(;o<s.length&&o<c.length;){const u=compareScoreArray(s[o],c[o]);if(u)return u;o++}if(Math.abs(c.length-s.length)===1){if(isLastScoreNegative(s))return 1;if(isLastScoreNegative(c))return-1}return c.length-s.length}function isLastScoreNegative(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const ROOT_TOKEN={type:0,value:""},VALID_PARAM_RE=/[a-zA-Z0-9_]/;function tokenizePath(n){if(!n)return[[]];if(n==="/")return[[ROOT_TOKEN]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(rh){throw new Error(`ERR (${o})/"${ue}": ${rh}`)}let o=0,s=o;const c=[];let u;function d(){u&&c.push(u),u=[]}let m=0,_,ue="",gn="";function nh(){ue&&(o===0?u.push({type:0,value:ue}):o===1||o===2||o===3?(u.length>1&&(_==="*"||_==="+")&&e(`A repeatable param (${ue}) must be alone in its segment. eg: '/:ids+.`),u.push({type:1,value:ue,regexp:gn,repeatable:_==="*"||_==="+",optional:_==="*"||_==="?"})):e("Invalid state to consume buffer"),ue="")}function ih(){ue+=_}for(;m<n.length;){if(_=n[m++],_==="\\"&&o!==2){s=o,o=4;continue}switch(o){case 0:_==="/"?(ue&&nh(),d()):_===":"?(nh(),o=1):ih();break;case 4:ih(),o=s;break;case 1:_==="("?o=2:VALID_PARAM_RE.test(_)?ih():(nh(),o=0,_!=="*"&&_!=="?"&&_!=="+"&&m--);break;case 2:_===")"?gn[gn.length-1]=="\\"?gn=gn.slice(0,-1)+_:o=3:gn+=_;break;case 3:nh(),o=0,_!=="*"&&_!=="?"&&_!=="+"&&m--,gn="";break;default:e("Unknown state");break}}return o===2&&e(`Unfinished custom RegExp for param "${ue}"`),nh(),d(),c}function createRouteRecordMatcher(n,e,o){const s=tokensToParser(tokenizePath(n.path),o),c=assign(s,{record:n,parent:e,children:[],alias:[]});return e&&!c.record.aliasOf==!e.record.aliasOf&&e.children.push(c),c}function createRouterMatcher(n,e){const o=[],s=new Map;e=mergeOptions({strict:!1,end:!0,sensitive:!1},e);function c(gn){return s.get(gn)}function u(gn,nh,ih){const rh=!ih,oh=normalizeRouteRecord(gn);oh.aliasOf=ih&&ih.record;const lh=mergeOptions(e,gn),ch=[oh];if("alias"in gn){const Sh=typeof gn.alias=="string"?[gn.alias]:gn.alias;for(const fh of Sh)ch.push(assign({},oh,{components:ih?ih.record.components:oh.components,path:fh,aliasOf:ih?ih.record:oh}))}let dh,_h;for(const Sh of ch){const{path:fh}=Sh;if(nh&&fh[0]!=="/"){const yh=nh.record.path,mh=yh[yh.length-1]==="/"?"":"/";Sh.path=nh.record.path+(fh&&mh+fh)}if(dh=createRouteRecordMatcher(Sh,nh,lh),ih?ih.alias.push(dh):(_h=_h||dh,_h!==dh&&_h.alias.push(dh),rh&&gn.name&&!isAliasRecord(dh)&&d(gn.name)),oh.children){const yh=oh.children;for(let mh=0;mh<yh.length;mh++)u(yh[mh],dh,ih&&ih.children[mh])}ih=ih||dh,(dh.record.components&&Object.keys(dh.record.components).length||dh.record.name||dh.record.redirect)&&_(dh)}return _h?()=>{d(_h)}:noop}function d(gn){if(isRouteName(gn)){const nh=s.get(gn);nh&&(s.delete(gn),o.splice(o.indexOf(nh),1),nh.children.forEach(d),nh.alias.forEach(d))}else{const nh=o.indexOf(gn);nh>-1&&(o.splice(nh,1),gn.record.name&&s.delete(gn.record.name),gn.children.forEach(d),gn.alias.forEach(d))}}function m(){return o}function _(gn){let nh=0;for(;nh<o.length&&comparePathParserScore(gn,o[nh])>=0&&(gn.record.path!==o[nh].record.path||!isRecordChildOf(gn,o[nh]));)nh++;o.splice(nh,0,gn),gn.record.name&&!isAliasRecord(gn)&&s.set(gn.record.name,gn)}function ue(gn,nh){let ih,rh={},oh,lh;if("name"in gn&&gn.name){if(ih=s.get(gn.name),!ih)throw createRouterError(1,{location:gn});lh=ih.record.name,rh=assign(paramsFromLocation(nh.params,ih.keys.filter(_h=>!_h.optional).map(_h=>_h.name)),gn.params&&paramsFromLocation(gn.params,ih.keys.map(_h=>_h.name))),oh=ih.stringify(rh)}else if("path"in gn)oh=gn.path,ih=o.find(_h=>_h.re.test(oh)),ih&&(rh=ih.parse(oh),lh=ih.record.name);else{if(ih=nh.name?s.get(nh.name):o.find(_h=>_h.re.test(nh.path)),!ih)throw createRouterError(1,{location:gn,currentLocation:nh});lh=ih.record.name,rh=assign({},nh.params,gn.params),oh=ih.stringify(rh)}const ch=[];let dh=ih;for(;dh;)ch.unshift(dh.record),dh=dh.parent;return{name:lh,path:oh,params:rh,matched:ch,meta:mergeMetaFields(ch)}}return n.forEach(gn=>u(gn)),{addRoute:u,resolve:ue,removeRoute:d,getRoutes:m,getRecordMatcher:c}}function paramsFromLocation(n,e){const o={};for(const s of e)s in n&&(o[s]=n[s]);return o}function normalizeRouteRecord(n){return{path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:void 0,beforeEnter:n.beforeEnter,props:normalizeRecordProps(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}}}function normalizeRecordProps(n){const e={},o=n.props||!1;if("component"in n)e.default=o;else for(const s in n.components)e[s]=typeof o=="boolean"?o:o[s];return e}function isAliasRecord(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function mergeMetaFields(n){return n.reduce((e,o)=>assign(e,o.meta),{})}function mergeOptions(n,e){const o={};for(const s in n)o[s]=s in e?e[s]:n[s];return o}function isRecordChildOf(n,e){return e.children.some(o=>o===n||isRecordChildOf(n,o))}const HASH_RE=/#/g,AMPERSAND_RE=/&/g,SLASH_RE=/\//g,EQUAL_RE=/=/g,IM_RE=/\?/g,PLUS_RE=/\+/g,ENC_BRACKET_OPEN_RE=/%5B/g,ENC_BRACKET_CLOSE_RE=/%5D/g,ENC_CARET_RE=/%5E/g,ENC_BACKTICK_RE=/%60/g,ENC_CURLY_OPEN_RE=/%7B/g,ENC_PIPE_RE=/%7C/g,ENC_CURLY_CLOSE_RE=/%7D/g,ENC_SPACE_RE=/%20/g;function commonEncode(n){return encodeURI(""+n).replace(ENC_PIPE_RE,"|").replace(ENC_BRACKET_OPEN_RE,"[").replace(ENC_BRACKET_CLOSE_RE,"]")}function encodeHash(n){return commonEncode(n).replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryValue(n){return commonEncode(n).replace(PLUS_RE,"%2B").replace(ENC_SPACE_RE,"+").replace(HASH_RE,"%23").replace(AMPERSAND_RE,"%26").replace(ENC_BACKTICK_RE,"`").replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryKey(n){return encodeQueryValue(n).replace(EQUAL_RE,"%3D")}function encodePath(n){return commonEncode(n).replace(HASH_RE,"%23").replace(IM_RE,"%3F")}function encodeParam(n){return n==null?"":encodePath(n).replace(SLASH_RE,"%2F")}function decode(n){try{return decodeURIComponent(""+n)}catch{}return""+n}function parseQuery(n){const e={};if(n===""||n==="?")return e;const s=(n[0]==="?"?n.slice(1):n).split("&");for(let c=0;c<s.length;++c){const u=s[c].replace(PLUS_RE," "),d=u.indexOf("="),m=decode(d<0?u:u.slice(0,d)),_=d<0?null:decode(u.slice(d+1));if(m in e){let ue=e[m];isArray(ue)||(ue=e[m]=[ue]),ue.push(_)}else e[m]=_}return e}function stringifyQuery(n){let e="";for(let o in n){const s=n[o];if(o=encodeQueryKey(o),s==null){s!==void 0&&(e+=(e.length?"&":"")+o);continue}(isArray(s)?s.map(u=>u&&encodeQueryValue(u)):[s&&encodeQueryValue(s)]).forEach(u=>{u!==void 0&&(e+=(e.length?"&":"")+o,u!=null&&(e+="="+u))})}return e}function normalizeQuery(n){const e={};for(const o in n){const s=n[o];s!==void 0&&(e[o]=isArray(s)?s.map(c=>c==null?null:""+c):s==null?s:""+s)}return e}const matchedRouteKey=Symbol(""),viewDepthKey=Symbol(""),routerKey=Symbol(""),routeLocationKey=Symbol(""),routerViewLocationKey=Symbol("");function useCallbacks(){let n=[];function e(s){return n.push(s),()=>{const c=n.indexOf(s);c>-1&&n.splice(c,1)}}function o(){n=[]}return{add:e,list:()=>n,reset:o}}function guardToPromiseFn(n,e,o,s,c){const u=s&&(s.enterCallbacks[c]=s.enterCallbacks[c]||[]);return()=>new Promise((d,m)=>{const _=nh=>{nh===!1?m(createRouterError(4,{from:o,to:e})):nh instanceof Error?m(nh):isRouteLocation(nh)?m(createRouterError(2,{from:e,to:nh})):(u&&s.enterCallbacks[c]===u&&typeof nh=="function"&&u.push(nh),d())},ue=n.call(s&&s.instances[c],e,o,_);let gn=Promise.resolve(ue);n.length<3&&(gn=gn.then(_)),gn.catch(nh=>m(nh))})}function extractComponentsGuards(n,e,o,s){const c=[];for(const u of n)for(const d in u.components){let m=u.components[d];if(!(e!=="beforeRouteEnter"&&!u.instances[d]))if(isRouteComponent(m)){const ue=(m.__vccOpts||m)[e];ue&&c.push(guardToPromiseFn(ue,o,s,u,d))}else{let _=m();c.push(()=>_.then(ue=>{if(!ue)return Promise.reject(new Error(`Couldn't resolve component "${d}" at "${u.path}"`));const gn=isESModule(ue)?ue.default:ue;u.components[d]=gn;const ih=(gn.__vccOpts||gn)[e];return ih&&guardToPromiseFn(ih,o,s,u,d)()}))}}return c}function isRouteComponent(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function useLink(n){const e=inject(routerKey),o=inject(routeLocationKey),s=computed(()=>e.resolve(unref(n.to))),c=computed(()=>{const{matched:_}=s.value,{length:ue}=_,gn=_[ue-1],nh=o.matched;if(!gn||!nh.length)return-1;const ih=nh.findIndex(isSameRouteRecord.bind(null,gn));if(ih>-1)return ih;const rh=getOriginalPath(_[ue-2]);return ue>1&&getOriginalPath(gn)===rh&&nh[nh.length-1].path!==rh?nh.findIndex(isSameRouteRecord.bind(null,_[ue-2])):ih}),u=computed(()=>c.value>-1&&includesParams(o.params,s.value.params)),d=computed(()=>c.value>-1&&c.value===o.matched.length-1&&isSameRouteLocationParams(o.params,s.value.params));function m(_={}){return guardEvent(_)?e[unref(n.replace)?"replace":"push"](unref(n.to)).catch(noop):Promise.resolve()}return{route:s,href:computed(()=>s.value.href),isActive:u,isExactActive:d,navigate:m}}const RouterLinkImpl=defineComponent({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink,setup(n,{slots:e}){const o=reactive(useLink(n)),{options:s}=inject(routerKey),c=computed(()=>({[getLinkClass(n.activeClass,s.linkActiveClass,"router-link-active")]:o.isActive,[getLinkClass(n.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:o.isExactActive}));return()=>{const u=e.default&&e.default(o);return n.custom?u:h$1("a",{"aria-current":o.isExactActive?n.ariaCurrentValue:null,href:o.href,onClick:o.navigate,class:c.value},u)}}}),RouterLink=RouterLinkImpl;function guardEvent(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function includesParams(n,e){for(const o in e){const s=e[o],c=n[o];if(typeof s=="string"){if(s!==c)return!1}else if(!isArray(c)||c.length!==s.length||s.some((u,d)=>u!==c[d]))return!1}return!0}function getOriginalPath(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const getLinkClass=(n,e,o)=>n??e??o,RouterViewImpl=defineComponent({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:o}){const s=inject(routerViewLocationKey),c=computed(()=>n.route||s.value),u=inject(viewDepthKey,0),d=computed(()=>{let ue=unref(u);const{matched:gn}=c.value;let nh;for(;(nh=gn[ue])&&!nh.components;)ue++;return ue}),m=computed(()=>c.value.matched[d.value]);provide(viewDepthKey,computed(()=>d.value+1)),provide(matchedRouteKey,m),provide(routerViewLocationKey,c);const _=ref$1();return watch(()=>[_.value,m.value,n.name],([ue,gn,nh],[ih,rh,oh])=>{gn&&(gn.instances[nh]=ue,rh&&rh!==gn&&ue&&ue===ih&&(gn.leaveGuards.size||(gn.leaveGuards=rh.leaveGuards),gn.updateGuards.size||(gn.updateGuards=rh.updateGuards))),ue&&gn&&(!rh||!isSameRouteRecord(gn,rh)||!ih)&&(gn.enterCallbacks[nh]||[]).forEach(lh=>lh(ue))},{flush:"post"}),()=>{const ue=c.value,gn=n.name,nh=m.value,ih=nh&&nh.components[gn];if(!ih)return normalizeSlot(o.default,{Component:ih,route:ue});const rh=nh.props[gn],oh=rh?rh===!0?ue.params:typeof rh=="function"?rh(ue):rh:null,ch=h$1(ih,assign({},oh,e,{onVnodeUnmounted:dh=>{dh.component.isUnmounted&&(nh.instances[gn]=null)},ref:_}));return normalizeSlot(o.default,{Component:ch,route:ue})||ch}}});function normalizeSlot(n,e){if(!n)return null;const o=n(e);return o.length===1?o[0]:o}const RouterView=RouterViewImpl;function createRouter(n){const e=createRouterMatcher(n.routes,n),o=n.parseQuery||parseQuery,s=n.stringifyQuery||stringifyQuery,c=n.history,u=useCallbacks(),d=useCallbacks(),m=useCallbacks(),_=shallowRef(START_LOCATION_NORMALIZED);let ue=START_LOCATION_NORMALIZED;isBrowser&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const gn=applyToParams.bind(null,Th=>""+Th),nh=applyToParams.bind(null,encodeParam),ih=applyToParams.bind(null,decode);function rh(Th,Fh){let Dh,Gh;return isRouteName(Th)?(Dh=e.getRecordMatcher(Th),Gh=Fh):Gh=Th,e.addRoute(Gh,Dh)}function oh(Th){const Fh=e.getRecordMatcher(Th);Fh&&e.removeRoute(Fh)}function lh(){return e.getRoutes().map(Th=>Th.record)}function ch(Th){return!!e.getRecordMatcher(Th)}function dh(Th,Fh){if(Fh=assign({},Fh||_.value),typeof Th=="string"){const uh=parseURL(o,Th,Fh.path),ph=e.resolve({path:uh.path},Fh),kh=c.createHref(uh.fullPath);return assign(uh,ph,{params:ih(ph.params),hash:decode(uh.hash),redirectedFrom:void 0,href:kh})}let Dh;if("path"in Th)Dh=assign({},Th,{path:parseURL(o,Th.path,Fh.path).path});else{const uh=assign({},Th.params);for(const ph in uh)uh[ph]==null&&delete uh[ph];Dh=assign({},Th,{params:nh(Th.params)}),Fh.params=nh(Fh.params)}const Gh=e.resolve(Dh,Fh),Jh=Th.hash||"";Gh.params=gn(ih(Gh.params));const rf=stringifyURL(s,assign({},Th,{hash:encodeHash(Jh),path:Gh.path})),ef=c.createHref(rf);return assign({fullPath:rf,hash:Jh,query:s===stringifyQuery?normalizeQuery(Th.query):Th.query||{}},Gh,{redirectedFrom:void 0,href:ef})}function _h(Th){return typeof Th=="string"?parseURL(o,Th,_.value.path):assign({},Th)}function Sh(Th,Fh){if(ue!==Th)return createRouterError(8,{from:Fh,to:Th})}function fh(Th){return Ch(Th)}function yh(Th){return fh(assign(_h(Th),{replace:!0}))}function mh(Th){const Fh=Th.matched[Th.matched.length-1];if(Fh&&Fh.redirect){const{redirect:Dh}=Fh;let Gh=typeof Dh=="function"?Dh(Th):Dh;return typeof Gh=="string"&&(Gh=Gh.includes("?")||Gh.includes("#")?Gh=_h(Gh):{path:Gh},Gh.params={}),assign({query:Th.query,hash:Th.hash,params:"path"in Gh?{}:Th.params},Gh)}}function Ch(Th,Fh){const Dh=ue=dh(Th),Gh=_.value,Jh=Th.state,rf=Th.force,ef=Th.replace===!0,uh=mh(Dh);if(uh)return Ch(assign(_h(uh),{state:typeof uh=="object"?assign({},Jh,uh.state):Jh,force:rf,replace:ef}),Fh||Dh);const ph=Dh;ph.redirectedFrom=Fh;let kh;return!rf&&isSameRouteLocation(s,Gh,Dh)&&(kh=createRouterError(16,{to:ph,from:Gh}),Lh(Gh,Gh,!0,!1)),(kh?Promise.resolve(kh):Ph(ph,Gh)).catch(xh=>isNavigationFailure(xh)?isNavigationFailure(xh,2)?xh:Oh(xh):$h(xh,ph,Gh)).then(xh=>{if(xh){if(isNavigationFailure(xh,2))return Ch(assign({replace:ef},_h(xh.to),{state:typeof xh.to=="object"?assign({},Jh,xh.to.state):Jh,force:rf}),Fh||ph)}else xh=Nh(ph,Gh,!0,ef,Jh);return Eh(ph,Gh,xh),xh})}function Mh(Th,Fh){const Dh=Sh(Th,Fh);return Dh?Promise.reject(Dh):Promise.resolve()}function Ph(Th,Fh){let Dh;const[Gh,Jh,rf]=extractChangingRecords(Th,Fh);Dh=extractComponentsGuards(Gh.reverse(),"beforeRouteLeave",Th,Fh);for(const uh of Gh)uh.leaveGuards.forEach(ph=>{Dh.push(guardToPromiseFn(ph,Th,Fh))});const ef=Mh.bind(null,Th,Fh);return Dh.push(ef),runGuardQueue(Dh).then(()=>{Dh=[];for(const uh of u.list())Dh.push(guardToPromiseFn(uh,Th,Fh));return Dh.push(ef),runGuardQueue(Dh)}).then(()=>{Dh=extractComponentsGuards(Jh,"beforeRouteUpdate",Th,Fh);for(const uh of Jh)uh.updateGuards.forEach(ph=>{Dh.push(guardToPromiseFn(ph,Th,Fh))});return Dh.push(ef),runGuardQueue(Dh)}).then(()=>{Dh=[];for(const uh of Th.matched)if(uh.beforeEnter&&!Fh.matched.includes(uh))if(isArray(uh.beforeEnter))for(const ph of uh.beforeEnter)Dh.push(guardToPromiseFn(ph,Th,Fh));else Dh.push(guardToPromiseFn(uh.beforeEnter,Th,Fh));return Dh.push(ef),runGuardQueue(Dh)}).then(()=>(Th.matched.forEach(uh=>uh.enterCallbacks={}),Dh=extractComponentsGuards(rf,"beforeRouteEnter",Th,Fh),Dh.push(ef),runGuardQueue(Dh))).then(()=>{Dh=[];for(const uh of d.list())Dh.push(guardToPromiseFn(uh,Th,Fh));return Dh.push(ef),runGuardQueue(Dh)}).catch(uh=>isNavigationFailure(uh,8)?uh:Promise.reject(uh))}function Eh(Th,Fh,Dh){for(const Gh of m.list())Gh(Th,Fh,Dh)}function Nh(Th,Fh,Dh,Gh,Jh){const rf=Sh(Th,Fh);if(rf)return rf;const ef=Fh===START_LOCATION_NORMALIZED,uh=isBrowser?history.state:{};Dh&&(Gh||ef?c.replace(Th.fullPath,assign({scroll:ef&&uh&&uh.scroll},Jh)):c.push(Th.fullPath,Jh)),_.value=Th,Lh(Th,Fh,Dh,ef),Oh()}let Wh;function Yh(){Wh||(Wh=c.listen((Th,Fh,Dh)=>{if(!Qh.listening)return;const Gh=dh(Th),Jh=mh(Gh);if(Jh){Ch(assign(Jh,{replace:!0}),Gh).catch(noop);return}ue=Gh;const rf=_.value;isBrowser&&saveScrollPosition(getScrollKey(rf.fullPath,Dh.delta),computeScrollPosition()),Ph(Gh,rf).catch(ef=>isNavigationFailure(ef,12)?ef:isNavigationFailure(ef,2)?(Ch(ef.to,Gh).then(uh=>{isNavigationFailure(uh,20)&&!Dh.delta&&Dh.type===NavigationType.pop&&c.go(-1,!1)}).catch(noop),Promise.reject()):(Dh.delta&&c.go(-Dh.delta,!1),$h(ef,Gh,rf))).then(ef=>{ef=ef||Nh(Gh,rf,!1),ef&&(Dh.delta&&!isNavigationFailure(ef,8)?c.go(-Dh.delta,!1):Dh.type===NavigationType.pop&&isNavigationFailure(ef,20)&&c.go(-1,!1)),Eh(Gh,rf,ef)}).catch(noop)}))}let gh=useCallbacks(),Ah=useCallbacks(),wh;function $h(Th,Fh,Dh){Oh(Th);const Gh=Ah.list();return Gh.length?Gh.forEach(Jh=>Jh(Th,Fh,Dh)):console.error(Th),Promise.reject(Th)}function Rh(){return wh&&_.value!==START_LOCATION_NORMALIZED?Promise.resolve():new Promise((Th,Fh)=>{gh.add([Th,Fh])})}function Oh(Th){return wh||(wh=!Th,Yh(),gh.list().forEach(([Fh,Dh])=>Th?Dh(Th):Fh()),gh.reset()),Th}function Lh(Th,Fh,Dh,Gh){const{scrollBehavior:Jh}=n;if(!isBrowser||!Jh)return Promise.resolve();const rf=!Dh&&getSavedScrollPosition(getScrollKey(Th.fullPath,0))||(Gh||!Dh)&&history.state&&history.state.scroll||null;return nextTick().then(()=>Jh(Th,Fh,rf)).then(ef=>ef&&scrollToPosition(ef)).catch(ef=>$h(ef,Th,Fh))}const qh=Th=>c.go(Th);let Hh;const Xh=new Set,Qh={currentRoute:_,listening:!0,addRoute:rh,removeRoute:oh,hasRoute:ch,getRoutes:lh,resolve:dh,options:n,push:fh,replace:yh,go:qh,back:()=>qh(-1),forward:()=>qh(1),beforeEach:u.add,beforeResolve:d.add,afterEach:m.add,onError:Ah.add,isReady:Rh,install(Th){const Fh=this;Th.component("RouterLink",RouterLink),Th.component("RouterView",RouterView),Th.config.globalProperties.$router=Fh,Object.defineProperty(Th.config.globalProperties,"$route",{enumerable:!0,get:()=>unref(_)}),isBrowser&&!Hh&&_.value===START_LOCATION_NORMALIZED&&(Hh=!0,fh(c.location).catch(Jh=>{}));const Dh={};for(const Jh in START_LOCATION_NORMALIZED)Dh[Jh]=computed(()=>_.value[Jh]);Th.provide(routerKey,Fh),Th.provide(routeLocationKey,reactive(Dh)),Th.provide(routerViewLocationKey,_);const Gh=Th.unmount;Xh.add(Th),Th.unmount=function(){Xh.delete(Th),Xh.size<1&&(ue=START_LOCATION_NORMALIZED,Wh&&Wh(),Wh=null,_.value=START_LOCATION_NORMALIZED,Hh=!1,wh=!1),Gh()}}};return Qh}function runGuardQueue(n){return n.reduce((e,o)=>e.then(()=>o()),Promise.resolve())}function extractChangingRecords(n,e){const o=[],s=[],c=[],u=Math.max(e.matched.length,n.matched.length);for(let d=0;d<u;d++){const m=e.matched[d];m&&(n.matched.find(ue=>isSameRouteRecord(ue,m))?s.push(m):o.push(m));const _=n.matched[d];_&&(e.matched.find(ue=>isSameRouteRecord(ue,_))||c.push(_))}return[o,s,c]}function useRouter(){return inject(routerKey)}function useRoute(){return inject(routeLocationKey)}const useFlowStore=defineStore("flow",{state:()=>({user:null,flows:[],selectedFlowId:0}),getters:{selectedFlow:n=>{var e;return(e=n.flows.find(o=>Number(o.id)===Number(n.selectedFlowId)))==null?void 0:e.code},userId:n=>{var e;return(e=n.user)==null?void 0:e.uid}},actions:{newFlow(n){const e=getDatabase(),o=typeof this.flows[0]<"u"?Number(this.flows[this.flows.length-1].id)+1:0;set(ref(e,`users/${this.userId}/flows/${o}`),{id:o,name:n,code:`[
  {
    id: '1',
    type: 'input',
    label: '${n}',
    position: {
      x: 250,
      y: 1
    },
  }
]`}),this.selectedFlowId=o},updateFlow(n){const e=getDatabase(),o={};o[`users/${this.userId}/flows/${this.selectedFlowId}/code`]=n,update(ref(e),o)},removeFlow(n){const e=getDatabase();remove(ref(e,`users/${this.userId}/flows/${n}`)),this.selectedFlowId=this.flows[0].id},reset(){this.$reset()}},persist:{paths:["user","selectedFlowId"]}}),Header_vue_vue_type_style_index_0_scoped_711bcc94_lang="",_export_sfc=(n,e)=>{const o=n.__vccOpts||n;for(const[s,c]of e)o[s]=c;return o},_withScopeId$2=n=>(pushScopeId("data-v-711bcc94"),n=n(),popScopeId(),n),_hoisted_1$4={class:"container"},_hoisted_2$3={class:"left"},_hoisted_3$2=_withScopeId$2(()=>createBaseVNode("h1",null,"FlowChart",-1)),_hoisted_4$2=["value"],_hoisted_5$2=["disabled"],_hoisted_6$2={class:"user"},_hoisted_7$2=["src"],_sfc_main$5={__name:"Header",setup(n){const e=useFlowStore(),o=useRouter(),s=useCurrentUser(),c=ref$1();onAuthStateChanged(getAuth(),function(ue){ue?c.value=!0:(c.value=!1,o.push("/auth"))});const u=ref$1(""),d=()=>{e.newFlow(u.value),u.value="",i("Flow created!",{type:"success"})},m=ue=>{e.removeFlow(ue),i("Flow removed!",{type:"success"})},_=()=>{signOut(getAuth()),o.push("/auth"),e.reset()};return(ue,gn)=>{var nh,ih,rh;return openBlock(),createElementBlock("header",null,[createBaseVNode("div",_hoisted_1$4,[createBaseVNode("div",_hoisted_2$3,[_hoisted_3$2,unref(e).flows.length?withDirectives((openBlock(),createElementBlock("select",{key:0,"onUpdate:modelValue":gn[0]||(gn[0]=oh=>unref(e).selectedFlowId=oh)},[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(e).flows,oh=>(openBlock(),createElementBlock("option",{value:oh.id},toDisplayString(oh.name),9,_hoisted_4$2))),256))],512)),[[vModelSelect,unref(e).selectedFlowId]]):createCommentVNode("",!0),withDirectives(createBaseVNode("input",{onKeydown:gn[1]||(gn[1]=withKeys(oh=>d(),["enter"])),class:"input",type:"text","onUpdate:modelValue":gn[2]||(gn[2]=oh=>u.value=oh),placeholder:"New flow name"},null,544),[[vModelText,u.value]]),createBaseVNode("button",{disabled:!u.value,onClick:gn[3]||(gn[3]=oh=>d())},"New Flow",8,_hoisted_5$2),createBaseVNode("button",{class:"remove",onClick:gn[4]||(gn[4]=oh=>m(unref(e).selectedFlowId))},"Remove")]),createBaseVNode("div",_hoisted_6$2,[createBaseVNode("span",null,toDisplayString(((nh=unref(s))==null?void 0:nh.displayName)||((ih=unref(s))==null?void 0:ih.email)),1),createBaseVNode("img",{src:((rh=unref(s))==null?void 0:rh.photoURL)||"https://avatars.githubusercontent.com/u/499550?v=4",alt:"John Doe"},null,8,_hoisted_7$2),c.value?(openBlock(),createElementBlock("button",{key:0,onClick:_}," Logout ")):createCommentVNode("",!0)])])])}}},Header=_export_sfc(_sfc_main$5,[["__scopeId","data-v-711bcc94"]]),_sfc_main$4={__name:"App",setup(n){return(e,o)=>(openBlock(),createElementBlock(Fragment,null,[unref(useRoute)().name!="auth"?(openBlock(),createBlock(Header,{key:0})):createCommentVNode("",!0),createVNode(unref(RouterView))],64))}};class Stack{constructor(e,o,s,c,u,d,m,_,ue,gn=0,nh){this.p=e,this.stack=o,this.state=s,this.reducePos=c,this.pos=u,this.score=d,this.buffer=m,this.bufferBase=_,this.curContext=ue,this.lookAhead=gn,this.parent=nh}toString(){return`[${this.stack.filter((e,o)=>o%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,o,s=0){let c=e.parser.context;return new Stack(e,[],o,s,s,0,[],0,c?new StackContext(c,c.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,o){this.stack.push(this.state,o,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var o;let s=e>>19,c=e&65535,{parser:u}=this.p,d=u.dynamicPrecedence(c);if(d&&(this.score+=d),s==0){this.pushState(u.getGoto(this.state,c,!0),this.reducePos),c<u.minRepeatTerm&&this.storeNode(c,this.reducePos,this.reducePos,4,!0),this.reduceContext(c,this.reducePos);return}let m=this.stack.length-(s-1)*3-(e&262144?6:0),_=m?this.stack[m-2]:this.p.ranges[0].from,ue=this.reducePos-_;ue>=2e3&&!(!((o=this.p.parser.nodeSet.types[c])===null||o===void 0)&&o.isAnonymous)&&(_==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=ue):this.p.lastBigReductionSize<ue&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=_,this.p.lastBigReductionSize=ue));let gn=m?this.stack[m-1]:0,nh=this.bufferBase+this.buffer.length-gn;if(c<u.minRepeatTerm||e&131072){let ih=u.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(c,_,ih,nh+4,!0)}if(e&262144)this.state=this.stack[m];else{let ih=this.stack[m-3];this.state=u.getGoto(ih,c,!0)}for(;this.stack.length>m;)this.stack.pop();this.reduceContext(c,_)}storeNode(e,o,s,c=4,u=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let d=this,m=this.buffer.length;if(m==0&&d.parent&&(m=d.bufferBase-d.parent.bufferBase,d=d.parent),m>0&&d.buffer[m-4]==0&&d.buffer[m-1]>-1){if(o==s)return;if(d.buffer[m-2]>=o){d.buffer[m-2]=s;return}}}if(!u||this.pos==s)this.buffer.push(e,o,s,c);else{let d=this.buffer.length;if(d>0&&this.buffer[d-4]!=0)for(;d>0&&this.buffer[d-2]>s;)this.buffer[d]=this.buffer[d-4],this.buffer[d+1]=this.buffer[d-3],this.buffer[d+2]=this.buffer[d-2],this.buffer[d+3]=this.buffer[d-1],d-=4,c>4&&(c-=4);this.buffer[d]=e,this.buffer[d+1]=o,this.buffer[d+2]=s,this.buffer[d+3]=c}}shift(e,o,s){let c=this.pos;if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=s,this.shiftContext(o,c),o<=this.p.parser.maxNode&&this.buffer.push(o,c,s,4);else{let u=e,{parser:d}=this.p;(s>this.pos||o<=d.maxNode)&&(this.pos=s,d.stateFlag(u,1)||(this.reducePos=s)),this.pushState(u,c),this.shiftContext(o,c),o<=d.maxNode&&this.buffer.push(o,c,s,4)}}apply(e,o,s){e&65536?this.reduce(e):this.shift(e,o,s)}useNode(e,o){let s=this.p.reused.length-1;(s<0||this.p.reused[s]!=e)&&(this.p.reused.push(e),s++);let c=this.pos;this.reducePos=this.pos=c+e.length,this.pushState(o,c),this.buffer.push(s,c,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,o=e.buffer.length;for(;o>0&&e.buffer[o-2]>e.reducePos;)o-=4;let s=e.buffer.slice(o),c=e.bufferBase+o;for(;e&&c==e.bufferBase;)e=e.parent;return new Stack(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,s,c,this.curContext,this.lookAhead,e)}recoverByDelete(e,o){let s=e<=this.p.parser.maxNode;s&&this.storeNode(e,this.pos,o,4),this.storeNode(0,this.pos,o,s?8:4),this.pos=this.reducePos=o,this.score-=190}canShift(e){for(let o=new SimulatedStack(this);;){let s=this.p.parser.stateSlot(o.state,4)||this.p.parser.hasAction(o.state,e);if(s==0)return!1;if(!(s&65536))return!0;o.reduce(s)}}recoverByInsert(e){if(this.stack.length>=300)return[];let o=this.p.parser.nextStates(this.state);if(o.length>4<<1||this.stack.length>=120){let c=[];for(let u=0,d;u<o.length;u+=2)(d=o[u+1])!=this.state&&this.p.parser.hasAction(d,e)&&c.push(o[u],d);if(this.stack.length<120)for(let u=0;c.length<4<<1&&u<o.length;u+=2){let d=o[u+1];c.some((m,_)=>_&1&&m==d)||c.push(o[u],d)}o=c}let s=[];for(let c=0;c<o.length&&s.length<4;c+=2){let u=o[c+1];if(u==this.state)continue;let d=this.split();d.pushState(u,this.pos),d.storeNode(0,d.pos,d.pos,4,!0),d.shiftContext(o[c],this.pos),d.score-=200,s.push(d)}return s}forceReduce(){let{parser:e}=this.p,o=e.stateSlot(this.state,5);if(!(o&65536))return!1;if(!e.validAction(this.state,o)){let s=o>>19,c=o&65535,u=this.stack.length-s*3;if(u<0||e.getGoto(this.stack[u],c,!1)<0){let d=this.findForcedReduction();if(d==null)return!1;o=d}this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(o),!0}findForcedReduction(){let{parser:e}=this.p,o=[],s=(c,u)=>{if(!o.includes(c))return o.push(c),e.allActions(c,d=>{if(!(d&393216))if(d&65536){let m=(d>>19)-u;if(m>1){let _=d&65535,ue=this.stack.length-m*3;if(ue>=0&&e.getGoto(this.stack[ue],_,!1)>=0)return m<<19|65536|_}}else{let m=s(d,u+1);if(m!=null)return m}})};return s(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let o=0;o<this.stack.length;o+=3)if(this.stack[o]!=e.stack[o])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,o){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(o)))}reduceContext(e,o){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(o)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(e){if(e!=this.curContext.context){let o=new StackContext(this.curContext.tracker,e);o.hash!=this.curContext.hash&&this.emitContext(),this.curContext=o}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class StackContext{constructor(e,o){this.tracker=e,this.context=o,this.hash=e.strict?e.hash(o):0}}var Recover;(function(n){n[n.Insert=200]="Insert",n[n.Delete=190]="Delete",n[n.Reduce=100]="Reduce",n[n.MaxNext=4]="MaxNext",n[n.MaxInsertStackDepth=300]="MaxInsertStackDepth",n[n.DampenInsertStackDepth=120]="DampenInsertStackDepth",n[n.MinBigReduction=2e3]="MinBigReduction"})(Recover||(Recover={}));class SimulatedStack{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let o=e&65535,s=e>>19;s==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(s-1)*3;let c=this.start.p.parser.getGoto(this.stack[this.base-3],o,!0);this.state=c}}class StackBufferCursor{constructor(e,o,s){this.stack=e,this.pos=o,this.index=s,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,o=e.bufferBase+e.buffer.length){return new StackBufferCursor(e,o,o-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new StackBufferCursor(this.stack,this.pos,this.index)}}function decodeArray(n,e=Uint16Array){if(typeof n!="string")return n;let o=null;for(let s=0,c=0;s<n.length;){let u=0;for(;;){let d=n.charCodeAt(s++),m=!1;if(d==126){u=65535;break}d>=92&&d--,d>=34&&d--;let _=d-32;if(_>=46&&(_-=46,m=!0),u+=_,m)break;u*=46}o?o[c++]=u:o=new e(u)}return o}class CachedToken{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const nullToken=new CachedToken;class InputStream{constructor(e,o){this.input=e,this.ranges=o,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=nullToken,this.rangeIndex=0,this.pos=this.chunkPos=o[0].from,this.range=o[0],this.end=o[o.length-1].to,this.readNext()}resolveOffset(e,o){let s=this.range,c=this.rangeIndex,u=this.pos+e;for(;u<s.from;){if(!c)return null;let d=this.ranges[--c];u-=s.from-d.to,s=d}for(;o<0?u>s.to:u>=s.to;){if(c==this.ranges.length-1)return null;let d=this.ranges[++c];u+=d.from-s.to,s=d}return u}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let o of this.ranges)if(o.to>e)return Math.max(e,o.from);return this.end}peek(e){let o=this.chunkOff+e,s,c;if(o>=0&&o<this.chunk.length)s=this.pos+e,c=this.chunk.charCodeAt(o);else{let u=this.resolveOffset(e,1);if(u==null)return-1;if(s=u,s>=this.chunk2Pos&&s<this.chunk2Pos+this.chunk2.length)c=this.chunk2.charCodeAt(s-this.chunk2Pos);else{let d=this.rangeIndex,m=this.range;for(;m.to<=s;)m=this.ranges[++d];this.chunk2=this.input.chunk(this.chunk2Pos=s),s+this.chunk2.length>m.to&&(this.chunk2=this.chunk2.slice(0,m.to-s)),c=this.chunk2.charCodeAt(0)}}return s>=this.token.lookAhead&&(this.token.lookAhead=s+1),c}acceptToken(e,o=0){let s=o?this.resolveOffset(o,-1):this.pos;if(s==null||s<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=s}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:o}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=o,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),o=this.pos+e.length;this.chunk=o>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,o){if(o?(this.token=o,o.start=e,o.lookAhead=e+1,o.value=o.extended=-1):this.token=nullToken,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,o){if(e>=this.chunkPos&&o<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,o-this.chunkPos);if(e>=this.chunk2Pos&&o<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,o-this.chunk2Pos);if(e>=this.range.from&&o<=this.range.to)return this.input.read(e,o);let s="";for(let c of this.ranges){if(c.from>=o)break;c.to>e&&(s+=this.input.read(Math.max(c.from,e),Math.min(c.to,o)))}return s}}class TokenGroup{constructor(e,o){this.data=e,this.id=o}token(e,o){let{parser:s}=o.p;readToken(this.data,e,o,this.id,s.data,s.tokenPrecTable)}}TokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;function readToken(n,e,o,s,c,u){let d=0,m=1<<s,{dialect:_}=o.p.parser;e:for(;m&n[d];){let ue=n[d+1];for(let rh=d+3;rh<ue;rh+=2)if((n[rh+1]&m)>0){let oh=n[rh];if(_.allows(oh)&&(e.token.value==-1||e.token.value==oh||overrides(oh,e.token.value,c,u))){e.acceptToken(oh);break}}let gn=e.next,nh=0,ih=n[d+2];if(e.next<0&&ih>nh&&n[ue+ih*3-3]==65535&&n[ue+ih*3-3]==65535){d=n[ue+ih*3-1];continue e}for(;nh<ih;){let rh=nh+ih>>1,oh=ue+rh+(rh<<1),lh=n[oh],ch=n[oh+1]||65536;if(gn<lh)ih=rh;else if(gn>=ch)nh=rh+1;else{d=n[oh+2],e.advance();continue e}}break}}function findOffset(n,e,o){for(let s=e,c;(c=n[s])!=65535;s++)if(c==o)return s-e;return-1}function overrides(n,e,o,s){let c=findOffset(o,s,e);return c<0||findOffset(o,s,n)<c}const verbose=typeof process<"u"&&process.env&&/\bparse\b/.test({}.LOG);let stackIDs=null;var Safety;(function(n){n[n.Margin=25]="Margin"})(Safety||(Safety={}));function cutAt(n,e,o){let s=n.cursor(IterMode.IncludeAnonymous);for(s.moveTo(e);;)if(!(o<0?s.childBefore(e):s.childAfter(e)))for(;;){if((o<0?s.to<e:s.from>e)&&!s.type.isError)return o<0?Math.max(0,Math.min(s.to-1,e-25)):Math.min(n.length,Math.max(s.from+1,e+25));if(o<0?s.prevSibling():s.nextSibling())break;if(!s.parent())return o<0?0:n.length}}class FragmentCursor{constructor(e,o){this.fragments=e,this.nodeSet=o,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?cutAt(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?cutAt(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let o=this.trees.length-1;if(o<0)return this.nextFragment(),null;let s=this.trees[o],c=this.index[o];if(c==s.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let u=s.children[c],d=this.start[o]+s.positions[c];if(d>e)return this.nextStart=d,null;if(u instanceof Tree$1){if(d==e){if(d<this.safeFrom)return null;let m=d+u.length;if(m<=this.safeTo){let _=u.prop(NodeProp.lookAhead);if(!_||m+_<this.fragment.to)return u}}this.index[o]++,d+u.length>=Math.max(this.safeFrom,e)&&(this.trees.push(u),this.start.push(d),this.index.push(0))}else this.index[o]++,this.nextStart=d+u.length}}}class TokenCache{constructor(e,o){this.stream=o,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(s=>new CachedToken)}getActions(e){let o=0,s=null,{parser:c}=e.p,{tokenizers:u}=c,d=c.stateSlot(e.state,3),m=e.curContext?e.curContext.hash:0,_=0;for(let ue=0;ue<u.length;ue++){if(!(1<<ue&d))continue;let gn=u[ue],nh=this.tokens[ue];if(!(s&&!gn.fallback)&&((gn.contextual||nh.start!=e.pos||nh.mask!=d||nh.context!=m)&&(this.updateCachedToken(nh,gn,e),nh.mask=d,nh.context=m),nh.lookAhead>nh.end+25&&(_=Math.max(nh.lookAhead,_)),nh.value!=0)){let ih=o;if(nh.extended>-1&&(o=this.addActions(e,nh.extended,nh.end,o)),o=this.addActions(e,nh.value,nh.end,o),!gn.extend&&(s=nh,o>ih))break}}for(;this.actions.length>o;)this.actions.pop();return _&&e.setLookAhead(_),!s&&e.pos==this.stream.end&&(s=new CachedToken,s.value=e.p.parser.eofTerm,s.start=s.end=e.pos,o=this.addActions(e,s.value,s.end,o)),this.mainToken=s,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let o=new CachedToken,{pos:s,p:c}=e;return o.start=s,o.end=Math.min(s+1,c.stream.end),o.value=s==c.stream.end?c.parser.eofTerm:0,o}updateCachedToken(e,o,s){let c=this.stream.clipPos(s.pos);if(o.token(this.stream.reset(c,e),s),e.value>-1){let{parser:u}=s.p;for(let d=0;d<u.specialized.length;d++)if(u.specialized[d]==e.value){let m=u.specializers[d](this.stream.read(e.start,e.end),s);if(m>=0&&s.p.parser.dialect.allows(m>>1)){m&1?e.extended=m>>1:e.value=m>>1;break}}}else e.value=0,e.end=this.stream.clipPos(c+1)}putAction(e,o,s,c){for(let u=0;u<c;u+=3)if(this.actions[u]==e)return c;return this.actions[c++]=e,this.actions[c++]=o,this.actions[c++]=s,c}addActions(e,o,s,c){let{state:u}=e,{parser:d}=e.p,{data:m}=d;for(let _=0;_<2;_++)for(let ue=d.stateSlot(u,_?2:1);;ue+=3){if(m[ue]==65535)if(m[ue+1]==1)ue=pair(m,ue+2);else{c==0&&m[ue+1]==2&&(c=this.putAction(pair(m,ue+2),o,s,c));break}m[ue]==o&&(c=this.putAction(pair(m,ue+1),o,s,c))}return c}}var Rec;(function(n){n[n.Distance=5]="Distance",n[n.MaxRemainingPerStep=3]="MaxRemainingPerStep",n[n.MinBufferLengthPrune=500]="MinBufferLengthPrune",n[n.ForceReduceLimit=10]="ForceReduceLimit",n[n.CutDepth=15e3]="CutDepth",n[n.CutTo=9e3]="CutTo",n[n.MaxLeftAssociativeReductionCount=300]="MaxLeftAssociativeReductionCount",n[n.MaxStackCount=12]="MaxStackCount"})(Rec||(Rec={}));class Parse{constructor(e,o,s,c){this.parser=e,this.input=o,this.ranges=c,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new InputStream(o,c),this.tokens=new TokenCache(e,this.stream),this.topTerm=e.top[1];let{from:u}=c[0];this.stacks=[Stack.start(this,e.top[0],u)],this.fragments=s.length&&this.stream.end-u>e.bufferLength*4?new FragmentCursor(s,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,o=this.minStackPos,s=this.stacks=[],c,u;if(this.bigReductionCount>300&&e.length==1){let[d]=e;for(;d.forceReduce()&&d.stack.length&&d.stack[d.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let d=0;d<e.length;d++){let m=e[d];for(;;){if(this.tokens.mainToken=null,m.pos>o)s.push(m);else{if(this.advanceStack(m,s,e))continue;{c||(c=[],u=[]),c.push(m);let _=this.tokens.getMainToken(m);u.push(_.value,_.end)}}break}}if(!s.length){let d=c&&findFinished(c);if(d)return this.stackToTree(d);if(this.parser.strict)throw verbose&&c&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+o);this.recovering||(this.recovering=5)}if(this.recovering&&c){let d=this.stoppedAt!=null&&c[0].pos>this.stoppedAt?c[0]:this.runRecovery(c,u,s);if(d)return this.stackToTree(d.forceAll())}if(this.recovering){let d=this.recovering==1?1:this.recovering*3;if(s.length>d)for(s.sort((m,_)=>_.score-m.score);s.length>d;)s.pop();s.some(m=>m.reducePos>o)&&this.recovering--}else if(s.length>1){e:for(let d=0;d<s.length-1;d++){let m=s[d];for(let _=d+1;_<s.length;_++){let ue=s[_];if(m.sameState(ue)||m.buffer.length>500&&ue.buffer.length>500)if((m.score-ue.score||m.buffer.length-ue.buffer.length)>0)s.splice(_--,1);else{s.splice(d--,1);continue e}}}s.length>12&&s.splice(12,s.length-12)}this.minStackPos=s[0].pos;for(let d=1;d<s.length;d++)s[d].pos<this.minStackPos&&(this.minStackPos=s[d].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,o,s){let c=e.pos,{parser:u}=this,d=verbose?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&c>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let ue=e.curContext&&e.curContext.tracker.strict,gn=ue?e.curContext.hash:0;for(let nh=this.fragments.nodeAt(c);nh;){let ih=this.parser.nodeSet.types[nh.type.id]==nh.type?u.getGoto(e.state,nh.type.id):-1;if(ih>-1&&nh.length&&(!ue||(nh.prop(NodeProp.contextHash)||0)==gn))return e.useNode(nh,ih),verbose&&console.log(d+this.stackID(e)+` (via reuse of ${u.getName(nh.type.id)})`),!0;if(!(nh instanceof Tree$1)||nh.children.length==0||nh.positions[0]>0)break;let rh=nh.children[0];if(rh instanceof Tree$1&&nh.positions[0]==0)nh=rh;else break}}let m=u.stateSlot(e.state,4);if(m>0)return e.reduce(m),verbose&&console.log(d+this.stackID(e)+` (via always-reduce ${u.getName(m&65535)})`),!0;if(e.stack.length>=15e3)for(;e.stack.length>9e3&&e.forceReduce(););let _=this.tokens.getActions(e);for(let ue=0;ue<_.length;){let gn=_[ue++],nh=_[ue++],ih=_[ue++],rh=ue==_.length||!s,oh=rh?e:e.split();if(oh.apply(gn,nh,ih),verbose&&console.log(d+this.stackID(oh)+` (via ${gn&65536?`reduce of ${u.getName(gn&65535)}`:"shift"} for ${u.getName(nh)} @ ${c}${oh==e?"":", split"})`),rh)return!0;oh.pos>c?o.push(oh):s.push(oh)}return!1}advanceFully(e,o){let s=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>s)return pushStackDedup(e,o),!0}}runRecovery(e,o,s){let c=null,u=!1;for(let d=0;d<e.length;d++){let m=e[d],_=o[d<<1],ue=o[(d<<1)+1],gn=verbose?this.stackID(m)+" -> ":"";if(m.deadEnd&&(u||(u=!0,m.restart(),verbose&&console.log(gn+this.stackID(m)+" (restarted)"),this.advanceFully(m,s))))continue;let nh=m.split(),ih=gn;for(let rh=0;nh.forceReduce()&&rh<10&&(verbose&&console.log(ih+this.stackID(nh)+" (via force-reduce)"),!this.advanceFully(nh,s));rh++)verbose&&(ih=this.stackID(nh)+" -> ");for(let rh of m.recoverByInsert(_))verbose&&console.log(gn+this.stackID(rh)+" (via recover-insert)"),this.advanceFully(rh,s);this.stream.end>m.pos?(ue==m.pos&&(ue++,_=0),m.recoverByDelete(_,ue),verbose&&console.log(gn+this.stackID(m)+` (via recover-delete ${this.parser.getName(_)})`),pushStackDedup(m,s)):(!c||c.score<m.score)&&(c=m)}return c}stackToTree(e){return e.close(),Tree$1.build({buffer:StackBufferCursor.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let o=(stackIDs||(stackIDs=new WeakMap)).get(e);return o||stackIDs.set(e,o=String.fromCodePoint(this.nextStackID++)),o+e}}function pushStackDedup(n,e){for(let o=0;o<e.length;o++){let s=e[o];if(s.pos==n.pos&&s.sameState(n)){e[o].score<n.score&&(e[o]=n);return}}e.push(n)}class Dialect{constructor(e,o,s){this.source=e,this.flags=o,this.disabled=s}allows(e){return!this.disabled||this.disabled[e]==0}}class LRParser extends Parser{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let o=e.nodeNames.split(" ");this.minRepeatTerm=o.length;for(let m=0;m<e.repeatNodeCount;m++)o.push("");let s=Object.keys(e.topRules).map(m=>e.topRules[m][1]),c=[];for(let m=0;m<o.length;m++)c.push([]);function u(m,_,ue){c[m].push([_,_.deserialize(String(ue))])}if(e.nodeProps)for(let m of e.nodeProps){let _=m[0];typeof _=="string"&&(_=NodeProp[_]);for(let ue=1;ue<m.length;){let gn=m[ue++];if(gn>=0)u(gn,_,m[ue++]);else{let nh=m[ue+-gn];for(let ih=-gn;ih>0;ih--)u(m[ue++],_,nh);ue++}}}this.nodeSet=new NodeSet(o.map((m,_)=>NodeType.define({name:_>=this.minRepeatTerm?void 0:m,id:_,props:c[_],top:s.indexOf(_)>-1,error:_==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(_)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=DefaultBufferLength;let d=decodeArray(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let m=0;m<this.specializerSpecs.length;m++)this.specialized[m]=this.specializerSpecs[m].term;this.specializers=this.specializerSpecs.map(getSpecializer),this.states=decodeArray(e.states,Uint32Array),this.data=decodeArray(e.stateData),this.goto=decodeArray(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(m=>typeof m=="number"?new TokenGroup(d,m):m),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,o,s){let c=new Parse(this,e,o,s);for(let u of this.wrappers)c=u(c,e,o,s);return c}getGoto(e,o,s=!1){let c=this.goto;if(o>=c[0])return-1;for(let u=c[o+1];;){let d=c[u++],m=d&1,_=c[u++];if(m&&s)return _;for(let ue=u+(d>>1);u<ue;u++)if(c[u]==e)return _;if(m)return-1}}hasAction(e,o){let s=this.data;for(let c=0;c<2;c++)for(let u=this.stateSlot(e,c?2:1),d;;u+=3){if((d=s[u])==65535)if(s[u+1]==1)d=s[u=pair(s,u+2)];else{if(s[u+1]==2)return pair(s,u+2);break}if(d==o||d==0)return pair(s,u+1)}return 0}stateSlot(e,o){return this.states[e*6+o]}stateFlag(e,o){return(this.stateSlot(e,0)&o)>0}validAction(e,o){return!!this.allActions(e,s=>s==o?!0:null)}allActions(e,o){let s=this.stateSlot(e,4),c=s?o(s):void 0;for(let u=this.stateSlot(e,1);c==null;u+=3){if(this.data[u]==65535)if(this.data[u+1]==1)u=pair(this.data,u+2);else break;c=o(pair(this.data,u+1))}return c}nextStates(e){let o=[];for(let s=this.stateSlot(e,1);;s+=3){if(this.data[s]==65535)if(this.data[s+1]==1)s=pair(this.data,s+2);else break;if(!(this.data[s+2]&1)){let c=this.data[s+1];o.some((u,d)=>d&1&&u==c)||o.push(this.data[s],c)}}return o}configure(e){let o=Object.assign(Object.create(LRParser.prototype),this);if(e.props&&(o.nodeSet=this.nodeSet.extend(...e.props)),e.top){let s=this.topRules[e.top];if(!s)throw new RangeError(`Invalid top rule name ${e.top}`);o.top=s}return e.tokenizers&&(o.tokenizers=this.tokenizers.map(s=>{let c=e.tokenizers.find(u=>u.from==s);return c?c.to:s})),e.specializers&&(o.specializers=this.specializers.slice(),o.specializerSpecs=this.specializerSpecs.map((s,c)=>{let u=e.specializers.find(m=>m.from==s.external);if(!u)return s;let d=Object.assign(Object.assign({},s),{external:u.to});return o.specializers[c]=getSpecializer(d),d})),e.contextTracker&&(o.context=e.contextTracker),e.dialect&&(o.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(o.strict=e.strict),e.wrap&&(o.wrappers=o.wrappers.concat(e.wrap)),e.bufferLength!=null&&(o.bufferLength=e.bufferLength),o}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let o=this.dynamicPrecedences;return o==null?0:o[e]||0}parseDialect(e){let o=Object.keys(this.dialects),s=o.map(()=>!1);if(e)for(let u of e.split(" ")){let d=o.indexOf(u);d>=0&&(s[d]=!0)}let c=null;for(let u=0;u<o.length;u++)if(!s[u])for(let d=this.dialects[o[u]],m;(m=this.data[d++])!=65535;)(c||(c=new Uint8Array(this.maxTerm+1)))[m]=1;return new Dialect(e,s,c)}static deserialize(e){return new LRParser(e)}}function pair(n,e){return n[e]|n[e+1]<<16}function findFinished(n){let e=null;for(let o of n){let s=o.p.stoppedAt;(o.pos==o.p.stream.end||s!=null&&o.pos>s)&&o.p.parser.stateFlag(o.state,2)&&(!e||e.score<o.score)&&(e=o)}return e}function getSpecializer(n){if(n.external){let e=n.extend?1:0;return(o,s)=>n.external(o,s)<<1|e}return n.get}const jsonHighlighting=styleTags({String:tags.string,Number:tags.number,"True False":tags.bool,PropertyName:tags.propertyName,Null:tags.null,",":tags.separator,"[ ]":tags.squareBracket,"{ }":tags.brace}),parser=LRParser.deserialize({version:14,states:"$bOVQPOOOOQO'#Cb'#CbOnQPO'#CeOvQPO'#CjOOQO'#Cp'#CpQOQPOOOOQO'#Cg'#CgO}QPO'#CfO!SQPO'#CrOOQO,59P,59PO![QPO,59PO!aQPO'#CuOOQO,59U,59UO!iQPO,59UOVQPO,59QOqQPO'#CkO!nQPO,59^OOQO1G.k1G.kOVQPO'#ClO!vQPO,59aOOQO1G.p1G.pOOQO1G.l1G.lOOQO,59V,59VOOQO-E6i-E6iOOQO,59W,59WOOQO-E6j-E6j",stateData:"#O~OcOS~OQSORSOSSOTSOWQO]ROePO~OVXOeUO~O[[O~PVOg^O~Oh_OVfX~OVaO~OhbO[iX~O[dO~Oh_OVfa~OhbO[ia~O",goto:"!kjPPPPPPkPPkqwPPk{!RPPP!XP!ePP!hXSOR^bQWQRf_TVQ_Q`WRg`QcZRicQTOQZRQe^RhbRYQR]R",nodeNames:" JsonText True False Null Number String } { Object Property PropertyName ] [ Array",maxTerm:25,nodeProps:[["openedBy",7,"{",12,"["],["closedBy",8,"}",13,"]"]],propSources:[jsonHighlighting],skippedNodes:[0],repeatNodeCount:2,tokenData:"(p~RaXY!WYZ!W]^!Wpq!Wrs!]|}$i}!O$n!Q!R$w!R![&V![!]&h!}#O&m#P#Q&r#Y#Z&w#b#c'f#h#i'}#o#p(f#q#r(k~!]Oc~~!`Upq!]qr!]rs!rs#O!]#O#P!w#P~!]~!wOe~~!zXrs!]!P!Q!]#O#P!]#U#V!]#Y#Z!]#b#c!]#f#g!]#h#i!]#i#j#g~#jR!Q![#s!c!i#s#T#Z#s~#vR!Q![$P!c!i$P#T#Z$P~$SR!Q![$]!c!i$]#T#Z$]~$`R!Q![!]!c!i!]#T#Z!]~$nOh~~$qQ!Q!R$w!R![&V~$|RT~!O!P%V!g!h%k#X#Y%k~%YP!Q![%]~%bRT~!Q![%]!g!h%k#X#Y%k~%nR{|%w}!O%w!Q![%}~%zP!Q![%}~&SPT~!Q![%}~&[ST~!O!P%V!Q![&V!g!h%k#X#Y%k~&mOg~~&rO]~~&wO[~~&zP#T#U&}~'QP#`#a'T~'WP#g#h'Z~'^P#X#Y'a~'fOR~~'iP#i#j'l~'oP#`#a'r~'uP#`#a'x~'}OS~~(QP#f#g(T~(WP#i#j(Z~(^P#X#Y(a~(fOQ~~(kOW~~(pOV~",tokenizers:[0],topRules:{JsonText:[0,1]},tokenPrec:0}),jsonLanguage=LRLanguage.define({name:"json",parser:parser.configure({props:[indentNodeProp.add({Object:continuedIndent({except:/^\s*\}/}),Array:continuedIndent({except:/^\s*\]/})}),foldNodeProp.add({"Object Array":foldInside})]}),languageData:{closeBrackets:{brackets:["[","{",'"']},indentOnInput:/^\s*[\}\]]$/}});function json(){return new LanguageSupport(jsonLanguage)}const chalky="#e5c07b",coral="#e06c75",cyan="#56b6c2",invalid="#ffffff",ivory="#abb2bf",stone="#7d8799",malibu="#61afef",sage="#98c379",whiskey="#d19a66",violet="#c678dd",darkBackground="#21252b",highlightBackground="#2c313a",background="#282c34",tooltipBackground="#353a42",selection="#3E4451",cursor="#528bff",oneDarkTheme=EditorView.theme({"&":{color:ivory,backgroundColor:background},".cm-content":{caretColor:cursor},".cm-cursor, .cm-dropCursor":{borderLeftColor:cursor},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:selection},".cm-panels":{backgroundColor:darkBackground,color:ivory},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:background,color:stone,border:"none"},".cm-activeLineGutter":{backgroundColor:highlightBackground},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:tooltipBackground},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:tooltipBackground,borderBottomColor:tooltipBackground},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:highlightBackground,color:ivory}}},{dark:!0}),oneDarkHighlightStyle=HighlightStyle.define([{tag:tags.keyword,color:violet},{tag:[tags.name,tags.deleted,tags.character,tags.propertyName,tags.macroName],color:coral},{tag:[tags.function(tags.variableName),tags.labelName],color:malibu},{tag:[tags.color,tags.constant(tags.name),tags.standard(tags.name)],color:whiskey},{tag:[tags.definition(tags.name),tags.separator],color:ivory},{tag:[tags.typeName,tags.className,tags.number,tags.changed,tags.annotation,tags.modifier,tags.self,tags.namespace],color:chalky},{tag:[tags.operator,tags.operatorKeyword,tags.url,tags.escape,tags.regexp,tags.link,tags.special(tags.string)],color:cyan},{tag:[tags.meta,tags.comment],color:stone},{tag:tags.strong,fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.link,color:stone,textDecoration:"underline"},{tag:tags.heading,fontWeight:"bold",color:coral},{tag:[tags.atom,tags.bool,tags.special(tags.variableName)],color:whiskey},{tag:[tags.processingInstruction,tags.string,tags.inserted],color:sage},{tag:tags.invalid,color:invalid}]),oneDark=[oneDarkTheme,syntaxHighlighting(oneDarkHighlightStyle)];function In$1(n,e){let o,s,c;const u=ref$1(!0),d=()=>{u.value=!0,c()};watch(n,d,{flush:"sync"});const m=typeof e=="function"?e:e.get,_=typeof e=="function"?void 0:e.set,ue=customRef((gn,nh)=>(s=gn,c=nh,{get(){return u.value&&(o=m(),u.value=!1),s(),o},set(ih){_==null||_(ih)}}));return Object.isExtensible(ue)&&(ue.trigger=d),ue}function Vt$1(n){return getCurrentScope()?(onScopeDispose(n),!0):!1}function le(n){return typeof n=="function"?n():unref(n)}const ki$1=typeof window<"u",Vr$1=n=>typeof n<"u",Ci$1=()=>{};function Hr$1(n,e){function o(...s){return new Promise((c,u)=>{Promise.resolve(n(()=>e.apply(this,s),{fn:e,thisArg:this,args:s})).then(c).catch(u)})}return o}const Mi$1=n=>n();function Lr$1(n=Mi$1){const e=ref$1(!0);function o(){e.value=!1}function s(){e.value=!0}const c=(...u)=>{e.value&&n(...u)};return{isActive:readonly(e),pause:o,resume:s,eventFilter:c}}function Oo$1(n,e=!1,o="Timeout"){return new Promise((s,c)=>{setTimeout(e?()=>c(o):s,n)})}function Pt(...n){if(n.length!==1)return toRef(...n);const e=n[0];return typeof e=="function"?readonly(customRef(()=>({get:e,set:Ci$1}))):ref$1(e)}var Fr$1=Object.defineProperty,Gr$1=Object.defineProperties,Yr$1=Object.getOwnPropertyDescriptors,Po$1=Object.getOwnPropertySymbols,Xr$1=Object.prototype.hasOwnProperty,Ur$1=Object.prototype.propertyIsEnumerable,Io$1=(n,e,o)=>e in n?Fr$1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,Zr$1=(n,e)=>{for(var o in e||(e={}))Xr$1.call(e,o)&&Io$1(n,o,e[o]);if(Po$1)for(var o of Po$1(e))Ur$1.call(e,o)&&Io$1(n,o,e[o]);return n},Wr$1=(n,e)=>Gr$1(n,Yr$1(e));function Kr$1(n){if(!isRef(n))return toRefs(n);const e=Array.isArray(n.value)?new Array(n.value.length):{};for(const o in n.value)e[o]=customRef(()=>({get(){return n.value[o]},set(s){if(Array.isArray(n.value)){const c=[...n.value];c[o]=s,n.value=c}else{const c=Wr$1(Zr$1({},n.value),{[o]:s});Object.setPrototypeOf(c,n.value),n.value=c}}}));return e}function Kn$1(n,e=!1){function o(nh,{flush:ih="sync",deep:rh=!1,timeout:oh,throwOnTimeout:lh}={}){let ch=null;const dh=[new Promise(_h=>{ch=watch(n,Sh=>{nh(Sh)!==e&&(ch==null||ch(),_h(Sh))},{flush:ih,deep:rh,immediate:!0})})];return oh!=null&&dh.push(Oo$1(oh,lh).then(()=>le(n)).finally(()=>ch==null?void 0:ch())),Promise.race(dh)}function s(nh,ih){if(!isRef(nh))return o(Sh=>Sh===nh,ih);const{flush:rh="sync",deep:oh=!1,timeout:lh,throwOnTimeout:ch}=ih??{};let dh=null;const _h=[new Promise(Sh=>{dh=watch([n,nh],([fh,yh])=>{e!==(fh===yh)&&(dh==null||dh(),Sh(fh))},{flush:rh,deep:oh,immediate:!0})})];return lh!=null&&_h.push(Oo$1(lh,ch).then(()=>le(n)).finally(()=>(dh==null||dh(),le(n)))),Promise.race(_h)}function c(nh){return o(ih=>!!ih,nh)}function u(nh){return s(null,nh)}function d(nh){return s(void 0,nh)}function m(nh){return o(Number.isNaN,nh)}function _(nh,ih){return o(rh=>{const oh=Array.from(rh);return oh.includes(nh)||oh.includes(le(nh))},ih)}function ue(nh){return gn(1,nh)}function gn(nh=1,ih){let rh=-1;return o(()=>(rh+=1,rh>=nh),ih)}return Array.isArray(le(n))?{toMatch:o,toContains:_,changed:ue,changedTimes:gn,get not(){return Kn$1(n,!e)}}:{toMatch:o,toBe:s,toBeTruthy:c,toBeNull:u,toBeNaN:m,toBeUndefined:d,changed:ue,changedTimes:gn,get not(){return Kn$1(n,!e)}}}function Se(n){return Kn$1(n)}var Do$1=Object.getOwnPropertySymbols,qr$1=Object.prototype.hasOwnProperty,jr$1=Object.prototype.propertyIsEnumerable,Jr$1=(n,e)=>{var o={};for(var s in n)qr$1.call(n,s)&&e.indexOf(s)<0&&(o[s]=n[s]);if(n!=null&&Do$1)for(var s of Do$1(n))e.indexOf(s)<0&&jr$1.call(n,s)&&(o[s]=n[s]);return o};function Qr$1(n,e,o={}){const s=o,{eventFilter:c=Mi$1}=s,u=Jr$1(s,["eventFilter"]);return watch(n,Hr$1(c,e),u)}var el=Object.defineProperty,tl=Object.defineProperties,nl=Object.getOwnPropertyDescriptors,en=Object.getOwnPropertySymbols,$i$1=Object.prototype.hasOwnProperty,Ti$1=Object.prototype.propertyIsEnumerable,Ao$1=(n,e,o)=>e in n?el(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,ol=(n,e)=>{for(var o in e||(e={}))$i$1.call(e,o)&&Ao$1(n,o,e[o]);if(en)for(var o of en(e))Ti$1.call(e,o)&&Ao$1(n,o,e[o]);return n},il=(n,e)=>tl(n,nl(e)),rl=(n,e)=>{var o={};for(var s in n)$i$1.call(n,s)&&e.indexOf(s)<0&&(o[s]=n[s]);if(n!=null&&en)for(var s of en(n))e.indexOf(s)<0&&Ti$1.call(n,s)&&(o[s]=n[s]);return o};function ct$1(n,e,o={}){const s=o,{eventFilter:c}=s,u=rl(s,["eventFilter"]),{eventFilter:d,pause:m,resume:_,isActive:ue}=Lr$1(c);return{stop:Qr$1(n,e,il(ol({},u),{eventFilter:d})),pause:m,resume:_,isActive:ue}}function qn$1(n){var e;const o=le(n);return(e=o==null?void 0:o.$el)!=null?e:o}const ho$2=ki$1?window:void 0;function go$1(...n){let e,o,s,c;if(typeof n[0]=="string"||Array.isArray(n[0])?([o,s,c]=n,e=ho$2):[e,o,s,c]=n,!e)return Ci$1;Array.isArray(o)||(o=[o]),Array.isArray(s)||(s=[s]);const u=[],d=()=>{u.forEach(gn=>gn()),u.length=0},m=(gn,nh,ih,rh)=>(gn.addEventListener(nh,ih,rh),()=>gn.removeEventListener(nh,ih,rh)),_=watch(()=>[qn$1(e),le(c)],([gn,nh])=>{d(),gn&&u.push(...o.flatMap(ih=>s.map(rh=>m(gn,ih,rh,nh))))},{immediate:!0,flush:"post"}),ue=()=>{_(),d()};return Vt$1(ue),ue}function ll(n){return typeof n=="function"?n:typeof n=="string"?e=>e.key===n:Array.isArray(n)?e=>n.includes(e.key):()=>!0}function zo$1(...n){let e,o,s={};n.length===3?(e=n[0],o=n[1],s=n[2]):n.length===2?typeof n[1]=="object"?(e=!0,o=n[0],s=n[1]):(e=n[0],o=n[1]):(e=!0,o=n[0]);const{target:c=ho$2,eventName:u="keydown",passive:d=!1,dedupe:m=!1}=s,_=ll(e);return go$1(c,u,ue=>{ue.repeat&&le(m)||_(ue)&&o(ue)},d)}function al(){const n=ref$1(!1);return getCurrentInstance()&&onMounted(()=>{n.value=!0}),n}function sl(n){const e=al();return computed(()=>(e.value,!!n()))}function ul(n){return JSON.parse(JSON.stringify(n))}var Bo$1=Object.getOwnPropertySymbols,cl=Object.prototype.hasOwnProperty,dl=Object.prototype.propertyIsEnumerable,fl=(n,e)=>{var o={};for(var s in n)cl.call(n,s)&&e.indexOf(s)<0&&(o[s]=n[s]);if(n!=null&&Bo$1)for(var s of Bo$1(n))e.indexOf(s)<0&&dl.call(n,s)&&(o[s]=n[s]);return o};function hl(n,e,o={}){const s=o,{window:c=ho$2}=s,u=fl(s,["window"]);let d;const m=sl(()=>c&&"ResizeObserver"in c),_=()=>{d&&(d.disconnect(),d=void 0)},ue=computed(()=>Array.isArray(n)?n.map(ih=>qn$1(ih)):[qn$1(n)]),gn=watch(ue,ih=>{if(_(),m.value&&c){d=new ResizeObserver(e);for(const rh of ih)rh&&d.observe(rh,u)}},{immediate:!0,flush:"post",deep:!0}),nh=()=>{_(),gn()};return Vt$1(nh),{isSupported:m,stop:nh}}function Tt$1(n,e,o,s={}){var c,u,d;const{clone:m=!1,passive:_=!1,eventName:ue,deep:gn=!1,defaultValue:nh,shouldEmit:ih}=s,rh=getCurrentInstance(),oh=o||(rh==null?void 0:rh.emit)||((c=rh==null?void 0:rh.$emit)==null?void 0:c.bind(rh))||((d=(u=rh==null?void 0:rh.proxy)==null?void 0:u.$emit)==null?void 0:d.bind(rh==null?void 0:rh.proxy));let lh=ue;e||(e="modelValue"),lh=ue||lh||`update:${e.toString()}`;const ch=Sh=>m?typeof m=="function"?m(Sh):ul(Sh):Sh,dh=()=>Vr$1(n[e])?ch(n[e]):nh,_h=Sh=>{ih?ih(Sh)&&oh(lh,Sh):oh(lh,Sh)};if(_){const Sh=dh(),fh=ref$1(Sh);return watch(()=>n[e],yh=>fh.value=ch(yh)),watch(fh,yh=>{(yh!==n[e]||gn)&&_h(yh)},{deep:gn}),fh}else return computed({get(){return dh()},set(Sh){_h(Sh)}})}var gl={value:()=>{}};function vn(){for(var n=0,e=arguments.length,o={},s;n<e;++n){if(!(s=arguments[n]+"")||s in o||/[\s.]/.test(s))throw new Error("illegal type: "+s);o[s]=[]}return new qt(o)}function qt(n){this._=n}function vl(n,e){return n.trim().split(/^|\s+/).map(function(o){var s="",c=o.indexOf(".");if(c>=0&&(s=o.slice(c+1),o=o.slice(0,c)),o&&!e.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:s}})}qt.prototype=vn.prototype={constructor:qt,on:function(n,e){var o=this._,s=vl(n+"",o),c,u=-1,d=s.length;if(arguments.length<2){for(;++u<d;)if((c=(n=s[u]).type)&&(c=pl(o[c],n.name)))return c;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++u<d;)if(c=(n=s[u]).type)o[c]=Ro$1(o[c],n.name,e);else if(e==null)for(c in o)o[c]=Ro$1(o[c],n.name,null);return this},copy:function(){var n={},e=this._;for(var o in e)n[o]=e[o].slice();return new qt(n)},call:function(n,e){if((c=arguments.length-2)>0)for(var o=new Array(c),s=0,c,u;s<c;++s)o[s]=arguments[s+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(u=this._[n],s=0,c=u.length;s<c;++s)u[s].value.apply(e,o)},apply:function(n,e,o){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var s=this._[n],c=0,u=s.length;c<u;++c)s[c].value.apply(e,o)}};function pl(n,e){for(var o=0,s=n.length,c;o<s;++o)if((c=n[o]).name===e)return c.value}function Ro$1(n,e,o){for(var s=0,c=n.length;s<c;++s)if(n[s].name===e){n[s]=gl,n=n.slice(0,s).concat(n.slice(s+1));break}return o!=null&&n.push({name:e,value:o}),n}var jn$1="http://www.w3.org/1999/xhtml";const Vo$1={svg:"http://www.w3.org/2000/svg",xhtml:jn$1,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function pn(n){var e=n+="",o=e.indexOf(":");return o>=0&&(e=n.slice(0,o))!=="xmlns"&&(n=n.slice(o+1)),Vo$1.hasOwnProperty(e)?{space:Vo$1[e],local:n}:n}function ml(n){return function(){var e=this.ownerDocument,o=this.namespaceURI;return o===jn$1&&e.documentElement.namespaceURI===jn$1?e.createElement(n):e.createElementNS(o,n)}}function yl(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function Oi$1(n){var e=pn(n);return(e.local?yl:ml)(e)}function xl(){}function vo$2(n){return n==null?xl:function(){return this.querySelector(n)}}function wl(n){typeof n!="function"&&(n=vo$2(n));for(var e=this._groups,o=e.length,s=new Array(o),c=0;c<o;++c)for(var u=e[c],d=u.length,m=s[c]=new Array(d),_,ue,gn=0;gn<d;++gn)(_=u[gn])&&(ue=n.call(_,_.__data__,gn,u))&&("__data__"in _&&(ue.__data__=_.__data__),m[gn]=ue);return new ke$1(s,this._parents)}function _l(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function bl(){return[]}function Pi$1(n){return n==null?bl:function(){return this.querySelectorAll(n)}}function El(n){return function(){return _l(n.apply(this,arguments))}}function Sl(n){typeof n=="function"?n=El(n):n=Pi$1(n);for(var e=this._groups,o=e.length,s=[],c=[],u=0;u<o;++u)for(var d=e[u],m=d.length,_,ue=0;ue<m;++ue)(_=d[ue])&&(s.push(n.call(_,_.__data__,ue,d)),c.push(_));return new ke$1(s,c)}function Ii$1(n){return function(){return this.matches(n)}}function Di$1(n){return function(e){return e.matches(n)}}var Nl=Array.prototype.find;function kl(n){return function(){return Nl.call(this.children,n)}}function Cl(){return this.firstElementChild}function Ml(n){return this.select(n==null?Cl:kl(typeof n=="function"?n:Di$1(n)))}var $l=Array.prototype.filter;function Tl(){return Array.from(this.children)}function Ol(n){return function(){return $l.call(this.children,n)}}function Pl(n){return this.selectAll(n==null?Tl:Ol(typeof n=="function"?n:Di$1(n)))}function Il(n){typeof n!="function"&&(n=Ii$1(n));for(var e=this._groups,o=e.length,s=new Array(o),c=0;c<o;++c)for(var u=e[c],d=u.length,m=s[c]=[],_,ue=0;ue<d;++ue)(_=u[ue])&&n.call(_,_.__data__,ue,u)&&m.push(_);return new ke$1(s,this._parents)}function Ai$1(n){return new Array(n.length)}function Dl(){return new ke$1(this._enter||this._groups.map(Ai$1),this._parents)}function tn$1(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}tn$1.prototype={constructor:tn$1,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function Al(n){return function(){return n}}function zl(n,e,o,s,c,u){for(var d=0,m,_=e.length,ue=u.length;d<ue;++d)(m=e[d])?(m.__data__=u[d],s[d]=m):o[d]=new tn$1(n,u[d]);for(;d<_;++d)(m=e[d])&&(c[d]=m)}function Bl(n,e,o,s,c,u,d){var m,_,ue=new Map,gn=e.length,nh=u.length,ih=new Array(gn),rh;for(m=0;m<gn;++m)(_=e[m])&&(ih[m]=rh=d.call(_,_.__data__,m,e)+"",ue.has(rh)?c[m]=_:ue.set(rh,_));for(m=0;m<nh;++m)rh=d.call(n,u[m],m,u)+"",(_=ue.get(rh))?(s[m]=_,_.__data__=u[m],ue.delete(rh)):o[m]=new tn$1(n,u[m]);for(m=0;m<gn;++m)(_=e[m])&&ue.get(ih[m])===_&&(c[m]=_)}function Rl(n){return n.__data__}function Vl(n,e){if(!arguments.length)return Array.from(this,Rl);var o=e?Bl:zl,s=this._parents,c=this._groups;typeof n!="function"&&(n=Al(n));for(var u=c.length,d=new Array(u),m=new Array(u),_=new Array(u),ue=0;ue<u;++ue){var gn=s[ue],nh=c[ue],ih=nh.length,rh=Hl(n.call(gn,gn&&gn.__data__,ue,s)),oh=rh.length,lh=m[ue]=new Array(oh),ch=d[ue]=new Array(oh),dh=_[ue]=new Array(ih);o(gn,nh,lh,ch,dh,rh,e);for(var _h=0,Sh=0,fh,yh;_h<oh;++_h)if(fh=lh[_h]){for(_h>=Sh&&(Sh=_h+1);!(yh=ch[Sh])&&++Sh<oh;);fh._next=yh||null}}return d=new ke$1(d,s),d._enter=m,d._exit=_,d}function Hl(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function Ll(){return new ke$1(this._exit||this._groups.map(Ai$1),this._parents)}function Fl(n,e,o){var s=this.enter(),c=this,u=this.exit();return typeof n=="function"?(s=n(s),s&&(s=s.selection())):s=s.append(n+""),e!=null&&(c=e(c),c&&(c=c.selection())),o==null?u.remove():o(u),s&&c?s.merge(c).order():c}function Gl(n){for(var e=n.selection?n.selection():n,o=this._groups,s=e._groups,c=o.length,u=s.length,d=Math.min(c,u),m=new Array(c),_=0;_<d;++_)for(var ue=o[_],gn=s[_],nh=ue.length,ih=m[_]=new Array(nh),rh,oh=0;oh<nh;++oh)(rh=ue[oh]||gn[oh])&&(ih[oh]=rh);for(;_<c;++_)m[_]=o[_];return new ke$1(m,this._parents)}function Yl(){for(var n=this._groups,e=-1,o=n.length;++e<o;)for(var s=n[e],c=s.length-1,u=s[c],d;--c>=0;)(d=s[c])&&(u&&d.compareDocumentPosition(u)^4&&u.parentNode.insertBefore(d,u),u=d);return this}function Xl(n){n||(n=Ul);function e(nh,ih){return nh&&ih?n(nh.__data__,ih.__data__):!nh-!ih}for(var o=this._groups,s=o.length,c=new Array(s),u=0;u<s;++u){for(var d=o[u],m=d.length,_=c[u]=new Array(m),ue,gn=0;gn<m;++gn)(ue=d[gn])&&(_[gn]=ue);_.sort(e)}return new ke$1(c,this._parents).order()}function Ul(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function Zl(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function Wl(){return Array.from(this)}function Kl(){for(var n=this._groups,e=0,o=n.length;e<o;++e)for(var s=n[e],c=0,u=s.length;c<u;++c){var d=s[c];if(d)return d}return null}function ql(){let n=0;for(const e of this)++n;return n}function jl(){return!this.node()}function Jl(n){for(var e=this._groups,o=0,s=e.length;o<s;++o)for(var c=e[o],u=0,d=c.length,m;u<d;++u)(m=c[u])&&n.call(m,m.__data__,u,c);return this}function Ql(n){return function(){this.removeAttribute(n)}}function ea(n){return function(){this.removeAttributeNS(n.space,n.local)}}function ta(n,e){return function(){this.setAttribute(n,e)}}function na(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function oa(n,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttribute(n):this.setAttribute(n,o)}}function ia(n,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,o)}}function ra(n,e){var o=pn(n);if(arguments.length<2){var s=this.node();return o.local?s.getAttributeNS(o.space,o.local):s.getAttribute(o)}return this.each((e==null?o.local?ea:Ql:typeof e=="function"?o.local?ia:oa:o.local?na:ta)(o,e))}function zi$1(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function la(n){return function(){this.style.removeProperty(n)}}function aa(n,e,o){return function(){this.style.setProperty(n,e,o)}}function sa(n,e,o){return function(){var s=e.apply(this,arguments);s==null?this.style.removeProperty(n):this.style.setProperty(n,s,o)}}function ua(n,e,o){return arguments.length>1?this.each((e==null?la:typeof e=="function"?sa:aa)(n,e,o??"")):Et$1(this.node(),n)}function Et$1(n,e){return n.style.getPropertyValue(e)||zi$1(n).getComputedStyle(n,null).getPropertyValue(e)}function ca(n){return function(){delete this[n]}}function da(n,e){return function(){this[n]=e}}function fa(n,e){return function(){var o=e.apply(this,arguments);o==null?delete this[n]:this[n]=o}}function ha(n,e){return arguments.length>1?this.each((e==null?ca:typeof e=="function"?fa:da)(n,e)):this.node()[n]}function Bi$1(n){return n.trim().split(/^|\s+/)}function po$1(n){return n.classList||new Ri$1(n)}function Ri$1(n){this._node=n,this._names=Bi$1(n.getAttribute("class")||"")}Ri$1.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function Vi$1(n,e){for(var o=po$1(n),s=-1,c=e.length;++s<c;)o.add(e[s])}function Hi$1(n,e){for(var o=po$1(n),s=-1,c=e.length;++s<c;)o.remove(e[s])}function ga(n){return function(){Vi$1(this,n)}}function va(n){return function(){Hi$1(this,n)}}function pa(n,e){return function(){(e.apply(this,arguments)?Vi$1:Hi$1)(this,n)}}function ma(n,e){var o=Bi$1(n+"");if(arguments.length<2){for(var s=po$1(this.node()),c=-1,u=o.length;++c<u;)if(!s.contains(o[c]))return!1;return!0}return this.each((typeof e=="function"?pa:e?ga:va)(o,e))}function ya(){this.textContent=""}function xa(n){return function(){this.textContent=n}}function wa(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function _a(n){return arguments.length?this.each(n==null?ya:(typeof n=="function"?wa:xa)(n)):this.node().textContent}function ba(){this.innerHTML=""}function Ea(n){return function(){this.innerHTML=n}}function Sa(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function Na(n){return arguments.length?this.each(n==null?ba:(typeof n=="function"?Sa:Ea)(n)):this.node().innerHTML}function ka(){this.nextSibling&&this.parentNode.appendChild(this)}function Ca(){return this.each(ka)}function Ma(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function $a(){return this.each(Ma)}function Ta(n){var e=typeof n=="function"?n:Oi$1(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Oa(){return null}function Pa(n,e){var o=typeof n=="function"?n:Oi$1(n),s=e==null?Oa:typeof e=="function"?e:vo$2(e);return this.select(function(){return this.insertBefore(o.apply(this,arguments),s.apply(this,arguments)||null)})}function Ia(){var n=this.parentNode;n&&n.removeChild(this)}function Da(){return this.each(Ia)}function Aa(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function za(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Ba(n){return this.select(n?za:Aa)}function Ra(n){return arguments.length?this.property("__data__",n):this.node().__data__}function Va(n){return function(e){n.call(this,e,this.__data__)}}function Ha(n){return n.trim().split(/^|\s+/).map(function(e){var o="",s=e.indexOf(".");return s>=0&&(o=e.slice(s+1),e=e.slice(0,s)),{type:e,name:o}})}function La(n){return function(){var e=this.__on;if(e){for(var o=0,s=-1,c=e.length,u;o<c;++o)u=e[o],(!n.type||u.type===n.type)&&u.name===n.name?this.removeEventListener(u.type,u.listener,u.options):e[++s]=u;++s?e.length=s:delete this.__on}}}function Fa(n,e,o){return function(){var s=this.__on,c,u=Va(e);if(s){for(var d=0,m=s.length;d<m;++d)if((c=s[d]).type===n.type&&c.name===n.name){this.removeEventListener(c.type,c.listener,c.options),this.addEventListener(c.type,c.listener=u,c.options=o),c.value=e;return}}this.addEventListener(n.type,u,o),c={type:n.type,name:n.name,value:e,listener:u,options:o},s?s.push(c):this.__on=[c]}}function Ga(n,e,o){var s=Ha(n+""),c,u=s.length,d;if(arguments.length<2){var m=this.node().__on;if(m){for(var _=0,ue=m.length,gn;_<ue;++_)for(c=0,gn=m[_];c<u;++c)if((d=s[c]).type===gn.type&&d.name===gn.name)return gn.value}return}for(m=e?Fa:La,c=0;c<u;++c)this.each(m(s[c],e,o));return this}function Li$1(n,e,o){var s=zi$1(n),c=s.CustomEvent;typeof c=="function"?c=new c(e,o):(c=s.document.createEvent("Event"),o?(c.initEvent(e,o.bubbles,o.cancelable),c.detail=o.detail):c.initEvent(e,!1,!1)),n.dispatchEvent(c)}function Ya(n,e){return function(){return Li$1(this,n,e)}}function Xa(n,e){return function(){return Li$1(this,n,e.apply(this,arguments))}}function Ua(n,e){return this.each((typeof e=="function"?Xa:Ya)(n,e))}function*Za(){for(var n=this._groups,e=0,o=n.length;e<o;++e)for(var s=n[e],c=0,u=s.length,d;c<u;++c)(d=s[c])&&(yield d)}var Fi$1=[null];function ke$1(n,e){this._groups=n,this._parents=e}function Ht(){return new ke$1([[document.documentElement]],Fi$1)}function Wa(){return this}ke$1.prototype=Ht.prototype={constructor:ke$1,select:wl,selectAll:Sl,selectChild:Ml,selectChildren:Pl,filter:Il,data:Vl,enter:Dl,exit:Ll,join:Fl,merge:Gl,selection:Wa,order:Yl,sort:Xl,call:Zl,nodes:Wl,node:Kl,size:ql,empty:jl,each:Jl,attr:ra,style:ua,property:ha,classed:ma,text:_a,html:Na,raise:Ca,lower:$a,append:Ta,insert:Pa,remove:Da,clone:Ba,datum:Ra,on:Ga,dispatch:Ua,[Symbol.iterator]:Za};function Ce$1(n){return typeof n=="string"?new ke$1([[document.querySelector(n)]],[document.documentElement]):new ke$1([[n]],Fi$1)}function Ka(n){let e;for(;e=n.sourceEvent;)n=e;return n}function Oe$1(n,e){if(n=Ka(n),e===void 0&&(e=n.currentTarget),e){var o=e.ownerSVGElement||e;if(o.createSVGPoint){var s=o.createSVGPoint();return s.x=n.clientX,s.y=n.clientY,s=s.matrixTransform(e.getScreenCTM().inverse()),[s.x,s.y]}if(e.getBoundingClientRect){var c=e.getBoundingClientRect();return[n.clientX-c.left-e.clientLeft,n.clientY-c.top-e.clientTop]}}return[n.pageX,n.pageY]}const qa={passive:!1},It$1={capture:!0,passive:!1};function Dn$1(n){n.stopImmediatePropagation()}function vt$1(n){n.preventDefault(),n.stopImmediatePropagation()}function Gi$1(n){var e=n.document.documentElement,o=Ce$1(n).on("dragstart.drag",vt$1,It$1);"onselectstart"in e?o.on("selectstart.drag",vt$1,It$1):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Yi$1(n,e){var o=n.document.documentElement,s=Ce$1(n).on("dragstart.drag",null);e&&(s.on("click.drag",vt$1,It$1),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in o?s.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}const Ft$1=n=>()=>n;function Jn$1(n,{sourceEvent:e,subject:o,target:s,identifier:c,active:u,x:d,y:m,dx:_,dy:ue,dispatch:gn}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:o,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:c,enumerable:!0,configurable:!0},active:{value:u,enumerable:!0,configurable:!0},x:{value:d,enumerable:!0,configurable:!0},y:{value:m,enumerable:!0,configurable:!0},dx:{value:_,enumerable:!0,configurable:!0},dy:{value:ue,enumerable:!0,configurable:!0},_:{value:gn}})}Jn$1.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function ja(n){return!n.ctrlKey&&!n.button}function Ja(){return this.parentNode}function Qa(n,e){return e??{x:n.x,y:n.y}}function es(){return navigator.maxTouchPoints||"ontouchstart"in this}function ts(){var n=ja,e=Ja,o=Qa,s=es,c={},u=vn("start","drag","end"),d=0,m,_,ue,gn,nh=0;function ih(fh){fh.on("mousedown.drag",rh).filter(s).on("touchstart.drag",ch).on("touchmove.drag",dh,qa).on("touchend.drag touchcancel.drag",_h).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function rh(fh,yh){if(!(gn||!n.call(this,fh,yh))){var mh=Sh(this,e.call(this,fh,yh),fh,yh,"mouse");mh&&(Ce$1(fh.view).on("mousemove.drag",oh,It$1).on("mouseup.drag",lh,It$1),Gi$1(fh.view),Dn$1(fh),ue=!1,m=fh.clientX,_=fh.clientY,mh("start",fh))}}function oh(fh){if(vt$1(fh),!ue){var yh=fh.clientX-m,mh=fh.clientY-_;ue=yh*yh+mh*mh>nh}c.mouse("drag",fh)}function lh(fh){Ce$1(fh.view).on("mousemove.drag mouseup.drag",null),Yi$1(fh.view,ue),vt$1(fh),c.mouse("end",fh)}function ch(fh,yh){if(n.call(this,fh,yh)){var mh=fh.changedTouches,Ch=e.call(this,fh,yh),Mh=mh.length,Ph,Eh;for(Ph=0;Ph<Mh;++Ph)(Eh=Sh(this,Ch,fh,yh,mh[Ph].identifier,mh[Ph]))&&(Dn$1(fh),Eh("start",fh,mh[Ph]))}}function dh(fh){var yh=fh.changedTouches,mh=yh.length,Ch,Mh;for(Ch=0;Ch<mh;++Ch)(Mh=c[yh[Ch].identifier])&&(vt$1(fh),Mh("drag",fh,yh[Ch]))}function _h(fh){var yh=fh.changedTouches,mh=yh.length,Ch,Mh;for(gn&&clearTimeout(gn),gn=setTimeout(function(){gn=null},500),Ch=0;Ch<mh;++Ch)(Mh=c[yh[Ch].identifier])&&(Dn$1(fh),Mh("end",fh,yh[Ch]))}function Sh(fh,yh,mh,Ch,Mh,Ph){var Eh=u.copy(),Nh=Oe$1(Ph||mh,yh),Wh,Yh,gh;if((gh=o.call(fh,new Jn$1("beforestart",{sourceEvent:mh,target:ih,identifier:Mh,active:d,x:Nh[0],y:Nh[1],dx:0,dy:0,dispatch:Eh}),Ch))!=null)return Wh=gh.x-Nh[0]||0,Yh=gh.y-Nh[1]||0,function Ah(wh,$h,Rh){var Oh=Nh,Lh;switch(wh){case"start":c[Mh]=Ah,Lh=d++;break;case"end":delete c[Mh],--d;case"drag":Nh=Oe$1(Rh||$h,yh),Lh=d;break}Eh.call(wh,fh,new Jn$1(wh,{sourceEvent:$h,subject:gh,target:ih,identifier:Mh,active:Lh,x:Nh[0]+Wh,y:Nh[1]+Yh,dx:Nh[0]-Oh[0],dy:Nh[1]-Oh[1],dispatch:Eh}),Ch)}}return ih.filter=function(fh){return arguments.length?(n=typeof fh=="function"?fh:Ft$1(!!fh),ih):n},ih.container=function(fh){return arguments.length?(e=typeof fh=="function"?fh:Ft$1(fh),ih):e},ih.subject=function(fh){return arguments.length?(o=typeof fh=="function"?fh:Ft$1(fh),ih):o},ih.touchable=function(fh){return arguments.length?(s=typeof fh=="function"?fh:Ft$1(!!fh),ih):s},ih.on=function(){var fh=u.on.apply(u,arguments);return fh===u?ih:fh},ih.clickDistance=function(fh){return arguments.length?(nh=(fh=+fh)*fh,ih):Math.sqrt(nh)},ih}function mo$1(n,e,o){n.prototype=e.prototype=o,o.constructor=n}function Xi$1(n,e){var o=Object.create(n.prototype);for(var s in e)o[s]=e[s];return o}function Lt$1(){}var Dt$1=.7,nn=1/Dt$1,pt$1="\\s*([+-]?\\d+)\\s*",At$1="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ie$1="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ns$1=/^#([0-9a-f]{3,8})$/,os=new RegExp(`^rgb\\(${pt$1},${pt$1},${pt$1}\\)$`),is=new RegExp(`^rgb\\(${Ie$1},${Ie$1},${Ie$1}\\)$`),rs=new RegExp(`^rgba\\(${pt$1},${pt$1},${pt$1},${At$1}\\)$`),ls=new RegExp(`^rgba\\(${Ie$1},${Ie$1},${Ie$1},${At$1}\\)$`),as=new RegExp(`^hsl\\(${At$1},${Ie$1},${Ie$1}\\)$`),ss=new RegExp(`^hsla\\(${At$1},${Ie$1},${Ie$1},${At$1}\\)$`),Ho$1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};mo$1(Lt$1,zt$1,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Lo$1,formatHex:Lo$1,formatHex8:us,formatHsl:cs,formatRgb:Fo$1,toString:Fo$1});function Lo$1(){return this.rgb().formatHex()}function us(){return this.rgb().formatHex8()}function cs(){return Ui$1(this).formatHsl()}function Fo$1(){return this.rgb().formatRgb()}function zt$1(n){var e,o;return n=(n+"").trim().toLowerCase(),(e=ns$1.exec(n))?(o=e[1].length,e=parseInt(e[1],16),o===6?Go$1(e):o===3?new be$1(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):o===8?Gt$1(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):o===4?Gt$1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=os.exec(n))?new be$1(e[1],e[2],e[3],1):(e=is.exec(n))?new be$1(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=rs.exec(n))?Gt$1(e[1],e[2],e[3],e[4]):(e=ls.exec(n))?Gt$1(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=as.exec(n))?Uo$1(e[1],e[2]/100,e[3]/100,1):(e=ss.exec(n))?Uo$1(e[1],e[2]/100,e[3]/100,e[4]):Ho$1.hasOwnProperty(n)?Go$1(Ho$1[n]):n==="transparent"?new be$1(NaN,NaN,NaN,0):null}function Go$1(n){return new be$1(n>>16&255,n>>8&255,n&255,1)}function Gt$1(n,e,o,s){return s<=0&&(n=e=o=NaN),new be$1(n,e,o,s)}function ds(n){return n instanceof Lt$1||(n=zt$1(n)),n?(n=n.rgb(),new be$1(n.r,n.g,n.b,n.opacity)):new be$1}function Qn$1(n,e,o,s){return arguments.length===1?ds(n):new be$1(n,e,o,s??1)}function be$1(n,e,o,s){this.r=+n,this.g=+e,this.b=+o,this.opacity=+s}mo$1(be$1,Qn$1,Xi$1(Lt$1,{brighter(n){return n=n==null?nn:Math.pow(nn,n),new be$1(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Dt$1:Math.pow(Dt$1,n),new be$1(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new be$1(nt$1(this.r),nt$1(this.g),nt$1(this.b),on(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yo$1,formatHex:Yo$1,formatHex8:fs,formatRgb:Xo$1,toString:Xo$1}));function Yo$1(){return`#${et$1(this.r)}${et$1(this.g)}${et$1(this.b)}`}function fs(){return`#${et$1(this.r)}${et$1(this.g)}${et$1(this.b)}${et$1((isNaN(this.opacity)?1:this.opacity)*255)}`}function Xo$1(){const n=on(this.opacity);return`${n===1?"rgb(":"rgba("}${nt$1(this.r)}, ${nt$1(this.g)}, ${nt$1(this.b)}${n===1?")":`, ${n})`}`}function on(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function nt$1(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function et$1(n){return n=nt$1(n),(n<16?"0":"")+n.toString(16)}function Uo$1(n,e,o,s){return s<=0?n=e=o=NaN:o<=0||o>=1?n=e=NaN:e<=0&&(n=NaN),new Me$1(n,e,o,s)}function Ui$1(n){if(n instanceof Me$1)return new Me$1(n.h,n.s,n.l,n.opacity);if(n instanceof Lt$1||(n=zt$1(n)),!n)return new Me$1;if(n instanceof Me$1)return n;n=n.rgb();var e=n.r/255,o=n.g/255,s=n.b/255,c=Math.min(e,o,s),u=Math.max(e,o,s),d=NaN,m=u-c,_=(u+c)/2;return m?(e===u?d=(o-s)/m+(o<s)*6:o===u?d=(s-e)/m+2:d=(e-o)/m+4,m/=_<.5?u+c:2-u-c,d*=60):m=_>0&&_<1?0:d,new Me$1(d,m,_,n.opacity)}function hs(n,e,o,s){return arguments.length===1?Ui$1(n):new Me$1(n,e,o,s??1)}function Me$1(n,e,o,s){this.h=+n,this.s=+e,this.l=+o,this.opacity=+s}mo$1(Me$1,hs,Xi$1(Lt$1,{brighter(n){return n=n==null?nn:Math.pow(nn,n),new Me$1(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Dt$1:Math.pow(Dt$1,n),new Me$1(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,o=this.l,s=o+(o<.5?o:1-o)*e,c=2*o-s;return new be$1(An$1(n>=240?n-240:n+120,c,s),An$1(n,c,s),An$1(n<120?n+240:n-120,c,s),this.opacity)},clamp(){return new Me$1(Zo$1(this.h),Yt$1(this.s),Yt$1(this.l),on(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=on(this.opacity);return`${n===1?"hsl(":"hsla("}${Zo$1(this.h)}, ${Yt$1(this.s)*100}%, ${Yt$1(this.l)*100}%${n===1?")":`, ${n})`}`}}));function Zo$1(n){return n=(n||0)%360,n<0?n+360:n}function Yt$1(n){return Math.max(0,Math.min(1,n||0))}function An$1(n,e,o){return(n<60?e+(o-e)*n/60:n<180?o:n<240?e+(o-e)*(240-n)/60:e)*255}const Zi$1=n=>()=>n;function gs(n,e){return function(o){return n+o*e}}function vs(n,e,o){return n=Math.pow(n,o),e=Math.pow(e,o)-n,o=1/o,function(s){return Math.pow(n+s*e,o)}}function ps(n){return(n=+n)==1?Wi$1:function(e,o){return o-e?vs(e,o,n):Zi$1(isNaN(e)?o:e)}}function Wi$1(n,e){var o=e-n;return o?gs(n,o):Zi$1(isNaN(n)?e:n)}const Wo$1=function n(e){var o=ps(e);function s(c,u){var d=o((c=Qn$1(c)).r,(u=Qn$1(u)).r),m=o(c.g,u.g),_=o(c.b,u.b),ue=Wi$1(c.opacity,u.opacity);return function(gn){return c.r=d(gn),c.g=m(gn),c.b=_(gn),c.opacity=ue(gn),c+""}}return s.gamma=n,s}(1);function Xe$1(n,e){return n=+n,e=+e,function(o){return n*(1-o)+e*o}}var eo$2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zn$1=new RegExp(eo$2.source,"g");function ms(n){return function(){return n}}function ys(n){return function(e){return n(e)+""}}function xs(n,e){var o=eo$2.lastIndex=zn$1.lastIndex=0,s,c,u,d=-1,m=[],_=[];for(n=n+"",e=e+"";(s=eo$2.exec(n))&&(c=zn$1.exec(e));)(u=c.index)>o&&(u=e.slice(o,u),m[d]?m[d]+=u:m[++d]=u),(s=s[0])===(c=c[0])?m[d]?m[d]+=c:m[++d]=c:(m[++d]=null,_.push({i:d,x:Xe$1(s,c)})),o=zn$1.lastIndex;return o<e.length&&(u=e.slice(o),m[d]?m[d]+=u:m[++d]=u),m.length<2?_[0]?ys(_[0].x):ms(e):(e=_.length,function(ue){for(var gn=0,nh;gn<e;++gn)m[(nh=_[gn]).i]=nh.x(ue);return m.join("")})}var Ko$1=180/Math.PI,to$2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ki$1(n,e,o,s,c,u){var d,m,_;return(d=Math.sqrt(n*n+e*e))&&(n/=d,e/=d),(_=n*o+e*s)&&(o-=n*_,s-=e*_),(m=Math.sqrt(o*o+s*s))&&(o/=m,s/=m,_/=m),n*s<e*o&&(n=-n,e=-e,_=-_,d=-d),{translateX:c,translateY:u,rotate:Math.atan2(e,n)*Ko$1,skewX:Math.atan(_)*Ko$1,scaleX:d,scaleY:m}}var Xt;function ws(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?to$2:Ki$1(e.a,e.b,e.c,e.d,e.e,e.f)}function _s(n){return n==null||(Xt||(Xt=document.createElementNS("http://www.w3.org/2000/svg","g")),Xt.setAttribute("transform",n),!(n=Xt.transform.baseVal.consolidate()))?to$2:(n=n.matrix,Ki$1(n.a,n.b,n.c,n.d,n.e,n.f))}function qi$1(n,e,o,s){function c(ue){return ue.length?ue.pop()+" ":""}function u(ue,gn,nh,ih,rh,oh){if(ue!==nh||gn!==ih){var lh=rh.push("translate(",null,e,null,o);oh.push({i:lh-4,x:Xe$1(ue,nh)},{i:lh-2,x:Xe$1(gn,ih)})}else(nh||ih)&&rh.push("translate("+nh+e+ih+o)}function d(ue,gn,nh,ih){ue!==gn?(ue-gn>180?gn+=360:gn-ue>180&&(ue+=360),ih.push({i:nh.push(c(nh)+"rotate(",null,s)-2,x:Xe$1(ue,gn)})):gn&&nh.push(c(nh)+"rotate("+gn+s)}function m(ue,gn,nh,ih){ue!==gn?ih.push({i:nh.push(c(nh)+"skewX(",null,s)-2,x:Xe$1(ue,gn)}):gn&&nh.push(c(nh)+"skewX("+gn+s)}function _(ue,gn,nh,ih,rh,oh){if(ue!==nh||gn!==ih){var lh=rh.push(c(rh)+"scale(",null,",",null,")");oh.push({i:lh-4,x:Xe$1(ue,nh)},{i:lh-2,x:Xe$1(gn,ih)})}else(nh!==1||ih!==1)&&rh.push(c(rh)+"scale("+nh+","+ih+")")}return function(ue,gn){var nh=[],ih=[];return ue=n(ue),gn=n(gn),u(ue.translateX,ue.translateY,gn.translateX,gn.translateY,nh,ih),d(ue.rotate,gn.rotate,nh,ih),m(ue.skewX,gn.skewX,nh,ih),_(ue.scaleX,ue.scaleY,gn.scaleX,gn.scaleY,nh,ih),ue=gn=null,function(rh){for(var oh=-1,lh=ih.length,ch;++oh<lh;)nh[(ch=ih[oh]).i]=ch.x(rh);return nh.join("")}}}var bs=qi$1(ws,"px, ","px)","deg)"),Es=qi$1(_s,", ",")",")"),Ss=1e-12;function qo$1(n){return((n=Math.exp(n))+1/n)/2}function Ns(n){return((n=Math.exp(n))-1/n)/2}function ks(n){return((n=Math.exp(2*n))-1)/(n+1)}const Cs=function n(e,o,s){function c(u,d){var m=u[0],_=u[1],ue=u[2],gn=d[0],nh=d[1],ih=d[2],rh=gn-m,oh=nh-_,lh=rh*rh+oh*oh,ch,dh;if(lh<Ss)dh=Math.log(ih/ue)/e,ch=function(Ch){return[m+Ch*rh,_+Ch*oh,ue*Math.exp(e*Ch*dh)]};else{var _h=Math.sqrt(lh),Sh=(ih*ih-ue*ue+s*lh)/(2*ue*o*_h),fh=(ih*ih-ue*ue-s*lh)/(2*ih*o*_h),yh=Math.log(Math.sqrt(Sh*Sh+1)-Sh),mh=Math.log(Math.sqrt(fh*fh+1)-fh);dh=(mh-yh)/e,ch=function(Ch){var Mh=Ch*dh,Ph=qo$1(yh),Eh=ue/(o*_h)*(Ph*ks(e*Mh+yh)-Ns(yh));return[m+Eh*rh,_+Eh*oh,ue*Ph/qo$1(e*Mh+yh)]}}return ch.duration=dh*1e3*e/Math.SQRT2,ch}return c.rho=function(u){var d=Math.max(.001,+u),m=d*d,_=m*m;return n(d,m,_)},c}(Math.SQRT2,2,4);var St$1=0,Mt$1=0,kt$1=0,ji$1=1e3,rn,$t$1,ln=0,rt=0,mn=0,Bt=typeof performance=="object"&&performance.now?performance:Date,Ji$1=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function yo$1(){return rt||(Ji$1(Ms),rt=Bt.now()+mn)}function Ms(){rt=0}function an(){this._call=this._time=this._next=null}an.prototype=Qi$1.prototype={constructor:an,restart:function(n,e,o){if(typeof n!="function")throw new TypeError("callback is not a function");o=(o==null?yo$1():+o)+(e==null?0:+e),!this._next&&$t$1!==this&&($t$1?$t$1._next=this:rn=this,$t$1=this),this._call=n,this._time=o,no$2()},stop:function(){this._call&&(this._call=null,this._time=1/0,no$2())}};function Qi$1(n,e,o){var s=new an;return s.restart(n,e,o),s}function $s(){yo$1(),++St$1;for(var n=rn,e;n;)(e=rt-n._time)>=0&&n._call.call(void 0,e),n=n._next;--St$1}function jo$1(){rt=(ln=Bt.now())+mn,St$1=Mt$1=0;try{$s()}finally{St$1=0,Os(),rt=0}}function Ts(){var n=Bt.now(),e=n-ln;e>ji$1&&(mn-=e,ln=n)}function Os(){for(var n,e=rn,o,s=1/0;e;)e._call?(s>e._time&&(s=e._time),n=e,e=e._next):(o=e._next,e._next=null,e=n?n._next=o:rn=o);$t$1=n,no$2(s)}function no$2(n){if(!St$1){Mt$1&&(Mt$1=clearTimeout(Mt$1));var e=n-rt;e>24?(n<1/0&&(Mt$1=setTimeout(jo$1,n-Bt.now()-mn)),kt$1&&(kt$1=clearInterval(kt$1))):(kt$1||(ln=Bt.now(),kt$1=setInterval(Ts,ji$1)),St$1=1,Ji$1(jo$1))}}function Jo$1(n,e,o){var s=new an;return e=e==null?0:+e,s.restart(c=>{s.stop(),n(c+e)},e,o),s}var Ps=vn("start","end","cancel","interrupt"),Is=[],er$1=0,Qo$1=1,oo$2=2,jt$1=3,ei$1=4,io$2=5,Jt$1=6;function yn(n,e,o,s,c,u){var d=n.__transition;if(!d)n.__transition={};else if(o in d)return;Ds(n,o,{name:e,index:s,group:c,on:Ps,tween:Is,time:u.time,delay:u.delay,duration:u.duration,ease:u.ease,timer:null,state:er$1})}function xo$1(n,e){var o=Te$1(n,e);if(o.state>er$1)throw new Error("too late; already scheduled");return o}function Ae$1(n,e){var o=Te$1(n,e);if(o.state>jt$1)throw new Error("too late; already running");return o}function Te$1(n,e){var o=n.__transition;if(!o||!(o=o[e]))throw new Error("transition not found");return o}function Ds(n,e,o){var s=n.__transition,c;s[e]=o,o.timer=Qi$1(u,0,o.time);function u(ue){o.state=Qo$1,o.timer.restart(d,o.delay,o.time),o.delay<=ue&&d(ue-o.delay)}function d(ue){var gn,nh,ih,rh;if(o.state!==Qo$1)return _();for(gn in s)if(rh=s[gn],rh.name===o.name){if(rh.state===jt$1)return Jo$1(d);rh.state===ei$1?(rh.state=Jt$1,rh.timer.stop(),rh.on.call("interrupt",n,n.__data__,rh.index,rh.group),delete s[gn]):+gn<e&&(rh.state=Jt$1,rh.timer.stop(),rh.on.call("cancel",n,n.__data__,rh.index,rh.group),delete s[gn])}if(Jo$1(function(){o.state===jt$1&&(o.state=ei$1,o.timer.restart(m,o.delay,o.time),m(ue))}),o.state=oo$2,o.on.call("start",n,n.__data__,o.index,o.group),o.state===oo$2){for(o.state=jt$1,c=new Array(ih=o.tween.length),gn=0,nh=-1;gn<ih;++gn)(rh=o.tween[gn].value.call(n,n.__data__,o.index,o.group))&&(c[++nh]=rh);c.length=nh+1}}function m(ue){for(var gn=ue<o.duration?o.ease.call(null,ue/o.duration):(o.timer.restart(_),o.state=io$2,1),nh=-1,ih=c.length;++nh<ih;)c[nh].call(n,gn);o.state===io$2&&(o.on.call("end",n,n.__data__,o.index,o.group),_())}function _(){o.state=Jt$1,o.timer.stop(),delete s[e];for(var ue in s)return;delete n.__transition}}function Qt$1(n,e){var o=n.__transition,s,c,u=!0,d;if(o){e=e==null?null:e+"";for(d in o){if((s=o[d]).name!==e){u=!1;continue}c=s.state>oo$2&&s.state<io$2,s.state=Jt$1,s.timer.stop(),s.on.call(c?"interrupt":"cancel",n,n.__data__,s.index,s.group),delete o[d]}u&&delete n.__transition}}function As(n){return this.each(function(){Qt$1(this,n)})}function zs(n,e){var o,s;return function(){var c=Ae$1(this,n),u=c.tween;if(u!==o){s=o=u;for(var d=0,m=s.length;d<m;++d)if(s[d].name===e){s=s.slice(),s.splice(d,1);break}}c.tween=s}}function Bs(n,e,o){var s,c;if(typeof o!="function")throw new Error;return function(){var u=Ae$1(this,n),d=u.tween;if(d!==s){c=(s=d).slice();for(var m={name:e,value:o},_=0,ue=c.length;_<ue;++_)if(c[_].name===e){c[_]=m;break}_===ue&&c.push(m)}u.tween=c}}function Rs(n,e){var o=this._id;if(n+="",arguments.length<2){for(var s=Te$1(this.node(),o).tween,c=0,u=s.length,d;c<u;++c)if((d=s[c]).name===n)return d.value;return null}return this.each((e==null?zs:Bs)(o,n,e))}function wo$1(n,e,o){var s=n._id;return n.each(function(){var c=Ae$1(this,s);(c.value||(c.value={}))[e]=o.apply(this,arguments)}),function(c){return Te$1(c,s).value[e]}}function tr$1(n,e){var o;return(typeof e=="number"?Xe$1:e instanceof zt$1?Wo$1:(o=zt$1(e))?(e=o,Wo$1):xs)(n,e)}function Vs(n){return function(){this.removeAttribute(n)}}function Hs(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Ls(n,e,o){var s,c=o+"",u;return function(){var d=this.getAttribute(n);return d===c?null:d===s?u:u=e(s=d,o)}}function Fs(n,e,o){var s,c=o+"",u;return function(){var d=this.getAttributeNS(n.space,n.local);return d===c?null:d===s?u:u=e(s=d,o)}}function Gs(n,e,o){var s,c,u;return function(){var d,m=o(this),_;return m==null?void this.removeAttribute(n):(d=this.getAttribute(n),_=m+"",d===_?null:d===s&&_===c?u:(c=_,u=e(s=d,m)))}}function Ys(n,e,o){var s,c,u;return function(){var d,m=o(this),_;return m==null?void this.removeAttributeNS(n.space,n.local):(d=this.getAttributeNS(n.space,n.local),_=m+"",d===_?null:d===s&&_===c?u:(c=_,u=e(s=d,m)))}}function Xs(n,e){var o=pn(n),s=o==="transform"?Es:tr$1;return this.attrTween(n,typeof e=="function"?(o.local?Ys:Gs)(o,s,wo$1(this,"attr."+n,e)):e==null?(o.local?Hs:Vs)(o):(o.local?Fs:Ls)(o,s,e))}function Us(n,e){return function(o){this.setAttribute(n,e.call(this,o))}}function Zs(n,e){return function(o){this.setAttributeNS(n.space,n.local,e.call(this,o))}}function Ws(n,e){var o,s;function c(){var u=e.apply(this,arguments);return u!==s&&(o=(s=u)&&Zs(n,u)),o}return c._value=e,c}function Ks(n,e){var o,s;function c(){var u=e.apply(this,arguments);return u!==s&&(o=(s=u)&&Us(n,u)),o}return c._value=e,c}function qs(n,e){var o="attr."+n;if(arguments.length<2)return(o=this.tween(o))&&o._value;if(e==null)return this.tween(o,null);if(typeof e!="function")throw new Error;var s=pn(n);return this.tween(o,(s.local?Ws:Ks)(s,e))}function js(n,e){return function(){xo$1(this,n).delay=+e.apply(this,arguments)}}function Js(n,e){return e=+e,function(){xo$1(this,n).delay=e}}function Qs(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?js:Js)(e,n)):Te$1(this.node(),e).delay}function eu(n,e){return function(){Ae$1(this,n).duration=+e.apply(this,arguments)}}function tu(n,e){return e=+e,function(){Ae$1(this,n).duration=e}}function nu(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?eu:tu)(e,n)):Te$1(this.node(),e).duration}function ou(n,e){if(typeof e!="function")throw new Error;return function(){Ae$1(this,n).ease=e}}function iu(n){var e=this._id;return arguments.length?this.each(ou(e,n)):Te$1(this.node(),e).ease}function ru(n,e){return function(){var o=e.apply(this,arguments);if(typeof o!="function")throw new Error;Ae$1(this,n).ease=o}}function lu(n){if(typeof n!="function")throw new Error;return this.each(ru(this._id,n))}function au(n){typeof n!="function"&&(n=Ii$1(n));for(var e=this._groups,o=e.length,s=new Array(o),c=0;c<o;++c)for(var u=e[c],d=u.length,m=s[c]=[],_,ue=0;ue<d;++ue)(_=u[ue])&&n.call(_,_.__data__,ue,u)&&m.push(_);return new Fe$1(s,this._parents,this._name,this._id)}function su(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,o=n._groups,s=e.length,c=o.length,u=Math.min(s,c),d=new Array(s),m=0;m<u;++m)for(var _=e[m],ue=o[m],gn=_.length,nh=d[m]=new Array(gn),ih,rh=0;rh<gn;++rh)(ih=_[rh]||ue[rh])&&(nh[rh]=ih);for(;m<s;++m)d[m]=e[m];return new Fe$1(d,this._parents,this._name,this._id)}function uu(n){return(n+"").trim().split(/^|\s+/).every(function(e){var o=e.indexOf(".");return o>=0&&(e=e.slice(0,o)),!e||e==="start"})}function cu(n,e,o){var s,c,u=uu(e)?xo$1:Ae$1;return function(){var d=u(this,n),m=d.on;m!==s&&(c=(s=m).copy()).on(e,o),d.on=c}}function du(n,e){var o=this._id;return arguments.length<2?Te$1(this.node(),o).on.on(n):this.each(cu(o,n,e))}function fu(n){return function(){var e=this.parentNode;for(var o in this.__transition)if(+o!==n)return;e&&e.removeChild(this)}}function hu(){return this.on("end.remove",fu(this._id))}function gu(n){var e=this._name,o=this._id;typeof n!="function"&&(n=vo$2(n));for(var s=this._groups,c=s.length,u=new Array(c),d=0;d<c;++d)for(var m=s[d],_=m.length,ue=u[d]=new Array(_),gn,nh,ih=0;ih<_;++ih)(gn=m[ih])&&(nh=n.call(gn,gn.__data__,ih,m))&&("__data__"in gn&&(nh.__data__=gn.__data__),ue[ih]=nh,yn(ue[ih],e,o,ih,ue,Te$1(gn,o)));return new Fe$1(u,this._parents,e,o)}function vu(n){var e=this._name,o=this._id;typeof n!="function"&&(n=Pi$1(n));for(var s=this._groups,c=s.length,u=[],d=[],m=0;m<c;++m)for(var _=s[m],ue=_.length,gn,nh=0;nh<ue;++nh)if(gn=_[nh]){for(var ih=n.call(gn,gn.__data__,nh,_),rh,oh=Te$1(gn,o),lh=0,ch=ih.length;lh<ch;++lh)(rh=ih[lh])&&yn(rh,e,o,lh,ih,oh);u.push(ih),d.push(gn)}return new Fe$1(u,d,e,o)}var pu=Ht.prototype.constructor;function mu(){return new pu(this._groups,this._parents)}function yu(n,e){var o,s,c;return function(){var u=Et$1(this,n),d=(this.style.removeProperty(n),Et$1(this,n));return u===d?null:u===o&&d===s?c:c=e(o=u,s=d)}}function nr$1(n){return function(){this.style.removeProperty(n)}}function xu(n,e,o){var s,c=o+"",u;return function(){var d=Et$1(this,n);return d===c?null:d===s?u:u=e(s=d,o)}}function wu(n,e,o){var s,c,u;return function(){var d=Et$1(this,n),m=o(this),_=m+"";return m==null&&(_=m=(this.style.removeProperty(n),Et$1(this,n))),d===_?null:d===s&&_===c?u:(c=_,u=e(s=d,m))}}function _u(n,e){var o,s,c,u="style."+e,d="end."+u,m;return function(){var _=Ae$1(this,n),ue=_.on,gn=_.value[u]==null?m||(m=nr$1(e)):void 0;(ue!==o||c!==gn)&&(s=(o=ue).copy()).on(d,c=gn),_.on=s}}function bu(n,e,o){var s=(n+="")=="transform"?bs:tr$1;return e==null?this.styleTween(n,yu(n,s)).on("end.style."+n,nr$1(n)):typeof e=="function"?this.styleTween(n,wu(n,s,wo$1(this,"style."+n,e))).each(_u(this._id,n)):this.styleTween(n,xu(n,s,e),o).on("end.style."+n,null)}function Eu(n,e,o){return function(s){this.style.setProperty(n,e.call(this,s),o)}}function Su(n,e,o){var s,c;function u(){var d=e.apply(this,arguments);return d!==c&&(s=(c=d)&&Eu(n,d,o)),s}return u._value=e,u}function Nu(n,e,o){var s="style."+(n+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(e==null)return this.tween(s,null);if(typeof e!="function")throw new Error;return this.tween(s,Su(n,e,o??""))}function ku(n){return function(){this.textContent=n}}function Cu(n){return function(){var e=n(this);this.textContent=e??""}}function Mu(n){return this.tween("text",typeof n=="function"?Cu(wo$1(this,"text",n)):ku(n==null?"":n+""))}function $u(n){return function(e){this.textContent=n.call(this,e)}}function Tu(n){var e,o;function s(){var c=n.apply(this,arguments);return c!==o&&(e=(o=c)&&$u(c)),e}return s._value=n,s}function Ou(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,Tu(n))}function Pu(){for(var n=this._name,e=this._id,o=or$1(),s=this._groups,c=s.length,u=0;u<c;++u)for(var d=s[u],m=d.length,_,ue=0;ue<m;++ue)if(_=d[ue]){var gn=Te$1(_,e);yn(_,n,o,ue,d,{time:gn.time+gn.delay+gn.duration,delay:0,duration:gn.duration,ease:gn.ease})}return new Fe$1(s,this._parents,n,o)}function Iu(){var n,e,o=this,s=o._id,c=o.size();return new Promise(function(u,d){var m={value:d},_={value:function(){--c===0&&u()}};o.each(function(){var ue=Ae$1(this,s),gn=ue.on;gn!==n&&(e=(n=gn).copy(),e._.cancel.push(m),e._.interrupt.push(m),e._.end.push(_)),ue.on=e}),c===0&&u()})}var Du=0;function Fe$1(n,e,o,s){this._groups=n,this._parents=e,this._name=o,this._id=s}function or$1(){return++Du}var Be$1=Ht.prototype;Fe$1.prototype={constructor:Fe$1,select:gu,selectAll:vu,selectChild:Be$1.selectChild,selectChildren:Be$1.selectChildren,filter:au,merge:su,selection:mu,transition:Pu,call:Be$1.call,nodes:Be$1.nodes,node:Be$1.node,size:Be$1.size,empty:Be$1.empty,each:Be$1.each,on:du,attr:Xs,attrTween:qs,style:bu,styleTween:Nu,text:Mu,textTween:Ou,remove:hu,tween:Rs,delay:Qs,duration:nu,ease:iu,easeVarying:lu,end:Iu,[Symbol.iterator]:Be$1[Symbol.iterator]};function Au(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var zu={time:null,delay:0,duration:250,ease:Au};function Bu(n,e){for(var o;!(o=n.__transition)||!(o=o[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return o}function Ru(n){var e,o;n instanceof Fe$1?(e=n._id,n=n._name):(e=or$1(),(o=zu).time=yo$1(),n=n==null?null:n+"");for(var s=this._groups,c=s.length,u=0;u<c;++u)for(var d=s[u],m=d.length,_,ue=0;ue<m;++ue)(_=d[ue])&&yn(_,n,e,ue,d,o||Bu(_,e));return new Fe$1(s,this._parents,n,e)}Ht.prototype.interrupt=As;Ht.prototype.transition=Ru;const Ut$1=n=>()=>n;function Vu(n,{sourceEvent:e,target:o,transform:s,dispatch:c}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:c}})}function Ve$1(n,e,o){this.k=n,this.x=e,this.y=o}Ve$1.prototype={constructor:Ve$1,scale:function(n){return n===1?this:new Ve$1(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new Ve$1(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var lt=new Ve$1(1,0,0);Ve$1.prototype;function Bn$1(n){n.stopImmediatePropagation()}function Ct$1(n){n.preventDefault(),n.stopImmediatePropagation()}function Hu(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function Lu(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function ti$1(){return this.__zoom||lt}function Fu(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function Gu(){return navigator.maxTouchPoints||"ontouchstart"in this}function Yu(n,e,o){var s=n.invertX(e[0][0])-o[0][0],c=n.invertX(e[1][0])-o[1][0],u=n.invertY(e[0][1])-o[0][1],d=n.invertY(e[1][1])-o[1][1];return n.translate(c>s?(s+c)/2:Math.min(0,s)||Math.max(0,c),d>u?(u+d)/2:Math.min(0,u)||Math.max(0,d))}function Xu(){var n=Hu,e=Lu,o=Yu,s=Fu,c=Gu,u=[0,1/0],d=[[-1/0,-1/0],[1/0,1/0]],m=250,_=Cs,ue=vn("start","zoom","end"),gn,nh,ih,rh=500,oh=150,lh=0,ch=10;function dh(gh){gh.property("__zoom",ti$1).on("wheel.zoom",Mh,{passive:!1}).on("mousedown.zoom",Ph).on("dblclick.zoom",Eh).filter(c).on("touchstart.zoom",Nh).on("touchmove.zoom",Wh).on("touchend.zoom touchcancel.zoom",Yh).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}dh.transform=function(gh,Ah,wh,$h){var Rh=gh.selection?gh.selection():gh;Rh.property("__zoom",ti$1),gh!==Rh?yh(gh,Ah,wh,$h):Rh.interrupt().each(function(){mh(this,arguments).event($h).start().zoom(null,typeof Ah=="function"?Ah.apply(this,arguments):Ah).end()})},dh.scaleBy=function(gh,Ah,wh,$h){dh.scaleTo(gh,function(){var Rh=this.__zoom.k,Oh=typeof Ah=="function"?Ah.apply(this,arguments):Ah;return Rh*Oh},wh,$h)},dh.scaleTo=function(gh,Ah,wh,$h){dh.transform(gh,function(){var Rh=e.apply(this,arguments),Oh=this.__zoom,Lh=wh==null?fh(Rh):typeof wh=="function"?wh.apply(this,arguments):wh,qh=Oh.invert(Lh),Hh=typeof Ah=="function"?Ah.apply(this,arguments):Ah;return o(Sh(_h(Oh,Hh),Lh,qh),Rh,d)},wh,$h)},dh.translateBy=function(gh,Ah,wh,$h){dh.transform(gh,function(){return o(this.__zoom.translate(typeof Ah=="function"?Ah.apply(this,arguments):Ah,typeof wh=="function"?wh.apply(this,arguments):wh),e.apply(this,arguments),d)},null,$h)},dh.translateTo=function(gh,Ah,wh,$h,Rh){dh.transform(gh,function(){var Oh=e.apply(this,arguments),Lh=this.__zoom,qh=$h==null?fh(Oh):typeof $h=="function"?$h.apply(this,arguments):$h;return o(lt.translate(qh[0],qh[1]).scale(Lh.k).translate(typeof Ah=="function"?-Ah.apply(this,arguments):-Ah,typeof wh=="function"?-wh.apply(this,arguments):-wh),Oh,d)},$h,Rh)};function _h(gh,Ah){return Ah=Math.max(u[0],Math.min(u[1],Ah)),Ah===gh.k?gh:new Ve$1(Ah,gh.x,gh.y)}function Sh(gh,Ah,wh){var $h=Ah[0]-wh[0]*gh.k,Rh=Ah[1]-wh[1]*gh.k;return $h===gh.x&&Rh===gh.y?gh:new Ve$1(gh.k,$h,Rh)}function fh(gh){return[(+gh[0][0]+ +gh[1][0])/2,(+gh[0][1]+ +gh[1][1])/2]}function yh(gh,Ah,wh,$h){gh.on("start.zoom",function(){mh(this,arguments).event($h).start()}).on("interrupt.zoom end.zoom",function(){mh(this,arguments).event($h).end()}).tween("zoom",function(){var Rh=this,Oh=arguments,Lh=mh(Rh,Oh).event($h),qh=e.apply(Rh,Oh),Hh=wh==null?fh(qh):typeof wh=="function"?wh.apply(Rh,Oh):wh,Xh=Math.max(qh[1][0]-qh[0][0],qh[1][1]-qh[0][1]),Qh=Rh.__zoom,Th=typeof Ah=="function"?Ah.apply(Rh,Oh):Ah,Fh=_(Qh.invert(Hh).concat(Xh/Qh.k),Th.invert(Hh).concat(Xh/Th.k));return function(Dh){if(Dh===1)Dh=Th;else{var Gh=Fh(Dh),Jh=Xh/Gh[2];Dh=new Ve$1(Jh,Hh[0]-Gh[0]*Jh,Hh[1]-Gh[1]*Jh)}Lh.zoom(null,Dh)}})}function mh(gh,Ah,wh){return!wh&&gh.__zooming||new Ch(gh,Ah)}function Ch(gh,Ah){this.that=gh,this.args=Ah,this.active=0,this.sourceEvent=null,this.extent=e.apply(gh,Ah),this.taps=0}Ch.prototype={event:function(gh){return gh&&(this.sourceEvent=gh),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(gh,Ah){return this.mouse&&gh!=="mouse"&&(this.mouse[1]=Ah.invert(this.mouse[0])),this.touch0&&gh!=="touch"&&(this.touch0[1]=Ah.invert(this.touch0[0])),this.touch1&&gh!=="touch"&&(this.touch1[1]=Ah.invert(this.touch1[0])),this.that.__zoom=Ah,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(gh){var Ah=Ce$1(this.that).datum();ue.call(gh,this.that,new Vu(gh,{sourceEvent:this.sourceEvent,target:dh,type:gh,transform:this.that.__zoom,dispatch:ue}),Ah)}};function Mh(gh,...Ah){if(!n.apply(this,arguments))return;var wh=mh(this,Ah).event(gh),$h=this.__zoom,Rh=Math.max(u[0],Math.min(u[1],$h.k*Math.pow(2,s.apply(this,arguments)))),Oh=Oe$1(gh);if(wh.wheel)(wh.mouse[0][0]!==Oh[0]||wh.mouse[0][1]!==Oh[1])&&(wh.mouse[1]=$h.invert(wh.mouse[0]=Oh)),clearTimeout(wh.wheel);else{if($h.k===Rh)return;wh.mouse=[Oh,$h.invert(Oh)],Qt$1(this),wh.start()}Ct$1(gh),wh.wheel=setTimeout(Lh,oh),wh.zoom("mouse",o(Sh(_h($h,Rh),wh.mouse[0],wh.mouse[1]),wh.extent,d));function Lh(){wh.wheel=null,wh.end()}}function Ph(gh,...Ah){if(ih||!n.apply(this,arguments))return;var wh=gh.currentTarget,$h=mh(this,Ah,!0).event(gh),Rh=Ce$1(gh.view).on("mousemove.zoom",Hh,!0).on("mouseup.zoom",Xh,!0),Oh=Oe$1(gh,wh),Lh=gh.clientX,qh=gh.clientY;Gi$1(gh.view),Bn$1(gh),$h.mouse=[Oh,this.__zoom.invert(Oh)],Qt$1(this),$h.start();function Hh(Qh){if(Ct$1(Qh),!$h.moved){var Th=Qh.clientX-Lh,Fh=Qh.clientY-qh;$h.moved=Th*Th+Fh*Fh>lh}$h.event(Qh).zoom("mouse",o(Sh($h.that.__zoom,$h.mouse[0]=Oe$1(Qh,wh),$h.mouse[1]),$h.extent,d))}function Xh(Qh){Rh.on("mousemove.zoom mouseup.zoom",null),Yi$1(Qh.view,$h.moved),Ct$1(Qh),$h.event(Qh).end()}}function Eh(gh,...Ah){if(n.apply(this,arguments)){var wh=this.__zoom,$h=Oe$1(gh.changedTouches?gh.changedTouches[0]:gh,this),Rh=wh.invert($h),Oh=wh.k*(gh.shiftKey?.5:2),Lh=o(Sh(_h(wh,Oh),$h,Rh),e.apply(this,Ah),d);Ct$1(gh),m>0?Ce$1(this).transition().duration(m).call(yh,Lh,$h,gh):Ce$1(this).call(dh.transform,Lh,$h,gh)}}function Nh(gh,...Ah){if(n.apply(this,arguments)){var wh=gh.touches,$h=wh.length,Rh=mh(this,Ah,gh.changedTouches.length===$h).event(gh),Oh,Lh,qh,Hh;for(Bn$1(gh),Lh=0;Lh<$h;++Lh)qh=wh[Lh],Hh=Oe$1(qh,this),Hh=[Hh,this.__zoom.invert(Hh),qh.identifier],Rh.touch0?!Rh.touch1&&Rh.touch0[2]!==Hh[2]&&(Rh.touch1=Hh,Rh.taps=0):(Rh.touch0=Hh,Oh=!0,Rh.taps=1+!!gn);gn&&(gn=clearTimeout(gn)),Oh&&(Rh.taps<2&&(nh=Hh[0],gn=setTimeout(function(){gn=null},rh)),Qt$1(this),Rh.start())}}function Wh(gh,...Ah){if(this.__zooming){var wh=mh(this,Ah).event(gh),$h=gh.changedTouches,Rh=$h.length,Oh,Lh,qh,Hh;for(Ct$1(gh),Oh=0;Oh<Rh;++Oh)Lh=$h[Oh],qh=Oe$1(Lh,this),wh.touch0&&wh.touch0[2]===Lh.identifier?wh.touch0[0]=qh:wh.touch1&&wh.touch1[2]===Lh.identifier&&(wh.touch1[0]=qh);if(Lh=wh.that.__zoom,wh.touch1){var Xh=wh.touch0[0],Qh=wh.touch0[1],Th=wh.touch1[0],Fh=wh.touch1[1],Dh=(Dh=Th[0]-Xh[0])*Dh+(Dh=Th[1]-Xh[1])*Dh,Gh=(Gh=Fh[0]-Qh[0])*Gh+(Gh=Fh[1]-Qh[1])*Gh;Lh=_h(Lh,Math.sqrt(Dh/Gh)),qh=[(Xh[0]+Th[0])/2,(Xh[1]+Th[1])/2],Hh=[(Qh[0]+Fh[0])/2,(Qh[1]+Fh[1])/2]}else if(wh.touch0)qh=wh.touch0[0],Hh=wh.touch0[1];else return;wh.zoom("touch",o(Sh(Lh,qh,Hh),wh.extent,d))}}function Yh(gh,...Ah){if(this.__zooming){var wh=mh(this,Ah).event(gh),$h=gh.changedTouches,Rh=$h.length,Oh,Lh;for(Bn$1(gh),ih&&clearTimeout(ih),ih=setTimeout(function(){ih=null},rh),Oh=0;Oh<Rh;++Oh)Lh=$h[Oh],wh.touch0&&wh.touch0[2]===Lh.identifier?delete wh.touch0:wh.touch1&&wh.touch1[2]===Lh.identifier&&delete wh.touch1;if(wh.touch1&&!wh.touch0&&(wh.touch0=wh.touch1,delete wh.touch1),wh.touch0)wh.touch0[1]=this.__zoom.invert(wh.touch0[0]);else if(wh.end(),wh.taps===2&&(Lh=Oe$1(Lh,this),Math.hypot(nh[0]-Lh[0],nh[1]-Lh[1])<ch)){var qh=Ce$1(this).on("dblclick.zoom");qh&&qh.apply(this,arguments)}}}return dh.wheelDelta=function(gh){return arguments.length?(s=typeof gh=="function"?gh:Ut$1(+gh),dh):s},dh.filter=function(gh){return arguments.length?(n=typeof gh=="function"?gh:Ut$1(!!gh),dh):n},dh.touchable=function(gh){return arguments.length?(c=typeof gh=="function"?gh:Ut$1(!!gh),dh):c},dh.extent=function(gh){return arguments.length?(e=typeof gh=="function"?gh:Ut$1([[+gh[0][0],+gh[0][1]],[+gh[1][0],+gh[1][1]]]),dh):e},dh.scaleExtent=function(gh){return arguments.length?(u[0]=+gh[0],u[1]=+gh[1],dh):[u[0],u[1]]},dh.translateExtent=function(gh){return arguments.length?(d[0][0]=+gh[0][0],d[1][0]=+gh[1][0],d[0][1]=+gh[0][1],d[1][1]=+gh[1][1],dh):[[d[0][0],d[0][1]],[d[1][0],d[1][1]]]},dh.constrain=function(gh){return arguments.length?(o=gh,dh):o},dh.duration=function(gh){return arguments.length?(m=+gh,dh):m},dh.interpolate=function(gh){return arguments.length?(_=gh,dh):_},dh.on=function(){var gh=ue.on.apply(ue,arguments);return gh===ue?dh:gh},dh.clickDistance=function(gh){return arguments.length?(lh=(gh=+gh)*gh,dh):Math.sqrt(lh)},dh.tapDistance=function(gh){return arguments.length?(ch=+gh,dh):ch},dh}var J$2=(n=>(n.Left="left",n.Top="top",n.Right="right",n.Bottom="bottom",n))(J$2||{}),_o$1=(n=>(n.Partial="partial",n.Full="full",n))(_o$1||{}),Qe$1=(n=>(n.Bezier="default",n.SimpleBezier="simple-bezier",n.Straight="straight",n.Step="step",n.SmoothStep="smoothstep",n))(Qe$1||{}),at$1=(n=>(n.Strict="strict",n.Loose="loose",n))(at$1||{}),ro$2=(n=>(n.Arrow="arrow",n.ArrowClosed="arrowclosed",n))(ro$2||{}),sn=(n=>(n.Free="free",n.Vertical="vertical",n.Horizontal="horizontal",n))(sn||{}),Uu=(n=>(n.TopLeft="top-left",n.TopCenter="top-center",n.TopRight="top-right",n.BottomLeft="bottom-left",n.BottomCenter="bottom-center",n.BottomRight="bottom-right",n))(Uu||{});const ir$1="vue-flow__node-desc",rr$1="vue-flow__edge-desc",Zu="vue-flow__aria-live",lr$1=["Enter"," ","Escape"],mt$1={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};function ni$1(n){return{...n.computedPosition||{x:0,y:0},width:n.dimensions.width||0,height:n.dimensions.height||0}}function lo$2(n,e){const o=Math.max(0,Math.min(n.x+n.width,e.x+e.width)-Math.max(n.x,e.x)),s=Math.max(0,Math.min(n.y+n.height,e.y+e.height)-Math.max(n.y,e.y));return Math.ceil(o*s)}function xn$1(n){return{width:n.offsetWidth,height:n.offsetHeight}}function st$1(n,e=0,o=1){return Math.min(Math.max(n,e),o)}function bo$1(n,e){return{x:st$1(n.x,e[0][0],e[1][0]),y:st$1(n.y,e[0][1],e[1][1])}}function oi$1(n){const e=n.getRootNode(),o=$o$1();return"elementFromPoint"in e?e:o.document}function De$1(n){return n&&typeof n=="object"&&"id"in n&&"source"in n&&"target"in n}function Wu(n){return De$1(n)&&"sourceNode"in n&&"targetNode"in n}function yt$1(n){return n&&typeof n=="object"&&"id"in n&&"position"in n&&!De$1(n)}function dt$1(n){return yt$1(n)&&"computedPosition"in n}function Ku(n){return!!n.width&&!!n.height&&!!n.x&&!!n.y}function qu(n,e={}){let o=e;return dt$1(n)||(o={type:n.type??e.type??"default",dimensions:markRaw({width:0,height:0}),handleBounds:{source:[],target:[]},computedPosition:markRaw({z:0,...n.position}),draggable:void 0,selectable:void 0,connectable:void 0,focusable:void 0,selected:!1,dragging:!1,resizing:!1,initialized:!1,...e,data:fe$1(n.data)?n.data:{},events:markRaw(fe$1(n.events)?n.events:{})}),Object.assign({},o,n,{id:n.id.toString()})}function Eo$1(n,e={}){const o=fe$1(n.events)?n.events:e.events&&fe$1(e.events)?e.events:{},s=fe$1(n.data)?n.data:e.data&&fe$1(e.data)?e.data:{};return e=Wu(n)?e:{...e,sourceHandle:(n.sourceHandle?n.sourceHandle.toString():void 0)||e.sourceHandle,targetHandle:(n.targetHandle?n.targetHandle.toString():void 0)||e.targetHandle,type:n.type??e.type??"default",source:n.source.toString()||e.source,target:n.target.toString()||e.target,updatable:n.updatable??e.updatable,selectable:n.selectable??e.selectable,focusable:n.focusable??e.focusable,data:s,events:markRaw(o),label:(n.label&&!Ue$1(n.label)?markRaw(n.label):n.label)||e.label,interactionWidth:n.interactionWidth||e.interactionWidth},Object.assign({},e,n,{id:n.id.toString()})}function wn({source:n,sourceHandle:e,target:o,targetHandle:s}){return`vueflow__edge-${n}${e??""}-${o}${s??""}`}function sr$1(n,e){return e.some(o=>De$1(o)&&o.source===n.source&&o.target===n.target&&(o.sourceHandle===n.sourceHandle||!o.sourceHandle&&!n.sourceHandle)&&(o.targetHandle===n.targetHandle||!o.targetHandle&&!n.targetHandle))}function ju({x:n,y:e},{x:o,y:s,zoom:c}){return{x:n*c+o,y:e*c+s}}function So$1({x:n,y:e},{x:o,y:s,zoom:c},u,[d,m]){const _={x:(n-o)/c,y:(e-s)/c};return u?{x:d*Math.round(_.x/d),y:m*Math.round(_.y/m)}:_}function ur$1(n,e){return{x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x2,e.x2),y2:Math.max(n.y2,e.y2)}}function un({x:n,y:e,width:o,height:s}){return{x:n,y:e,x2:n+o,y2:e+s}}function cr$1({x:n,y:e,x2:o,y2:s}){return{x:n,y:e,width:o-n,height:s-e}}function Gd(n,e){return cr$1(ur$1(un(n),un(e)))}function No$1(n){const e=n.reduce((o,{computedPosition:s={x:0,y:0},dimensions:c={width:0,height:0}}={})=>ur$1(o,un({...s,...c})),{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return cr$1(e)}function dr$1(n,e,{x:o,y:s,zoom:c}={x:0,y:0,zoom:1},u=!1,d=!1){const m={x:(e.x-o)/c,y:(e.y-s)/c,width:e.width/c,height:e.height/c};return n.filter(_=>{const{computedPosition:ue={x:0,y:0},dimensions:gn={width:0,height:0},selectable:nh}=_;if(d&&!nh)return!1;const ih={...ue,width:gn.width||0,height:gn.height||0},rh=lo$2(m,ih),oh=typeof gn.width>"u"||typeof gn.height>"u"||gn.width===0||gn.height===0,lh=u&&rh>0,ch=gn.width*gn.height;return oh||lh||rh>=ch})}function _n$1(n,e){const o=n.map(s=>Ue$1(s)?s:s.id);return e.filter(s=>o.includes(s.source)||o.includes(s.target))}function cn(n,e,o,s,c,u=.1,d={x:0,y:0}){const m=e/(n.width*(1+u)),_=o/(n.height*(1+u)),ue=Math.min(m,_),gn=st$1(ue,s,c),nh=n.x+n.width/2,ih=n.y+n.height/2,rh=e/2-nh*gn+(d.x??0),oh=o/2-ih*gn+(d.y??0);return{x:rh,y:oh,zoom:gn}}function Ju(n,e){return{x:e.x+n.x,y:e.y+n.y,z:(n.z>e.z?n.z:e.z)+1}}function fr$1(n,e){if(!n.parentNode)return!1;const o=e(n.parentNode);return o?o.selected?!0:fr$1(o,e):!1}function tt$1(n,e){return typeof n>"u"?"":typeof n=="string"?n:`${e?`${e}__`:""}${Object.keys(n).sort().map(o=>`${o}=${n[o]}`).join("&")}`}function ii$1(n,e,o){return n<e?st$1(Math.abs(n-e),1,50)/50:n>o?-st$1(Math.abs(n-o),1,50)/50:0}function hr$1(n,e){const o=ii$1(n.x,35,e.width-35)*20,s=ii$1(n.y,35,e.height-35)*20;return[o,s]}function Rn$1(n,e){if(e){const o=n.position.x+n.dimensions.width-e.dimensions.width,s=n.position.y+n.dimensions.height-e.dimensions.height;if(o>0||s>0||n.position.x<0||n.position.y<0){let c={};if(Nt$1(e.style)?c={...e.style(e)}:e.style&&(c={...e.style}),c.width=c.width??`${e.dimensions.width}px`,c.height=c.height??`${e.dimensions.height}px`,o>0)if(Ue$1(c.width)){const u=Number(c.width.replace("px",""));c.width=`${u+o}px`}else c.width+=o;if(s>0)if(Ue$1(c.height)){const u=Number(c.height.replace("px",""));c.height=`${u+s}px`}else c.height+=s;if(n.position.x<0){const u=Math.abs(n.position.x);if(e.position.x=e.position.x-u,Ue$1(c.width)){const d=Number(c.width.replace("px",""));c.width=`${d+u}px`}else c.width+=u;n.position.x=0}if(n.position.y<0){const u=Math.abs(n.position.y);if(e.position.y=e.position.y-u,Ue$1(c.height)){const d=Number(c.height.replace("px",""));c.height=`${d+u}px`}else c.height+=u;n.position.y=0}e.dimensions.width=Number(c.width.toString().replace("px","")),e.dimensions.height=Number(c.height.toString().replace("px","")),Nt$1(e.style)?e.style=u=>{const d=e.style;return{...d(u),...c}}:e.style={...e.style,...c}}}}function dn(n,e){n.filter(s=>s.type==="add"||s.type==="remove").forEach(s=>{if(s.type==="add")e.findIndex(c=>c.id===s.item.id)===-1&&e.push(s.item);else if(s.type==="remove"){const c=e.findIndex(u=>u.id===s.id);c!==-1&&e.splice(c,1)}});const o=e.map(s=>s.id);return e.forEach(s=>{var c,u;const d=n.filter(m=>m.id===s.id);for(const m of d)switch(m.type){case"select":s.selected=m.selected;break;case"position":if(dt$1(s)&&(typeof m.position<"u"&&(s.position=m.position),typeof m.dragging<"u"&&(s.dragging=m.dragging),s.expandParent&&s.parentNode)){const _=e[o.indexOf(s.parentNode)];_&&dt$1(_)&&Rn$1(s,_)}break;case"dimensions":if(dt$1(s)){if(typeof m.dimensions<"u"&&(s.dimensions=m.dimensions),typeof m.updateStyle<"u"&&(s.style={...s.style||{},width:`${(c=m.dimensions)==null?void 0:c.width}px`,height:`${(u=m.dimensions)==null?void 0:u.height}px`}),typeof m.resizing<"u"&&(s.resizing=m.resizing),s.expandParent&&s.parentNode){const _=e[o.indexOf(s.parentNode)];_&&dt$1(_)&&(_.initialized?Rn$1(s,_):nextTick(()=>{Rn$1(s,_)}))}s.initialized||(s.initialized=!0)}break}}),e}function Re$1(n,e){return{id:n,type:"select",selected:e}}function ri$1(n){return{item:n,type:"add"}}function Vn$1(n){return{id:n,type:"remove"}}function Hn$1(n,e){return n.reduce((o,s)=>{let c=e.includes(s.id);fe$1(s.selectable)&&!s.selectable&&(c=!1);const u=dt$1(s)?"changedNodes":"changedEdges";return!s.selected&&c?o[u].push(Re$1(s.id,!0)):s.selected&&!c&&o[u].push(Re$1(s.id,!1)),o},{changedNodes:[],changedEdges:[]})}function L$3(n=()=>{}){const e=ref$1(new Set);n&&e.value.add(n);const o=s=>{e.value.delete(s)};return{on:s=>{e.value.has(n)&&e.value.delete(n),e.value.add(s);const c=()=>o(s);return Vt$1(c),{off:c}},off:o,trigger:s=>Promise.all(Array.from(e.value).map(c=>c(s))),fns:e}}function li$1(n,e,o){let s=n;do{if(s&&s.matches(e))return!0;if(s===o)return!1;s=s.parentElement}while(s);return!1}function Qu(n,e,o,s,c){return n.filter(u=>(u.selected||u.id===c)&&(!u.parentNode||!fr$1(u,s))&&(u.draggable||e&&typeof u.draggable>"u")).map(u=>{var d,m;return markRaw({id:u.id,position:u.position||{x:0,y:0},distance:{x:o.x-((d=u.computedPosition)==null?void 0:d.x)||0,y:o.y-((m=u.computedPosition)==null?void 0:m.y)||0},from:u.computedPosition,extent:u.extent,parentNode:u.parentNode,dimensions:u.dimensions})})}function Ln$1({id:n,dragItems:e,findNode:o}){const s=e.reduce((c,u)=>{const d=o(u.id);return d&&c.push(d),c},[]);return[n?s.find(c=>c.id===n):s[0],s]}function gr$1(n){if(Array.isArray(n))switch(n.length){case 1:return[n[0],n[0],n[0],n[0]];case 2:return[n[0],n[1],n[0],n[1]];case 3:return[n[0],n[1],n[2],n[1]];case 4:return n;default:return[0,0,0,0]}return[n,n,n,n]}function ec(n,e,o){const[s,c,u,d]=typeof n!="string"?gr$1(n.padding):[0,0,0,0];return o&&He$1(o.computedPosition.x)&&He$1(o.computedPosition.y)&&He$1(o.dimensions.width)&&He$1(o.dimensions.height)?[[o.computedPosition.x+d,o.computedPosition.y+s],[o.computedPosition.x+(o.dimensions.width-e.dimensions.width)-c,o.computedPosition.y+(o.dimensions.height-e.dimensions.height)-u]]:!1}function tc(n,e,o,s){let c=n.extent||o;if(c==="parent"||!Array.isArray(c)&&(c==null?void 0:c.range)==="parent")if(n.parentNode&&s&&n.dimensions.width&&n.dimensions.height){const u=ec(c,n,s);u&&(c=u)}else e(new xe$1(ye$1.NODE_EXTENT_INVALID,n.id)),c=o;else if(Array.isArray(c)){const u=(s==null?void 0:s.computedPosition.x)||0,d=(s==null?void 0:s.computedPosition.y)||0;c=[[c[0][0]+u,c[0][1]+d],[c[1][0]+u,c[1][1]+d]]}else if(c!=null&&c.range&&Array.isArray(c.range)){const[u,d,m,_]=gr$1(c.padding),ue=(s==null?void 0:s.computedPosition.x)||0,gn=(s==null?void 0:s.computedPosition.y)||0;c=[[c.range[0][0]+ue+_,c.range[0][1]+gn+u],[c.range[1][0]+ue-d,c.range[1][1]+gn-m]]}return c}function ko$1(n,e,o,s,c){const u=tc(n,o,s,c),d=bo$1(e,u);return{position:{x:d.x-((c==null?void 0:c.computedPosition.x)||0),y:d.y-((c==null?void 0:c.computedPosition.y)||0)},computedPosition:d}}function fn(n,e,o){const s=((o==null?void 0:o.x)??0)+e.x,c=((o==null?void 0:o.y)??0)+e.y,u=(o==null?void 0:o.width)??e.width,d=(o==null?void 0:o.height)??e.height;switch(n){case J$2.Top:return{x:s+u/2,y:c};case J$2.Right:return{x:s+u,y:c+d/2};case J$2.Bottom:return{x:s+u/2,y:c+d};case J$2.Left:return{x:s,y:c+d/2}}}function ai$1(n=[],e){return n.length?!e||n.length===1?n[0]:e&&n.find(o=>o.id===e)||null:null}function nc(n,e,o,s,c,u){const d=fn(o,{...n.dimensions,...n.computedPosition},e),m=fn(u,{...s.dimensions,...s.computedPosition},c);return{sourceX:d.x,sourceY:d.y,targetX:m.x,targetY:m.y}}function oc({sourcePos:n,targetPos:e,sourceWidth:o,sourceHeight:s,targetWidth:c,targetHeight:u,width:d,height:m,viewport:_}){const ue={x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x+o,e.x+c),y2:Math.max(n.y+s,e.y+u)};ue.x===ue.x2&&(ue.x2+=1),ue.y===ue.y2&&(ue.y2+=1);const gn=un({x:(0-_.x)/_.zoom,y:(0-_.y)/_.zoom,width:d/_.zoom,height:m/_.zoom}),nh=Math.max(0,Math.min(gn.x2,ue.x2)-Math.max(gn.x,ue.x)),ih=Math.max(0,Math.min(gn.y2,ue.y2)-Math.max(gn.y,ue.y));return Math.ceil(nh*ih)>0}function ic(n,e,o=!1){let s=-1;const c=n.reduce((u,d)=>{const m=He$1(d.zIndex);let _=m?d.zIndex:0;const ue=e(d.source),gn=e(d.target);return!ue||!gn||(o&&(_=m?d.zIndex:Math.max(ue.computedPosition.z||0,gn.computedPosition.z||0)),u[_]?u[_].push(d):u[_]=[d],s=_>s?_:s),u},{});return Object.entries(Object.keys(c).length?c:{0:[]}).map(([u,d])=>{const m=+u;return{edges:d,level:m,isMaxLevel:m===s}})}var ye$1=(n=>(n.MISSING_VIEWPORT_DIMENSIONS="MISSING_VIEWPORT_DIMENSIONS",n.NODE_INVALID="NODE_INVALID",n.NODE_NOT_FOUND="NODE_NOT_FOUND",n.NODE_MISSING_PARENT="NODE_MISSING_PARENT",n.NODE_TYPE_MISSING="NODE_TYPE_MISSING",n.NODE_EXTENT_INVALID="NODE_EXTENT_INVALID",n.EDGE_INVALID="EDGE_INVALID",n.EDGE_NOT_FOUND="EDGE_NOT_FOUND",n.EDGE_SOURCE_MISSING="EDGE_SOURCE_MISSING",n.EDGE_TARGET_MISSING="EDGE_TARGET_MISSING",n.EDGE_TYPE_MISSING="EDGE_TYPE_MISSING",n.EDGE_SOURCE_TARGET_SAME="EDGE_SOURCE_TARGET_SAME",n.EDGE_SOURCE_TARGET_MISSING="EDGE_SOURCE_TARGET_MISSING",n.EDGE_ORPHANED="EDGE_ORPHANED",n))(ye$1||{});const Fn$1={MISSING_VIEWPORT_DIMENSIONS:()=>"The Vue Flow parent container needs a width and a height to render the graph",NODE_INVALID:n=>`Node is invalid
Node: ${n}`,NODE_NOT_FOUND:n=>`Node not found
Node: ${n}`,NODE_MISSING_PARENT:(n,e)=>`Node is missing a parent
Node: ${n}
Parent: ${e}`,NODE_TYPE_MISSING:n=>`Node type is missing
Type: ${n}`,NODE_EXTENT_INVALID:n=>`Only child nodes can use a parent extent
Node: ${n}`,EDGE_INVALID:n=>`An edge needs a source and a target
Edge: ${n}`,EDGE_SOURCE_MISSING:(n,e)=>`Edge source is missing
Edge: ${n} 
Source: ${e}`,EDGE_TARGET_MISSING:(n,e)=>`Edge target is missing
Edge: ${n} 
Target: ${e}`,EDGE_TYPE_MISSING:n=>`Edge type is missing
Type: ${n}`,EDGE_SOURCE_TARGET_SAME:(n,e,o)=>`Edge source and target are the same
Edge: ${n} 
Source: ${e} 
Target: ${o}`,EDGE_SOURCE_TARGET_MISSING:(n,e,o)=>`Edge source or target is missing
Edge: ${n} 
Source: ${e} 
Target: ${o}`,EDGE_ORPHANED:n=>`Edge was orphaned (suddenly missing source or target) and has been removed
Edge: ${n}`,EDGE_NOT_FOUND:n=>`Edge not found
Edge: ${n}`};let xe$1=class extends Error{constructor(e,...o){var s;super((s=Fn$1[e])==null?void 0:s.call(Fn$1,...o)),this.code=e}};function Co$1(n){return"clientX"in n}function xt$1(n,e){var o,s;const c=Co$1(n),u=c?n.clientX:(o=n.touches)==null?void 0:o[0].clientX,d=c?n.clientY:(s=n.touches)==null?void 0:s[0].clientY;return{x:u-((e==null?void 0:e.left)??0),y:d-((e==null?void 0:e.top)??0)}}function Ue$1(n){return typeof n=="string"}function Nt$1(n){return typeof n=="function"}function rc(n){return typeof n=="boolean"}function He$1(n){return typeof n=="number"}function vr$1(){return{handleDomNode:null,isValid:!1,connection:{source:"",target:"",sourceHandle:null,targetHandle:null},endHandle:null}}function Gn$1(n){n==null||n.classList.remove("valid","connecting","vue-flow__handle-valid","vue-flow__handle-connecting")}function si$1(n,e,o,s){return(e[o]||[]).reduce((c,u)=>(`${n.id}-${u.id}-${o}`!==s&&c.push({id:u.id||null,type:o,nodeId:n.id,...fn(u.position,{...n.dimensions,...n.computedPosition},u)}),c),[])}function lc(n,e,o,s){let c=[],u=1/0;return o.forEach(d=>{const m=Math.sqrt((d.x-n.x)**2+(d.y-n.y)**2);if(m<=e){const _=s(d);m<=u&&_.isValid&&(m<u?c=[{handle:d,validHandleResult:_}]:m===u&&c.push({handle:d,validHandleResult:_}),u=m)}}),c.length?c.length===1?c[0]:c.find(({handle:d})=>d.type==="target")||c[0]:{handle:null,validHandleResult:vr$1()}}function ui$1(n,e,o,s,c,u,d,m,_,ue){const gn=u==="target",nh=m.querySelector(`.vue-flow__handle[data-id="${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`),{x:ih,y:rh}=xt$1(n),oh=m.elementFromPoint(ih,rh),lh=oh!=null&&oh.classList.contains("vue-flow__handle")?oh:nh,ch={...vr$1(),handleDomNode:lh};if(lh){const dh=pr$1(void 0,lh),_h=lh.getAttribute("data-nodeid"),Sh=lh.getAttribute("data-handleid"),fh=lh.classList.contains("connectable"),yh=lh.classList.contains("connectableend"),mh={source:gn?_h:s,sourceHandle:gn?Sh:c,target:gn?s:_h,targetHandle:gn?c:Sh};ch.connection=mh,fh&&yh&&(o===at$1.Strict?gn&&dh==="source"||!gn&&dh==="target":_h!==s||Sh!==c)&&(ch.endHandle={nodeId:_h,handleId:Sh,type:dh},ch.isValid=d(mh,{edges:_,sourceNode:ue(mh.source),targetNode:ue(mh.target)}))}return ch}function ac({nodes:n,nodeId:e,handleId:o,handleType:s}){return n.reduce((c,u)=>{const{handleBounds:d}=u;let m=[],_=[];return d&&(m=si$1(u,d,"source",`${e}-${o}-${s}`),_=si$1(u,d,"target",`${e}-${o}-${s}`)),c.push(...m,..._),c},[])}function pr$1(n,e){return n||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function sc(n,e){let o=null;return e?o="valid":n&&!e&&(o="invalid"),o}const uc=["production","prod"];function Rt$1(n,...e){uc.includes("production")||console.warn(`[Vue Flow]: ${n}`,...e)}function ci$1(n,e,o){const s=e.querySelectorAll(`.vue-flow__handle${n}`);if(!s||!s.length)return;const c=Array.from(s),u=e.getBoundingClientRect();return c.map(d=>{const m=d.getBoundingClientRect();return{id:d.getAttribute("data-handleid"),position:d.getAttribute("data-handlepos"),x:(m.left-u.left)/o,y:(m.top-u.top)/o,...xn$1(d)}})}function ao$2(n,e,o,s,c,u=!1,d){c.value=!1,n.selected?(u||n.selected&&e)&&(s([n]),nextTick(d.blur)):o([n])}function fe$1(n){return typeof unref(n)<"u"}function cc(n,e,o){if(!n.source||!n.target)return o(new xe$1(ye$1.EDGE_INVALID,n.id)),!1;let s;return De$1(n)?s=n:s={...n,id:wn(n)},s=Eo$1(s),sr$1(s,e)?!1:s}function dc(n,e,o,s,c,u){if(!e.source||!e.target)return u(new xe$1(ye$1.EDGE_INVALID,n.id)),!1;const d=s(n.id);if(!d)return u(new xe$1(ye$1.EDGE_NOT_FOUND,n.id)),!1;const{id:m,..._}=n,ue={..._,id:c?wn(e):m,source:e.source,target:e.target,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle};return o.splice(o.indexOf(d),1,ue),ue}function di$1(n,e,o,s){const c={},u=n.reduce((m,_)=>{if(!yt$1(_))return s(new xe$1(ye$1.NODE_INVALID)),m;const ue=qu(_,{...o(_.id),parentNode:_.parentNode});return _.parentNode&&(c[_.parentNode]=!0),m.concat(ue)},[]),d=[...u,...e];for(const m of u){const _=d.find(ue=>ue.id===m.parentNode);m.parentNode&&!_&&s(new xe$1(ye$1.NODE_MISSING_PARENT,m.id,m.parentNode)),(m.parentNode||c[m.id])&&(c[m.id]&&(m.isParent=!0),_&&(_.isParent=!0))}return u}function mr$1(n){const{vueFlowRef:e,snapToGrid:o,snapGrid:s,noDragClassName:c,nodes:u,nodeExtent:d,viewport:m,autoPanOnNodeDrag:_,nodesDraggable:ue,panBy:gn,findNode:nh,multiSelectionActive:ih,nodesSelectionActive:rh,selectNodesOnDrag:oh,removeSelectedElements:lh,addSelectedNodes:ch,updateNodePositions:dh,emits:_h}=ve$1(),{onStart:Sh,onDrag:fh,onStop:yh,el:mh,disabled:Ch,id:Mh,selectable:Ph,dragHandle:Eh}=n,Nh=ref$1(!1);let Wh=[],Yh,gh=null,Ah={x:void 0,y:void 0},wh={x:0,y:0},$h=null,Rh=0,Oh=!1;const Lh=nd(),qh=({x:Xh,y:Qh})=>{Ah={x:Xh,y:Qh};let Th=!1;if(Wh=Wh.map(Fh=>{const Dh={x:Xh-Fh.distance.x,y:Qh-Fh.distance.y};o.value&&(Dh.x=s.value[0]*Math.round(Dh.x/s.value[0]),Dh.y=s.value[1]*Math.round(Dh.y/s.value[1]));const{computedPosition:Gh}=ko$1(Fh,Dh,_h.error,d.value,Fh.parentNode?nh(Fh.parentNode):void 0);return Th=Th||Fh.position.x!==Gh.x||Fh.position.y!==Gh.y,Fh.position=Gh,Fh}),!!Th&&(dh(Wh,!0,!0),Nh.value=!0,$h)){const[Fh,Dh]=Ln$1({id:Mh,dragItems:Wh,findNode:nh});fh({event:$h,node:Fh,nodes:Dh})}},Hh=()=>{if(!gh)return;const[Xh,Qh]=hr$1(wh,gh);if(Xh!==0||Qh!==0){const Th={x:(Ah.x??0)-Xh/m.value.zoom,y:(Ah.y??0)-Qh/m.value.zoom};gn({x:Xh,y:Qh})&&qh(Th)}Rh=requestAnimationFrame(Hh)};return watch([()=>le(Ch),mh],([Xh,Qh])=>{if(Qh){const Th=Ce$1(Qh);Xh?Th.on(".drag",null):(Yh=ts().on("start",Fh=>{var Dh;const Gh=nh(Mh);!oh.value&&!ih.value&&Gh&&(Gh.selected||lh()),Gh&&le(Ph)&&oh.value&&ao$2(Gh,ih.value,ch,lh,rh,!1,Qh);const Jh=Lh(Fh);if(Ah=Jh,Wh=Qu(u.value,ue.value,Jh,nh,Mh),Wh.length){const[rf,ef]=Ln$1({id:Mh,dragItems:Wh,findNode:nh});Sh({event:Fh.sourceEvent,node:rf,nodes:ef})}gh=((Dh=e.value)==null?void 0:Dh.getBoundingClientRect())||null,wh=xt$1(Fh.sourceEvent,gh)}).on("drag",Fh=>{const Dh=Lh(Fh);!Oh&&_.value&&(Oh=!0,Hh()),(Ah.x!==Dh.xSnapped||Ah.y!==Dh.ySnapped)&&Wh.length&&($h=Fh.sourceEvent,wh=xt$1(Fh.sourceEvent,gh),qh(Dh))}).on("end",Fh=>{if(Nh.value=!1,Oh=!1,cancelAnimationFrame(Rh),Wh.length){dh(Wh,!1,!1);const[Dh,Gh]=Ln$1({id:Mh,dragItems:Wh,findNode:nh});yh({event:Fh.sourceEvent,node:Dh,nodes:Gh})}}).filter(Fh=>{const Dh=Fh.target,Gh=le(Eh);return!Fh.button&&(!c.value||!li$1(Dh,`.${c.value}`,Qh)&&(!Gh||li$1(Dh,Gh,Qh)))}),Th.call(Yh))}}),Nh}function fc(){return{edgesChange:L$3(),nodesChange:L$3(),nodeDoubleClick:L$3(),nodeClick:L$3(),nodeMouseEnter:L$3(),nodeMouseMove:L$3(),nodeMouseLeave:L$3(),nodeContextMenu:L$3(),nodeDragStart:L$3(),nodeDrag:L$3(),nodeDragStop:L$3(),nodesInitialized:L$3(),miniMapNodeClick:L$3(),miniMapNodeDoubleClick:L$3(),miniMapNodeMouseEnter:L$3(),miniMapNodeMouseMove:L$3(),miniMapNodeMouseLeave:L$3(),connect:L$3(),connectStart:L$3(),connectEnd:L$3(),clickConnectStart:L$3(),clickConnectEnd:L$3(),paneReady:L$3(),move:L$3(),moveStart:L$3(),moveEnd:L$3(),selectionDragStart:L$3(),selectionDrag:L$3(),selectionDragStop:L$3(),selectionContextMenu:L$3(),selectionStart:L$3(),selectionEnd:L$3(),viewportChangeStart:L$3(),viewportChange:L$3(),viewportChangeEnd:L$3(),paneScroll:L$3(),paneClick:L$3(),paneContextMenu:L$3(),paneMouseEnter:L$3(),paneMouseMove:L$3(),paneMouseLeave:L$3(),edgeContextMenu:L$3(),edgeMouseEnter:L$3(),edgeMouseMove:L$3(),edgeMouseLeave:L$3(),edgeDoubleClick:L$3(),edgeClick:L$3(),edgeUpdateStart:L$3(),edgeUpdate:L$3(),edgeUpdateEnd:L$3(),updateNodeInternals:L$3(),error:L$3(n=>Rt$1(n.message))}}function hc(n,e){onBeforeMount(()=>{for(const[o,s]of Object.entries(e.value)){const c=u=>{n(o,u)};s.on(c),Vt$1(()=>{s.off(c)})}})}function gc(n,e){const o={};for(const s in n)e.includes(s)||Object.defineProperty(o,s,{enumerable:!0,get:()=>n[s]});return o}const vc=["data-id","data-handleid","data-nodeid","data-handlepos"],pc={name:"Handle",compatConfig:{MODE:3}},hn=defineComponent({...pc,props:{id:null,type:null,position:{default:J$2.Top},isValidConnection:{type:Function},connectable:{type:[Boolean,String,Function],default:void 0},connectableStart:{type:Boolean,default:!0},connectableEnd:{type:Boolean,default:!0}},setup(n){const e=gc(n,["position","connectable","connectableStart","connectableEnd","id"]),o=Pt(e,"type","source"),s=Pt(e,"isValidConnection",void 0),{connectionStartHandle:c,connectionClickStartHandle:u,connectionEndHandle:d,vueFlowRef:m,nodesConnectable:_,noDragClassName:ue,noPanClassName:gn}=ve$1(),{id:nh,node:ih,nodeEl:rh,connectedEdges:oh}=rd(),lh=ref$1(),ch=computed(()=>n.id??`${nh}__handle-${n.position}`),dh=computed(()=>typeof n.connectableStart<"u"?n.connectableStart:!0),_h=computed(()=>typeof n.connectableEnd<"u"?n.connectableEnd:!0),{handlePointerDown:Sh,handleClick:fh}=Mr$1({nodeId:nh,handleId:ch,isValidConnection:s,type:o}),yh=computed(()=>Ue$1(n.connectable)&&n.connectable==="single"?!oh.value.some(Eh=>{const Nh=Eh[`${o.value}Handle`];return Eh[o.value]!==nh?!1:Nh?Nh===ch.value:!0}):Nt$1(n.connectable)?n.connectable(ih,oh.value):fe$1(n.connectable)?n.connectable:_.value),mh=computed(()=>{var Eh,Nh,Wh,Yh,gh,Ah;return((Eh=c.value)==null?void 0:Eh.nodeId)===nh&&((Nh=c.value)==null?void 0:Nh.handleId)===ch.value&&((Wh=c.value)==null?void 0:Wh.type)===o.value||((Yh=d.value)==null?void 0:Yh.nodeId)===nh&&((gh=d.value)==null?void 0:gh.handleId)===ch.value&&((Ah=d.value)==null?void 0:Ah.type)===o.value}),Ch=computed(()=>{var Eh,Nh,Wh;return((Eh=u.value)==null?void 0:Eh.nodeId)===nh&&((Nh=u.value)==null?void 0:Nh.handleId)===ch.value&&((Wh=u.value)==null?void 0:Wh.type)===o.value});Se(()=>ih.initialized).toBe(!0,{flush:"post"}).then(()=>{var Eh;const Nh=(Eh=ih.handleBounds[o.value])==null?void 0:Eh.find(Rh=>Rh.id===ch.value);if(!m.value||Nh)return;const Wh=m.value.querySelector(".vue-flow__transformationpane");if(!rh||!lh.value||!Wh||!ch.value)return;const Yh=rh.value.getBoundingClientRect(),gh=lh.value.getBoundingClientRect(),Ah=window.getComputedStyle(Wh),{m22:wh}=new window.DOMMatrixReadOnly(Ah.transform),$h={id:ch.value,position:n.position,x:(gh.left-Yh.left)/wh,y:(gh.top-Yh.top)/wh,...xn$1(lh.value)};ih.handleBounds[o.value]=[...ih.handleBounds[o.value]??[],$h]});function Mh(Eh){const Nh=Co$1(Eh);yh.value&&dh.value&&(Nh&&Eh.button===0||!Nh)&&Sh(Eh)}function Ph(Eh){!nh||!u.value&&!dh.value||yh.value&&fh(Eh)}return(Eh,Nh)=>(openBlock(),createElementBlock("div",{ref_key:"handle",ref:lh,"data-id":`${unref(nh)}-${unref(ch)}-${unref(o)}`,"data-handleid":unref(ch),"data-nodeid":unref(nh),"data-handlepos":n.position,class:normalizeClass(["vue-flow__handle",[`vue-flow__handle-${n.position}`,`vue-flow__handle-${unref(ch)}`,unref(ue),unref(gn),unref(o),{connectable:unref(yh),connecting:unref(Ch),connectablestart:unref(dh),connectableend:unref(_h),connectionindicator:unref(yh)&&(unref(dh)&&!unref(mh)||unref(_h)&&unref(mh))}]]),onMousedown:Mh,onTouchstartPassive:Mh,onClick:Ph},[renderSlot(Eh.$slots,"default",{id:n.id})],42,vc))}}),bn$1=function({sourcePosition:n=J$2.Bottom,targetPosition:e=J$2.Top,label:o,connectable:s=!0,isValidTargetPos:c,isValidSourcePos:u}){return[h$1(hn,{type:"target",position:e,connectable:s,isValidConnection:c}),typeof o!="string"&&o?h$1(o):h$1("div",{innerHTML:o}),h$1(hn,{type:"source",position:n,connectable:s,isValidConnection:u})]};bn$1.props=["sourcePosition","targetPosition","label","isValidTargetPos","isValidSourcePos","connectable"];bn$1.inheritAttrs=!1;bn$1.compatConfig={MODE:3};const mc=bn$1,En$1=function({sourcePosition:n=J$2.Bottom,label:e,connectable:o=!0,isValidSourcePos:s}){return[typeof e!="string"&&e?h$1(e):h$1("div",{innerHTML:e}),h$1(hn,{type:"source",position:n,connectable:o,isValidConnection:s})]};En$1.props=["sourcePosition","label","isValidSourcePos","connectable"];En$1.inheritAttrs=!1;En$1.compatConfig={MODE:3};const yc=En$1,Sn$1=function({targetPosition:n=J$2.Top,label:e,connectable:o=!0,isValidTargetPos:s}){return[h$1(hn,{type:"target",position:n,connectable:o,isValidConnection:s}),typeof e!="string"&&e?h$1(e):h$1("div",{innerHTML:e})]};Sn$1.props=["targetPosition","label","isValidTargetPos","connectable"];Sn$1.inheritAttrs=!1;Sn$1.compatConfig={MODE:3};const xc=Sn$1,fi$1=Symbol("vueFlow"),yr$1=Symbol("nodeId"),xr$1=Symbol("nodeRef"),wr$1=Symbol("edgeId"),_r$1=Symbol("edgeRef"),Nn$1=Symbol("slots"),wc=defineComponent({name:"Node",compatConfig:{MODE:3},props:["name","type","id","draggable","selectable","focusable","connectable","node","resizeObserver"],setup(n){provide(yr$1,n.id);const{id:e,edges:o,noPanClassName:s,selectNodesOnDrag:c,nodesSelectionActive:u,multiSelectionActive:d,emits:m,findNode:_,removeSelectedNodes:ue,addSelectedNodes:gn,updateNodeDimensions:nh,onUpdateNodeInternals:ih,getIntersectingNodes:rh,getNodeTypes:oh,nodeExtent:lh,elevateNodesOnSelect:ch,disableKeyboardA11y:dh,ariaLiveMessage:_h,snapToGrid:Sh,snapGrid:fh}=ve$1(),yh=$r$1(),mh=Tt$1(n,"node"),Ch=computed(()=>_(mh.value.parentNode)),Mh=computed(()=>_n$1([mh.value],o.value)),Ph=ref$1();provide(xr$1,Ph);const{emit:Eh,on:Nh}=ad(mh.value,m),Wh=mr$1({id:n.id,el:Ph,disabled:()=>!n.draggable,selectable:()=>n.selectable,dragHandle:()=>mh.value.dragHandle,onStart(Th){Eh.dragStart({...Th,intersections:rh(mh.value)})},onDrag(Th){Eh.drag({...Th,intersections:rh(mh.value)})},onStop(Th){Eh.dragStop({...Th,intersections:rh(mh.value)})}}),Yh=computed(()=>mh.value.class instanceof Function?mh.value.class(mh.value):mh.value.class),gh=computed(()=>{const Th=(mh.value.style instanceof Function?mh.value.style(mh.value):mh.value.style)||{},Fh=mh.value.width instanceof Function?mh.value.width(mh.value):mh.value.width,Dh=mh.value.height instanceof Function?mh.value.height(mh.value):mh.value.height;return Fh&&(Th.width=typeof Fh=="string"?Fh:`${Fh}px`),Dh&&(Th.height=typeof Dh=="string"?Dh:`${Dh}px`),Th}),Ah=()=>Number(mh.value.zIndex??gh.value.zIndex??0);return ih(Th=>{Th.includes(n.id)&&$h()}),onMounted(()=>{n.resizeObserver.observe(Ph.value)}),onBeforeUnmount(()=>{n.resizeObserver.unobserve(Ph.value)}),watch([()=>mh.value.type,()=>mh.value.sourcePosition,()=>mh.value.targetPosition],()=>{nh([{id:n.id,nodeElement:Ph.value,forceUpdate:!0}])},{flush:"pre"}),watch([()=>mh.value.position.x,()=>mh.value.position.y,()=>{var Th;return(Th=Ch.value)==null?void 0:Th.computedPosition.x},()=>{var Th;return(Th=Ch.value)==null?void 0:Th.computedPosition.y},()=>{var Th;return(Th=Ch.value)==null?void 0:Th.computedPosition.z},()=>Ah(),()=>mh.value.selected,()=>mh.value.dimensions.height,()=>mh.value.dimensions.width,()=>{var Th;return(Th=Ch.value)==null?void 0:Th.dimensions.height},()=>{var Th;return(Th=Ch.value)==null?void 0:Th.dimensions.width}],([Th,Fh,Dh,Gh,Jh,rf])=>{const ef={x:Th,y:Fh,z:rf+(ch.value&&mh.value.selected?1e3:0)};He$1(Dh)&&He$1(Gh)?mh.value.computedPosition=Ju({x:Dh,y:Gh,z:Jh},ef):mh.value.computedPosition=ef},{flush:"pre",immediate:!0}),watch([()=>mh.value.extent,lh],([Th,Fh],[Dh,Gh])=>{(Th!==Dh||Fh!==Gh)&&wh()}),mh.value.extent==="parent"||typeof mh.value.extent=="object"&&"range"in mh.value.extent&&mh.value.extent.range==="parent"?Se(()=>mh.value.initialized).toBe(!0).then(wh):wh(),()=>h$1("div",{ref:Ph,"data-id":mh.value.id,class:["vue-flow__node",`vue-flow__node-${n.type===!1?"default":n.name}`,{[s.value]:n.draggable,dragging:Wh==null?void 0:Wh.value,selected:mh.value.selected,selectable:n.selectable,parent:mh.value.isParent},Yh.value],style:{zIndex:mh.value.computedPosition.z??Ah(),transform:`translate(${mh.value.computedPosition.x}px,${mh.value.computedPosition.y}px)`,pointerEvents:n.selectable||n.draggable?"all":"none",visibility:mh.value.initialized?"visible":"hidden",...gh.value},tabIndex:n.focusable?0:void 0,role:n.focusable?"button":void 0,"aria-describedby":dh.value?void 0:`${ir$1}-${e}`,"aria-label":mh.value.ariaLabel,onMouseenter:Rh,onMousemove:Oh,onMouseleave:Lh,onContextmenu:qh,onClick:Xh,onDblclick:Hh,onKeydown:Qh},[h$1(n.type===!1?oh.value.default:n.type,{id:mh.value.id,type:mh.value.type,data:mh.value.data,events:{...mh.value.events,...Nh},selected:!!mh.value.selected,resizing:!!mh.value.resizing,dragging:Wh.value,connectable:n.connectable,position:mh.value.position,dimensions:mh.value.dimensions,isValidTargetPos:mh.value.isValidTargetPos,isValidSourcePos:mh.value.isValidSourcePos,parent:mh.value.parentNode,zIndex:mh.value.computedPosition.z,targetPosition:mh.value.targetPosition,sourcePosition:mh.value.sourcePosition,label:mh.value.label,dragHandle:mh.value.dragHandle,onUpdateNodeInternals:$h})]);function wh(){const Th=mh.value.computedPosition;Sh.value&&(Th.x=fh.value[0]*Math.round(Th.x/fh.value[0]),Th.y=fh.value[1]*Math.round(Th.y/fh.value[1]));const{computedPosition:Fh,position:Dh}=ko$1(mh.value,Th,m.error,lh.value,Ch.value);(mh.value.computedPosition.x!==Fh.x||mh.value.computedPosition.y!==Fh.y)&&(mh.value.computedPosition={...mh.value.computedPosition,...Fh}),(mh.value.position.x!==Dh.x||mh.value.position.y!==Dh.y)&&(mh.value.position=Dh)}function $h(){Ph.value&&nh([{id:n.id,nodeElement:Ph.value,forceUpdate:!0}])}function Rh(Th){Wh!=null&&Wh.value||Eh.mouseEnter({event:Th,node:mh.value,connectedEdges:Mh.value})}function Oh(Th){Wh!=null&&Wh.value||Eh.mouseMove({event:Th,node:mh.value,connectedEdges:Mh.value})}function Lh(Th){Wh!=null&&Wh.value||Eh.mouseLeave({event:Th,node:mh.value,connectedEdges:Mh.value})}function qh(Th){return Eh.contextMenu({event:Th,node:mh.value,connectedEdges:Mh.value})}function Hh(Th){return Eh.doubleClick({event:Th,node:mh.value,connectedEdges:Mh.value})}function Xh(Th){n.selectable&&(!c.value||!n.draggable)&&ao$2(mh.value,d.value,gn,ue,u,!1,Ph.value),Eh.click({event:Th,node:mh.value,connectedEdges:Mh.value})}function Qh(Th){if(!co$2(Th))if(lr$1.includes(Th.key)&&n.selectable){const Fh=Th.key==="Escape";ao$2(mh.value,d.value,gn,ue,u,Fh,Ph.value)}else!dh.value&&n.draggable&&mh.value.selected&&mt$1[Th.key]&&(_h.value=`Moved selected node ${Th.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~mh.value.position.x}, y: ${~~mh.value.position.y}`,yh({x:mt$1[Th.key].x,y:mt$1[Th.key].y},Th.shiftKey))}}}),_c=wc,bc=["transform"],Ec=["width","height","x","y","rx","ry"],Sc=["y"],Nc={name:"EdgeText",compatConfig:{MODE:3}},kc=defineComponent({...Nc,props:{"aria-activedescendant":null,"aria-atomic":{type:[Boolean,String]},"aria-autocomplete":null,"aria-busy":{type:[Boolean,String]},"aria-checked":{type:[Boolean,String]},"aria-colcount":null,"aria-colindex":null,"aria-colspan":null,"aria-controls":null,"aria-current":{type:[Boolean,String]},"aria-describedby":null,"aria-details":null,"aria-disabled":{type:[Boolean,String]},"aria-dropeffect":null,"aria-errormessage":null,"aria-expanded":{type:[Boolean,String]},"aria-flowto":null,"aria-grabbed":{type:[Boolean,String]},"aria-haspopup":{type:[Boolean,String]},"aria-hidden":{type:[Boolean,String]},"aria-invalid":{type:[Boolean,String]},"aria-keyshortcuts":null,"aria-label":null,"aria-labelledby":null,"aria-level":null,"aria-live":null,"aria-modal":{type:[Boolean,String]},"aria-multiline":{type:[Boolean,String]},"aria-multiselectable":{type:[Boolean,String]},"aria-orientation":null,"aria-owns":null,"aria-placeholder":null,"aria-posinset":null,"aria-pressed":{type:[Boolean,String]},"aria-readonly":{type:[Boolean,String]},"aria-relevant":null,"aria-required":{type:[Boolean,String]},"aria-roledescription":null,"aria-rowcount":null,"aria-rowindex":null,"aria-rowspan":null,"aria-selected":{type:[Boolean,String]},"aria-setsize":null,"aria-sort":null,"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null,"aria-valuetext":null,innerHTML:null,class:null,style:null,color:null,height:null,id:null,lang:null,max:null,media:null,method:null,min:null,name:null,target:null,type:null,width:null,role:null,tabindex:null,"accent-height":null,accumulate:null,additive:null,"alignment-baseline":null,allowReorder:null,alphabetic:null,amplitude:null,"arabic-form":null,ascent:null,attributeName:null,attributeType:null,autoReverse:null,azimuth:null,baseFrequency:null,"baseline-shift":null,baseProfile:null,bbox:null,begin:null,bias:null,by:null,calcMode:null,"cap-height":null,clip:null,"clip-path":null,clipPathUnits:null,"clip-rule":null,"color-interpolation":null,"color-interpolation-filters":null,"color-profile":null,"color-rendering":null,contentScriptType:null,contentStyleType:null,cursor:null,cx:null,cy:null,d:null,decelerate:null,descent:null,diffuseConstant:null,direction:null,display:null,divisor:null,"dominant-baseline":null,dur:null,dx:null,dy:null,edgeMode:null,elevation:null,"enable-background":null,end:null,exponent:null,externalResourcesRequired:null,fill:null,"fill-opacity":null,"fill-rule":null,filter:null,filterRes:null,filterUnits:null,"flood-color":null,"flood-opacity":null,focusable:null,"font-family":null,"font-size":null,"font-size-adjust":null,"font-stretch":null,"font-style":null,"font-variant":null,"font-weight":null,format:null,from:null,fx:null,fy:null,g1:null,g2:null,"glyph-name":null,"glyph-orientation-horizontal":null,"glyph-orientation-vertical":null,glyphRef:null,gradientTransform:null,gradientUnits:null,hanging:null,"horiz-adv-x":null,"horiz-origin-x":null,href:null,ideographic:null,"image-rendering":null,in2:null,in:null,intercept:null,k1:null,k2:null,k3:null,k4:null,k:null,kernelMatrix:null,kernelUnitLength:null,kerning:null,keyPoints:null,keySplines:null,keyTimes:null,lengthAdjust:null,"letter-spacing":null,"lighting-color":null,limitingConeAngle:null,local:null,"marker-end":null,markerHeight:null,"marker-mid":null,"marker-start":null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,mode:null,numOctaves:null,offset:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,"overline-position":null,"overline-thickness":null,"paint-order":null,"panose-1":null,pathLength:null,patternContentUnits:null,patternTransform:null,patternUnits:null,"pointer-events":null,points:null,pointsAtX:null,pointsAtY:null,pointsAtZ:null,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,r:null,radius:null,refX:null,refY:null,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:null,requiredFeatures:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,"shape-rendering":null,slope:null,spacing:null,specularConstant:null,specularExponent:null,speed:null,spreadMethod:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,"stop-color":null,"stop-opacity":null,"strikethrough-position":null,"strikethrough-thickness":null,string:null,stroke:null,"stroke-dasharray":null,"stroke-dashoffset":null,"stroke-linecap":null,"stroke-linejoin":null,"stroke-miterlimit":null,"stroke-opacity":null,"stroke-width":null,surfaceScale:null,systemLanguage:null,tableValues:null,targetX:null,targetY:null,"text-anchor":null,"text-decoration":null,textLength:null,"text-rendering":null,to:null,transform:null,u1:null,u2:null,"underline-position":null,"underline-thickness":null,unicode:null,"unicode-bidi":null,"unicode-range":null,"unitsPer-em":null,"v-alphabetic":null,values:null,"vector-effect":null,version:null,"vert-adv-y":null,"vert-origin-x":null,"vert-origin-y":null,"v-hanging":null,"v-ideographic":null,viewBox:null,viewTarget:null,visibility:null,"v-mathematical":null,widths:null,"word-spacing":null,"writing-mode":null,x1:null,x2:null,x:null,xChannelSelector:null,"x-height":null,xlinkActuate:null,xlinkArcrole:null,xlinkHref:null,xlinkRole:null,xlinkShow:null,xlinkTitle:null,xlinkType:null,xmlns:null,y1:null,y2:null,y:null,yChannelSelector:null,z:null,zoomAndPan:null,label:null,labelStyle:{default:{}},labelShowBg:{type:Boolean,default:!0},labelBgStyle:{default:{}},labelBgPadding:{default:[2,4]},labelBgBorderRadius:{default:2}},setup(n){const e=ref$1({x:0,y:0,width:0,height:0}),o=ref$1(null),s=computed(()=>`translate(${n.x-e.value.width/2} ${n.y-e.value.height/2})`);onMounted(c),watch([()=>n.x,()=>n.y,o,()=>n.label],c);function c(){if(!o.value)return;const u=o.value.getBBox();(u.width!==e.value.width||u.height!==e.value.height)&&(e.value=u)}return(u,d)=>(openBlock(),createElementBlock("g",{transform:unref(s),class:"vue-flow__edge-textwrapper"},[n.labelShowBg?(openBlock(),createElementBlock("rect",{key:0,class:"vue-flow__edge-textbg",width:`${e.value.width+2*n.labelBgPadding[0]}px`,height:`${e.value.height+2*n.labelBgPadding[1]}px`,x:-n.labelBgPadding[0],y:-n.labelBgPadding[1],style:normalizeStyle(n.labelBgStyle),rx:n.labelBgBorderRadius,ry:n.labelBgBorderRadius},null,12,Ec)):createCommentVNode("",!0),createBaseVNode("text",mergeProps(u.$attrs,{ref_key:"el",ref:o,class:"vue-flow__edge-text",y:e.value.height/2,dy:"0.3em",style:n.labelStyle}),[renderSlot(u.$slots,"default",{},()=>[unref(Ue$1)(n.label)?(openBlock(),createElementBlock(Fragment,{key:1},[createTextVNode(toDisplayString(n.label),1)],64)):(openBlock(),createBlock(resolveDynamicComponent(n.label),{key:0}))])],16,Sc)],8,bc))}}),kn$1=function({id:n,path:e,label:o,labelX:s,labelY:c,labelBgBorderRadius:u,labelBgPadding:d,labelBgStyle:m,labelShowBg:_=!0,labelStyle:ue,markerStart:gn,markerEnd:nh,interactionWidth:ih=20},{attrs:rh}){return[h$1("path",{id:n,style:rh.style,class:["vue-flow__edge-path",rh.class].join(" "),d:e,"marker-end":nh,"marker-start":gn}),ih?h$1("path",{d:e,fill:"none","stroke-opacity":0,"stroke-width":ih}):null,o&&He$1(s)&&He$1(c)?h$1(kc,{x:s,y:c,label:o,labelStyle:ue,labelShowBg:_,labelBgStyle:m,labelBgPadding:d,labelBgBorderRadius:u}):null]};kn$1.props=["id","path","labelX","labelY","label","labelBgBorderRadius","labelBgPadding","labelBgStyle","labelShowBg","labelStyle","markerStart","markerEnd","interactionWidth"];kn$1.inheritAttrs=!1;kn$1.compatConfig={MODE:3};const Cn$1=kn$1;function br$1({sourceX:n,sourceY:e,targetX:o,targetY:s}){const c=Math.abs(o-n)/2,u=o<n?o+c:o-c,d=Math.abs(s-e)/2,m=s<e?s+d:s-d;return[u,m,c,d]}function Er$1({sourceX:n,sourceY:e,targetX:o,targetY:s,sourceControlX:c,sourceControlY:u,targetControlX:d,targetControlY:m}){const _=n*.125+c*.375+d*.375+o*.125,ue=e*.125+u*.375+m*.375+s*.125,gn=Math.abs(_-n),nh=Math.abs(ue-e);return[_,ue,gn,nh]}function Zt$1(n,e){return n>=0?.5*n:e*25*Math.sqrt(-n)}function hi$1({pos:n,x1:e,y1:o,x2:s,y2:c,c:u}){let d,m;switch(n){case J$2.Left:d=e-Zt$1(e-s,u),m=o;break;case J$2.Right:d=e+Zt$1(s-e,u),m=o;break;case J$2.Top:d=e,m=o-Zt$1(o-c,u);break;case J$2.Bottom:d=e,m=o+Zt$1(c-o,u);break}return[d,m]}function so$2({sourceX:n,sourceY:e,sourcePosition:o=J$2.Bottom,targetX:s,targetY:c,targetPosition:u=J$2.Top,curvature:d=.25}){const[m,_]=hi$1({pos:o,x1:n,y1:e,x2:s,y2:c,c:d}),[ue,gn]=hi$1({pos:u,x1:s,y1:c,x2:n,y2:e,c:d}),[nh,ih,rh,oh]=Er$1({sourceX:n,sourceY:e,targetX:s,targetY:c,sourceControlX:m,sourceControlY:_,targetControlX:ue,targetControlY:gn});return[`M${n},${e} C${m},${_} ${ue},${gn} ${s},${c}`,nh,ih,rh,oh]}function gi$1({pos:n,x1:e,y1:o,x2:s,y2:c}){let u,d;switch(n){case J$2.Left:case J$2.Right:u=.5*(e+s),d=o;break;case J$2.Top:case J$2.Bottom:u=e,d=.5*(o+c);break}return[u,d]}function Sr$1({sourceX:n,sourceY:e,sourcePosition:o=J$2.Bottom,targetX:s,targetY:c,targetPosition:u=J$2.Top}){const[d,m]=gi$1({pos:o,x1:n,y1:e,x2:s,y2:c}),[_,ue]=gi$1({pos:u,x1:s,y1:c,x2:n,y2:e}),[gn,nh,ih,rh]=Er$1({sourceX:n,sourceY:e,targetX:s,targetY:c,sourceControlX:d,sourceControlY:m,targetControlX:_,targetControlY:ue});return[`M${n},${e} C${d},${m} ${_},${ue} ${s},${c}`,gn,nh,ih,rh]}const vi$1={[J$2.Left]:{x:-1,y:0},[J$2.Right]:{x:1,y:0},[J$2.Top]:{x:0,y:-1},[J$2.Bottom]:{x:0,y:1}};function Cc({source:n,sourcePosition:e=J$2.Bottom,target:o}){return e===J$2.Left||e===J$2.Right?n.x<o.x?{x:1,y:0}:{x:-1,y:0}:n.y<o.y?{x:0,y:1}:{x:0,y:-1}}function pi$1(n,e){return Math.sqrt((e.x-n.x)**2+(e.y-n.y)**2)}function Mc({source:n,sourcePosition:e=J$2.Bottom,target:o,targetPosition:s=J$2.Top,center:c,offset:u}){const d=vi$1[e],m=vi$1[s],_={x:n.x+d.x*u,y:n.y+d.y*u},ue={x:o.x+m.x*u,y:o.y+m.y*u},gn=Cc({source:_,sourcePosition:e,target:ue}),nh=gn.x!==0?"x":"y",ih=gn[nh];let rh,oh,lh;const[ch,dh,_h,Sh]=br$1({sourceX:n.x,sourceY:n.y,targetX:o.x,targetY:o.y});if(d[nh]*m[nh]===-1){oh=c.x||ch,lh=c.y||dh;const fh=[{x:oh,y:_.y},{x:oh,y:ue.y}],yh=[{x:_.x,y:lh},{x:ue.x,y:lh}];d[nh]===ih?rh=nh==="x"?fh:yh:rh=nh==="x"?yh:fh}else{const fh=[{x:_.x,y:ue.y}],yh=[{x:ue.x,y:_.y}];if(nh==="x"?rh=d.x===ih?yh:fh:rh=d.y===ih?fh:yh,e!==s){const mh=nh==="x"?"y":"x",Ch=d[nh]===m[mh],Mh=_[mh]>ue[mh],Ph=_[mh]<ue[mh];(d[nh]===1&&(!Ch&&Mh||Ch&&Ph)||d[nh]!==1&&(!Ch&&Ph||Ch&&Mh))&&(rh=nh==="x"?fh:yh)}oh=rh[0].x,lh=rh[0].y}return[[n,_,...rh,ue,o],oh,lh,_h,Sh]}function $c(n,e,o,s){const c=Math.min(pi$1(n,e)/2,pi$1(e,o)/2,s),{x:u,y:d}=e;if(n.x===u&&u===o.x||n.y===d&&d===o.y)return`L${u} ${d}`;if(n.y===d){const ue=n.x<o.x?-1:1,gn=n.y<o.y?1:-1;return`L ${u+c*ue},${d}Q ${u},${d} ${u},${d+c*gn}`}const m=n.x<o.x?1:-1,_=n.y<o.y?-1:1;return`L ${u},${d+c*_}Q ${u},${d} ${u+c*m},${d}`}function uo$2({sourceX:n,sourceY:e,sourcePosition:o=J$2.Bottom,targetX:s,targetY:c,targetPosition:u=J$2.Top,borderRadius:d=5,centerX:m,centerY:_,offset:ue=20}){const[gn,nh,ih,rh,oh]=Mc({source:{x:n,y:e},sourcePosition:o,target:{x:s,y:c},targetPosition:u,center:{x:m,y:_},offset:ue});return[gn.reduce((lh,ch,dh)=>{let _h;return dh>0&&dh<gn.length-1?_h=$c(gn[dh-1],ch,gn[dh+1],d):_h=`${dh===0?"M":"L"}${ch.x} ${ch.y}`,lh+=_h,lh},""),nh,ih,rh,oh]}function Nr$1({sourceX:n,sourceY:e,targetX:o,targetY:s}){const[c,u,d,m]=br$1({sourceX:n,sourceY:e,targetX:o,targetY:s});return[`M ${n},${e}L ${o},${s}`,c,u,d,m]}const Mn$1=function({sourcePosition:n=J$2.Bottom,targetPosition:e=J$2.Top,...o},{attrs:s}){const[c,u,d]=so$2({sourcePosition:n,targetPosition:e,...o});return h$1(Cn$1,{path:c,labelX:u,labelY:d,...o,...s})};Mn$1.props=["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","curvature","markerEnd","markerStart","interactionWidth"];Mn$1.inheritAttrs=!1;Mn$1.compatConfig={MODE:3};const Tc=Mn$1,$n$1=function({sourcePosition:n=J$2.Bottom,targetPosition:e=J$2.Top,...o},{attrs:s}){const[c,u,d]=Sr$1({sourcePosition:n,targetPosition:e,...o});return h$1(Cn$1,{path:c,labelX:u,labelY:d,...o,...s})};$n$1.props=["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","markerEnd","markerStart","interactionWidth"];$n$1.inheritAttrs=!1;$n$1.compatConfig={MODE:3};const Oc=$n$1,Tn$1=function({sourcePosition:n=J$2.Bottom,targetPosition:e=J$2.Top,...o},{attrs:s}){const[c,u,d]=uo$2({sourcePosition:n,targetPosition:e,...o});return h$1(Cn$1,{path:c,labelX:u,labelY:d,...o,...s})};Tn$1.props=["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","borderRadius","markerEnd","markerStart","interactionWidth","offset"];Tn$1.inheritAttrs=!1;Tn$1.compatConfig={MODE:3};const kr$1=Tn$1,On$1=function(n,{attrs:e}){return h$1(kr$1,{...n,...e,borderRadius:0})};On$1.props=["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","markerEnd","markerStart","interactionWidth"];On$1.inheritAttrs=!1;On$1.compatConfig={MODE:3};const Pc=On$1,Pn$1=function(n,{attrs:e}){const[o,s,c]=Nr$1(n);return h$1(Cn$1,{path:o,labelX:s,labelY:c,...n,...e})};Pn$1.props=["label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","markerEnd","markerStart","interactionWidth"];Pn$1.inheritAttrs=!1;Pn$1.compatConfig={MODE:3};const Ic=Pn$1;function Dc(n,e,o){return o===J$2.Left?n-e:o===J$2.Right?n+e:n}function Ac(n,e,o){return o===J$2.Top?n-e:o===J$2.Bottom?n+e:n}const Mo$1=function({radius:n=10,centerX:e=0,centerY:o=0,position:s=J$2.Top,type:c}){return h$1("circle",{class:`vue-flow__edgeupdater vue-flow__edgeupdater-${c}`,cx:Dc(e,n,s),cy:Ac(o,n,s),r:n,stroke:"transparent",fill:"transparent"})};Mo$1.props=["radius","centerX","centerY","position","type"];Mo$1.compatConfig={MODE:3};const mi$1=Mo$1,zc=defineComponent({name:"Edge",compatConfig:{MODE:3},props:["name","type","id","updatable","selectable","focusable","edge"],setup(n){const{id:e,addSelectedEdges:o,connectionMode:s,edgeUpdaterRadius:c,emits:u,nodesSelectionActive:d,noPanClassName:m,getEdgeTypes:_,removeSelectedEdges:ue,findEdge:gn,findNode:nh,isValidConnection:ih}=ve$1(),rh=td(n.edge,u),oh=Tt$1(n,"edge"),lh=ref$1(!1),ch=ref$1(!1),dh=ref$1(""),_h=ref$1(null),Sh=ref$1("source"),fh=ref$1();provide(wr$1,n.id),provide(_r$1,fh);const yh=computed(()=>oh.value.class instanceof Function?oh.value.class(oh.value):oh.value.class),mh=computed(()=>oh.value.style instanceof Function?oh.value.style(oh.value):oh.value.style),{handlePointerDown:Ch}=Mr$1({nodeId:dh,handleId:_h,type:Sh,isValidConnection:ih,edgeUpdaterType:Sh,onEdgeUpdate:Eh,onEdgeUpdateEnd:Nh});return()=>{const Hh=nh(oh.value.source),Xh=nh(oh.value.target);if(!Hh||!Xh||!oh.value||Hh.hidden||Xh.hidden)return null;let Qh;s.value===at$1.Strict?Qh=Hh.handleBounds.source:Qh=[...Hh.handleBounds.source||[],...Hh.handleBounds.target||[]];const Th=ai$1(Qh,oh.value.sourceHandle);let Fh;s.value===at$1.Strict?Fh=Xh.handleBounds.target:Fh=[...Xh.handleBounds.target||[],...Xh.handleBounds.source||[]];const Dh=ai$1(Fh,oh.value.targetHandle),Gh=Th?Th.position:J$2.Bottom,Jh=Dh?Dh.position:J$2.Top,{sourceX:rf,sourceY:ef,targetY:uh,targetX:ph}=nc(Hh,Th,Gh,Xh,Dh,Jh);return oh.value.sourceX=rf,oh.value.sourceY=ef,oh.value.targetX=ph,oh.value.targetY=uh,h$1("g",{ref:fh,key:n.id,"data-id":n.id,class:["vue-flow__edge",`vue-flow__edge-${n.type===!1?"default":n.name}`,m.value,yh.value,{updating:lh.value,selected:oh.value.selected,animated:oh.value.animated,inactive:!n.selectable}],onClick:Yh,onContextmenu:gh,onDblclick:Ah,onMouseenter:wh,onMousemove:$h,onMouseleave:Rh,onKeyDown:n.focusable?qh:void 0,tabIndex:n.focusable?0:void 0,"aria-label":oh.value.ariaLabel===null?void 0:oh.value.ariaLabel||`Edge from ${oh.value.source} to ${oh.value.target}`,"aria-describedby":n.focusable?`${rr$1}-${e}`:void 0,role:n.focusable?"button":void 0},[ch.value?null:h$1(n.type===!1?_.value.default:n.type,{id:n.id,sourceNode:Hh,targetNode:Xh,source:oh.value.source,target:oh.value.target,type:oh.value.type,updatable:n.updatable,selected:oh.value.selected,animated:oh.value.animated,label:oh.value.label,labelStyle:oh.value.labelStyle,labelShowBg:oh.value.labelShowBg,labelBgStyle:oh.value.labelBgStyle,labelBgPadding:oh.value.labelBgPadding,labelBgBorderRadius:oh.value.labelBgBorderRadius,data:oh.value.data,events:{...oh.value.events,...rh.on},style:mh.value,markerStart:`url(#${tt$1(oh.value.markerStart,e)})`,markerEnd:`url(#${tt$1(oh.value.markerEnd,e)})`,sourcePosition:Gh,targetPosition:Jh,sourceX:rf,sourceY:ef,targetX:ph,targetY:uh,sourceHandleId:oh.value.sourceHandle,targetHandleId:oh.value.targetHandle,interactionWidth:oh.value.interactionWidth}),[n.updatable==="source"||n.updatable===!0?[h$1("g",{onMousedown:Oh,onMouseenter:Mh,onMouseout:Ph},h$1(mi$1,{position:Gh,centerX:rf,centerY:ef,radius:c.value,type:"source","data-type":"source"}))]:null,n.updatable==="target"||n.updatable===!0?[h$1("g",{onMousedown:Lh,onMouseenter:Mh,onMouseout:Ph},h$1(mi$1,{position:Jh,centerX:ph,centerY:uh,radius:c.value,type:"target","data-type":"target"}))]:null]])};function Mh(){lh.value=!0}function Ph(){lh.value=!1}function Eh(Hh,Xh){rh.emit.update({event:Hh,edge:oh.value,connection:Xh})}function Nh(Hh){rh.emit.updateEnd({event:Hh,edge:oh.value}),ch.value=!1}function Wh(Hh,Xh){Hh.button===0&&(ch.value=!0,dh.value=Xh?oh.value.target:oh.value.source,_h.value=(Xh?oh.value.targetHandle:oh.value.sourceHandle)??"",Sh.value=Xh?"target":"source",rh.emit.updateStart({event:Hh,edge:oh.value}),Ch(Hh))}function Yh(Hh){const Xh={event:Hh,edge:oh.value};n.selectable&&(d.value=!1,o([oh.value])),rh.emit.click(Xh)}function gh(Hh){rh.emit.contextMenu({event:Hh,edge:oh.value})}function Ah(Hh){rh.emit.doubleClick({event:Hh,edge:oh.value})}function wh(Hh){rh.emit.mouseEnter({event:Hh,edge:oh.value})}function $h(Hh){rh.emit.mouseMove({event:Hh,edge:oh.value})}function Rh(Hh){rh.emit.mouseLeave({event:Hh,edge:oh.value})}function Oh(Hh){Wh(Hh,!0)}function Lh(Hh){Wh(Hh,!1)}function qh(Hh){var Xh;lr$1.includes(Hh.key)&&n.selectable&&(Hh.key==="Escape"?((Xh=fh.value)==null||Xh.blur(),ue([gn(n.id)])):o([gn(n.id)]))}}}),Bc=zc,Hc={class:"vue-flow__connection"},Lc=["d","marker-end","marker-start"],Fc={name:"ConnectionLine",compatConfig:{MODE:3}},Gc=defineComponent({...Fc,props:{sourceNode:null},setup(n){var e;const{connectionMode:o,connectionStartHandle:s,connectionEndHandle:c,connectionPosition:u,connectionLineType:d,connectionLineStyle:m,connectionLineOptions:_,connectionStatus:ue,viewport:gn,findNode:nh}=ve$1(),ih={[J$2.Left]:J$2.Right,[J$2.Right]:J$2.Left,[J$2.Top]:J$2.Bottom,[J$2.Bottom]:J$2.Top},rh=(e=inject(Nn$1))==null?void 0:e["connection-line"],oh=s.value.handleId,lh=s.value.type,ch=computed(()=>{var Mh;return((Mh=c.value)==null?void 0:Mh.handleId)&&nh(c.value.nodeId)||null}),dh=computed(()=>{var Mh,Ph;return(o.value===at$1.Strict?(Mh=n.sourceNode.handleBounds[lh])==null?void 0:Mh.find(Eh=>Eh.id===oh):[...n.sourceNode.handleBounds.source||[],...n.sourceNode.handleBounds.target||[]].find(Eh=>Eh.id===oh))||((Ph=n.sourceNode.handleBounds[lh??"source"])==null?void 0:Ph[0])}),_h=computed(()=>{var Mh,Ph,Eh;return ch.value&&((Mh=c.value)==null?void 0:Mh.handleId)&&((o.value===at$1.Strict?(Ph=ch.value.handleBounds[lh==="source"?"target":"source"])==null?void 0:Ph.find(Nh=>{var Wh;return Nh.id===((Wh=c.value)==null?void 0:Wh.handleId)}):[...ch.value.handleBounds.source||[],...ch.value.handleBounds.target||[]].find(Nh=>{var Wh;return Nh.id===((Wh=c.value)==null?void 0:Wh.handleId)}))||((Eh=ch.value.handleBounds[lh??"target"])==null?void 0:Eh[0]))||null}),Sh=computed(()=>{var Mh;return dh.value?fn(((Mh=dh.value)==null?void 0:Mh.position)||J$2.Top,{...n.sourceNode.dimensions,...n.sourceNode.computedPosition},dh.value):{x:n.sourceNode.dimensions.width/2,y:n.sourceNode.dimensions.height/2}}),fh=Pt(()=>{var Mh,Ph;return(Mh=dh.value)!=null&&Mh.position?ih[(Ph=dh.value)==null?void 0:Ph.position]:void 0}),yh=computed(()=>(u.value.x-gn.value.x)/gn.value.zoom),mh=computed(()=>(u.value.y-gn.value.y)/gn.value.zoom),Ch=computed(()=>{var Mh;let Ph;const Eh={sourceX:Sh.value.x,sourceY:Sh.value.y,sourcePosition:(Mh=dh.value)==null?void 0:Mh.position,targetX:yh.value,targetY:mh.value,targetPosition:fh.value};switch(d.value??_.value.type){case Qe$1.Bezier:[Ph]=so$2(Eh);break;case Qe$1.Step:[Ph]=uo$2({...Eh,borderRadius:0});break;case Qe$1.SmoothStep:[Ph]=uo$2(Eh);break;case Qe$1.SimpleBezier:[Ph]=Sr$1(Eh);break;case Qe$1.Straight:[Ph]=Nr$1(Eh);break;default:[Ph]=so$2(Eh);break}return Ph});return(Mh,Ph)=>{var Eh;return openBlock(),createElementBlock("g",Hc,[unref(rh)?(openBlock(),createBlock(resolveDynamicComponent(unref(rh)),normalizeProps(mergeProps({key:0},{sourceX:unref(Sh).x,sourceY:unref(Sh).y,sourcePosition:(Eh=unref(dh))==null?void 0:Eh.position,targetX:unref(yh),targetY:unref(mh),targetPosition:unref(fh),sourceNode:n.sourceNode,sourceHandle:unref(dh),targetNode:unref(ch),targetHandle:unref(_h),markerEnd:`url(#${unref(tt$1)(unref(_).markerEnd)})`,markerStart:`url(#${unref(tt$1)(unref(_).markerStart)})`,connectionStatus:unref(ue)})),null,16)):(openBlock(),createElementBlock("path",{key:1,d:unref(Ch),class:normalizeClass(["vue-flow__connection-path",[unref(_).class,unref(ue)]]),style:normalizeStyle(unref(m)||unref(_).style||{}),"marker-end":`url(#${unref(tt$1)(unref(_).markerEnd)})`,"marker-start":`url(#${unref(tt$1)(unref(_).markerStart)})`},null,14,Lc))])}}}),Yc=["tabIndex"],Xc={name:"NodesSelection",compatConfig:{MODE:3}},Uc=defineComponent({...Xc,setup(n){const e=ve$1(),o=toRef(e,"emits"),s=toRef(e,"viewport"),c=toRef(e,"getSelectedNodes"),u=toRef(e,"noPanClassName"),d=toRef(e,"disableKeyboardA11y"),m=toRef(e,"userSelectionActive"),_=$r$1(),ue=ref$1(),gn=mr$1({el:ue,onStart(lh){o.value.selectionDragStart(lh)},onDrag(lh){o.value.selectionDrag(lh)},onStop(lh){o.value.selectionDragStop(lh)}});onMounted(()=>{var lh;d.value||(lh=ue.value)==null||lh.focus({preventScroll:!0})});const nh=computed(()=>No$1(c.value)),ih=computed(()=>({width:`${nh.value.width}px`,height:`${nh.value.height}px`,top:`${nh.value.y}px`,left:`${nh.value.x}px`}));function rh(lh){o.value.selectionContextMenu({event:lh,nodes:c.value})}function oh(lh){d.value||mt$1[lh.key]&&_({x:mt$1[lh.key].x,y:mt$1[lh.key].y},lh.shiftKey)}return(lh,ch)=>!unref(m)&&unref(nh).width&&unref(nh).height?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(["vue-flow__nodesselection vue-flow__container",unref(u)]),style:normalizeStyle({transform:`translate(${unref(s).x}px,${unref(s).y}px) scale(${unref(s).zoom})`})},[createBaseVNode("div",{ref_key:"el",ref:ue,class:normalizeClass([{dragging:unref(gn)},"vue-flow__nodesselection-rect"]),style:normalizeStyle(unref(ih)),tabIndex:unref(d)?void 0:-1,onContextmenu:rh,onKeydown:oh},null,46,Yc)],6)):createCommentVNode("",!0)}}),Zc={name:"UserSelection",compatConfig:{MODE:3}},Wc=defineComponent({...Zc,setup(n){const{userSelectionRect:e}=ve$1();return(o,s)=>{var c,u,d,m;return openBlock(),createElementBlock("div",{class:"vue-flow__selection vue-flow__container",style:normalizeStyle({width:`${(c=unref(e))==null?void 0:c.width}px`,height:`${(u=unref(e))==null?void 0:u.height}px`,transform:`translate(${(d=unref(e))==null?void 0:d.x}px, ${(m=unref(e))==null?void 0:m.y}px)`})},null,4)}}}),Kc={input:yc,default:mc,output:xc},qc={default:Tc,straight:Ic,step:Pc,smoothstep:kr$1,simplebezier:Oc};function jc(){return{vueFlowRef:null,viewportRef:null,nodes:[],edges:[],nodeTypes:{},edgeTypes:{},initialized:!1,dimensions:{width:0,height:0},viewport:{x:0,y:0,zoom:1},d3Zoom:null,d3Selection:null,d3ZoomHandler:null,minZoom:.5,maxZoom:2,translateExtent:[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],nodeExtent:[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],selectionMode:_o$1.Full,paneDragging:!1,preventScrolling:!0,zoomOnScroll:!0,zoomOnPinch:!0,zoomOnDoubleClick:!0,panOnScroll:!1,panOnScrollSpeed:.5,panOnScrollMode:sn.Free,panOnDrag:!0,edgeUpdaterRadius:10,onlyRenderVisibleElements:!1,defaultViewport:{x:0,y:0,zoom:1},nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,defaultMarkerColor:"#b1b1b7",connectionLineStyle:{},connectionLineType:null,connectionLineOptions:{type:Qe$1.Bezier,style:{}},connectionMode:at$1.Loose,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectionPosition:{x:NaN,y:NaN},connectionRadius:20,connectOnClick:!0,connectionStatus:null,isValidConnection:null,snapGrid:[15,15],snapToGrid:!1,edgesUpdatable:!1,edgesFocusable:!0,nodesFocusable:!0,nodesConnectable:!0,nodesDraggable:!0,elementsSelectable:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,selectionKeyCode:"Shift",multiSelectionKeyCode:"Meta",zoomActivationKeyCode:"Meta",deleteKeyCode:"Backspace",panActivationKeyCode:"Space",hooks:fc(),applyDefault:!0,autoConnect:!1,fitViewOnInit:!1,noDragClassName:"nodrag",noWheelClassName:"nowheel",noPanClassName:"nopan",defaultEdgeOptions:void 0,elevateEdgesOnSelect:!1,elevateNodesOnSelect:!0,autoPanOnNodeDrag:!0,autoPanOnConnect:!0,disableKeyboardA11y:!1,ariaLiveMessage:"",__experimentalFeatures:{nestedFlow:!1}}}function Cr$1(n){const e=jc();return n&&Object.keys(n).forEach(o=>{const s=n[o];fe$1(s)&&(e[o]=s)}),e}function Jc(n,e,o,s){let c=!1;const u=ud(n,e),d=uh=>{const ph=uh??o.value??[];n.hooks.updateNodeInternals.trigger(ph)},m=uh=>{if(uh)return n.nodes&&!o.value.length?n.nodes.find(ph=>ph.id===uh):n.nodes[o.value.indexOf(uh)]},_=uh=>{if(uh)return n.edges&&!s.value.length?n.edges.find(ph=>ph.id===uh):n.edges[s.value.indexOf(uh)]},ue=(uh,ph,kh)=>{const xh=[];uh.forEach(bh=>{var Bh,Uh;const zh={id:bh.id,type:"position",dragging:kh,from:bh.from};if(ph&&(zh.position=bh.position,bh.parentNode)){const jh=m(bh.parentNode);zh.position={x:zh.position.x-(((Bh=jh==null?void 0:jh.computedPosition)==null?void 0:Bh.x)??0),y:zh.position.y-(((Uh=jh==null?void 0:jh.computedPosition)==null?void 0:Uh.y)??0)}}xh.push(zh)}),xh!=null&&xh.length&&n.hooks.nodesChange.trigger(xh)},gn=uh=>{var ph;if(!n.vueFlowRef)return;const kh=n.vueFlowRef.querySelector(".vue-flow__transformationpane");if(!kh)return;let xh;if((ph=n.__experimentalFeatures)!=null&&ph.nestedFlow){let Bh=[kh],Uh=kh,zh;for(;!zh&&Uh;)Uh=Uh.parentElement,zh=Uh==null?void 0:Uh.classList.contains("vue-flow__transformationpane"),zh&&(Bh=[Uh,...Bh]);Bh.forEach(jh=>{const Kh=window.getComputedStyle(jh),{m22:tf}=new window.DOMMatrixReadOnly(Kh.transform);xh?xh*=tf:xh=tf})}else{const Bh=window.getComputedStyle(kh),{m22:Uh}=new window.DOMMatrixReadOnly(Bh.transform);xh=Uh}const bh=uh.reduce((Bh,Uh)=>{const zh=m(Uh.id);if(zh){const jh=xn$1(Uh.nodeElement);jh.width&&jh.height&&(zh.dimensions.width!==jh.width||zh.dimensions.height!==jh.height||Uh.forceUpdate)&&(zh.handleBounds.source=ci$1(".source",Uh.nodeElement,xh),zh.handleBounds.target=ci$1(".target",Uh.nodeElement,xh),zh.dimensions=jh,zh.initialized=!0,Bh.push({id:zh.id,type:"dimensions",dimensions:jh}))}return Bh},[]);n.fitViewOnInit&&!c&&(Se(()=>u.value.initialized).toBe(!0).then(()=>{u.value.fitView()}),c=!0),bh.length&&n.hooks.nodesChange.trigger(bh)},nh=(uh,ph)=>{const kh=uh.map(Bh=>Bh.id);let xh,bh=[];if(n.multiSelectionActive)xh=kh.map(Bh=>Re$1(Bh,ph));else{const Bh=Hn$1([...n.nodes,...n.edges],kh);xh=Bh.changedNodes,bh=Bh.changedEdges}xh.length&&n.hooks.nodesChange.trigger(xh),bh.length&&n.hooks.edgesChange.trigger(bh)},ih=(uh,ph)=>{const kh=uh.map(Bh=>Bh.id);let xh=[],bh;if(n.multiSelectionActive)bh=kh.map(Bh=>Re$1(Bh,ph));else{const Bh=Hn$1([...n.nodes,...n.edges],kh);xh=Bh.changedNodes,bh=Bh.changedEdges}xh.length&&n.hooks.nodesChange.trigger(xh),bh.length&&n.hooks.edgesChange.trigger(bh)},rh=(uh,ph)=>{const kh=uh.filter(yt$1).map(Uh=>Uh.id),xh=uh.filter(De$1).map(Uh=>Uh.id);let{changedNodes:bh,changedEdges:Bh}=Hn$1([...n.nodes,...n.edges],[...kh,...xh]);n.multiSelectionActive&&(bh=kh.map(Uh=>Re$1(Uh,ph)),Bh=xh.map(Uh=>Re$1(Uh,ph))),bh.length&&n.hooks.nodesChange.trigger(bh),Bh.length&&n.hooks.edgesChange.trigger(Bh)},oh=uh=>{nh(uh,!0)},lh=uh=>{ih(uh,!0)},ch=uh=>{rh(uh,!0)},dh=uh=>{if(!uh.length)return nh(uh,!1);const ph=uh.map(kh=>kh.id).map(kh=>Re$1(kh,!1));ph.length&&n.hooks.nodesChange.trigger(ph)},_h=uh=>{if(!uh.length)return ih(uh,!1);const ph=uh.map(kh=>kh.id).map(kh=>Re$1(kh,!1));ph.length&&n.hooks.edgesChange.trigger(ph)},Sh=uh=>{if(!uh||!uh.length)return rh([],!1);const{changedNodes:ph,changedEdges:kh}=uh.reduce((xh,bh)=>{const Bh=Re$1(bh.id,!1);return yt$1(bh)?xh.changedNodes.push(Bh):xh.changedEdges.push(Bh),xh},{changedNodes:[],changedEdges:[]});ph.length&&n.hooks.nodesChange.trigger(ph),kh.length&&n.hooks.edgesChange.trigger(kh)},fh=uh=>{var ph;(ph=n.d3Zoom)==null||ph.scaleExtent([uh,n.maxZoom]),n.minZoom=uh},yh=uh=>{var ph;(ph=n.d3Zoom)==null||ph.scaleExtent([n.minZoom,uh]),n.maxZoom=uh},mh=uh=>{var ph;(ph=n.d3Zoom)==null||ph.translateExtent(uh),n.translateExtent=uh},Ch=uh=>{n.nodeExtent=uh,d(o.value)},Mh=uh=>{n.nodesDraggable=uh,n.nodesConnectable=uh,n.elementsSelectable=uh},Ph=uh=>{const ph=uh instanceof Function?uh(n.nodes):uh;!n.initialized&&!ph.length||(n.nodes=di$1(ph,n.nodes,m,n.hooks.error.trigger))},Eh=uh=>{const ph=uh instanceof Function?uh(n.edges):uh;if(!n.initialized&&!ph.length)return;const kh=n.isValidConnection?ph.filter(xh=>n.isValidConnection(xh,{edges:n.edges,sourceNode:m(xh.source),targetNode:m(xh.target)})):ph;n.edges=kh.reduce((xh,bh)=>{const Bh=m(bh.source),Uh=m(bh.target),zh=!Bh||typeof Bh>"u",jh=!Uh||typeof Uh>"u";if(zh&&jh?n.hooks.error.trigger(new xe$1(ye$1.EDGE_SOURCE_TARGET_MISSING,bh.id,bh.source,bh.target)):(zh&&n.hooks.error.trigger(new xe$1(ye$1.EDGE_SOURCE_MISSING,bh.id,bh.source)),jh&&n.hooks.error.trigger(new xe$1(ye$1.EDGE_TARGET_MISSING,bh.id,bh.target))),zh||jh)return xh;const Kh=_(bh.id);return xh.push({...Eo$1(bh,Object.assign({},Kh,n.defaultEdgeOptions)),sourceNode:Bh,targetNode:Uh}),xh},[])},Nh=uh=>{const ph=uh instanceof Function?uh([...n.nodes,...n.edges]):uh;!n.initialized&&!ph.length||(Ph(ph.filter(yt$1)),Eh(ph.filter(De$1)))},Wh=uh=>{let ph=uh instanceof Function?uh(n.nodes):uh;ph=Array.isArray(ph)?ph:[ph];const kh=di$1(ph,n.nodes,m,n.hooks.error.trigger).map(ri$1);kh.length&&n.hooks.nodesChange.trigger(kh)},Yh=uh=>{let ph=uh instanceof Function?uh(n.edges):uh;ph=Array.isArray(ph)?ph:[ph];const kh=(n.isValidConnection?ph.filter(xh=>n.isValidConnection(xh,{edges:n.edges,sourceNode:m(xh.source),targetNode:m(xh.target)})):ph).reduce((xh,bh)=>{const Bh=cc({...bh,...n.defaultEdgeOptions},n.edges,n.hooks.error.trigger);if(Bh){const Uh=m(Bh.source),zh=m(Bh.target),jh=!Uh||typeof Uh>"u",Kh=!zh||typeof zh>"u";if(jh&&Kh?n.hooks.error.trigger(new xe$1(ye$1.EDGE_SOURCE_TARGET_MISSING,Bh.id,Bh.source,Bh.target)):(jh&&n.hooks.error.trigger(new xe$1(ye$1.EDGE_SOURCE_MISSING,Bh.id,Bh.source)),Kh&&n.hooks.error.trigger(new xe$1(ye$1.EDGE_TARGET_MISSING,Bh.id,Bh.target))),jh||Kh)return xh;xh.push(ri$1({...Bh,sourceNode:Uh,targetNode:zh}))}return xh},[]);kh.length&&n.hooks.edgesChange.trigger(kh)},gh=(uh,ph=!0)=>{let kh=uh instanceof Function?uh(n.nodes):uh;kh=Array.isArray(kh)?kh:[kh];const xh=[],bh=[];kh.forEach(Bh=>{const Uh=typeof Bh=="string"?m(Bh):Bh;if(Uh&&!(fe$1(Uh.deletable)&&!Uh.deletable)&&(xh.push(Vn$1(Uh.id)),ph)){const zh=_n$1([Uh],n.edges).filter(jh=>fe$1(jh.deletable)?jh.deletable:!0);bh.push(...zh.map(jh=>Vn$1(jh.id)))}}),bh.length&&n.hooks.edgesChange.trigger(bh),xh.length&&n.hooks.nodesChange.trigger(xh)},Ah=uh=>{let ph=uh instanceof Function?uh(n.edges):uh;ph=Array.isArray(ph)?ph:[ph];const kh=[];ph.forEach(xh=>{const bh=typeof xh=="string"?_(xh):xh;bh&&(fe$1(bh.deletable)&&!bh.deletable||kh.push(Vn$1(typeof xh=="string"?xh:xh.id)))}),n.hooks.edgesChange.trigger(kh)},wh=(uh,ph,kh=!0)=>dc(uh,ph,n.edges,_,kh,n.hooks.error.trigger),$h=uh=>dn(uh,n.nodes),Rh=uh=>dn(uh,n.edges),Oh=(uh,ph,kh,xh=!1)=>{xh?n.connectionClickStartHandle=uh:n.connectionStartHandle=uh,n.connectionEndHandle=null,n.connectionStatus=null,ph&&(n.connectionPosition=ph)},Lh=(uh,ph=null,kh=null)=>{n.connectionStartHandle&&(n.connectionPosition=uh,n.connectionEndHandle=ph,n.connectionStatus=kh)},qh=(uh,ph)=>{n.connectionPosition={x:NaN,y:NaN},n.connectionStatus=null,ph?n.connectionClickStartHandle=null:n.connectionStartHandle=null},Hh=uh=>{const ph=Ku(uh),kh=ph?null:m(uh.id);return!ph&&!kh?[null,null,ph]:[ph?uh:ni$1(kh),kh,ph]},Xh=(uh,ph=!0,kh)=>{const[xh,bh,Bh]=Hh(uh);return xh?(kh||n.nodes).filter(Uh=>{if(!Bh&&(Uh.id===bh.id||!Uh.computedPosition))return!1;const zh=ni$1(Uh),jh=lo$2(zh,xh);return ph&&jh>0||jh>=Number(uh.width)*Number(uh.height)}):[]},Qh=(uh,ph,kh=!0)=>{const[xh]=Hh(uh);if(!xh)return!1;const bh=lo$2(xh,ph);return kh&&bh>0||bh>=Number(uh.width)*Number(uh.height)},Th=uh=>{const{viewport:ph,dimensions:kh,d3Zoom:xh,d3Selection:bh,translateExtent:Bh}=n;if(!xh||!bh||!uh.x&&!uh.y)return!1;const Uh=lt.translate(ph.x+uh.x,ph.y+uh.y).scale(ph.zoom),zh=[[0,0],[kh.width,kh.height]],jh=xh.constrain()(Uh,zh,Bh),Kh=n.viewport.x!==jh.x||n.viewport.y!==jh.y||n.viewport.zoom!==jh.k;return xh.transform(bh,jh),Kh},Fh=uh=>{const ph=uh instanceof Function?uh(n):uh,kh=["modelValue","nodes","edges","maxZoom","minZoom","translateExtent","nodeExtent","hooks","defaultEdgeOptions"],xh=["d3Zoom","d3Selection","d3ZoomHandler","viewportRef","vueFlowRef","dimensions","hooks"];fe$1(ph.defaultEdgeOptions)&&(n.defaultEdgeOptions=ph.defaultEdgeOptions);const bh=ph.modelValue||ph.nodes||ph.edges?[]:void 0;bh&&(ph.modelValue&&bh.push(...ph.modelValue),ph.nodes&&bh.push(...ph.nodes),ph.edges&&bh.push(...ph.edges),Nh(bh));const Bh=()=>{fe$1(ph.maxZoom)&&yh(ph.maxZoom),fe$1(ph.minZoom)&&fh(ph.minZoom),fe$1(ph.translateExtent)&&mh(ph.translateExtent),fe$1(ph.nodeExtent)&&Ch(ph.nodeExtent)};Object.keys(ph).forEach(Uh=>{const zh=Uh,jh=ph[zh];![...kh,...xh].includes(zh)&&fe$1(jh)&&(n[zh]=jh)}),n.d3Zoom?Bh():Se(()=>n.d3Zoom).not.toBeUndefined().then(Bh),n.initialized||(n.initialized=!0)},Dh=async(uh={padding:.1})=>{await Se(()=>u.value.initialized).toBe(!0),u.value.fitView(uh)},Gh=async uh=>{await Se(()=>u.value.initialized).toBe(!0),u.value.zoomIn(uh)},Jh=async uh=>{await Se(()=>u.value.initialized).toBe(!0),u.value.zoomOut(uh)},rf=async(uh,ph)=>{await Se(()=>u.value.initialized).toBe(!0),u.value.zoomTo(uh,ph)},ef=async(uh,ph)=>{await Se(()=>u.value.initialized).toBe(!0),u.value.setTransform(uh,ph)};return{updateNodePositions:ue,updateNodeDimensions:gn,setElements:Nh,setNodes:Ph,setEdges:Eh,addNodes:Wh,addEdges:Yh,removeNodes:gh,removeEdges:Ah,findNode:m,findEdge:_,updateEdge:wh,applyEdgeChanges:Rh,applyNodeChanges:$h,addSelectedElements:ch,addSelectedNodes:oh,addSelectedEdges:lh,setMinZoom:fh,setMaxZoom:yh,setTranslateExtent:mh,setNodeExtent:Ch,removeSelectedElements:Sh,removeSelectedNodes:dh,removeSelectedEdges:_h,startConnection:Oh,updateConnection:Lh,endConnection:qh,setInteractive:Mh,setState:Fh,getIntersectingNodes:Xh,isNodeIntersecting:Qh,panBy:Th,fitView:Dh,zoomIn:Gh,zoomOut:Jh,zoomTo:rf,setTransform:ef,getTransform:()=>u.value.getTransform(),setCenter:async(uh,ph,kh)=>{await Se(()=>u.value.initialized).toBe(!0),u.value.setCenter(uh,ph,kh)},fitBounds:async(uh,ph)=>{await Se(()=>u.value.initialized).toBe(!0),u.value.fitBounds(uh,ph)},project:uh=>u.value.project(uh),toObject:()=>JSON.parse(JSON.stringify({nodes:n.nodes.map(uh=>{const{computedPosition:ph,handleBounds:kh,selected:xh,dimensions:bh,isParent:Bh,resizing:Uh,dragging:zh,initialized:jh,...Kh}=uh;return Kh}),edges:n.edges.map(uh=>{const{selected:ph,sourceNode:kh,targetNode:xh,...bh}=uh;return bh}),position:[n.viewport.x,n.viewport.y],zoom:n.viewport.zoom})),fromObject:uh=>{const{nodes:ph,edges:kh,position:xh,zoom:bh}=uh;ph&&Ph(ph),kh&&Eh(kh),xh&&ef({x:xh[0],y:xh[1],zoom:bh||1})},updateNodeInternals:d,$reset:()=>{const uh=Cr$1();if(n.edges=[],n.nodes=[],n.d3Zoom&&n.d3Selection){const ph=lt.translate(uh.defaultViewport.x??0,uh.defaultViewport.y??0).scale(st$1(uh.defaultViewport.zoom??1,uh.minZoom,uh.maxZoom)),kh=n.viewportRef.getBoundingClientRect(),xh=[[0,0],[kh.width,kh.height]],bh=n.d3Zoom.constrain()(ph,xh,uh.translateExtent);n.d3Zoom.transform(n.d3Selection,bh)}Fh(uh)},$destroy:()=>{}}}function Qc(n,e,o){const s=computed(()=>lh=>n.nodes&&!e.value.length?n.nodes.find(ch=>ch.id===lh):n.nodes[e.value.indexOf(lh)]),c=computed(()=>lh=>n.edges&&!o.value.length?n.edges.find(ch=>ch.id===lh):n.edges[o.value.indexOf(lh)]),u=computed(()=>{var lh;const ch={...qc,...n.edgeTypes},dh=Object.keys(ch);return(lh=n.edges)==null||lh.forEach(_h=>_h.type&&!dh.includes(_h.type)&&(ch[_h.type]=_h.type)),ch}),d=computed(()=>{var lh;const ch={...Kc,...n.nodeTypes},dh=Object.keys(ch);return(lh=n.nodes)==null||lh.forEach(_h=>_h.type&&!dh.includes(_h.type)&&(ch[_h.type]=_h.type)),ch}),m=computed(()=>{const lh=n.nodes.filter(ch=>!ch.hidden);return n.onlyRenderVisibleElements?lh&&dr$1(lh,{x:0,y:0,width:n.dimensions.width,height:n.dimensions.height},n.viewport,!0):lh??[]}),_=(lh,ch,dh)=>{if(ch=ch??s.value(lh.source),dh=dh??s.value(lh.target),!ch||!dh){n.hooks.error.trigger(new xe$1(ye$1.EDGE_ORPHANED,lh.id));return}return!lh.hidden&&!dh.hidden&&!ch.hidden},ue=computed(()=>n.onlyRenderVisibleElements?n.edges.filter(lh=>{const ch=s.value(lh.source),dh=s.value(lh.target);return _(lh,ch,dh)&&oc({sourcePos:ch.computedPosition||{x:0,y:0},targetPos:dh.computedPosition||{x:0,y:0},sourceWidth:ch.dimensions.width,sourceHeight:ch.dimensions.height,targetWidth:dh.dimensions.width,targetHeight:dh.dimensions.height,width:n.dimensions.width,height:n.dimensions.height,viewport:n.viewport})}):n.edges.filter(lh=>_(lh))),gn=computed(()=>[...m.value,...ue.value]),nh=computed(()=>n.nodes.filter(lh=>lh.selected)),ih=computed(()=>n.edges.filter(lh=>lh.selected)),rh=computed(()=>[...nh.value??[],...ih.value??[]]),oh=computed(()=>m.value.filter(lh=>lh.initialized&&lh.handleBounds!==void 0));return{getNode:s,getEdge:c,getElements:gn,getEdgeTypes:u,getNodeTypes:d,getEdges:ue,getNodes:m,getSelectedElements:rh,getSelectedNodes:nh,getSelectedEdges:ih,getNodesInitialized:oh}}let ft$1=class gf{constructor(){this.currentId=0,this.flows=new Map}static getInstance(){return gf.instance||(gf.instance=new gf),gf.instance}set(e,o){return this.flows.set(e,o)}get(e){return this.flows.get(e)}remove(e){return this.flows.delete(e)}create(e,o){const s=Cr$1(o),c=reactive(s),u=computed(()=>c.nodes.map(ih=>ih.id)),d=computed(()=>c.edges.map(ih=>ih.id)),m=Qc(c,u,d),_=Jc(c,m,u,d),ue={};Object.entries(c.hooks).forEach(([ih,rh])=>{const oh=`on${ih.charAt(0).toUpperCase()+ih.slice(1)}`;ue[oh]=rh.on});const gn={};Object.entries(c.hooks).forEach(([ih,rh])=>{gn[ih]=rh.trigger}),_.setState(c);const nh={...ue,...m,..._,...Kr$1(c),emits:gn,id:e,vueFlowVersion:"1.20.1",$destroy:()=>{this.remove(e)}};return this.set(e,nh),nh}getId(){return`vue-flow-${this.currentId++}`}};function ve$1(n){const e=ft$1.getInstance(),o=getCurrentScope(),s=n==null?void 0:n.id,c=(o==null?void 0:o.vueFlowId)||s;let u,d=!1;if(o){const m=inject(fi$1,null);typeof m<"u"&&m!==null&&(u=m)}if(u||c&&(u=e.get(c)),!u||u&&s&&s!==u.id){const m=s??e.getId();u=e.create(m,n),o&&(d=!0)}else n&&u.setState(n);return o&&(provide(fi$1,u),o.vueFlowId=u.id,d&&Vt$1(()=>{if(u){const m=e.get(u.id);m?m.$destroy():Rt$1(`No store instance found for id ${u.id} in storage.`)}})),u}function ed(){return{doubleClick:L$3(),click:L$3(),mouseEnter:L$3(),mouseMove:L$3(),mouseLeave:L$3(),contextMenu:L$3(),updateStart:L$3(),update:L$3(),updateEnd:L$3()}}function td(n,e){const o=ed();return o.doubleClick.on(s=>{var c,u;e.edgeDoubleClick(s),(u=(c=n.events)==null?void 0:c.doubleClick)==null||u.call(c,s)}),o.click.on(s=>{var c,u;e.edgeClick(s),(u=(c=n.events)==null?void 0:c.click)==null||u.call(c,s)}),o.mouseEnter.on(s=>{var c,u;e.edgeMouseEnter(s),(u=(c=n.events)==null?void 0:c.mouseEnter)==null||u.call(c,s)}),o.mouseMove.on(s=>{var c,u;e.edgeMouseMove(s),(u=(c=n.events)==null?void 0:c.mouseMove)==null||u.call(c,s)}),o.mouseLeave.on(s=>{var c,u;e.edgeMouseLeave(s),(u=(c=n.events)==null?void 0:c.mouseLeave)==null||u.call(c,s)}),o.contextMenu.on(s=>{var c,u;e.edgeContextMenu(s),(u=(c=n.events)==null?void 0:c.contextMenu)==null||u.call(c,s)}),o.updateStart.on(s=>{var c,u;e.edgeUpdateStart(s),(u=(c=n.events)==null?void 0:c.updateStart)==null||u.call(c,s)}),o.update.on(s=>{var c,u;e.edgeUpdate(s),(u=(c=n.events)==null?void 0:c.update)==null||u.call(c,s)}),o.updateEnd.on(s=>{var c,u;e.edgeUpdateEnd(s),(u=(c=n.events)==null?void 0:c.updateEnd)==null||u.call(c,s)}),Object.entries(o).reduce((s,[c,u])=>(s.emit[c]=u.trigger,s.on[c]=u.on,s),{emit:{},on:{}})}function nd(){const{viewport:n,snapGrid:e,snapToGrid:o}=ve$1();return({sourceEvent:s})=>{const c=s.touches?s.touches[0].clientX:s.clientX,u=s.touches?s.touches[0].clientY:s.clientY,d={x:(c-n.value.x)/n.value.zoom,y:(u-n.value.y)/n.value.zoom};return{xSnapped:o.value?e.value[0]*Math.round(d.x/e.value[0]):d.x,ySnapped:o.value?e.value[1]*Math.round(d.y/e.value[1]):d.y,...d}}}function Wt$1(){return!0}function Mr$1({handleId:n,nodeId:e,type:o,isValidConnection:s,edgeUpdaterType:c,onEdgeUpdate:u,onEdgeUpdateEnd:d}){const{vueFlowRef:m,connectionMode:_,connectionRadius:ue,connectOnClick:gn,connectionClickStartHandle:nh,nodesConnectable:ih,autoPanOnConnect:rh,findNode:oh,panBy:lh,getNodes:ch,startConnection:dh,updateConnection:_h,endConnection:Sh,emits:fh,viewport:yh,edges:mh,isValidConnection:Ch}=ve$1();let Mh=null,Ph=!1,Eh=null;function Nh(Yh){var gh;const Ah=le(o)==="target",wh=Co$1(Yh),$h=oi$1(Yh.target);if(wh&&Yh.button===0||!wh){let Rh=function(kh){rf=xt$1(kh,Gh);const{handle:xh,validHandleResult:bh}=lc(So$1(rf,yh.value,!1,[1,1]),ue.value,uh,Bh=>ui$1(kh,Bh,_.value,le(e),le(n),Ah?"target":"source",qh,$h,mh.value,oh));if(Hh=xh,ef||(ph(),ef=!0),Mh=bh.connection,Ph=bh.isValid,Eh=bh.handleDomNode,_h(Hh&&Ph?ju({x:Hh.x,y:Hh.y},yh.value):rf,bh.endHandle,sc(!!Hh,Ph)),!Hh&&!Ph&&!Eh)return Gn$1(Jh);Mh&&Mh.source!==Mh.target&&Eh&&(Gn$1(Jh),Jh=Eh,Eh.classList.add("connecting","vue-flow__handle-connecting"),Eh.classList.toggle("valid",Ph),Eh.classList.toggle("vue-flow__handle-valid",Ph))},Oh=function(kh){(Hh||Eh)&&Mh&&Ph&&(u?u(kh,Mh):fh.connect(Mh)),fh.connectEnd(kh),c&&(d==null||d(kh)),Gn$1(Jh),cancelAnimationFrame(Xh),Sh(kh),ef=!1,Ph=!1,Mh=null,Eh=null,$h.removeEventListener("mousemove",Rh),$h.removeEventListener("mouseup",Oh),$h.removeEventListener("touchmove",Rh),$h.removeEventListener("touchend",Oh)};const Lh=oh(le(e));let qh=le(s)||Ch.value||Wt$1;!qh&&Lh&&(qh=(Ah?Lh.isValidSourcePos:Lh.isValidTargetPos)||Wt$1);let Hh,Xh=0;const{x:Qh,y:Th}=xt$1(Yh),Fh=$h==null?void 0:$h.elementFromPoint(Qh,Th),Dh=pr$1(le(c),Fh),Gh=(gh=m.value)==null?void 0:gh.getBoundingClientRect();if(!Gh||!Dh)return;let Jh,rf=xt$1(Yh,Gh),ef=!1;const uh=ac({nodes:ch.value,nodeId:le(e),handleId:le(n),handleType:Dh}),ph=()=>{if(!rh)return;const[kh,xh]=hr$1(rf,Gh);lh({x:kh,y:xh}),Xh=requestAnimationFrame(ph)};dh({nodeId:le(e),handleId:le(n),type:Dh},{x:Qh-Gh.left,y:Th-Gh.top},Yh),fh.connectStart({event:Yh,nodeId:le(e),handleId:le(n),handleType:Dh}),$h.addEventListener("mousemove",Rh),$h.addEventListener("mouseup",Oh),$h.addEventListener("touchmove",Rh),$h.addEventListener("touchend",Oh)}}function Wh(Yh){if(!gn.value)return;const gh=le(o)==="target";if(!nh.value)fh.clickConnectStart({event:Yh,nodeId:le(e),handleId:le(n)}),dh({nodeId:le(e),type:le(o),handleId:le(n)},void 0,Yh,!0);else{let Ah=le(s)||Ch.value||Wt$1;const wh=oh(le(e));if(!Ah&&wh&&(Ah=(gh?wh.isValidSourcePos:wh.isValidTargetPos)||Wt$1),wh&&(typeof wh.connectable>"u"?ih.value:wh.connectable)===!1)return;const $h=oi$1(Yh.target),{connection:Rh,isValid:Oh}=ui$1(Yh,{nodeId:le(e),id:le(n),type:le(o)},_.value,nh.value.nodeId,nh.value.handleId||null,nh.value.type,Ah,$h,mh.value,oh),Lh=Rh.source===Rh.target;Oh&&!Lh&&fh.connect(Rh),fh.clickConnectEnd(Yh),Sh(Yh,!0)}}return{handlePointerDown:Nh,handleClick:Wh}}function $o$1(){return typeof window<"u"?window:{chrome:!1}}function co$2(n){var e,o;const s=((o=(e=n.composedPath)==null?void 0:e.call(n))==null?void 0:o[0])||n.target,c=Nt$1(s.hasAttribute)?s.hasAttribute("contenteditable"):!1,u=Nt$1(s.closest)?s.closest(".nokey"):null;return["INPUT","SELECT","TEXTAREA"].includes(s==null?void 0:s.nodeName)||c||!!u}function od(n){return n.ctrlKey||n.metaKey||n.shiftKey}function id(n,e){return o=>n.some(s=>{const c=s.split("+").map(u=>u.trim().toLowerCase());return c.length===1?o.key===s:(e.add(o.key.toLowerCase()),c.every(u=>e.has(u)))})}function Ot$1(n,e){const o=$o$1(),s=ref$1(le(n)===!0);let c=!1;const u=new Set;return watch(s,()=>{e==null||e(s.value)}),watch(()=>le(n),d=>{if(o&&typeof o.addEventListener<"u"&&go$1(o,"blur",()=>{s.value=!1}),rc(d)){s.value=d;return}Array.isArray(d)&&(d=id(d,u)),d&&(zo$1(d,m=>{c=od(m),!(!c&&co$2(m))&&(m.preventDefault(),s.value=!0)},{eventName:"keydown"}),zo$1(d,m=>{if(s.value){if(!c&&co$2(m))return;c=!1,u.clear(),s.value=!1}},{eventName:"keyup"}))},{immediate:!0}),s}function rd(n){const e=n??inject(yr$1,""),o=inject(xr$1,null),{findNode:s,edges:c,emits:u}=ve$1(),d=s(e);return d||u.error(new xe$1(ye$1.NODE_NOT_FOUND,e)),{id:e,nodeEl:o,node:d,parentNode:computed(()=>s(d.parentNode)),connectedEdges:computed(()=>_n$1([d],c.value))}}function ld(){return{doubleClick:L$3(),click:L$3(),mouseEnter:L$3(),mouseMove:L$3(),mouseLeave:L$3(),contextMenu:L$3(),dragStart:L$3(),drag:L$3(),dragStop:L$3()}}function ad(n,e){const o=ld();return o.doubleClick.on(s=>{var c,u;e.nodeDoubleClick(s),(u=(c=n.events)==null?void 0:c.doubleClick)==null||u.call(c,s)}),o.click.on(s=>{var c,u;e.nodeClick(s),(u=(c=n.events)==null?void 0:c.click)==null||u.call(c,s)}),o.mouseEnter.on(s=>{var c,u;e.nodeMouseEnter(s),(u=(c=n.events)==null?void 0:c.mouseEnter)==null||u.call(c,s)}),o.mouseMove.on(s=>{var c,u;e.nodeMouseMove(s),(u=(c=n.events)==null?void 0:c.mouseMove)==null||u.call(c,s)}),o.mouseLeave.on(s=>{var c,u;e.nodeMouseLeave(s),(u=(c=n.events)==null?void 0:c.mouseLeave)==null||u.call(c,s)}),o.contextMenu.on(s=>{var c,u;e.nodeContextMenu(s),(u=(c=n.events)==null?void 0:c.contextMenu)==null||u.call(c,s)}),o.dragStart.on(s=>{var c,u;e.nodeDragStart(s),(u=(c=n.events)==null?void 0:c.dragStart)==null||u.call(c,s)}),o.drag.on(s=>{var c,u;e.nodeDrag(s),(u=(c=n.events)==null?void 0:c.drag)==null||u.call(c,s)}),o.dragStop.on(s=>{var c,u;e.nodeDragStop(s),(u=(c=n.events)==null?void 0:c.dragStop)==null||u.call(c,s)}),Object.entries(o).reduce((s,[c,u])=>(s.emit[c]=u.trigger,s.on[c]=u.on,s),{emit:{},on:{}})}function $r$1(){const{getSelectedNodes:n,nodeExtent:e,updateNodePositions:o,findNode:s,snapGrid:c,snapToGrid:u,nodesDraggable:d,emits:m}=ve$1();return(_,ue=!1)=>{const gn=u.value?c.value[0]:5,nh=u.value?c.value[1]:5,ih=ue?4:1,rh=_.x*gn*ih,oh=_.y*nh*ih,lh=n.value.filter(ch=>ch.draggable||d&&typeof ch.draggable>"u").map(ch=>{const dh={x:ch.computedPosition.x+rh,y:ch.computedPosition.y+oh},{computedPosition:_h}=ko$1(ch,dh,m.error,e.value,ch.parentNode?s(ch.parentNode):void 0);return{id:ch.id,position:_h,from:ch.position,distance:{x:_.x,y:_.y},dimensions:ch.dimensions}});o(lh,!0,!1)}}const Yn$1=.1;function je$1(){}const sd={zoomIn:je$1,zoomOut:je$1,zoomTo:je$1,fitView:je$1,setCenter:je$1,fitBounds:je$1,project:n=>n,setTransform:je$1,getTransform:()=>({x:0,y:0,zoom:1}),initialized:!1};function ud(n,e){const o=n,s=toRef(o,"nodes"),c=toRef(o,"d3Zoom"),u=toRef(o,"d3Selection"),d=toRef(o,"dimensions"),m=toRef(o,"translateExtent"),_=toRef(o,"minZoom"),ue=toRef(o,"maxZoom"),gn=toRef(o,"viewport"),nh=toRef(o,"snapToGrid"),ih=toRef(o,"snapGrid"),rh=toRef(o,"hooks"),oh=e,lh=toRef(oh,"getNodes"),ch=ref$1(!1);rh.value.nodesInitialized.on(()=>{ch.value=!0});const dh=computed(()=>!!c.value&&!!u.value&&!!d.value.width&&!!d.value.height&&ch.value);function _h(fh,yh){u.value&&c.value&&c.value.scaleBy(Xn$1(u.value,yh),fh)}function Sh(fh,yh,mh,Ch){const{x:Mh,y:Ph}=bo$1({x:-fh,y:-yh},m.value),Eh=lt.translate(-Mh,-Ph).scale(mh);u.value&&c.value&&c.value.transform(Xn$1(u.value,Ch),Eh)}return computed(()=>dh.value?{initialized:!0,zoomIn:fh=>{_h(1.2,fh==null?void 0:fh.duration)},zoomOut:fh=>{_h(1/1.2,fh==null?void 0:fh.duration)},zoomTo:(fh,yh)=>{u.value&&c.value&&c.value.scaleTo(Xn$1(u.value,yh==null?void 0:yh.duration),fh)},setTransform:(fh,yh)=>{Sh(fh.x,fh.y,fh.zoom,yh==null?void 0:yh.duration)},getTransform:()=>({x:gn.value.x,y:gn.value.y,zoom:gn.value.zoom}),fitView:(fh={padding:Yn$1,includeHiddenNodes:!1,duration:0})=>{if(!s.value.length)return;const yh=(fh.includeHiddenNodes?s.value:lh.value).filter(Eh=>{var Nh;const Wh=Eh.initialized&&Eh.dimensions.width&&Eh.dimensions.height;let Yh=!0;return(Nh=fh.nodes)!=null&&Nh.length&&(Yh=fh.nodes.includes(Eh.id)),Wh&&Yh}),mh=No$1(yh),{x:Ch,y:Mh,zoom:Ph}=cn(mh,d.value.width,d.value.height,fh.minZoom??_.value,fh.maxZoom??ue.value,fh.padding??Yn$1,fh.offset);Sh(Ch,Mh,Ph,fh==null?void 0:fh.duration)},setCenter:(fh,yh,mh)=>{const Ch=typeof(mh==null?void 0:mh.zoom)<"u"?mh.zoom:ue.value,Mh=d.value.width/2-fh*Ch,Ph=d.value.height/2-yh*Ch;Sh(Mh,Ph,Ch,mh==null?void 0:mh.duration)},fitBounds:(fh,yh={padding:Yn$1})=>{const{x:mh,y:Ch,zoom:Mh}=cn(fh,d.value.width,d.value.height,_.value,ue.value,yh.padding);Sh(mh,Ch,Mh,yh==null?void 0:yh.duration)},project:fh=>So$1(fh,gn.value,nh.value,ih.value)}:sd)}function Xn$1(n,e=0){return n.transition().duration(e)}function cd(n,e,o){const s=effectScope();return s.run(()=>{[()=>{s.run(()=>{let c,u,d=!!(o.nodes.value.length||o.edges.value.length);c=ct$1([n.modelValue,()=>{var m,_;return(_=(m=n.modelValue)==null?void 0:m.value)==null?void 0:_.length}],([m])=>{m&&Array.isArray(m)&&(u==null||u.pause(),o.setElements(m),!u&&!d&&m.length?d=!0:u==null||u.resume())}),u=ct$1([o.nodes,o.edges,()=>o.edges.value.length,()=>o.nodes.value.length],([m,_])=>{var ue;(ue=n.modelValue)!=null&&ue.value&&Array.isArray(n.modelValue.value)&&(c==null||c.pause(),n.modelValue.value=[...m,..._],nextTick(()=>{c==null||c.resume()}))},{immediate:d}),onScopeDispose(()=>{c==null||c.stop(),u==null||u.stop()})})},()=>{s.run(()=>{let c,u,d=!!o.nodes.value.length;c=ct$1([n.nodes,()=>{var m,_;return(_=(m=n.nodes)==null?void 0:m.value)==null?void 0:_.length}],([m])=>{m&&Array.isArray(m)&&(u==null||u.pause(),o.setNodes(m),!u&&!d&&m.length?d=!0:u==null||u.resume())}),u=ct$1([o.nodes,()=>o.nodes.value.length],([m])=>{var _;(_=n.nodes)!=null&&_.value&&Array.isArray(n.nodes.value)&&(c==null||c.pause(),n.nodes.value=[...m],nextTick(()=>{c==null||c.resume()}))},{immediate:d}),onScopeDispose(()=>{c==null||c.stop(),u==null||u.stop()})})},()=>{s.run(()=>{let c,u,d=!!o.edges.value.length;c=ct$1([n.edges,()=>{var m,_;return(_=(m=n.edges)==null?void 0:m.value)==null?void 0:_.length}],([m])=>{m&&Array.isArray(m)&&(u==null||u.pause(),o.setEdges(m),!u&&!d&&m.length?d=!0:u==null||u.resume())}),u=ct$1([o.edges,()=>o.edges.value.length],([m])=>{var _;(_=n.edges)!=null&&_.value&&Array.isArray(n.edges.value)&&(c==null||c.pause(),n.edges.value=[...m],nextTick(()=>{c==null||c.resume()}))},{immediate:d}),onScopeDispose(()=>{c==null||c.stop(),u==null||u.stop()})})},()=>{s.run(()=>{watch(()=>e.minZoom,()=>{e.minZoom&&fe$1(e.minZoom)&&o.setMinZoom(e.minZoom)})})},()=>{s.run(()=>{watch(()=>e.maxZoom,()=>{e.maxZoom&&fe$1(e.maxZoom)&&o.setMaxZoom(e.maxZoom)})})},()=>{s.run(()=>{watch(()=>e.translateExtent,()=>{e.translateExtent&&fe$1(e.translateExtent)&&o.setTranslateExtent(e.translateExtent)})})},()=>{s.run(()=>{watch(()=>e.nodeExtent,()=>{e.nodeExtent&&fe$1(e.nodeExtent)&&o.setNodeExtent(e.nodeExtent)})})},()=>{s.run(()=>{watch(()=>e.applyDefault,()=>{fe$1(e.applyDefault)&&(o.applyDefault.value=e.applyDefault)}),watch(o.applyDefault,(c,u,d)=>{o.applyDefault.value?(o.onNodesChange(o.applyNodeChanges),o.onEdgesChange(o.applyEdgeChanges)):(o.hooks.value.nodesChange.off(o.applyNodeChanges),o.hooks.value.edgesChange.off(o.applyEdgeChanges)),d(()=>{o.hooks.value.nodesChange.off(o.applyNodeChanges),o.hooks.value.edgesChange.off(o.applyEdgeChanges)})},{immediate:!0})})},()=>{s.run(()=>{const c=async u=>{let d=u;Nt$1(e.autoConnect)&&(d=await e.autoConnect(u)),d!==!1&&o.addEdges([d])};watch(()=>e.autoConnect,()=>{fe$1(e.autoConnect)&&(o.autoConnect.value=e.autoConnect)}),watch(o.autoConnect,(u,d,m)=>{u?o.onConnect(c):o.hooks.value.connect.off(c),m(()=>{o.hooks.value.connect.off(c)})},{immediate:!0})})},()=>{const c=["id","modelValue","translateExtent","nodeExtent","edges","nodes","maxZoom","minZoom","applyDefault","autoConnect"];Object.keys(e).forEach(u=>{if(!c.includes(u)){const d=Pt(e,u),m=o[u];s.run(()=>{watch(d,_=>{fe$1(_)&&(m.value=_)},{flush:"pre"})})}})}].forEach(c=>c())}),()=>s.stop()}function yi$1(n,e){return{x:n.clientX-e.left,y:n.clientY-e.top}}const dd={name:"Pane",compatConfig:{MODE:3}},fd=defineComponent({...dd,props:{isSelecting:{type:Boolean}},setup(n){const{id:e,vueFlowRef:o,getNodes:s,getEdges:c,viewport:u,emits:d,userSelectionActive:m,removeSelectedElements:_,panOnDrag:ue,userSelectionRect:gn,elementsSelectable:nh,nodesSelectionActive:ih,addSelectedElements:rh,getSelectedEdges:oh,getSelectedNodes:lh,removeNodes:ch,removeEdges:dh,selectionMode:_h,deleteKeyCode:Sh,multiSelectionKeyCode:fh,multiSelectionActive:yh}=ve$1(),mh=ref$1(null),Ch=ref$1(0),Mh=ref$1(0),Ph=ref$1(),Eh=computed(()=>nh.value&&(n.isSelecting||m.value));Ot$1(Sh,Lh=>{if(!Lh)return;const qh=s.value.reduce((Hh,Xh)=>((!Xh.selected&&Xh.parentNode&&Hh.find(Qh=>Qh.id===Xh.parentNode)||Xh.selected)&&Hh.push(Xh),Hh),[]);(qh||oh.value)&&(oh.value.length>0&&dh(oh.value),qh.length>0&&ch(qh),ih.value=!1,_())}),Ot$1(fh,Lh=>{yh.value=Lh});function Nh(){m.value=!1,gn.value=null,Ch.value=0,Mh.value=0}function Wh(Lh){Lh.target!==mh.value||Eh.value||(d.paneClick(Lh),_(),ih.value=!1)}function Yh(Lh){var qh;if(Lh.target===mh.value){if(Array.isArray(ue.value)&&(qh=ue.value)!=null&&qh.includes(2)){Lh.preventDefault();return}d.paneContextMenu(Lh)}}function gh(Lh){Lh.target===mh.value&&d.paneScroll(Lh)}function Ah(Lh){if(Ph.value=o.value.getBoundingClientRect(),!Eh.value||!nh||!n.isSelecting||Lh.button!==0||Lh.target!==mh.value||!Ph.value)return;const{x:qh,y:Hh}=yi$1(Lh,Ph.value);_(),gn.value={width:0,height:0,startX:qh,startY:Hh,x:qh,y:Hh},m.value=!0,d.selectionStart(Lh)}function wh(Lh){if(!Eh.value)return d.paneMouseMove(Lh);if(!n.isSelecting||!Ph.value||!gn.value)return;m.value||(m.value=!0),ih.value&&(ih.value=!1);const qh=yi$1(Lh,Ph.value),Hh=gn.value.startX??0,Xh=gn.value.startY??0,Qh={...gn.value,x:qh.x<Hh?qh.x:Hh,y:qh.y<Xh?qh.y:Xh,width:Math.abs(qh.x-Hh),height:Math.abs(qh.y-Xh)},Th=dr$1(s.value,gn.value,u.value,_h.value===_o$1.Partial),Fh=_n$1(Th,c.value);Ch.value=Th.length,Mh.value=Fh.length,gn.value=Qh,rh([...Th,...Fh])}function $h(Lh){Eh.value&&Lh.button===0&&(!m.value&&gn.value&&Lh.target===mh.value&&Wh(Lh),ih.value=Ch.value>0,Nh(),d.selectionEnd(Lh))}function Rh(Lh){var qh;if(!Eh.value)return d.paneMouseLeave(Lh);m.value&&(ih.value=Ch.value>0,(qh=d.selectionEnd)==null||qh.call(d,Lh)),Nh()}function Oh(Lh){Eh.value||d.paneMouseEnter(Lh)}return(Lh,qh)=>(openBlock(),createElementBlock("div",{ref_key:"container",ref:mh,key:`pane-${unref(e)}`,class:normalizeClass(["vue-flow__pane vue-flow__container",{selection:n.isSelecting}]),onClick:Wh,onContextmenu:Yh,onWheelPassive:gh,onMouseenter:Oh,onMousedown:Ah,onMousemove:wh,onMouseup:$h,onMouseleave:Rh},[renderSlot(Lh.$slots,"default"),unref(m)&&unref(gn)?(openBlock(),createBlock(Wc,{key:0})):createCommentVNode("",!0),unref(ih)&&unref(lh).length?(openBlock(),createBlock(Uc,{key:1})):createCommentVNode("",!0)],34))}}),hd={class:"vue-flow__nodes vue-flow__container"},gd={name:"Nodes",compatConfig:{MODE:3}},vd=defineComponent({...gd,setup(n){const e=inject(Nn$1),o=ve$1(),s=toRef(o,"nodesDraggable"),c=toRef(o,"nodesFocusable"),u=toRef(o,"elementsSelectable"),d=toRef(o,"nodesConnectable"),m=toRef(o,"getNodes"),_=toRef(o,"getNodesInitialized"),ue=toRef(o,"getNodeTypes"),gn=toRef(o,"updateNodeDimensions"),nh=toRef(o,"emits");let ih=ref$1();Se(()=>m.value.length>0&&_.value.length===m.value.length).toBe(!0).then(()=>{nextTick(()=>{nh.value.nodesInitialized(_.value)})}),onMounted(()=>{ih.value=new ResizeObserver(_h=>{const Sh=_h.map(fh=>({id:fh.target.getAttribute("data-id"),nodeElement:fh.target,forceUpdate:!0}));gn.value(Sh)})}),onBeforeUnmount(()=>{var _h;return(_h=ih.value)==null?void 0:_h.disconnect()});function rh(_h){return typeof _h>"u"?s.value:_h}function oh(_h){return typeof _h>"u"?u.value:_h}function lh(_h){return typeof _h>"u"?d.value:_h}function ch(_h){return typeof _h>"u"?c.value:_h}function dh(_h,Sh){const fh=_h||"default";let yh=Sh??ue.value[fh];const mh=getCurrentInstance();if(typeof yh=="string"&&mh){const Mh=Object.keys(mh.appContext.components);Mh&&Mh.includes(fh)&&(yh=resolveComponent(fh,!1))}return typeof yh!="string"?yh:(e==null?void 0:e[`node-${fh}`])||(nh.value.error(new xe$1(ye$1.NODE_TYPE_MISSING,yh)),!1)}return(_h,Sh)=>(openBlock(),createElementBlock("div",hd,[unref(ih)?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(m),fh=>(openBlock(),createBlock(unref(_c),{id:fh.id,key:fh.id,"resize-observer":unref(ih),type:dh(fh.type,fh.template),name:fh.type||"default",draggable:rh(fh.draggable),selectable:oh(fh.selectable),connectable:lh(fh.connectable),focusable:ch(fh.focusable),node:fh},null,8,["id","resize-observer","type","name","draggable","selectable","connectable","focusable","node"]))),128)):createCommentVNode("",!0)]))}}),pd=["id","markerWidth","markerHeight","markerUnits","orient"],md=["stroke","stroke-width","fill"],yd=["stroke","stroke-width"],xd={name:"MarkerType",compatConfig:{MODE:3}},wd=defineComponent({...xd,props:{id:null,type:null,color:{default:"none"},width:{default:12.5},height:{default:12.5},markerUnits:{default:"strokeWidth"},orient:{default:"auto-start-reverse"},strokeWidth:{default:1}},setup(n){return(e,o)=>(openBlock(),createElementBlock("marker",{id:n.id,class:"vue-flow__arrowhead",viewBox:"-10 -10 20 20",refX:"0",refY:"0",markerWidth:`${n.width}`,markerHeight:`${n.height}`,markerUnits:n.markerUnits,orient:n.orient},[n.type===unref(ro$2).ArrowClosed?(openBlock(),createElementBlock("polyline",{key:0,stroke:n.color,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":n.strokeWidth,fill:n.color,points:"-5,-4 0,0 -5,4 -5,-4"},null,8,md)):createCommentVNode("",!0),n.type===unref(ro$2).Arrow?(openBlock(),createElementBlock("polyline",{key:1,stroke:n.color,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":n.strokeWidth,fill:"none",points:"-5,-4 0,0 -5,4"},null,8,yd)):createCommentVNode("",!0)],8,pd))}}),_d={name:"MarkerDefinitions",compatConfig:{MODE:3}},bd=defineComponent({..._d,setup(n){const e=ve$1(),o=toRef(e,"id"),s=toRef(e,"edges"),c=toRef(e,"connectionLineOptions"),u=toRef(e,"defaultMarkerColor"),d=computed(()=>{const m=[],_=[],ue=gn=>{if(gn){const nh=tt$1(gn,o.value);m.includes(nh)||(typeof gn=="object"?_.push({...gn,id:nh,color:gn.color||u.value}):_.push({id:nh,color:u.value,type:gn}),m.push(nh))}};return[c.value.markerEnd,c.value.markerStart].forEach(ue),s.value.reduce((gn,nh)=>([nh.markerStart,nh.markerEnd].forEach(ue),gn.sort((ih,rh)=>ih.id.localeCompare(rh.id))),_),_});return(m,_)=>(openBlock(),createElementBlock("defs",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(d),ue=>(openBlock(),createBlock(wd,{id:ue.id,key:ue.id,type:ue.type,color:ue.color,width:ue.width,height:ue.height,markerUnits:ue.markerUnits,"stroke-width":ue.strokeWidth,orient:ue.orient},null,8,["id","type","color","width","height","markerUnits","stroke-width","orient"]))),128))]))}}),Ed={key:0,class:"vue-flow__edges vue-flow__connectionline vue-flow__container"},Sd={name:"Edges",compatConfig:{MODE:3}},Nd=defineComponent({...Sd,setup(n){const e=inject(Nn$1),{connectionStartHandle:o,nodesConnectable:s,edgesUpdatable:c,edgesFocusable:u,elementsSelectable:d,getSelectedNodes:m,findNode:_,edges:ue,getEdges:gn,getNodesInitialized:nh,getEdgeTypes:ih,elevateEdgesOnSelect:rh,dimensions:oh,emits:lh}=ve$1(),ch=In$1(()=>{var Ch;return(Ch=o.value)==null?void 0:Ch.nodeId},()=>{var Ch;return(Ch=o.value)!=null&&Ch.nodeId?_(o.value.nodeId):!1}),dh=In$1(()=>{var Ch;return(Ch=o.value)==null?void 0:Ch.nodeId},()=>{var Ch,Mh;return!!(ch.value&&(typeof ch.value.connectable>"u"?s.value:ch.value.connectable)&&(Ch=o.value)!=null&&Ch.nodeId&&(Mh=o.value)!=null&&Mh.type)}),_h=In$1([()=>ue.value.map(Ch=>Ch.zIndex),()=>rh.value?[m.value.length]:[0],()=>rh.value?nh.value.map(Ch=>Ch.computedPosition.z):[]],()=>ic(gn.value,_,rh.value));function Sh(Ch){return typeof Ch>"u"?d.value:Ch}function fh(Ch){return typeof Ch>"u"?c.value:Ch}function yh(Ch){return typeof Ch>"u"?u.value:Ch}function mh(Ch,Mh){const Ph=Ch||"default";let Eh=Mh??ih.value[Ph];const Nh=getCurrentInstance();if(typeof Eh=="string"&&Nh){const Yh=Object.keys(Nh.appContext.components);Yh&&Yh.includes(Ph)&&(Eh=resolveComponent(Ph,!1))}return Eh&&typeof Eh!="string"?Eh:(e==null?void 0:e[`edge-${Ph}`])||(lh.error(new xe$1(ye$1.EDGE_TYPE_MISSING,Eh)),!1)}return(Ch,Mh)=>unref(oh).width&&unref(oh).height?(openBlock(),createElementBlock(Fragment,{key:0},[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(_h),Ph=>(openBlock(),createElementBlock("svg",{key:Ph.level,class:"vue-flow__edges vue-flow__container",style:normalizeStyle(`z-index: ${Ph.level}`)},[Ph.isMaxLevel?(openBlock(),createBlock(bd,{key:0})):createCommentVNode("",!0),createBaseVNode("g",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(Ph.edges,Eh=>(openBlock(),createBlock(unref(Bc),{id:Eh.id,key:Eh.id,edge:Eh,type:mh(Eh.type,Eh.template),name:Eh.type||"default",selectable:Sh(Eh.selectable),updatable:fh(Eh.updatable),focusable:yh(Eh.focusable)},null,8,["id","edge","type","name","selectable","updatable","focusable"]))),128))])],4))),128)),unref(dh)&&unref(ch)?(openBlock(),createElementBlock("svg",Ed,[createVNode(Gc,{"source-node":unref(ch)},null,8,["source-node"])])):createCommentVNode("",!0)],64)):createCommentVNode("",!0)}}),kd=createBaseVNode("div",{class:"vue-flow__edge-labels"},null,-1),Cd={name:"Transform",compatConfig:{MODE:3}},Md=defineComponent({...Cd,setup(n){const{id:e,viewport:o,emits:s,d3Zoom:c,d3Selection:u,dimensions:d,...m}=ve$1(),_=ref$1(!ki$1);return Se(()=>c.value&&u.value&&d.value.width>0&&d.value.height>0).toBeTruthy().then(()=>{s.paneReady({id:e,viewport:o,emits:s,d3Zoom:c,d3Selection:u,dimensions:d,...m}),setTimeout(()=>{_.value=!0},0)}),(ue,gn)=>(openBlock(),createElementBlock("div",{key:`transform-${unref(e)}`,class:"vue-flow__transformationpane vue-flow__container",style:normalizeStyle({transform:`translate(${unref(o).x}px,${unref(o).y}px) scale(${unref(o).zoom})`,opacity:_.value?void 0:0})},[createVNode(Nd),kd,createVNode(vd),renderSlot(ue.$slots,"default")],4))}}),$d={name:"Viewport",compatConfig:{MODE:3}},Td=defineComponent({...$d,setup(n){const{id:e,minZoom:o,maxZoom:s,defaultViewport:c,translateExtent:u,dimensions:d,zoomActivationKeyCode:m,selectionKeyCode:_,panActivationKeyCode:ue,panOnScroll:gn,panOnScrollMode:nh,panOnScrollSpeed:ih,panOnDrag:rh,zoomOnDoubleClick:oh,zoomOnPinch:lh,zoomOnScroll:ch,preventScrolling:dh,noWheelClassName:_h,noPanClassName:Sh,emits:fh,connectionStartHandle:yh,userSelectionActive:mh,paneDragging:Ch,d3Zoom:Mh,d3Selection:Ph,d3ZoomHandler:Eh,viewport:Nh,viewportRef:Wh}=ve$1(),Yh=ref$1(),gh=ref$1(!1),Ah=ref$1(!1);let wh=!1,$h=0,Rh={x:0,y:0,zoom:0};const Oh=Ot$1(ue),Lh=computed(()=>!gh.value&&rh.value&&Oh.value),qh=computed(()=>_.value!==!0&&gh.value||_.value===!0&&!Lh.value);onMounted(()=>{hl(Yh,Th);const Dh=$o$1();go$1(Dh,"resize",Th)}),onMounted(()=>{const Dh=Yh.value,Gh=Dh.getBoundingClientRect(),Jh=Xu().scaleExtent([o.value,s.value]).translateExtent(u.value),rf=Ce$1(Dh).call(Jh),ef=rf.on("wheel.zoom"),uh=lt.translate(c.value.x??0,c.value.y??0).scale(st$1(c.value.zoom??1,o.value,s.value)),ph=[[0,0],[Gh.width,Gh.height]],kh=Jh.constrain()(uh,ph,u.value);Jh.transform(rf,kh),Mh.value=Jh,Ph.value=rf,Eh.value=ef,Nh.value={x:kh.x,y:kh.y,zoom:kh.k},Wh.value=Dh,Ot$1(_,bh=>{gh.value=bh});const xh=Ot$1(m);watchEffect(()=>{gh.value&&mh.value&&!Ah.value?Jh.on("zoom",null):!gh.value&&!mh.value&&Jh.on("zoom",bh=>{Nh.value={x:bh.transform.x,y:bh.transform.y,zoom:bh.transform.k};const Bh=Qh(bh.transform);wh=Hh(rh.value,$h??0),fh.viewportChange(Bh),fh.move({event:bh,flowTransform:Bh})})}),Jh.on("start",bh=>{var Bh;if(!bh.sourceEvent)return null;$h=bh.sourceEvent.button,Ah.value=!0;const Uh=Qh(bh.transform);((Bh=bh.sourceEvent)==null?void 0:Bh.type)==="mousedown"&&(Ch.value=!0),Rh=Uh,fh.viewportChangeStart(Uh),fh.moveStart({event:bh,flowTransform:Uh})}),Jh.on("end",bh=>{if(!bh.sourceEvent)return null;if(Ah.value=!1,Ch.value=!1,Hh(rh.value,$h??0)&&!wh&&fh.paneContextMenu(bh.sourceEvent),wh=!1,Xh(Rh,bh.transform)){const Bh=Qh(bh.transform);Rh=Bh,fh.viewportChangeEnd(Bh),fh.moveEnd({event:bh,flowTransform:Bh})}}),watchEffect(()=>{gn.value&&!xh.value&&!mh.value?rf.on("wheel.zoom",bh=>{if(Fh(bh,_h.value))return!1;bh.preventDefault(),bh.stopImmediatePropagation();const Bh=rf.property("__zoom").k||1;if(bh.ctrlKey&&lh.value){const Kh=Oe$1(bh),tf=-bh.deltaY*(bh.deltaMode===1?.05:bh.deltaMode?1:.002)*10,Zh=Bh*2**tf;Jh.scaleTo(rf,Zh,Kh);return}const Uh=bh.deltaMode===1?20:1,zh=nh.value===sn.Vertical?0:bh.deltaX*Uh,jh=nh.value===sn.Horizontal?0:bh.deltaY*Uh;Jh.translateBy(rf,-(zh/Bh)*ih.value,-(jh/Bh)*ih.value)},{passive:!1}):typeof ef<"u"&&rf.on("wheel.zoom",function(bh,Bh){if(!dh.value||Fh(bh,_h.value))return null;bh.preventDefault(),ef.call(this,bh,Bh)},{passive:!1})}),Jh.filter(bh=>{var Bh,Uh;const zh=xh.value||ch.value,jh=lh.value&&bh.ctrlKey;if(bh.button===1&&bh.type==="mousedown"&&((Bh=bh.target)!=null&&Bh.closest(".vue-flow__node")||(Uh=bh.target)!=null&&Uh.closest(".vue-flow__edge")))return!0;if(!rh.value&&!zh&&!gn.value&&!oh.value&&!lh.value||mh.value||!oh.value&&bh.type==="dblclick"||Fh(bh,_h.value)&&bh.type==="wheel"||Fh(bh,Sh.value)&&bh.type!=="wheel"||!lh.value&&bh.ctrlKey&&bh.type==="wheel"||!zh&&!gn.value&&!jh&&bh.type==="wheel"||!rh.value&&(bh.type==="mousedown"||bh.type==="touchstart")||Array.isArray(rh.value)&&!rh.value.includes(bh.button)&&(bh.type==="mousedown"||bh.type==="touchstart"))return!1;const Kh=Array.isArray(rh.value)&&rh.value.includes(bh.button)||!bh.button||bh.button<=1;return(!bh.ctrlKey||bh.type==="wheel")&&Kh})});function Hh(Dh,Gh){return Gh===2&&Array.isArray(Dh)&&Dh.includes(2)}function Xh(Dh,Gh){return Dh.x!==Gh.x&&!isNaN(Gh.x)||Dh.y!==Gh.y&&!isNaN(Gh.y)||Dh.zoom!==Gh.k&&!isNaN(Gh.k)}function Qh(Dh){return{x:Dh.x,y:Dh.y,zoom:Dh.k}}function Th(){if(!Yh.value)return;const{width:Dh,height:Gh}=xn$1(Yh.value);(Dh===0||Gh===0)&&fh.error(new xe$1(ye$1.MISSING_VIEWPORT_DIMENSIONS)),d.value.width=Dh||500,d.value.height=Gh||500}function Fh(Dh,Gh){return Dh.target.closest(`.${Gh}`)}return(Dh,Gh)=>(openBlock(),createElementBlock(Fragment,null,[(openBlock(),createElementBlock("div",{ref_key:"viewportEl",ref:Yh,key:`viewport-${unref(e)}`,class:"vue-flow__viewport vue-flow__container"},[createVNode(fd,{"is-selecting":unref(qh),class:normalizeClass({connecting:!!unref(yh),dragging:unref(Ch),draggable:!!unref(rh)})},{default:withCtx(()=>[createVNode(Md,null,{default:withCtx(()=>[renderSlot(Dh.$slots,"zoom-pane")]),_:3})]),_:3},8,["is-selecting","class"])])),renderSlot(Dh.$slots,"default")],64))}}),Od=["id"],Pd=["id"],Id=["id"],Dd={name:"A11yDescriptions",compatConfig:{MODE:3}},Ad=defineComponent({...Dd,setup(n){const{id:e,disableKeyboardA11y:o,ariaLiveMessage:s}=ve$1(),c={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"};return(u,d)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",{id:`${unref(ir$1)}-${unref(e)}`,style:{display:"none"}}," Press enter or space to select a node. "+toDisplayString(unref(o)?"":"You can then use the arrow keys to move the node around.")+" You can then use the arrow keys to move the node around, press delete to remove it and press escape to cancel. ",9,Od),createBaseVNode("div",{id:`${unref(rr$1)}-${unref(e)}`,style:{display:"none"}}," Press enter or space to select an edge. You can then press delete to remove it or press escape to cancel. ",8,Pd),unref(o)?createCommentVNode("",!0):(openBlock(),createElementBlock("div",{key:0,id:`${unref(Zu)}-${unref(e)}`,"aria-live":"assertive","aria-atomic":"true",style:c},toDisplayString(unref(s)),9,Id))],64))}}),zd={name:"VueFlow",compatConfig:{MODE:3}},Kd=defineComponent({...zd,props:{id:null,modelValue:null,nodes:null,edges:null,edgeTypes:null,nodeTypes:null,connectionMode:null,connectionLineType:null,connectionLineStyle:{default:void 0},connectionLineOptions:{default:void 0},connectionRadius:null,isValidConnection:{type:Function,default:void 0},deleteKeyCode:{type:[Boolean,String,Function],default:void 0},selectionKeyCode:{type:[Boolean,String,Function],default:void 0},multiSelectionKeyCode:{type:[Boolean,String,Function],default:void 0},zoomActivationKeyCode:{type:[Boolean,String,Function],default:void 0},panActivationKeyCode:{type:[Boolean,String,Function],default:void 0},snapToGrid:{type:Boolean,default:void 0},snapGrid:null,onlyRenderVisibleElements:{type:Boolean,default:void 0},edgesUpdatable:{type:[Boolean,String],default:void 0},nodesDraggable:{type:Boolean,default:void 0},nodesConnectable:{type:Boolean,default:void 0},elementsSelectable:{type:Boolean,default:void 0},selectNodesOnDrag:{type:Boolean,default:void 0},panOnDrag:{type:Boolean,default:void 0},minZoom:null,maxZoom:null,defaultViewport:null,translateExtent:null,nodeExtent:null,defaultMarkerColor:null,zoomOnScroll:{type:Boolean,default:void 0},zoomOnPinch:{type:Boolean,default:void 0},panOnScroll:{type:Boolean,default:void 0},panOnScrollSpeed:null,panOnScrollMode:null,zoomOnDoubleClick:{type:Boolean,default:void 0},preventScrolling:{type:Boolean,default:void 0},selectionMode:null,edgeUpdaterRadius:null,fitViewOnInit:{type:Boolean,default:void 0},connectOnClick:{type:Boolean,default:void 0},applyDefault:{type:Boolean,default:void 0},autoConnect:{type:[Boolean,Function],default:void 0},noDragClassName:null,noWheelClassName:null,noPanClassName:null,defaultEdgeOptions:null,elevateEdgesOnSelect:{type:Boolean,default:void 0},elevateNodesOnSelect:{type:Boolean,default:void 0},disableKeyboardA11y:{type:Boolean,default:void 0},edgesFocusable:{type:Boolean,default:void 0},nodesFocusable:{type:Boolean,default:void 0},autoPanOnConnect:{type:Boolean,default:void 0},autoPanOnNodeDrag:{type:Boolean,default:void 0},__experimentalFeatures:null},emits:["nodesChange","edgesChange","nodeDoubleClick","nodeClick","nodeMouseEnter","nodeMouseMove","nodeMouseLeave","nodeContextMenu","nodeDragStart","nodeDrag","nodeDragStop","nodesInitialized","miniMapNodeClick","miniMapNodeDoubleClick","miniMapNodeMouseEnter","miniMapNodeMouseMove","miniMapNodeMouseLeave","connect","connectStart","connectEnd","clickConnectStart","clickConnectEnd","moveStart","move","moveEnd","selectionDragStart","selectionDrag","selectionDragStop","selectionContextMenu","selectionStart","selectionEnd","viewportChangeStart","viewportChange","viewportChangeEnd","paneReady","paneScroll","paneClick","paneContextMenu","paneMouseEnter","paneMouseMove","paneMouseLeave","edgeContextMenu","edgeMouseEnter","edgeMouseMove","edgeMouseLeave","edgeDoubleClick","edgeClick","edgeUpdateStart","edgeUpdate","edgeUpdateEnd","updateNodeInternals","error","update:modelValue","update:nodes","update:edges"],setup(n,{expose:e,emit:o}){const s=n,c=Tt$1(s,"modelValue",o),u=Tt$1(s,"nodes",o),d=Tt$1(s,"edges",o),{vueFlowRef:m,hooks:_,getNodeTypes:ue,getEdgeTypes:gn,...nh}=ve$1(s),ih=cd({modelValue:c,nodes:u,edges:d},s,{vueFlowRef:m,hooks:_,getNodeTypes:ue,getEdgeTypes:gn,...nh});hc(o,_);const rh=ref$1();return provide(Nn$1,useSlots()),onUnmounted(()=>{ih()}),onMounted(()=>{m.value=rh.value}),e({vueFlowRef:m,hooks:_,getNodeTypes:ue,getEdgeTypes:gn,...nh}),(oh,lh)=>(openBlock(),createElementBlock("div",{ref_key:"el",ref:rh,class:"vue-flow"},[createVNode(Td,null,{nodes:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(Object.keys(unref(ue)),ch=>renderSlot(oh.$slots,`node-${ch}`)),256))]),edges:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(Object.keys(unref(gn)),ch=>renderSlot(oh.$slots,`edge-${ch}`)),256))]),"connection-name":withCtx(()=>[renderSlot(oh.$slots,"connection-line")]),"zoom-pane":withCtx(()=>[renderSlot(oh.$slots,"zoom-pane")]),default:withCtx(()=>[renderSlot(oh.$slots,"default")]),_:3}),createVNode(Ad)],512))}}),Bd={name:"Panel",compatConfig:{MODE:3}},qd=defineComponent({...Bd,props:{position:null},setup(n){const e=n,{userSelectionActive:o}=ve$1(),s=computed(()=>`${e.position}`.split("-"));return(c,u)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["vue-flow__panel",unref(s)]),style:normalizeStyle({pointerEvents:unref(o)?"none":"all"})},[renderSlot(c.$slots,"default")],6))}});var a=(n=>(n.Lines="lines",n.Dots="dots",n))(a||{});const z=function({dimensions:n,size:e,color:o}){return h$1("path",{stroke:o,"stroke-width":e,d:`M${n[0]/2} 0 V${n[1]} M0 ${n[1]/2} H${n[0]}`})},C=function({radius:n,color:e}){return h$1("circle",{cx:n,cy:n,r:n,fill:e})};a.Lines+"",a.Dots+"";const L$2=["id","x","y","width","height","patternTransform"],B$1={key:2,height:"100",width:"100"},S$1=["fill"],E$1=["x","y","fill"],M={name:"Background",compatConfig:{MODE:3}},A=defineComponent({...M,props:{id:null,variant:{default:a.Dots},gap:{default:20},size:{default:1},lineWidth:{default:1},patternColor:null,bgColor:null,height:{default:100},width:{default:100},x:{default:0},y:{default:0},offset:{default:2}},setup(n){const e={[a.Dots]:"#81818a",[a.Lines]:"#eee"},{id:o,viewport:s}=ve$1(),c=computed(()=>{const[m,_]=Array.isArray(n.gap)?n.gap:[n.gap,n.gap],ue=[m*s.value.zoom||1,_*s.value.zoom||1],gn=n.size*s.value.zoom,nh=n.variant===a.Dots?[gn/n.offset,gn/n.offset]:[ue[0]/n.offset,ue[1]/n.offset];return{scaledGap:ue,offset:nh,size:gn}}),u=computed(()=>`pattern-${o}${n.id?`-${n.id}`:""}`),d=computed(()=>n.patternColor||e[n.variant||a.Dots]);return(m,_)=>(openBlock(),createElementBlock("svg",{class:"vue-flow__background vue-flow__container",style:normalizeStyle({height:`${n.height>100?100:n.height}%`,width:`${n.width>100?100:n.width}%`})},[renderSlot(m.$slots,"pattern-container",{id:unref(u)},()=>[createBaseVNode("pattern",{id:unref(u),x:unref(s).x%unref(c).scaledGap[0],y:unref(s).y%unref(c).scaledGap[1],width:unref(c).scaledGap[0],height:unref(c).scaledGap[1],patternTransform:`translate(-${unref(c).offset[0]},-${unref(c).offset[1]})`,patternUnits:"userSpaceOnUse"},[renderSlot(m.$slots,"pattern",{},()=>[n.variant===unref(a).Lines?(openBlock(),createBlock(unref(z),{key:0,size:n.lineWidth,color:unref(d),dimensions:unref(c).scaledGap},null,8,["size","color","dimensions"])):n.variant===unref(a).Dots?(openBlock(),createBlock(unref(C),{key:1,color:unref(d),radius:unref(c).size/n.offset},null,8,["color","radius"])):createCommentVNode("",!0),n.bgColor?(openBlock(),createElementBlock("svg",B$1,[createBaseVNode("rect",{width:"100%",height:"100%",fill:n.bgColor},null,8,S$1)])):createCommentVNode("",!0)])],8,L$2)]),createBaseVNode("rect",{x:n.x,y:n.y,width:"100%",height:"100%",fill:`url(#${unref(u)})`},null,8,E$1),renderSlot(m.$slots,"default",{id:unref(u)})],4))}}),Sidebar_vue_vue_type_style_index_0_scoped_14ae0d55_lang="",_withScopeId$1=n=>(pushScopeId("data-v-14ae0d55"),n=n(),popScopeId(),n),_hoisted_1$3=_withScopeId$1(()=>createBaseVNode("div",{class:"description"},"You can drag these nodes to the pane.",-1)),_hoisted_2$2={class:"nodes"},_sfc_main$3={__name:"Sidebar",setup(n){function e(o,s){o.dataTransfer&&(o.dataTransfer.setData("application/vueflow",s),o.dataTransfer.effectAllowed="move")}return(o,s)=>(openBlock(),createElementBlock("aside",null,[_hoisted_1$3,createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",{class:"vue-flow__node-input",draggable:!0,onDragstart:s[0]||(s[0]=c=>e(c,"input"))}," Input Node ",32),createBaseVNode("div",{class:"vue-flow__node-default",draggable:!0,onDragstart:s[1]||(s[1]=c=>e(c,"default"))}," Default Node ",32),createBaseVNode("div",{class:"vue-flow__node-output",draggable:!0,onDragstart:s[2]||(s[2]=c=>e(c,"output"))}," Output Node ",32)])]))}},Sidebar=_export_sfc(_sfc_main$3,[["__scopeId","data-v-14ae0d55"]]),D={name:"ControlButton",compatConfig:{MODE:3}},E=(n,e)=>{const o=n.__vccOpts||n;for(const[s,c]of e)o[s]=c;return o},N={class:"vue-flow__controls-button"};function L$1(n,e,o,s,c,u){return openBlock(),createElementBlock("button",N,[renderSlot(n.$slots,"default")])}const w=E(D,[["render",L$1]]),R={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},S=createBaseVNode("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),U=[S];function j$1(n,e){return openBlock(),createElementBlock("svg",R,U)}const q={render:j$1},G={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},J$1=createBaseVNode("path",{d:"M0 0h32v4.2H0z"},null,-1),K$1=[J$1];function Q$1(n,e){return openBlock(),createElementBlock("svg",G,K$1)}const T={render:Q$1},W$1={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},X=createBaseVNode("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Y$1=[X];function oo$1(n,e){return openBlock(),createElementBlock("svg",W$1,Y$1)}const to$1={render:oo$1},eo$1={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},no$1=createBaseVNode("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),so$1=[no$1];function co$1(n,e){return openBlock(),createElementBlock("svg",eo$1,so$1)}const lo$1={render:co$1},io$1={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},ro$1=createBaseVNode("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),ao$1=[ro$1];function uo$1(n,e){return openBlock(),createElementBlock("svg",io$1,ao$1)}const vo$1={render:uo$1},ho$1={name:"Controls",compatConfig:{MODE:3}},fo$1=defineComponent({...ho$1,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:null,position:{default:Uu.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(n,{emit:e}){const{nodesDraggable:o,nodesConnectable:s,elementsSelectable:c,setInteractive:u,zoomIn:d,zoomOut:m,fitView:_,viewport:ue,minZoom:gn,maxZoom:nh}=ve$1(),ih=computed(()=>o.value||s.value||c.value),rh=computed(()=>ue.value.zoom<=gn.value),oh=computed(()=>ue.value.zoom>=nh.value);function lh(){d(),e("zoomIn")}function ch(){m(),e("zoomOut")}function dh(){_(n.fitViewParams),e("fitView")}function _h(){u(!ih.value),e("interactionChange",!ih.value)}return(Sh,fh)=>(openBlock(),createBlock(unref(qd),{class:"vue-flow__controls",position:n.position},{default:withCtx(()=>[renderSlot(Sh.$slots,"top"),n.showZoom?(openBlock(),createElementBlock(Fragment,{key:0},[renderSlot(Sh.$slots,"control-zoom-in",{},()=>[createVNode(w,{class:"vue-flow__controls-zoomin",disabled:unref(oh),onClick:lh},{default:withCtx(()=>[renderSlot(Sh.$slots,"icon-zoom-in",{},()=>[(openBlock(),createBlock(resolveDynamicComponent(unref(q))))])]),_:3},8,["disabled"])]),renderSlot(Sh.$slots,"control-zoom-out",{},()=>[createVNode(w,{class:"vue-flow__controls-zoomout",disabled:unref(rh),onClick:ch},{default:withCtx(()=>[renderSlot(Sh.$slots,"icon-zoom-out",{},()=>[(openBlock(),createBlock(resolveDynamicComponent(unref(T))))])]),_:3},8,["disabled"])])],64)):createCommentVNode("",!0),n.showFitView?renderSlot(Sh.$slots,"control-fit-view",{key:1},()=>[createVNode(w,{class:"vue-flow__controls-fitview",onClick:dh},{default:withCtx(()=>[renderSlot(Sh.$slots,"icon-fit-view",{},()=>[(openBlock(),createBlock(resolveDynamicComponent(unref(to$1))))])]),_:3})]):createCommentVNode("",!0),n.showInteractive?renderSlot(Sh.$slots,"control-interactive",{key:2},()=>[n.showInteractive?(openBlock(),createBlock(w,{key:0,class:"vue-flow__controls-interactive",onClick:_h},{default:withCtx(()=>[unref(ih)?renderSlot(Sh.$slots,"icon-unlock",{key:0},()=>[(openBlock(),createBlock(resolveDynamicComponent(unref(vo$1))))]):createCommentVNode("",!0),unref(ih)?createCommentVNode("",!0):renderSlot(Sh.$slots,"icon-lock",{key:1},()=>[(openBlock(),createBlock(resolveDynamicComponent(unref(lo$1))))])]),_:3})):createCommentVNode("",!0)]):createCommentVNode("",!0),renderSlot(Sh.$slots,"default")]),_:3},8,["position"]))}});var _n={value:()=>{}};function te(){for(var n=0,e=arguments.length,o={},s;n<e;++n){if(!(s=arguments[n]+"")||s in o||/[\s.]/.test(s))throw new Error("illegal type: "+s);o[s]=[]}return new Mt(o)}function Mt(n){this._=n}function xn(n,e){return n.trim().split(/^|\s+/).map(function(o){var s="",c=o.indexOf(".");if(c>=0&&(s=o.slice(c+1),o=o.slice(0,c)),o&&!e.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:s}})}Mt.prototype=te.prototype={constructor:Mt,on:function(n,e){var o=this._,s=xn(n+"",o),c,u=-1,d=s.length;if(arguments.length<2){for(;++u<d;)if((c=(n=s[u]).type)&&(c=bn(o[c],n.name)))return c;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++u<d;)if(c=(n=s[u]).type)o[c]=ce(o[c],n.name,e);else if(e==null)for(c in o)o[c]=ce(o[c],n.name,null);return this},copy:function(){var n={},e=this._;for(var o in e)n[o]=e[o].slice();return new Mt(n)},call:function(n,e){if((c=arguments.length-2)>0)for(var o=new Array(c),s=0,c,u;s<c;++s)o[s]=arguments[s+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(u=this._[n],s=0,c=u.length;s<c;++s)u[s].value.apply(e,o)},apply:function(n,e,o){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var s=this._[n],c=0,u=s.length;c<u;++c)s[c].value.apply(e,o)}};function bn(n,e){for(var o=0,s=n.length,c;o<s;++o)if((c=n[o]).name===e)return c.value}function ce(n,e,o){for(var s=0,c=n.length;s<c;++s)if(n[s].name===e){n[s]=_n,n=n.slice(0,s).concat(n.slice(s+1));break}return o!=null&&n.push({name:e,value:o}),n}var Ot="http://www.w3.org/1999/xhtml";const fe={svg:"http://www.w3.org/2000/svg",xhtml:Ot,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Dt(n){var e=n+="",o=e.indexOf(":");return o>=0&&(e=n.slice(0,o))!=="xmlns"&&(n=n.slice(o+1)),fe.hasOwnProperty(e)?{space:fe[e],local:n}:n}function kn(n){return function(){var e=this.ownerDocument,o=this.namespaceURI;return o===Ot&&e.documentElement.namespaceURI===Ot?e.createElement(n):e.createElementNS(o,n)}}function Mn(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function ze(n){var e=Dt(n);return(e.local?Mn:kn)(e)}function Nn(){}function ee(n){return n==null?Nn:function(){return this.querySelector(n)}}function En(n){typeof n!="function"&&(n=ee(n));for(var e=this._groups,o=e.length,s=new Array(o),c=0;c<o;++c)for(var u=e[c],d=u.length,m=s[c]=new Array(d),_,ue,gn=0;gn<d;++gn)(_=u[gn])&&(ue=n.call(_,_.__data__,gn,u))&&("__data__"in _&&(ue.__data__=_.__data__),m[gn]=ue);return new B(s,this._parents)}function Cn(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function Sn(){return[]}function $e(n){return n==null?Sn:function(){return this.querySelectorAll(n)}}function zn(n){return function(){return Cn(n.apply(this,arguments))}}function $n(n){typeof n=="function"?n=zn(n):n=$e(n);for(var e=this._groups,o=e.length,s=[],c=[],u=0;u<o;++u)for(var d=e[u],m=d.length,_,ue=0;ue<m;++ue)(_=d[ue])&&(s.push(n.call(_,_.__data__,ue,d)),c.push(_));return new B(s,c)}function Ae(n){return function(){return this.matches(n)}}function Te(n){return function(e){return e.matches(n)}}var An=Array.prototype.find;function Tn(n){return function(){return An.call(this.children,n)}}function Rn(){return this.firstElementChild}function Dn(n){return this.select(n==null?Rn:Tn(typeof n=="function"?n:Te(n)))}var Fn=Array.prototype.filter;function In(){return Array.from(this.children)}function Hn(n){return function(){return Fn.call(this.children,n)}}function Pn(n){return this.selectAll(n==null?In:Hn(typeof n=="function"?n:Te(n)))}function Bn(n){typeof n!="function"&&(n=Ae(n));for(var e=this._groups,o=e.length,s=new Array(o),c=0;c<o;++c)for(var u=e[c],d=u.length,m=s[c]=[],_,ue=0;ue<d;++ue)(_=u[ue])&&n.call(_,_.__data__,ue,u)&&m.push(_);return new B(s,this._parents)}function Re(n){return new Array(n.length)}function Xn(){return new B(this._enter||this._groups.map(Re),this._parents)}function St(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}St.prototype={constructor:St,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function qn(n){return function(){return n}}function Vn(n,e,o,s,c,u){for(var d=0,m,_=e.length,ue=u.length;d<ue;++d)(m=e[d])?(m.__data__=u[d],s[d]=m):o[d]=new St(n,u[d]);for(;d<_;++d)(m=e[d])&&(c[d]=m)}function Ln(n,e,o,s,c,u,d){var m,_,ue=new Map,gn=e.length,nh=u.length,ih=new Array(gn),rh;for(m=0;m<gn;++m)(_=e[m])&&(ih[m]=rh=d.call(_,_.__data__,m,e)+"",ue.has(rh)?c[m]=_:ue.set(rh,_));for(m=0;m<nh;++m)rh=d.call(n,u[m],m,u)+"",(_=ue.get(rh))?(s[m]=_,_.__data__=u[m],ue.delete(rh)):o[m]=new St(n,u[m]);for(m=0;m<gn;++m)(_=e[m])&&ue.get(ih[m])===_&&(c[m]=_)}function Yn(n){return n.__data__}function On(n,e){if(!arguments.length)return Array.from(this,Yn);var o=e?Ln:Vn,s=this._parents,c=this._groups;typeof n!="function"&&(n=qn(n));for(var u=c.length,d=new Array(u),m=new Array(u),_=new Array(u),ue=0;ue<u;++ue){var gn=s[ue],nh=c[ue],ih=nh.length,rh=Wn(n.call(gn,gn&&gn.__data__,ue,s)),oh=rh.length,lh=m[ue]=new Array(oh),ch=d[ue]=new Array(oh),dh=_[ue]=new Array(ih);o(gn,nh,lh,ch,dh,rh,e);for(var _h=0,Sh=0,fh,yh;_h<oh;++_h)if(fh=lh[_h]){for(_h>=Sh&&(Sh=_h+1);!(yh=ch[Sh])&&++Sh<oh;);fh._next=yh||null}}return d=new B(d,s),d._enter=m,d._exit=_,d}function Wn(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function Un(){return new B(this._exit||this._groups.map(Re),this._parents)}function Gn(n,e,o){var s=this.enter(),c=this,u=this.exit();return typeof n=="function"?(s=n(s),s&&(s=s.selection())):s=s.append(n+""),e!=null&&(c=e(c),c&&(c=c.selection())),o==null?u.remove():o(u),s&&c?s.merge(c).order():c}function Kn(n){for(var e=n.selection?n.selection():n,o=this._groups,s=e._groups,c=o.length,u=s.length,d=Math.min(c,u),m=new Array(c),_=0;_<d;++_)for(var ue=o[_],gn=s[_],nh=ue.length,ih=m[_]=new Array(nh),rh,oh=0;oh<nh;++oh)(rh=ue[oh]||gn[oh])&&(ih[oh]=rh);for(;_<c;++_)m[_]=o[_];return new B(m,this._parents)}function Zn(){for(var n=this._groups,e=-1,o=n.length;++e<o;)for(var s=n[e],c=s.length-1,u=s[c],d;--c>=0;)(d=s[c])&&(u&&d.compareDocumentPosition(u)^4&&u.parentNode.insertBefore(d,u),u=d);return this}function Qn(n){n||(n=Jn);function e(nh,ih){return nh&&ih?n(nh.__data__,ih.__data__):!nh-!ih}for(var o=this._groups,s=o.length,c=new Array(s),u=0;u<s;++u){for(var d=o[u],m=d.length,_=c[u]=new Array(m),ue,gn=0;gn<m;++gn)(ue=d[gn])&&(_[gn]=ue);_.sort(e)}return new B(c,this._parents).order()}function Jn(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function jn(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function ti(){return Array.from(this)}function ei(){for(var n=this._groups,e=0,o=n.length;e<o;++e)for(var s=n[e],c=0,u=s.length;c<u;++c){var d=s[c];if(d)return d}return null}function ni(){let n=0;for(const e of this)++n;return n}function ii(){return!this.node()}function ri(n){for(var e=this._groups,o=0,s=e.length;o<s;++o)for(var c=e[o],u=0,d=c.length,m;u<d;++u)(m=c[u])&&n.call(m,m.__data__,u,c);return this}function oi(n){return function(){this.removeAttribute(n)}}function si(n){return function(){this.removeAttributeNS(n.space,n.local)}}function ai(n,e){return function(){this.setAttribute(n,e)}}function ui(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function li(n,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttribute(n):this.setAttribute(n,o)}}function ci(n,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,o)}}function fi(n,e){var o=Dt(n);if(arguments.length<2){var s=this.node();return o.local?s.getAttributeNS(o.space,o.local):s.getAttribute(o)}return this.each((e==null?o.local?si:oi:typeof e=="function"?o.local?ci:li:o.local?ui:ai)(o,e))}function De(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function hi(n){return function(){this.style.removeProperty(n)}}function di(n,e,o){return function(){this.style.setProperty(n,e,o)}}function mi(n,e,o){return function(){var s=e.apply(this,arguments);s==null?this.style.removeProperty(n):this.style.setProperty(n,s,o)}}function pi(n,e,o){return arguments.length>1?this.each((e==null?hi:typeof e=="function"?mi:di)(n,e,o??"")):st(this.node(),n)}function st(n,e){return n.style.getPropertyValue(e)||De(n).getComputedStyle(n,null).getPropertyValue(e)}function gi(n){return function(){delete this[n]}}function vi(n,e){return function(){this[n]=e}}function yi(n,e){return function(){var o=e.apply(this,arguments);o==null?delete this[n]:this[n]=o}}function wi(n,e){return arguments.length>1?this.each((e==null?gi:typeof e=="function"?yi:vi)(n,e)):this.node()[n]}function Fe(n){return n.trim().split(/^|\s+/)}function ne(n){return n.classList||new Ie(n)}function Ie(n){this._node=n,this._names=Fe(n.getAttribute("class")||"")}Ie.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function He(n,e){for(var o=ne(n),s=-1,c=e.length;++s<c;)o.add(e[s])}function Pe(n,e){for(var o=ne(n),s=-1,c=e.length;++s<c;)o.remove(e[s])}function _i(n){return function(){He(this,n)}}function xi(n){return function(){Pe(this,n)}}function bi(n,e){return function(){(e.apply(this,arguments)?He:Pe)(this,n)}}function ki(n,e){var o=Fe(n+"");if(arguments.length<2){for(var s=ne(this.node()),c=-1,u=o.length;++c<u;)if(!s.contains(o[c]))return!1;return!0}return this.each((typeof e=="function"?bi:e?_i:xi)(o,e))}function Mi(){this.textContent=""}function Ni(n){return function(){this.textContent=n}}function Ei(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function Ci(n){return arguments.length?this.each(n==null?Mi:(typeof n=="function"?Ei:Ni)(n)):this.node().textContent}function Si(){this.innerHTML=""}function zi(n){return function(){this.innerHTML=n}}function $i(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function Ai(n){return arguments.length?this.each(n==null?Si:(typeof n=="function"?$i:zi)(n)):this.node().innerHTML}function Ti(){this.nextSibling&&this.parentNode.appendChild(this)}function Ri(){return this.each(Ti)}function Di(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Fi(){return this.each(Di)}function Ii(n){var e=typeof n=="function"?n:ze(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Hi(){return null}function Pi(n,e){var o=typeof n=="function"?n:ze(n),s=e==null?Hi:typeof e=="function"?e:ee(e);return this.select(function(){return this.insertBefore(o.apply(this,arguments),s.apply(this,arguments)||null)})}function Bi(){var n=this.parentNode;n&&n.removeChild(this)}function Xi(){return this.each(Bi)}function qi(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Vi(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Li(n){return this.select(n?Vi:qi)}function Yi(n){return arguments.length?this.property("__data__",n):this.node().__data__}function Oi(n){return function(e){n.call(this,e,this.__data__)}}function Wi(n){return n.trim().split(/^|\s+/).map(function(e){var o="",s=e.indexOf(".");return s>=0&&(o=e.slice(s+1),e=e.slice(0,s)),{type:e,name:o}})}function Ui(n){return function(){var e=this.__on;if(e){for(var o=0,s=-1,c=e.length,u;o<c;++o)u=e[o],(!n.type||u.type===n.type)&&u.name===n.name?this.removeEventListener(u.type,u.listener,u.options):e[++s]=u;++s?e.length=s:delete this.__on}}}function Gi(n,e,o){return function(){var s=this.__on,c,u=Oi(e);if(s){for(var d=0,m=s.length;d<m;++d)if((c=s[d]).type===n.type&&c.name===n.name){this.removeEventListener(c.type,c.listener,c.options),this.addEventListener(c.type,c.listener=u,c.options=o),c.value=e;return}}this.addEventListener(n.type,u,o),c={type:n.type,name:n.name,value:e,listener:u,options:o},s?s.push(c):this.__on=[c]}}function Ki(n,e,o){var s=Wi(n+""),c,u=s.length,d;if(arguments.length<2){var m=this.node().__on;if(m){for(var _=0,ue=m.length,gn;_<ue;++_)for(c=0,gn=m[_];c<u;++c)if((d=s[c]).type===gn.type&&d.name===gn.name)return gn.value}return}for(m=e?Gi:Ui,c=0;c<u;++c)this.each(m(s[c],e,o));return this}function Be(n,e,o){var s=De(n),c=s.CustomEvent;typeof c=="function"?c=new c(e,o):(c=s.document.createEvent("Event"),o?(c.initEvent(e,o.bubbles,o.cancelable),c.detail=o.detail):c.initEvent(e,!1,!1)),n.dispatchEvent(c)}function Zi(n,e){return function(){return Be(this,n,e)}}function Qi(n,e){return function(){return Be(this,n,e.apply(this,arguments))}}function Ji(n,e){return this.each((typeof e=="function"?Qi:Zi)(n,e))}function*ji(){for(var n=this._groups,e=0,o=n.length;e<o;++e)for(var s=n[e],c=0,u=s.length,d;c<u;++c)(d=s[c])&&(yield d)}var Xe=[null];function B(n,e){this._groups=n,this._parents=e}function yt(){return new B([[document.documentElement]],Xe)}function tr(){return this}B.prototype=yt.prototype={constructor:B,select:En,selectAll:$n,selectChild:Dn,selectChildren:Pn,filter:Bn,data:On,enter:Xn,exit:Un,join:Gn,merge:Kn,selection:tr,order:Zn,sort:Qn,call:jn,nodes:ti,node:ei,size:ni,empty:ii,each:ri,attr:fi,style:pi,property:wi,classed:ki,text:Ci,html:Ai,raise:Ri,lower:Fi,append:Ii,insert:Pi,remove:Xi,clone:Li,datum:Yi,on:Ki,dispatch:Ji,[Symbol.iterator]:ji};function tt(n){return typeof n=="string"?new B([[document.querySelector(n)]],[document.documentElement]):new B([[n]],Xe)}function er(n){let e;for(;e=n.sourceEvent;)n=e;return n}function J(n,e){if(n=er(n),e===void 0&&(e=n.currentTarget),e){var o=e.ownerSVGElement||e;if(o.createSVGPoint){var s=o.createSVGPoint();return s.x=n.clientX,s.y=n.clientY,s=s.matrixTransform(e.getScreenCTM().inverse()),[s.x,s.y]}if(e.getBoundingClientRect){var c=e.getBoundingClientRect();return[n.clientX-c.left-e.clientLeft,n.clientY-c.top-e.clientTop]}}return[n.pageX,n.pageY]}const Wt={capture:!0,passive:!1};function Ut(n){n.preventDefault(),n.stopImmediatePropagation()}function nr(n){var e=n.document.documentElement,o=tt(n).on("dragstart.drag",Ut,Wt);"onselectstart"in e?o.on("selectstart.drag",Ut,Wt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ir(n,e){var o=n.document.documentElement,s=tt(n).on("dragstart.drag",null);e&&(s.on("click.drag",Ut,Wt),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in o?s.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}function ie(n,e,o){n.prototype=e.prototype=o,o.constructor=n}function qe(n,e){var o=Object.create(n.prototype);for(var s in e)o[s]=e[s];return o}function wt(){}var mt=.7,zt=1/mt,ot="\\s*([+-]?\\d+)\\s*",pt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",O="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",rr=/^#([0-9a-f]{3,8})$/,or=new RegExp(`^rgb\\(${ot},${ot},${ot}\\)$`),sr=new RegExp(`^rgb\\(${O},${O},${O}\\)$`),ar=new RegExp(`^rgba\\(${ot},${ot},${ot},${pt}\\)$`),ur=new RegExp(`^rgba\\(${O},${O},${O},${pt}\\)$`),lr=new RegExp(`^hsl\\(${pt},${O},${O}\\)$`),cr=new RegExp(`^hsla\\(${pt},${O},${O},${pt}\\)$`),he={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ie(wt,gt,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:de,formatHex:de,formatHex8:fr,formatHsl:hr,formatRgb:me,toString:me});function de(){return this.rgb().formatHex()}function fr(){return this.rgb().formatHex8()}function hr(){return Ve(this).formatHsl()}function me(){return this.rgb().formatRgb()}function gt(n){var e,o;return n=(n+"").trim().toLowerCase(),(e=rr.exec(n))?(o=e[1].length,e=parseInt(e[1],16),o===6?pe(e):o===3?new F(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):o===8?_t(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):o===4?_t(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=or.exec(n))?new F(e[1],e[2],e[3],1):(e=sr.exec(n))?new F(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=ar.exec(n))?_t(e[1],e[2],e[3],e[4]):(e=ur.exec(n))?_t(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=lr.exec(n))?ye(e[1],e[2]/100,e[3]/100,1):(e=cr.exec(n))?ye(e[1],e[2]/100,e[3]/100,e[4]):he.hasOwnProperty(n)?pe(he[n]):n==="transparent"?new F(NaN,NaN,NaN,0):null}function pe(n){return new F(n>>16&255,n>>8&255,n&255,1)}function _t(n,e,o,s){return s<=0&&(n=e=o=NaN),new F(n,e,o,s)}function dr(n){return n instanceof wt||(n=gt(n)),n?(n=n.rgb(),new F(n.r,n.g,n.b,n.opacity)):new F}function Gt(n,e,o,s){return arguments.length===1?dr(n):new F(n,e,o,s??1)}function F(n,e,o,s){this.r=+n,this.g=+e,this.b=+o,this.opacity=+s}ie(F,Gt,qe(wt,{brighter(n){return n=n==null?zt:Math.pow(zt,n),new F(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?mt:Math.pow(mt,n),new F(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new F(nt(this.r),nt(this.g),nt(this.b),$t(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ge,formatHex:ge,formatHex8:mr,formatRgb:ve,toString:ve}));function ge(){return`#${et(this.r)}${et(this.g)}${et(this.b)}`}function mr(){return`#${et(this.r)}${et(this.g)}${et(this.b)}${et((isNaN(this.opacity)?1:this.opacity)*255)}`}function ve(){const n=$t(this.opacity);return`${n===1?"rgb(":"rgba("}${nt(this.r)}, ${nt(this.g)}, ${nt(this.b)}${n===1?")":`, ${n})`}`}function $t(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function nt(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function et(n){return n=nt(n),(n<16?"0":"")+n.toString(16)}function ye(n,e,o,s){return s<=0?n=e=o=NaN:o<=0||o>=1?n=e=NaN:e<=0&&(n=NaN),new L(n,e,o,s)}function Ve(n){if(n instanceof L)return new L(n.h,n.s,n.l,n.opacity);if(n instanceof wt||(n=gt(n)),!n)return new L;if(n instanceof L)return n;n=n.rgb();var e=n.r/255,o=n.g/255,s=n.b/255,c=Math.min(e,o,s),u=Math.max(e,o,s),d=NaN,m=u-c,_=(u+c)/2;return m?(e===u?d=(o-s)/m+(o<s)*6:o===u?d=(s-e)/m+2:d=(e-o)/m+4,m/=_<.5?u+c:2-u-c,d*=60):m=_>0&&_<1?0:d,new L(d,m,_,n.opacity)}function pr(n,e,o,s){return arguments.length===1?Ve(n):new L(n,e,o,s??1)}function L(n,e,o,s){this.h=+n,this.s=+e,this.l=+o,this.opacity=+s}ie(L,pr,qe(wt,{brighter(n){return n=n==null?zt:Math.pow(zt,n),new L(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?mt:Math.pow(mt,n),new L(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,o=this.l,s=o+(o<.5?o:1-o)*e,c=2*o-s;return new F(Vt(n>=240?n-240:n+120,c,s),Vt(n,c,s),Vt(n<120?n+240:n-120,c,s),this.opacity)},clamp(){return new L(we(this.h),xt(this.s),xt(this.l),$t(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=$t(this.opacity);return`${n===1?"hsl(":"hsla("}${we(this.h)}, ${xt(this.s)*100}%, ${xt(this.l)*100}%${n===1?")":`, ${n})`}`}}));function we(n){return n=(n||0)%360,n<0?n+360:n}function xt(n){return Math.max(0,Math.min(1,n||0))}function Vt(n,e,o){return(n<60?e+(o-e)*n/60:n<180?o:n<240?e+(o-e)*(240-n)/60:e)*255}const Le=n=>()=>n;function gr(n,e){return function(o){return n+o*e}}function vr(n,e,o){return n=Math.pow(n,o),e=Math.pow(e,o)-n,o=1/o,function(s){return Math.pow(n+s*e,o)}}function yr(n){return(n=+n)==1?Ye:function(e,o){return o-e?vr(e,o,n):Le(isNaN(e)?o:e)}}function Ye(n,e){var o=e-n;return o?gr(n,o):Le(isNaN(n)?e:n)}const _e=function n(e){var o=yr(e);function s(c,u){var d=o((c=Gt(c)).r,(u=Gt(u)).r),m=o(c.g,u.g),_=o(c.b,u.b),ue=Ye(c.opacity,u.opacity);return function(gn){return c.r=d(gn),c.g=m(gn),c.b=_(gn),c.opacity=ue(gn),c+""}}return s.gamma=n,s}(1);function j(n,e){return n=+n,e=+e,function(o){return n*(1-o)+e*o}}var Kt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Lt=new RegExp(Kt.source,"g");function wr(n){return function(){return n}}function _r(n){return function(e){return n(e)+""}}function xr(n,e){var o=Kt.lastIndex=Lt.lastIndex=0,s,c,u,d=-1,m=[],_=[];for(n=n+"",e=e+"";(s=Kt.exec(n))&&(c=Lt.exec(e));)(u=c.index)>o&&(u=e.slice(o,u),m[d]?m[d]+=u:m[++d]=u),(s=s[0])===(c=c[0])?m[d]?m[d]+=c:m[++d]=c:(m[++d]=null,_.push({i:d,x:j(s,c)})),o=Lt.lastIndex;return o<e.length&&(u=e.slice(o),m[d]?m[d]+=u:m[++d]=u),m.length<2?_[0]?_r(_[0].x):wr(e):(e=_.length,function(ue){for(var gn=0,nh;gn<e;++gn)m[(nh=_[gn]).i]=nh.x(ue);return m.join("")})}var xe=180/Math.PI,Zt={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Oe(n,e,o,s,c,u){var d,m,_;return(d=Math.sqrt(n*n+e*e))&&(n/=d,e/=d),(_=n*o+e*s)&&(o-=n*_,s-=e*_),(m=Math.sqrt(o*o+s*s))&&(o/=m,s/=m,_/=m),n*s<e*o&&(n=-n,e=-e,_=-_,d=-d),{translateX:c,translateY:u,rotate:Math.atan2(e,n)*xe,skewX:Math.atan(_)*xe,scaleX:d,scaleY:m}}var bt;function br(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?Zt:Oe(e.a,e.b,e.c,e.d,e.e,e.f)}function kr(n){return n==null||(bt||(bt=document.createElementNS("http://www.w3.org/2000/svg","g")),bt.setAttribute("transform",n),!(n=bt.transform.baseVal.consolidate()))?Zt:(n=n.matrix,Oe(n.a,n.b,n.c,n.d,n.e,n.f))}function We(n,e,o,s){function c(ue){return ue.length?ue.pop()+" ":""}function u(ue,gn,nh,ih,rh,oh){if(ue!==nh||gn!==ih){var lh=rh.push("translate(",null,e,null,o);oh.push({i:lh-4,x:j(ue,nh)},{i:lh-2,x:j(gn,ih)})}else(nh||ih)&&rh.push("translate("+nh+e+ih+o)}function d(ue,gn,nh,ih){ue!==gn?(ue-gn>180?gn+=360:gn-ue>180&&(ue+=360),ih.push({i:nh.push(c(nh)+"rotate(",null,s)-2,x:j(ue,gn)})):gn&&nh.push(c(nh)+"rotate("+gn+s)}function m(ue,gn,nh,ih){ue!==gn?ih.push({i:nh.push(c(nh)+"skewX(",null,s)-2,x:j(ue,gn)}):gn&&nh.push(c(nh)+"skewX("+gn+s)}function _(ue,gn,nh,ih,rh,oh){if(ue!==nh||gn!==ih){var lh=rh.push(c(rh)+"scale(",null,",",null,")");oh.push({i:lh-4,x:j(ue,nh)},{i:lh-2,x:j(gn,ih)})}else(nh!==1||ih!==1)&&rh.push(c(rh)+"scale("+nh+","+ih+")")}return function(ue,gn){var nh=[],ih=[];return ue=n(ue),gn=n(gn),u(ue.translateX,ue.translateY,gn.translateX,gn.translateY,nh,ih),d(ue.rotate,gn.rotate,nh,ih),m(ue.skewX,gn.skewX,nh,ih),_(ue.scaleX,ue.scaleY,gn.scaleX,gn.scaleY,nh,ih),ue=gn=null,function(rh){for(var oh=-1,lh=ih.length,ch;++oh<lh;)nh[(ch=ih[oh]).i]=ch.x(rh);return nh.join("")}}}var Mr=We(br,"px, ","px)","deg)"),Nr=We(kr,", ",")",")"),Er=1e-12;function be(n){return((n=Math.exp(n))+1/n)/2}function Cr(n){return((n=Math.exp(n))-1/n)/2}function Sr(n){return((n=Math.exp(2*n))-1)/(n+1)}const zr=function n(e,o,s){function c(u,d){var m=u[0],_=u[1],ue=u[2],gn=d[0],nh=d[1],ih=d[2],rh=gn-m,oh=nh-_,lh=rh*rh+oh*oh,ch,dh;if(lh<Er)dh=Math.log(ih/ue)/e,ch=function(Ch){return[m+Ch*rh,_+Ch*oh,ue*Math.exp(e*Ch*dh)]};else{var _h=Math.sqrt(lh),Sh=(ih*ih-ue*ue+s*lh)/(2*ue*o*_h),fh=(ih*ih-ue*ue-s*lh)/(2*ih*o*_h),yh=Math.log(Math.sqrt(Sh*Sh+1)-Sh),mh=Math.log(Math.sqrt(fh*fh+1)-fh);dh=(mh-yh)/e,ch=function(Ch){var Mh=Ch*dh,Ph=be(yh),Eh=ue/(o*_h)*(Ph*Sr(e*Mh+yh)-Cr(yh));return[m+Eh*rh,_+Eh*oh,ue*Ph/be(e*Mh+yh)]}}return ch.duration=dh*1e3*e/Math.SQRT2,ch}return c.rho=function(u){var d=Math.max(.001,+u),m=d*d,_=m*m;return n(d,m,_)},c}(Math.SQRT2,2,4);var at=0,ht=0,ct=0,Ue=1e3,At,dt,Tt=0,it=0,Ft=0,vt=typeof performance=="object"&&performance.now?performance:Date,Ge=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function re(){return it||(Ge($r),it=vt.now()+Ft)}function $r(){it=0}function Rt(){this._call=this._time=this._next=null}Rt.prototype=Ke.prototype={constructor:Rt,restart:function(n,e,o){if(typeof n!="function")throw new TypeError("callback is not a function");o=(o==null?re():+o)+(e==null?0:+e),!this._next&&dt!==this&&(dt?dt._next=this:At=this,dt=this),this._call=n,this._time=o,Qt()},stop:function(){this._call&&(this._call=null,this._time=1/0,Qt())}};function Ke(n,e,o){var s=new Rt;return s.restart(n,e,o),s}function Ar(){re(),++at;for(var n=At,e;n;)(e=it-n._time)>=0&&n._call.call(void 0,e),n=n._next;--at}function ke(){it=(Tt=vt.now())+Ft,at=ht=0;try{Ar()}finally{at=0,Rr(),it=0}}function Tr(){var n=vt.now(),e=n-Tt;e>Ue&&(Ft-=e,Tt=n)}function Rr(){for(var n,e=At,o,s=1/0;e;)e._call?(s>e._time&&(s=e._time),n=e,e=e._next):(o=e._next,e._next=null,e=n?n._next=o:At=o);dt=n,Qt(s)}function Qt(n){if(!at){ht&&(ht=clearTimeout(ht));var e=n-it;e>24?(n<1/0&&(ht=setTimeout(ke,n-vt.now()-Ft)),ct&&(ct=clearInterval(ct))):(ct||(Tt=vt.now(),ct=setInterval(Tr,Ue)),at=1,Ge(ke))}}function Me(n,e,o){var s=new Rt;return e=e==null?0:+e,s.restart(c=>{s.stop(),n(c+e)},e,o),s}var Dr=te("start","end","cancel","interrupt"),Fr=[],Ze=0,Ne=1,Jt=2,Nt=3,Ee=4,jt=5,Et=6;function It(n,e,o,s,c,u){var d=n.__transition;if(!d)n.__transition={};else if(o in d)return;Ir(n,o,{name:e,index:s,group:c,on:Dr,tween:Fr,time:u.time,delay:u.delay,duration:u.duration,ease:u.ease,timer:null,state:Ze})}function oe(n,e){var o=Y(n,e);if(o.state>Ze)throw new Error("too late; already scheduled");return o}function W(n,e){var o=Y(n,e);if(o.state>Nt)throw new Error("too late; already running");return o}function Y(n,e){var o=n.__transition;if(!o||!(o=o[e]))throw new Error("transition not found");return o}function Ir(n,e,o){var s=n.__transition,c;s[e]=o,o.timer=Ke(u,0,o.time);function u(ue){o.state=Ne,o.timer.restart(d,o.delay,o.time),o.delay<=ue&&d(ue-o.delay)}function d(ue){var gn,nh,ih,rh;if(o.state!==Ne)return _();for(gn in s)if(rh=s[gn],rh.name===o.name){if(rh.state===Nt)return Me(d);rh.state===Ee?(rh.state=Et,rh.timer.stop(),rh.on.call("interrupt",n,n.__data__,rh.index,rh.group),delete s[gn]):+gn<e&&(rh.state=Et,rh.timer.stop(),rh.on.call("cancel",n,n.__data__,rh.index,rh.group),delete s[gn])}if(Me(function(){o.state===Nt&&(o.state=Ee,o.timer.restart(m,o.delay,o.time),m(ue))}),o.state=Jt,o.on.call("start",n,n.__data__,o.index,o.group),o.state===Jt){for(o.state=Nt,c=new Array(ih=o.tween.length),gn=0,nh=-1;gn<ih;++gn)(rh=o.tween[gn].value.call(n,n.__data__,o.index,o.group))&&(c[++nh]=rh);c.length=nh+1}}function m(ue){for(var gn=ue<o.duration?o.ease.call(null,ue/o.duration):(o.timer.restart(_),o.state=jt,1),nh=-1,ih=c.length;++nh<ih;)c[nh].call(n,gn);o.state===jt&&(o.on.call("end",n,n.__data__,o.index,o.group),_())}function _(){o.state=Et,o.timer.stop(),delete s[e];for(var ue in s)return;delete n.__transition}}function Ct(n,e){var o=n.__transition,s,c,u=!0,d;if(o){e=e==null?null:e+"";for(d in o){if((s=o[d]).name!==e){u=!1;continue}c=s.state>Jt&&s.state<jt,s.state=Et,s.timer.stop(),s.on.call(c?"interrupt":"cancel",n,n.__data__,s.index,s.group),delete o[d]}u&&delete n.__transition}}function Hr(n){return this.each(function(){Ct(this,n)})}function Pr(n,e){var o,s;return function(){var c=W(this,n),u=c.tween;if(u!==o){s=o=u;for(var d=0,m=s.length;d<m;++d)if(s[d].name===e){s=s.slice(),s.splice(d,1);break}}c.tween=s}}function Br(n,e,o){var s,c;if(typeof o!="function")throw new Error;return function(){var u=W(this,n),d=u.tween;if(d!==s){c=(s=d).slice();for(var m={name:e,value:o},_=0,ue=c.length;_<ue;++_)if(c[_].name===e){c[_]=m;break}_===ue&&c.push(m)}u.tween=c}}function Xr(n,e){var o=this._id;if(n+="",arguments.length<2){for(var s=Y(this.node(),o).tween,c=0,u=s.length,d;c<u;++c)if((d=s[c]).name===n)return d.value;return null}return this.each((e==null?Pr:Br)(o,n,e))}function se(n,e,o){var s=n._id;return n.each(function(){var c=W(this,s);(c.value||(c.value={}))[e]=o.apply(this,arguments)}),function(c){return Y(c,s).value[e]}}function Qe(n,e){var o;return(typeof e=="number"?j:e instanceof gt?_e:(o=gt(e))?(e=o,_e):xr)(n,e)}function qr(n){return function(){this.removeAttribute(n)}}function Vr(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Lr(n,e,o){var s,c=o+"",u;return function(){var d=this.getAttribute(n);return d===c?null:d===s?u:u=e(s=d,o)}}function Yr(n,e,o){var s,c=o+"",u;return function(){var d=this.getAttributeNS(n.space,n.local);return d===c?null:d===s?u:u=e(s=d,o)}}function Or(n,e,o){var s,c,u;return function(){var d,m=o(this),_;return m==null?void this.removeAttribute(n):(d=this.getAttribute(n),_=m+"",d===_?null:d===s&&_===c?u:(c=_,u=e(s=d,m)))}}function Wr(n,e,o){var s,c,u;return function(){var d,m=o(this),_;return m==null?void this.removeAttributeNS(n.space,n.local):(d=this.getAttributeNS(n.space,n.local),_=m+"",d===_?null:d===s&&_===c?u:(c=_,u=e(s=d,m)))}}function Ur(n,e){var o=Dt(n),s=o==="transform"?Nr:Qe;return this.attrTween(n,typeof e=="function"?(o.local?Wr:Or)(o,s,se(this,"attr."+n,e)):e==null?(o.local?Vr:qr)(o):(o.local?Yr:Lr)(o,s,e))}function Gr(n,e){return function(o){this.setAttribute(n,e.call(this,o))}}function Kr(n,e){return function(o){this.setAttributeNS(n.space,n.local,e.call(this,o))}}function Zr(n,e){var o,s;function c(){var u=e.apply(this,arguments);return u!==s&&(o=(s=u)&&Kr(n,u)),o}return c._value=e,c}function Qr(n,e){var o,s;function c(){var u=e.apply(this,arguments);return u!==s&&(o=(s=u)&&Gr(n,u)),o}return c._value=e,c}function Jr(n,e){var o="attr."+n;if(arguments.length<2)return(o=this.tween(o))&&o._value;if(e==null)return this.tween(o,null);if(typeof e!="function")throw new Error;var s=Dt(n);return this.tween(o,(s.local?Zr:Qr)(s,e))}function jr(n,e){return function(){oe(this,n).delay=+e.apply(this,arguments)}}function to(n,e){return e=+e,function(){oe(this,n).delay=e}}function eo(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?jr:to)(e,n)):Y(this.node(),e).delay}function no(n,e){return function(){W(this,n).duration=+e.apply(this,arguments)}}function io(n,e){return e=+e,function(){W(this,n).duration=e}}function ro(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?no:io)(e,n)):Y(this.node(),e).duration}function oo(n,e){if(typeof e!="function")throw new Error;return function(){W(this,n).ease=e}}function so(n){var e=this._id;return arguments.length?this.each(oo(e,n)):Y(this.node(),e).ease}function ao(n,e){return function(){var o=e.apply(this,arguments);if(typeof o!="function")throw new Error;W(this,n).ease=o}}function uo(n){if(typeof n!="function")throw new Error;return this.each(ao(this._id,n))}function lo(n){typeof n!="function"&&(n=Ae(n));for(var e=this._groups,o=e.length,s=new Array(o),c=0;c<o;++c)for(var u=e[c],d=u.length,m=s[c]=[],_,ue=0;ue<d;++ue)(_=u[ue])&&n.call(_,_.__data__,ue,u)&&m.push(_);return new Q(s,this._parents,this._name,this._id)}function co(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,o=n._groups,s=e.length,c=o.length,u=Math.min(s,c),d=new Array(s),m=0;m<u;++m)for(var _=e[m],ue=o[m],gn=_.length,nh=d[m]=new Array(gn),ih,rh=0;rh<gn;++rh)(ih=_[rh]||ue[rh])&&(nh[rh]=ih);for(;m<s;++m)d[m]=e[m];return new Q(d,this._parents,this._name,this._id)}function fo(n){return(n+"").trim().split(/^|\s+/).every(function(e){var o=e.indexOf(".");return o>=0&&(e=e.slice(0,o)),!e||e==="start"})}function ho(n,e,o){var s,c,u=fo(e)?oe:W;return function(){var d=u(this,n),m=d.on;m!==s&&(c=(s=m).copy()).on(e,o),d.on=c}}function mo(n,e){var o=this._id;return arguments.length<2?Y(this.node(),o).on.on(n):this.each(ho(o,n,e))}function po(n){return function(){var e=this.parentNode;for(var o in this.__transition)if(+o!==n)return;e&&e.removeChild(this)}}function go(){return this.on("end.remove",po(this._id))}function vo(n){var e=this._name,o=this._id;typeof n!="function"&&(n=ee(n));for(var s=this._groups,c=s.length,u=new Array(c),d=0;d<c;++d)for(var m=s[d],_=m.length,ue=u[d]=new Array(_),gn,nh,ih=0;ih<_;++ih)(gn=m[ih])&&(nh=n.call(gn,gn.__data__,ih,m))&&("__data__"in gn&&(nh.__data__=gn.__data__),ue[ih]=nh,It(ue[ih],e,o,ih,ue,Y(gn,o)));return new Q(u,this._parents,e,o)}function yo(n){var e=this._name,o=this._id;typeof n!="function"&&(n=$e(n));for(var s=this._groups,c=s.length,u=[],d=[],m=0;m<c;++m)for(var _=s[m],ue=_.length,gn,nh=0;nh<ue;++nh)if(gn=_[nh]){for(var ih=n.call(gn,gn.__data__,nh,_),rh,oh=Y(gn,o),lh=0,ch=ih.length;lh<ch;++lh)(rh=ih[lh])&&It(rh,e,o,lh,ih,oh);u.push(ih),d.push(gn)}return new Q(u,d,e,o)}var wo=yt.prototype.constructor;function _o(){return new wo(this._groups,this._parents)}function xo(n,e){var o,s,c;return function(){var u=st(this,n),d=(this.style.removeProperty(n),st(this,n));return u===d?null:u===o&&d===s?c:c=e(o=u,s=d)}}function Je(n){return function(){this.style.removeProperty(n)}}function bo(n,e,o){var s,c=o+"",u;return function(){var d=st(this,n);return d===c?null:d===s?u:u=e(s=d,o)}}function ko(n,e,o){var s,c,u;return function(){var d=st(this,n),m=o(this),_=m+"";return m==null&&(_=m=(this.style.removeProperty(n),st(this,n))),d===_?null:d===s&&_===c?u:(c=_,u=e(s=d,m))}}function Mo(n,e){var o,s,c,u="style."+e,d="end."+u,m;return function(){var _=W(this,n),ue=_.on,gn=_.value[u]==null?m||(m=Je(e)):void 0;(ue!==o||c!==gn)&&(s=(o=ue).copy()).on(d,c=gn),_.on=s}}function No(n,e,o){var s=(n+="")=="transform"?Mr:Qe;return e==null?this.styleTween(n,xo(n,s)).on("end.style."+n,Je(n)):typeof e=="function"?this.styleTween(n,ko(n,s,se(this,"style."+n,e))).each(Mo(this._id,n)):this.styleTween(n,bo(n,s,e),o).on("end.style."+n,null)}function Eo(n,e,o){return function(s){this.style.setProperty(n,e.call(this,s),o)}}function Co(n,e,o){var s,c;function u(){var d=e.apply(this,arguments);return d!==c&&(s=(c=d)&&Eo(n,d,o)),s}return u._value=e,u}function So(n,e,o){var s="style."+(n+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(e==null)return this.tween(s,null);if(typeof e!="function")throw new Error;return this.tween(s,Co(n,e,o??""))}function zo(n){return function(){this.textContent=n}}function $o(n){return function(){var e=n(this);this.textContent=e??""}}function Ao(n){return this.tween("text",typeof n=="function"?$o(se(this,"text",n)):zo(n==null?"":n+""))}function To(n){return function(e){this.textContent=n.call(this,e)}}function Ro(n){var e,o;function s(){var c=n.apply(this,arguments);return c!==o&&(e=(o=c)&&To(c)),e}return s._value=n,s}function Do(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,Ro(n))}function Fo(){for(var n=this._name,e=this._id,o=je(),s=this._groups,c=s.length,u=0;u<c;++u)for(var d=s[u],m=d.length,_,ue=0;ue<m;++ue)if(_=d[ue]){var gn=Y(_,e);It(_,n,o,ue,d,{time:gn.time+gn.delay+gn.duration,delay:0,duration:gn.duration,ease:gn.ease})}return new Q(s,this._parents,n,o)}function Io(){var n,e,o=this,s=o._id,c=o.size();return new Promise(function(u,d){var m={value:d},_={value:function(){--c===0&&u()}};o.each(function(){var ue=W(this,s),gn=ue.on;gn!==n&&(e=(n=gn).copy(),e._.cancel.push(m),e._.interrupt.push(m),e._.end.push(_)),ue.on=e}),c===0&&u()})}var Ho=0;function Q(n,e,o,s){this._groups=n,this._parents=e,this._name=o,this._id=s}function je(){return++Ho}var K=yt.prototype;Q.prototype={constructor:Q,select:vo,selectAll:yo,selectChild:K.selectChild,selectChildren:K.selectChildren,filter:lo,merge:co,selection:_o,transition:Fo,call:K.call,nodes:K.nodes,node:K.node,size:K.size,empty:K.empty,each:K.each,on:mo,attr:Ur,attrTween:Jr,style:No,styleTween:So,text:Ao,textTween:Do,remove:go,tween:Xr,delay:eo,duration:ro,ease:so,easeVarying:uo,end:Io,[Symbol.iterator]:K[Symbol.iterator]};function Po(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var Bo={time:null,delay:0,duration:250,ease:Po};function Xo(n,e){for(var o;!(o=n.__transition)||!(o=o[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return o}function qo(n){var e,o;n instanceof Q?(e=n._id,n=n._name):(e=je(),(o=Bo).time=re(),n=n==null?null:n+"");for(var s=this._groups,c=s.length,u=0;u<c;++u)for(var d=s[u],m=d.length,_,ue=0;ue<m;++ue)(_=d[ue])&&It(_,n,e,ue,d,o||Xo(_,e));return new Q(s,this._parents,n,e)}yt.prototype.interrupt=Hr;yt.prototype.transition=qo;const kt=n=>()=>n;function Vo(n,{sourceEvent:e,target:o,transform:s,dispatch:c}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:c}})}function Z(n,e,o){this.k=n,this.x=e,this.y=o}Z.prototype={constructor:Z,scale:function(n){return n===1?this:new Z(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new Z(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ae=new Z(1,0,0);Z.prototype;function Yt(n){n.stopImmediatePropagation()}function ft(n){n.preventDefault(),n.stopImmediatePropagation()}function Lo(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function Yo(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function Ce(){return this.__zoom||ae}function Oo(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function Wo(){return navigator.maxTouchPoints||"ontouchstart"in this}function Uo(n,e,o){var s=n.invertX(e[0][0])-o[0][0],c=n.invertX(e[1][0])-o[1][0],u=n.invertY(e[0][1])-o[0][1],d=n.invertY(e[1][1])-o[1][1];return n.translate(c>s?(s+c)/2:Math.min(0,s)||Math.max(0,c),d>u?(u+d)/2:Math.min(0,u)||Math.max(0,d))}function Go(){var n=Lo,e=Yo,o=Uo,s=Oo,c=Wo,u=[0,1/0],d=[[-1/0,-1/0],[1/0,1/0]],m=250,_=zr,ue=te("start","zoom","end"),gn,nh,ih,rh=500,oh=150,lh=0,ch=10;function dh(gh){gh.property("__zoom",Ce).on("wheel.zoom",Mh,{passive:!1}).on("mousedown.zoom",Ph).on("dblclick.zoom",Eh).filter(c).on("touchstart.zoom",Nh).on("touchmove.zoom",Wh).on("touchend.zoom touchcancel.zoom",Yh).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}dh.transform=function(gh,Ah,wh,$h){var Rh=gh.selection?gh.selection():gh;Rh.property("__zoom",Ce),gh!==Rh?yh(gh,Ah,wh,$h):Rh.interrupt().each(function(){mh(this,arguments).event($h).start().zoom(null,typeof Ah=="function"?Ah.apply(this,arguments):Ah).end()})},dh.scaleBy=function(gh,Ah,wh,$h){dh.scaleTo(gh,function(){var Rh=this.__zoom.k,Oh=typeof Ah=="function"?Ah.apply(this,arguments):Ah;return Rh*Oh},wh,$h)},dh.scaleTo=function(gh,Ah,wh,$h){dh.transform(gh,function(){var Rh=e.apply(this,arguments),Oh=this.__zoom,Lh=wh==null?fh(Rh):typeof wh=="function"?wh.apply(this,arguments):wh,qh=Oh.invert(Lh),Hh=typeof Ah=="function"?Ah.apply(this,arguments):Ah;return o(Sh(_h(Oh,Hh),Lh,qh),Rh,d)},wh,$h)},dh.translateBy=function(gh,Ah,wh,$h){dh.transform(gh,function(){return o(this.__zoom.translate(typeof Ah=="function"?Ah.apply(this,arguments):Ah,typeof wh=="function"?wh.apply(this,arguments):wh),e.apply(this,arguments),d)},null,$h)},dh.translateTo=function(gh,Ah,wh,$h,Rh){dh.transform(gh,function(){var Oh=e.apply(this,arguments),Lh=this.__zoom,qh=$h==null?fh(Oh):typeof $h=="function"?$h.apply(this,arguments):$h;return o(ae.translate(qh[0],qh[1]).scale(Lh.k).translate(typeof Ah=="function"?-Ah.apply(this,arguments):-Ah,typeof wh=="function"?-wh.apply(this,arguments):-wh),Oh,d)},$h,Rh)};function _h(gh,Ah){return Ah=Math.max(u[0],Math.min(u[1],Ah)),Ah===gh.k?gh:new Z(Ah,gh.x,gh.y)}function Sh(gh,Ah,wh){var $h=Ah[0]-wh[0]*gh.k,Rh=Ah[1]-wh[1]*gh.k;return $h===gh.x&&Rh===gh.y?gh:new Z(gh.k,$h,Rh)}function fh(gh){return[(+gh[0][0]+ +gh[1][0])/2,(+gh[0][1]+ +gh[1][1])/2]}function yh(gh,Ah,wh,$h){gh.on("start.zoom",function(){mh(this,arguments).event($h).start()}).on("interrupt.zoom end.zoom",function(){mh(this,arguments).event($h).end()}).tween("zoom",function(){var Rh=this,Oh=arguments,Lh=mh(Rh,Oh).event($h),qh=e.apply(Rh,Oh),Hh=wh==null?fh(qh):typeof wh=="function"?wh.apply(Rh,Oh):wh,Xh=Math.max(qh[1][0]-qh[0][0],qh[1][1]-qh[0][1]),Qh=Rh.__zoom,Th=typeof Ah=="function"?Ah.apply(Rh,Oh):Ah,Fh=_(Qh.invert(Hh).concat(Xh/Qh.k),Th.invert(Hh).concat(Xh/Th.k));return function(Dh){if(Dh===1)Dh=Th;else{var Gh=Fh(Dh),Jh=Xh/Gh[2];Dh=new Z(Jh,Hh[0]-Gh[0]*Jh,Hh[1]-Gh[1]*Jh)}Lh.zoom(null,Dh)}})}function mh(gh,Ah,wh){return!wh&&gh.__zooming||new Ch(gh,Ah)}function Ch(gh,Ah){this.that=gh,this.args=Ah,this.active=0,this.sourceEvent=null,this.extent=e.apply(gh,Ah),this.taps=0}Ch.prototype={event:function(gh){return gh&&(this.sourceEvent=gh),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(gh,Ah){return this.mouse&&gh!=="mouse"&&(this.mouse[1]=Ah.invert(this.mouse[0])),this.touch0&&gh!=="touch"&&(this.touch0[1]=Ah.invert(this.touch0[0])),this.touch1&&gh!=="touch"&&(this.touch1[1]=Ah.invert(this.touch1[0])),this.that.__zoom=Ah,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(gh){var Ah=tt(this.that).datum();ue.call(gh,this.that,new Vo(gh,{sourceEvent:this.sourceEvent,target:dh,type:gh,transform:this.that.__zoom,dispatch:ue}),Ah)}};function Mh(gh,...Ah){if(!n.apply(this,arguments))return;var wh=mh(this,Ah).event(gh),$h=this.__zoom,Rh=Math.max(u[0],Math.min(u[1],$h.k*Math.pow(2,s.apply(this,arguments)))),Oh=J(gh);if(wh.wheel)(wh.mouse[0][0]!==Oh[0]||wh.mouse[0][1]!==Oh[1])&&(wh.mouse[1]=$h.invert(wh.mouse[0]=Oh)),clearTimeout(wh.wheel);else{if($h.k===Rh)return;wh.mouse=[Oh,$h.invert(Oh)],Ct(this),wh.start()}ft(gh),wh.wheel=setTimeout(Lh,oh),wh.zoom("mouse",o(Sh(_h($h,Rh),wh.mouse[0],wh.mouse[1]),wh.extent,d));function Lh(){wh.wheel=null,wh.end()}}function Ph(gh,...Ah){if(ih||!n.apply(this,arguments))return;var wh=gh.currentTarget,$h=mh(this,Ah,!0).event(gh),Rh=tt(gh.view).on("mousemove.zoom",Hh,!0).on("mouseup.zoom",Xh,!0),Oh=J(gh,wh),Lh=gh.clientX,qh=gh.clientY;nr(gh.view),Yt(gh),$h.mouse=[Oh,this.__zoom.invert(Oh)],Ct(this),$h.start();function Hh(Qh){if(ft(Qh),!$h.moved){var Th=Qh.clientX-Lh,Fh=Qh.clientY-qh;$h.moved=Th*Th+Fh*Fh>lh}$h.event(Qh).zoom("mouse",o(Sh($h.that.__zoom,$h.mouse[0]=J(Qh,wh),$h.mouse[1]),$h.extent,d))}function Xh(Qh){Rh.on("mousemove.zoom mouseup.zoom",null),ir(Qh.view,$h.moved),ft(Qh),$h.event(Qh).end()}}function Eh(gh,...Ah){if(n.apply(this,arguments)){var wh=this.__zoom,$h=J(gh.changedTouches?gh.changedTouches[0]:gh,this),Rh=wh.invert($h),Oh=wh.k*(gh.shiftKey?.5:2),Lh=o(Sh(_h(wh,Oh),$h,Rh),e.apply(this,Ah),d);ft(gh),m>0?tt(this).transition().duration(m).call(yh,Lh,$h,gh):tt(this).call(dh.transform,Lh,$h,gh)}}function Nh(gh,...Ah){if(n.apply(this,arguments)){var wh=gh.touches,$h=wh.length,Rh=mh(this,Ah,gh.changedTouches.length===$h).event(gh),Oh,Lh,qh,Hh;for(Yt(gh),Lh=0;Lh<$h;++Lh)qh=wh[Lh],Hh=J(qh,this),Hh=[Hh,this.__zoom.invert(Hh),qh.identifier],Rh.touch0?!Rh.touch1&&Rh.touch0[2]!==Hh[2]&&(Rh.touch1=Hh,Rh.taps=0):(Rh.touch0=Hh,Oh=!0,Rh.taps=1+!!gn);gn&&(gn=clearTimeout(gn)),Oh&&(Rh.taps<2&&(nh=Hh[0],gn=setTimeout(function(){gn=null},rh)),Ct(this),Rh.start())}}function Wh(gh,...Ah){if(this.__zooming){var wh=mh(this,Ah).event(gh),$h=gh.changedTouches,Rh=$h.length,Oh,Lh,qh,Hh;for(ft(gh),Oh=0;Oh<Rh;++Oh)Lh=$h[Oh],qh=J(Lh,this),wh.touch0&&wh.touch0[2]===Lh.identifier?wh.touch0[0]=qh:wh.touch1&&wh.touch1[2]===Lh.identifier&&(wh.touch1[0]=qh);if(Lh=wh.that.__zoom,wh.touch1){var Xh=wh.touch0[0],Qh=wh.touch0[1],Th=wh.touch1[0],Fh=wh.touch1[1],Dh=(Dh=Th[0]-Xh[0])*Dh+(Dh=Th[1]-Xh[1])*Dh,Gh=(Gh=Fh[0]-Qh[0])*Gh+(Gh=Fh[1]-Qh[1])*Gh;Lh=_h(Lh,Math.sqrt(Dh/Gh)),qh=[(Xh[0]+Th[0])/2,(Xh[1]+Th[1])/2],Hh=[(Qh[0]+Fh[0])/2,(Qh[1]+Fh[1])/2]}else if(wh.touch0)qh=wh.touch0[0],Hh=wh.touch0[1];else return;wh.zoom("touch",o(Sh(Lh,qh,Hh),wh.extent,d))}}function Yh(gh,...Ah){if(this.__zooming){var wh=mh(this,Ah).event(gh),$h=gh.changedTouches,Rh=$h.length,Oh,Lh;for(Yt(gh),ih&&clearTimeout(ih),ih=setTimeout(function(){ih=null},rh),Oh=0;Oh<Rh;++Oh)Lh=$h[Oh],wh.touch0&&wh.touch0[2]===Lh.identifier?delete wh.touch0:wh.touch1&&wh.touch1[2]===Lh.identifier&&delete wh.touch1;if(wh.touch1&&!wh.touch0&&(wh.touch0=wh.touch1,delete wh.touch1),wh.touch0)wh.touch0[1]=this.__zoom.invert(wh.touch0[0]);else if(wh.end(),wh.taps===2&&(Lh=J(Lh,this),Math.hypot(nh[0]-Lh[0],nh[1]-Lh[1])<ch)){var qh=tt(this).on("dblclick.zoom");qh&&qh.apply(this,arguments)}}}return dh.wheelDelta=function(gh){return arguments.length?(s=typeof gh=="function"?gh:kt(+gh),dh):s},dh.filter=function(gh){return arguments.length?(n=typeof gh=="function"?gh:kt(!!gh),dh):n},dh.touchable=function(gh){return arguments.length?(c=typeof gh=="function"?gh:kt(!!gh),dh):c},dh.extent=function(gh){return arguments.length?(e=typeof gh=="function"?gh:kt([[+gh[0][0],+gh[0][1]],[+gh[1][0],+gh[1][1]]]),dh):e},dh.scaleExtent=function(gh){return arguments.length?(u[0]=+gh[0],u[1]=+gh[1],dh):[u[0],u[1]]},dh.translateExtent=function(gh){return arguments.length?(d[0][0]=+gh[0][0],d[1][0]=+gh[1][0],d[0][1]=+gh[0][1],d[1][1]=+gh[1][1],dh):[[d[0][0],d[0][1]],[d[1][0],d[1][1]]]},dh.constrain=function(gh){return arguments.length?(o=gh,dh):o},dh.duration=function(gh){return arguments.length?(m=+gh,dh):m},dh.interpolate=function(gh){return arguments.length?(_=gh,dh):_},dh.on=function(){var gh=ue.on.apply(ue,arguments);return gh===ue?dh:gh},dh.clickDistance=function(gh){return arguments.length?(lh=(gh=+gh)*gh,dh):Math.sqrt(lh)},dh.tapDistance=function(gh){return arguments.length?(ch=+gh,dh):ch},dh}const tn=Symbol("MiniMapSlots"),Ko=defineComponent({name:"MiniMapNode",compatConfig:{MODE:3},props:["id","position","dimensions","strokeWidth","strokeColor","borderRadius","color","shapeRendering","type"],emits:["click","dblclick","mouseenter","mousemove","mouseleave"],setup(n,{attrs:e,emit:o}){const s=inject(tn);return()=>{const c=e.style??{},u=s[`node-${n.type}`];return u?u(n):h$1("rect",{id:n.id,class:["vue-flow__minimap-node",e.class].join(" "),style:c,x:n.position.x,y:n.position.y,rx:n.borderRadius,ry:n.borderRadius,width:n.dimensions.width,height:n.dimensions.height,fill:n.color||c.background||c.backgroundColor,stroke:n.strokeColor,strokeWidth:n.strokeWidth,shapeRendering:n.shapeRendering,onClick:d=>o("click",d),onDblClick:d=>o("dblclick",d),onMouseenter:d=>o("mouseenter",d),onMousemove:d=>o("mousemove",d),onMouseleave:d=>o("mouseleave",d)})}}}),Zo=["width","height","viewBox","aria-labelledby"],Qo=["id"],Jo=["d","fill","stroke","stroke-width"],jo={name:"MiniMap",compatConfig:{MODE:3}},ns=defineComponent({...jo,props:{nodeColor:{type:[String,Function],default:"#e2e2e2"},nodeStrokeColor:{type:[String,Function],default:"transparent"},nodeClassName:{type:[String,Function]},nodeBorderRadius:{default:5},nodeStrokeWidth:{default:2},maskColor:{default:"rgb(240, 240, 240, 0.6)"},maskStrokeColor:{default:"none"},maskStrokeWidth:{default:1},position:{default:"bottom-right"},pannable:{type:Boolean,default:!1},zoomable:{type:Boolean,default:!1},width:null,height:null,ariaLabel:{default:"Vue Flow mini map"},inversePan:{type:Boolean,default:!1},zoomStep:{default:10}},emits:["click","nodeClick","nodeDblclick","nodeMouseenter","nodeMousemove","nodeMouseleave"],setup(n,{emit:e}){const o=useAttrs(),s=200,c=150,{id:u,edges:d,viewport:m,translateExtent:_,dimensions:ue,emits:gn,nodes:nh,d3Selection:ih,d3Zoom:rh}=ve$1(),oh=ref$1();provide(tn,useSlots());const lh=computed(()=>{var $h;return n.width??(($h=o.style)==null?void 0:$h.width)??s}),ch=computed(()=>{var $h;return n.height??(($h=o.style)==null?void 0:$h.height)??c}),dh=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision",_h=computed(()=>n.nodeColor instanceof Function?n.nodeColor:()=>n.nodeColor),Sh=computed(()=>n.nodeStrokeColor instanceof Function?n.nodeStrokeColor:()=>n.nodeStrokeColor),fh=computed(()=>n.nodeClassName instanceof Function?n.nodeClassName:()=>n.nodeClassName),yh=computed(()=>No$1(nh.value)),mh=computed(()=>({x:-m.value.x/m.value.zoom,y:-m.value.y/m.value.zoom,width:ue.value.width/m.value.zoom,height:ue.value.height/m.value.zoom})),Ch=computed(()=>nh.value&&nh.value.length?Gd(yh.value,mh.value):mh.value),Mh=computed(()=>{const $h=Ch.value.width/lh.value,Rh=Ch.value.height/ch.value;return Math.max($h,Rh)}),Ph=computed(()=>{const $h=Mh.value*lh.value,Rh=Mh.value*ch.value,Oh=5*Mh.value;return{offset:Oh,x:Ch.value.x-($h-Ch.value.width)/2-Oh,y:Ch.value.y-(Rh-Ch.value.height)/2-Oh,width:$h+Oh*2,height:Rh+Oh*2}}),Eh=computed(()=>!Ph.value.x||!Ph.value.y?"":`
    M${Ph.value.x-Ph.value.offset},${Ph.value.y-Ph.value.offset}
    h${Ph.value.width+Ph.value.offset*2}
    v${Ph.value.height+Ph.value.offset*2}
    h${-Ph.value.width-Ph.value.offset*2}z
    M${mh.value.x},${mh.value.y}
    h${mh.value.width}
    v${mh.value.height}
    h${-mh.value.width}z`);watchEffect($h=>{if(oh.value){const Rh=tt(oh.value),Oh=Hh=>{if(Hh.sourceEvent.type!=="wheel"||!ih.value||!rh.value)return;const Xh=-Hh.sourceEvent.deltaY*(Hh.sourceEvent.deltaMode===1?.05:Hh.sourceEvent.deltaMode?1:.002)*n.zoomStep,Qh=m.value.zoom*2**Xh;rh.value.scaleTo(ih.value,Qh)},Lh=Hh=>{if(Hh.sourceEvent.type!=="mousemove"||!ih.value||!rh.value)return;const Xh=Mh.value*Math.max(1,m.value.zoom)*(n.inversePan?-1:1),Qh={x:m.value.x-Hh.sourceEvent.movementX*Xh,y:m.value.y-Hh.sourceEvent.movementY*Xh},Th=[[0,0],[ue.value.width,ue.value.height]],Fh=ae.translate(Qh.x,Qh.y).scale(m.value.zoom),Dh=rh.value.constrain()(Fh,Th,_.value);rh.value.transform(ih.value,Dh)},qh=Go().on("zoom",n.pannable?Lh:()=>{}).on("zoom.wheel",n.zoomable?Oh:()=>{});Rh.call(qh),$h(()=>{Rh.on("zoom",null)})}},{flush:"post"});function Nh($h){const[Rh,Oh]=J($h);e("click",{event:$h,position:{x:Rh,y:Oh}})}function Wh($h,Rh){const Oh={event:$h,node:Rh,connectedEdges:_n$1([Rh],d.value)};gn.miniMapNodeClick(Oh),e("nodeClick",Oh)}function Yh($h,Rh){const Oh={event:$h,node:Rh,connectedEdges:_n$1([Rh],d.value)};gn.miniMapNodeDoubleClick(Oh),e("nodeDblclick",Oh)}function gh($h,Rh){const Oh={event:$h,node:Rh,connectedEdges:_n$1([Rh],d.value)};gn.miniMapNodeMouseEnter(Oh),e("nodeMouseenter",Oh)}function Ah($h,Rh){const Oh={event:$h,node:Rh,connectedEdges:_n$1([Rh],d.value)};gn.miniMapNodeMouseMove(Oh),e("nodeMousemove",Oh)}function wh($h,Rh){const Oh={event:$h,node:Rh,connectedEdges:_n$1([Rh],d.value)};gn.miniMapNodeMouseLeave(Oh),e("nodeMouseleave",Oh)}return($h,Rh)=>(openBlock(),createBlock(unref(qd),{position:n.position,class:normalizeClass(["vue-flow__minimap",{pannable:n.pannable,zoomable:n.zoomable}])},{default:withCtx(()=>[(openBlock(),createElementBlock("svg",{ref_key:"el",ref:oh,width:unref(lh),height:unref(ch),viewBox:[unref(Ph).x,unref(Ph).y,unref(Ph).width,unref(Ph).height].join(" "),role:"img","aria-labelledby":`vue-flow__minimap-${unref(u)}`,onClick:Nh},[n.ariaLabel?(openBlock(),createElementBlock("title",{key:0,id:`vue-flow__minimap-${unref(u)}`},toDisplayString(n.ariaLabel),9,Qo)):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(nh),Oh=>(openBlock(),createBlock(unref(Ko),{id:Oh.id,key:Oh.id,position:Oh.computedPosition,dimensions:Oh.dimensions,style:normalizeStyle(Oh.style),class:normalizeClass(unref(fh)(Oh)),color:unref(_h)(Oh),"border-radius":n.nodeBorderRadius,"stroke-color":unref(Sh)(Oh),"stroke-width":n.nodeStrokeWidth,"shape-rendering":unref(dh),type:Oh.type,onClick:Lh=>Wh(Lh,Oh),onDblclick:Lh=>Yh(Lh,Oh),onMouseenter:Lh=>gh(Lh,Oh),onMousemove:Lh=>Ah(Lh,Oh),onMouseleave:Lh=>wh(Lh,Oh)},null,8,["id","position","dimensions","style","class","color","border-radius","stroke-color","stroke-width","shape-rendering","type","onClick","onDblclick","onMouseenter","onMousemove","onMouseleave"]))),128)),createBaseVNode("path",{class:"vue-flow__minimap-mask",d:unref(Eh),fill:n.maskColor,stroke:n.maskStrokeColor,"stroke-width":n.maskStrokeWidth,"fill-rule":"evenodd"},null,8,Jo)],8,Zo))]),_:1},8,["position","class"]))}}),VueFlow_vue_vue_type_style_index_0_lang="",_hoisted_1$2={class:"updatenode__controls"},_hoisted_2$1={key:0},_hoisted_3$1=createBaseVNode("label",{class:"updatenode__bglabel"},"background:",-1),_hoisted_4$1={key:1},_hoisted_5$1=createBaseVNode("label",{class:"updatenode__bglabel"},"storke:",-1),_hoisted_6$1={key:2},_hoisted_7$1=createBaseVNode("label",{class:"updatenode__bglabel"},"labelBgStyle:",-1),_hoisted_8$1={key:3},_hoisted_9$1=createBaseVNode("label",{class:"updatenode__bglabel"},"type:",-1),_hoisted_10$1=createBaseVNode("option",{value:"default"},"default",-1),_hoisted_11$1=createBaseVNode("option",{value:"smoothstep"},"smoothstep",-1),_hoisted_12$1=createBaseVNode("option",{value:"step"},"step",-1),_hoisted_13$1=[_hoisted_10$1,_hoisted_11$1,_hoisted_12$1],_hoisted_14$1={class:"updatenode__checkboxwrapper"},_hoisted_15$1=createBaseVNode("label",null,"hidden:",-1),_hoisted_16$1={key:4,class:"updatenode__checkboxwrapper"},_hoisted_17$1=createBaseVNode("label",null,"animated:",-1),_sfc_main$2={__name:"VueFlow",props:["modelValue"],emits:["update:modelValue"],setup(n,{emit:e}){const o=n;let s=0;function c(){return`dnd${s++}`}const u=computed({get(){return o.modelValue},set(Eh){if(Eh!==u.value){const Nh=Eh.map(Yh=>({id:Yh.id,type:Yh.type,label:Yh.label,position:Yh.position,style:Yh.style,class:Yh.Class,hidden:Yh.hidden,animated:Yh.animated,source:Yh.source,target:Yh.target,labelBgStyle:Yh.labelBgStyle})),Wh=JSON.stringify(Nh,null,2).replace(/"(\w+)"\s*:/g,"$1:").replace(/["]/g,"'");e("update:modelValue",Wh),Eh.map(Yh=>{var gh,Ah,wh;Yh.id===mh&&(yh.bg=(gh=Yh.style)==null?void 0:gh.background,yh.stroke=(Ah=Yh.style)==null?void 0:Ah.stroke,yh.type=Yh.type,yh.labelBgStyle.fill=(wh=Yh.labelBgStyle)==null?void 0:wh.fill,yh.label=Yh.label,yh.hidden=Yh.hidden)})}}});watch(()=>u.value,Eh=>{Eh&&(u.value=Eh.map(Nh=>(Nh.position===void 0&&(Nh.position={x:Math.random()*_h.value.width,y:Math.random()*_h.value.height}),Nh)))},{deep:!0});const{onPaneReady:d,findNode:m,onNodeDragStop:_,onConnect:ue,onEdgeUpdate:gn,updateEdge:nh,addEdges:ih,addNodes:rh,getSelectedElements:oh,getElements:lh,project:ch,vueFlowRef:dh,dimensions:_h}=ve$1({});d(({fitView:Eh})=>{Eh(),setTimeout(()=>{Eh()},100)}),_(Eh=>{const Nh=Eh.node;u.value=u.value.map(Wh=>(Wh.id===Nh.id&&(Wh.position={x:Math.round(Nh.position.x),y:Math.round(Nh.position.y)}),Wh))});function Sh(Eh){Eh.preventDefault(),Eh.dataTransfer&&(Eh.dataTransfer.dropEffect="move")}function fh(Eh){var wh;const Nh=(wh=Eh.dataTransfer)==null?void 0:wh.getData("application/vueflow"),{left:Wh,top:Yh}=dh.value.getBoundingClientRect(),gh=ch({x:Eh.clientX-Wh,y:Eh.clientY-Yh}),Ah={id:c(),type:Nh,position:gh,label:`${Nh} node`};rh([Ah]),nextTick(()=>{const $h=m(Ah.id),Rh=watch(()=>$h.dimensions,Oh=>{Oh.width>0&&Oh.height>0&&($h.position={x:$h.position.x-$h.dimensions.width/2,y:$h.position.y-$h.dimensions.height/2},Rh())},{deep:!0,flush:"post"})})}ue(Eh=>ih([Eh])),gn(({edge:Eh,connection:Nh})=>nh(Eh,Nh));const yh=reactive({bg:null,stroke:null,type:null,labelBgStyle:{fill:null},label:null,hidden:null});let mh="1",Ch=!1;onMounted(()=>{lh.value.map(Nh=>{Nh.id===mh&&(mh.slice(0,1)==="e"||mh.slice(0,1)==="v"?Ch=!0:Ch=!1,yh.label=Nh.label?Nh.label:"",yh.hidden=Nh.hidden,Nh.style&&(yh.bg=Nh.style.backgroundColor),Ch&&(Nh.labelBgStyle&&(yh.labelBgStyle.fill=Nh.labelBgStyle.fill?Nh.labelBgStyle.fill:""),yh.animated=Nh.animated?Nh.animated:!1,yh.type=Nh.type?Nh.type:"default",Nh.style&&(yh.stroke=Nh.style.stroke?Nh.style.stroke:"")))})});function Mh(){const Eh=oh.value[0];Eh&&(mh=Eh.id,mh.slice(0,1)==="e"||mh.slice(0,1)==="v"?Ch=!0:Ch=!1,yh.label=Eh.label?Eh.label:"",yh.hidden=Eh.hidden,yh.bg=Eh.style?Eh.style.backgroundColor:"",Ch&&(yh.labelBgStyle.fill=Eh.labelBgStyle?Eh.labelBgStyle.fill:"",yh.animated=Eh.animated?Eh.animated:!1,yh.type=Eh.type?Eh.type:"default",yh.stroke=Eh.style?Eh.style.stroke:""))}function Ph(Eh){u.value=u.value.map(Nh=>(Nh.id===mh&&(Eh==="label"&&(Nh.label=yh.label!==""?yh.label:""),Eh==="bg"&&(Nh.style={backgroundColor:yh.bg}),Eh==="hidden"&&(Nh.hidden=yh.hidden),Ch&&(Eh==="stroke"&&(Nh.style={stroke:yh.stroke}),Eh==="labelBgStyle"&&(Nh.labelBgStyle={fill:yh.labelBgStyle.fill}),Eh==="animated"&&(Nh.animated=yh.animated),Eh==="type"&&(Nh.type=yh.type))),Nh))}return(Eh,Nh)=>(openBlock(),createElementBlock("div",{class:"dndflow",onDrop:fh,onClick:Mh},[createVNode(Sidebar),createVNode(unref(Kd),{modelValue:unref(u),"onUpdate:modelValue":Nh[14]||(Nh[14]=Wh=>isRef(u)?u.value=Wh:null),"only-render-visible-elements":!0,"fit-view-on-init":"",class:"basicflow","edges-updatable":!0,"zoom-on-double-click":!1,"default-viewport":{zoom:1.5},"min-zoom":.2,"max-zoom":4,onDragover:Sh},{default:withCtx(()=>[createVNode(unref(A)),createBaseVNode("div",_hoisted_1$2,[createBaseVNode("div",null,[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Nh[0]||(Nh[0]=Wh=>yh.label=Wh),onInput:Nh[1]||(Nh[1]=Wh=>Ph("label")),placeholder:"label"},null,544),[[vModelText,yh.label]])]),unref(Ch)?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_2$1,[_hoisted_3$1,withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Nh[2]||(Nh[2]=Wh=>yh.bg=Wh),type:"color",onInput:Nh[3]||(Nh[3]=Wh=>Ph("bg"))},null,544),[[vModelText,yh.bg]])])),unref(Ch)?(openBlock(),createElementBlock("div",_hoisted_4$1,[_hoisted_5$1,withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Nh[4]||(Nh[4]=Wh=>yh.stroke=Wh),type:"color",onInput:Nh[5]||(Nh[5]=Wh=>Ph("stroke"))},null,544),[[vModelText,yh.stroke]])])):createCommentVNode("",!0),unref(Ch)&&yh.labelBgStyle?(openBlock(),createElementBlock("div",_hoisted_6$1,[_hoisted_7$1,withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Nh[6]||(Nh[6]=Wh=>yh.labelBgStyle.fill=Wh),type:"color",onInput:Nh[7]||(Nh[7]=Wh=>Ph("labelBgStyle"))},null,544),[[vModelText,yh.labelBgStyle.fill]])])):createCommentVNode("",!0),unref(Ch)?(openBlock(),createElementBlock("div",_hoisted_8$1,[_hoisted_9$1,withDirectives(createBaseVNode("select",{"onUpdate:modelValue":Nh[8]||(Nh[8]=Wh=>yh.type=Wh),onChange:Nh[9]||(Nh[9]=Wh=>Ph("type"))},_hoisted_13$1,544),[[vModelSelect,yh.type]])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_14$1,[_hoisted_15$1,withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Nh[10]||(Nh[10]=Wh=>yh.hidden=Wh),type:"checkbox",onChange:Nh[11]||(Nh[11]=Wh=>Ph("hidden"))},null,544),[[vModelCheckbox,yh.hidden]])]),unref(Ch)?(openBlock(),createElementBlock("div",_hoisted_16$1,[_hoisted_17$1,withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Nh[12]||(Nh[12]=Wh=>yh.animated=Wh),type:"checkbox",onChange:Nh[13]||(Nh[13]=Wh=>Ph("animated"))},null,544),[[vModelCheckbox,yh.animated]])])):createCommentVNode("",!0)]),createVNode(unref(ns)),createVNode(unref(fo$1))]),_:1},8,["modelValue","default-viewport","min-zoom"])],32))}},HomeView_vue_vue_type_style_index_0_lang="",_hoisted_1$1={class:"wrapper"},_sfc_main$1={__name:"HomeView",setup(__props){const flowStore=useFlowStore(),db=getDatabase();flowStore.flows=useDatabaseList(ref(db,`users/${flowStore.userId}/flows`));const extensions=[json(),oneDark],view=shallowRef(),handleReady=n=>{view.value=n.view},permision=ref$1(!0),codeObj=computed({get(){if(flowStore.selectedFlow){const validator=()=>{try{return eval(flowStore.selectedFlow),!0}catch(n){return!1}};if(validator()===!0){const validateId=eval(flowStore.selectedFlow).every(n=>n.id);if(validateId)return eval(flowStore.selectedFlow)}}},set(n){permision.value&&n!==flowStore.selectedFlow&&flowStore.updateFlow(n)}});return(n,e)=>(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",null,[createVNode(unref(T$2),{modelValue:unref(flowStore).selectedFlow,"onUpdate:modelValue":e[0]||(e[0]=o=>unref(flowStore).updateFlow(o)),placeholder:"Code goes here...",style:{height:"100%"},autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions,onReady:handleReady,onFocus:e[1]||(e[1]=o=>permision.value=!1),onBlur:e[2]||(e[2]=o=>permision.value=!0)},null,8,["modelValue"])]),createBaseVNode("div",null,[createVNode(_sfc_main$2,{modelValue:unref(codeObj),"onUpdate:modelValue":e[3]||(e[3]=o=>isRef(codeObj)?codeObj.value=o:null)},null,8,["modelValue"])])]))}},Auth_vue_vue_type_style_index_0_scoped_0cf2678f_lang="",_withScopeId=n=>(pushScopeId("data-v-0cf2678f"),n=n(),popScopeId(),n),_hoisted_1={id:"login"},_hoisted_2={key:0,id:"description"},_hoisted_3=_withScopeId(()=>createBaseVNode("h1",null,"Login",-1)),_hoisted_4=_withScopeId(()=>createBaseVNode("p",null,"By logging in you agree to the ridiculously long terms that you didn't bother to read.",-1)),_hoisted_5=[_hoisted_3,_hoisted_4],_hoisted_6={key:1,id:"description"},_hoisted_7=_withScopeId(()=>createBaseVNode("h1",null,"Sing up",-1)),_hoisted_8=_withScopeId(()=>createBaseVNode("p",null," By creating an account you agree to the ridiculously long terms that you didn't bother to read. ",-1)),_hoisted_9=[_hoisted_7,_hoisted_8],_hoisted_10={id:"form"},_hoisted_11=["onSubmit"],_hoisted_12=_withScopeId(()=>createBaseVNode("label",{for:"email"},"Email",-1)),_hoisted_13=_withScopeId(()=>createBaseVNode("label",{for:"password"},"Password",-1)),_hoisted_14=["type"],_hoisted_15=_withScopeId(()=>createBaseVNode("button",{type:"submit"},"Log in",-1)),_hoisted_16=["onSubmit"],_hoisted_17=_withScopeId(()=>createBaseVNode("label",{for:"email"},"Email",-1)),_hoisted_18=_withScopeId(()=>createBaseVNode("label",{for:"password"},"Password",-1)),_hoisted_19=["type"],_hoisted_20=_withScopeId(()=>createBaseVNode("button",{type:"submit"},"Sing up",-1)),_sfc_main={__name:"Auth",setup(n){const e=useFlowStore(),o=ref$1(""),s=ref$1(""),c=ref$1(!0),u=ref$1(""),d=ref$1(""),m=ref$1(!0),_=computed(()=>c.value?"fa-eye":"fa-eye-slash"),ue=computed(()=>c.value?"password":"text"),gn=useRouter(),nh=ref$1("login"),ih=async()=>{await signInWithEmailAndPassword(getAuth(),o.value,s.value).then(lh=>{i("Successfully logged in!",{type:"success"}),e.user=lh.user,gn.push("/")}).catch(lh=>{switch(lh.code){case"auth/invalid-email":i("Invalid email",{type:"error"});break;case"auth/user-not-found":i("No account with that email was found",{type:"error"});break;case"auth/wrong-password":i("Incorrect password",{type:"error"});break;default:i("Email or password was incorrect",{type:"error"});break}})},rh=async()=>{await createUserWithEmailAndPassword(getAuth(),u.value,d.value).then(lh=>{i("Successfully logged in!",{type:"success"}),e.user=lh.user,gn.push("/")}).catch(lh=>{switch(lh.code){case"auth/invalid-email":i("Invalid email",{type:"error"});break;case"auth/user-not-found":i("No account with that email was found",{type:"error"});break;case"auth/wrong-password":i("Incorrect password",{type:"error"});break;default:i("Email or password was incorrect",{type:"error"});break}})},oh=async()=>{const lh=new GoogleAuthProvider;try{const ch=await signInWithPopup(getAuth(),lh);ch.user&&(i("Successfully logged in!",{type:"success"}),e.user=ch.user,gn.push("/"))}catch(ch){i(`Something went wrong ${ch}`,{type:"error"})}};return(lh,ch)=>(openBlock(),createElementBlock("div",_hoisted_1,[nh.value==="login"?(openBlock(),createElementBlock("div",_hoisted_2,_hoisted_5)):createCommentVNode("",!0),nh.value==="singup"?(openBlock(),createElementBlock("div",_hoisted_6,_hoisted_9)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_10,[nh.value==="login"?(openBlock(),createElementBlock("form",{key:0,onSubmit:withModifiers(ih,["prevent"])},[_hoisted_12,withDirectives(createBaseVNode("input",{type:"text",id:"email","onUpdate:modelValue":ch[0]||(ch[0]=dh=>o.value=dh),placeholder:"elon@musk.io",autocomplete:"off"},null,512),[[vModelText,o.value]]),_hoisted_13,createTextVNode(" "),createBaseVNode("i",{class:normalizeClass(["fas",[unref(_)]]),onClick:ch[1]||(ch[1]=dh=>c.value=!c.value)},null,2),withDirectives(createBaseVNode("input",{type:unref(ue),id:"password","onUpdate:modelValue":ch[2]||(ch[2]=dh=>s.value=dh),placeholder:"**********"},null,8,_hoisted_14),[[vModelDynamic,s.value]]),_hoisted_15,createBaseVNode("button",{class:"outline",onClick:ch[3]||(ch[3]=dh=>nh.value="singup")},"Sing up")],40,_hoisted_11)):createCommentVNode("",!0),nh.value==="singup"?(openBlock(),createElementBlock("form",{key:1,onSubmit:withModifiers(rh,["prevent"])},[_hoisted_17,withDirectives(createBaseVNode("input",{type:"text",id:"email","onUpdate:modelValue":ch[4]||(ch[4]=dh=>u.value=dh),placeholder:"elon@musk.io",autocomplete:"off"},null,512),[[vModelText,u.value]]),_hoisted_18,createTextVNode(" "),createBaseVNode("i",{class:normalizeClass(["fas",[unref(_)]]),onClick:ch[5]||(ch[5]=dh=>m.value=!m.value)},null,2),withDirectives(createBaseVNode("input",{type:unref(ue),id:"password","onUpdate:modelValue":ch[6]||(ch[6]=dh=>d.value=dh),placeholder:"**********"},null,8,_hoisted_19),[[vModelDynamic,d.value]]),_hoisted_20,createBaseVNode("button",{class:"outline",onClick:ch[7]||(ch[7]=dh=>nh.value="login")},"Log in")],40,_hoisted_16)):createCommentVNode("",!0),createBaseVNode("button",{class:"outline",onClick:oh},"Google")])]))}},Auth=_export_sfc(_sfc_main,[["__scopeId","data-v-0cf2678f"]]),router=createRouter({history:createWebHistory("/mermaid/"),routes:[{path:"/",name:"home",component:_sfc_main$1},{path:"/auth",name:"auth",component:Auth}]});router.beforeEach(async n=>{if(n.meta.requiresAuth&&!await getCurrentUser())return{path:"/auth",query:{redirect:n.fullPath}}});const main="",app=createApp(_sfc_main$4),firebaseConfig={apiKey:"AIzaSyA8HX4muv5mNgGgQSOoXwUQ80BaVQ7woSE",authDomain:"mermeid-316df.firebaseapp.com",projectId:"mermeid-316df",storageBucket:"mermeid-316df.appspot.com",messagingSenderId:"778367453854",appId:"1:778367453854:web:2d5e4990ceea083e1dc98f",measurementId:"G-13QDXNHTHG",databaseURL:"https://mermeid-316df-default-rtdb.europe-west1.firebasedatabase.app/"},firebaseApp=initializeApp(firebaseConfig);getDatabase(firebaseApp);app.use(VueFire,{firebaseApp,modules:[VueFireAuth()]});const pinia=createPinia();app.use(pinia);pinia.use(src_default);app.use(W$5,{autofocus:!0,disabled:!1,indentWithTab:!0,tabSize:2,placeholder:"Code goes here...",extensions:[basicSetup]});app.use(dt$2,{autoClose:3e3,position:i.POSITION.TOP_RIGHT});app.use(router);app.mount("#app");
